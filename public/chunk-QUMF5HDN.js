import{b as ge}from"./chunk-ISZQ6G3H.js";import"./chunk-GGQ7LRWG.js";import{c as ne,d as re,f as J,g as le}from"./chunk-P2GLRHRS.js";import{a as me,b as ue}from"./chunk-WKNXHDPQ.js";import{b as de}from"./chunk-VPTHVLTQ.js";import{k as pe}from"./chunk-YDT6XDAL.js";import"./chunk-LMZWYZYD.js";import{b as se,c as ce}from"./chunk-JYNQ7DY3.js";import{g as oe,j as ae}from"./chunk-DDKTLT4U.js";import{Ab as B,Eb as F,Gb as x,Ma as Y,Oa as r,Sb as G,Ta as A,U as Q,Ub as m,Vb as D,Wb as h,Za as Z,ca as b,da as C,dc as X,gc as u,hc as _,ic as q,n as K,nb as O,ob as M,qb as ee,rb as te,sb as ie,tb as I,ub as d,vb as p,wb as N}from"./chunk-PTIYVII4.js";import{j as P}from"./chunk-K4ALXBGI.js";function fe(a,v,z){return P(this,arguments,function*(n,l,t,s={}){let{especialidadFiltro:k,incluirDatosDinamicos:H=!0}=s,w=l;if(k&&(w=l.filter(e=>e.especialidadNombre===k)),w.sort((e,i)=>new Date(i.fechaHora).getTime()-new Date(e.fechaHora).getTime()),w.length===0)throw new Error("No hay citas para exportar con los filtros aplicados");let E=[];E.push({titulo:"Datos del Paciente",encabezados:["Campo","Valor"],filas:[["Nombre completo",`${n.nombre} ${n.apellido}`],["DNI",n.dni.toString()],["Edad",n.edad.toString()],["Email",n.email],["Obra Social",n.obraSocial||"No registrada"]]});let W=[...new Set(w.map(e=>e.especialidadNombre))];E.push({titulo:"Resumen de Atenciones",encabezados:["Especialidad","Cantidad de Consultas"],filas:W.map(e=>[e,w.filter(i=>i.especialidadNombre===e).length])}),w.forEach((e,i)=>{let g=new Date(e.fechaHora),T=g.toLocaleDateString("es-AR",{day:"2-digit",month:"2-digit",year:"numeric"}),$=g.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"}),f=[["Fecha",T],["Hora",$],["Especialidad",e.especialidadNombre],["Especialista",e.especialistaNombreCompleto],["Estado",e.estado]];(e.alturaCm||e.pesoKg||e.temperaturaC||e.presionArterial)&&(f.push(["--- Signos Vitales ---","---"]),e.alturaCm&&f.push(["Altura",`${e.alturaCm} cm`]),e.pesoKg&&f.push(["Peso",`${e.pesoKg} kg`]),e.temperaturaC&&f.push(["Temperatura",`${e.temperaturaC} \xB0C`]),e.presionArterial&&f.push(["Presi\xF3n Arterial",e.presionArterial])),e.comentarioPaciente&&(f.push(["--- Comentarios ---","---"]),f.push(["Comentario del paciente",e.comentarioPaciente])),e.comentarioEspecialista&&f.push(["Comentario del especialista",e.comentarioEspecialista]),e.resenia&&f.push(["Rese\xF1a",e.resenia]),H&&e.datosDinamicos&&e.datosDinamicos.length>0&&(f.push(["--- Datos Adicionales ---","---"]),e.datosDinamicos.forEach(V=>{f.push([V.clave,V.valor])})),E.push({titulo:`Consulta ${w.length-i} - ${e.especialidadNombre}`,subtitulo:`${T} ${$}`,encabezados:["Campo","Informaci\xF3n"],filas:f})}),yield t.exportarAPdfMultiplesSecciones(E,{titulo:`Historia Cl\xEDnica - ${n.nombre} ${n.apellido}`,nombreArchivo:`historia_clinica_${n.dni}`,incluirFecha:!0,incluirLogo:!0,logoPath:"assets/imagenes/logo_png.png",colorEncabezado:[53,112,221]})})}function xe(n){let l=new Set(n.map(t=>t.especialidadNombre));return Array.from(l).sort()}var R=class n{exportarAPdf(l,t){return P(this,null,function*(){let{titulo:s="Documento",subtitulo:a,nombreArchivo:v,incluirFecha:z=!0,incluirLogo:k=!0,logoPath:H="assets/imagenes/logo_png.png",orientacion:w="portrait",colorEncabezado:E=[53,112,221]}=t,[{default:W},{default:e}]=yield Promise.all([import("./chunk-4GOUPJ26.js"),import("./chunk-GH6CWWPP.js")]),i=new W({orientation:w}),g=i.internal.pageSize.getWidth(),T=i.internal.pageSize.getHeight(),$=(y=10)=>{let o=y;if(k){let c=new Image;return c.src=H,new Promise(S=>{c.onload=()=>{if(i.addImage(c,"PNG",15,o,35,35),i.setFontSize(16),i.setFont("helvetica","bold"),i.setTextColor(53,112,221),i.text("Centro M\xE9dico Insua",58,o+12),z){i.setFontSize(9),i.setFont("helvetica","normal"),i.setTextColor(100,100,100);let U=`Emitido: ${new Date().toLocaleDateString("es-AR",{day:"2-digit",month:"long",year:"numeric"})}`;i.text(U,g-15,o+12,{align:"right"})}i.setDrawColor(53,112,221),i.setLineWidth(.5),i.line(15,o+35+5,g-15,o+35+5),i.setTextColor(0,0,0),S(o+35+15)}})}else{i.setFontSize(18),i.setFont("helvetica","bold"),i.setTextColor(53,112,221);let c="Centro M\xE9dico Insua",S=i.getTextWidth(c);if(i.text(c,(g-S)/2,o+8),z){i.setFontSize(9),i.setFont("helvetica","normal"),i.setTextColor(100,100,100);let L=`Emitido: ${new Date().toLocaleDateString("es-AR",{day:"2-digit",month:"long",year:"numeric"})}`;i.text(L,g-15,o+8,{align:"right"})}return i.setDrawColor(53,112,221),i.setLineWidth(.5),i.line(15,o+15,g-15,o+15),i.setTextColor(0,0,0),Promise.resolve(o+25)}},f=()=>{i.setFontSize(8),i.setFont("helvetica","italic"),i.setTextColor(150,150,150),i.text("Centro M\xE9dico Insua - Documento Confidencial",g/2,T-10,{align:"center"}),i.setTextColor(0,0,0)},V=()=>P(null,null,function*(){let y=yield $();yield j(y),f();let o=v;if(z){let c=new Date().toISOString().slice(0,10);o=`${v}_${c}`}i.save(`${o}.pdf`)}),j=y=>P(null,null,function*(){let o=y;if(s){i.setFillColor(53,112,221),i.roundedRect(15,o-5,g-30,15,2,2,"F"),i.setFontSize(16),i.setFont("helvetica","bold"),i.setTextColor(255,255,255);let c=i.getTextWidth(s);i.text(s,(g-c)/2,o+5),i.setTextColor(0,0,0),o+=20}if(a){i.setFontSize(11),i.setFont("helvetica","italic"),i.setTextColor(80,80,80);let c=i.getTextWidth(a);i.text(a,(g-c)/2,o),i.setTextColor(0,0,0),o+=10}e(i,{head:[l.encabezados],body:l.filas,startY:o,margin:{left:15,right:15},headStyles:{fillColor:E,textColor:255,halign:"center",fontStyle:"bold",fontSize:10,cellPadding:5},styles:{halign:"center",fontSize:9,cellPadding:4,lineColor:[200,200,200],lineWidth:.1},alternateRowStyles:{fillColor:[245,245,245]},tableLineColor:[200,200,200],tableLineWidth:.1})});V()})}exportarAPdfMultiplesSecciones(l,t){return P(this,null,function*(){let{titulo:s="Documento",nombreArchivo:a,incluirFecha:v=!0,incluirLogo:z=!0,logoPath:k="assets/imagenes/logo_png.png",orientacion:H="portrait",colorEncabezado:w=[53,112,221]}=t,[{default:E},{default:W}]=yield Promise.all([import("./chunk-4GOUPJ26.js"),import("./chunk-GH6CWWPP.js")]),e=new E({orientation:H}),i=e.internal.pageSize.getWidth(),g=e.internal.pageSize.getHeight(),T=1,$=(y=10)=>{let o=y;if(z){let c=new Image;return c.src=k,new Promise(S=>{c.onload=()=>{if(e.addImage(c,"PNG",15,o,35,35),e.setFontSize(16),e.setFont("helvetica","bold"),e.setTextColor(53,112,221),e.text("Centro M\xE9dico Insua",58,o+12),v){e.setFontSize(9),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);let U=`Emitido: ${new Date().toLocaleDateString("es-AR",{day:"2-digit",month:"long",year:"numeric"})}`;e.text(U,i-15,o+12,{align:"right"})}e.setDrawColor(53,112,221),e.setLineWidth(.5),e.line(15,o+35+5,i-15,o+35+5),e.setTextColor(0,0,0),S(o+35+15)}})}else{e.setFontSize(18),e.setFont("helvetica","bold"),e.setTextColor(53,112,221);let c="Centro M\xE9dico Insua",S=e.getTextWidth(c);if(e.text(c,(i-S)/2,o+8),v){e.setFontSize(9),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);let L=`Emitido: ${new Date().toLocaleDateString("es-AR",{day:"2-digit",month:"long",year:"numeric"})}`;e.text(L,i-15,o+8,{align:"right"})}return e.setDrawColor(53,112,221),e.setLineWidth(.5),e.line(15,o+15,i-15,o+15),e.setTextColor(0,0,0),Promise.resolve(o+25)}},f=()=>{e.setDrawColor(200,200,200),e.setLineWidth(.3),e.line(15,g-18,i-15,g-18),e.setFontSize(8),e.setFont("helvetica","italic"),e.setTextColor(120,120,120),e.text("Centro M\xE9dico Insua - Documento Confidencial",i/2,g-12,{align:"center"}),e.setFont("helvetica","normal"),e.text(`P\xE1gina ${T}`,i-20,g-12,{align:"right"}),e.setTextColor(0,0,0)},V=()=>P(null,null,function*(){let y=yield $();yield j(y),f();let o=a;if(v){let c=new Date().toISOString().slice(0,10);o=`${a}_${c}`}e.save(`${o}.pdf`)}),j=y=>P(null,null,function*(){let o=y;if(s){e.setFillColor(53,112,221),e.roundedRect(15,o-5,i-30,16,2,2,"F"),e.setFontSize(16),e.setFont("helvetica","bold"),e.setTextColor(255,255,255);let c=e.getTextWidth(s);e.text(s,(i-c)/2,o+6),e.setTextColor(0,0,0),o+=25}l.forEach(c=>{o>g-60&&(f(),e.addPage(),T++,o=20),c.titulo&&(e.setFillColor(53,112,221),e.rect(15,o-3,3,10,"F"),e.setFontSize(13),e.setFont("helvetica","bold"),e.setTextColor(53,112,221),e.text(c.titulo,22,o+4),e.setTextColor(0,0,0),o+=10),c.subtitulo&&(e.setFontSize(10),e.setFont("helvetica","italic"),e.setTextColor(100,100,100),e.text(c.subtitulo,22,o),e.setTextColor(0,0,0),o+=8),W(e,{head:[c.encabezados],body:c.filas,startY:o,margin:{left:15,right:15},headStyles:{fillColor:w,textColor:255,halign:"center",fontStyle:"bold",fontSize:9,cellPadding:4},styles:{halign:"left",fontSize:8.5,cellPadding:3,lineColor:[220,220,220],lineWidth:.1,textColor:[50,50,50]},alternateRowStyles:{fillColor:[248,248,250]},bodyStyles:{minCellHeight:8},columnStyles:{0:{fontStyle:"bold",cellWidth:60,fillColor:[240,245,250]}},tableLineColor:[200,200,200],tableLineWidth:.1,didDrawPage:S=>{S.pageNumber>T&&(T=S.pageNumber)}}),o=e.lastAutoTable.finalY+12})});V()})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Q({token:n,factory:n.\u0275fac,providedIn:"root"})};var _e=n=>({count:n});function we(n,l){if(n&1){let t=B();d(0,"div",0)(1,"div",2)(2,"div",3)(3,"h1",4),m(4),u(5,"transloco"),p(),d(6,"button",5),F("click",function(){b(t);let a=x(2);return C(a.abrirModalDescarga())}),m(7),u(8,"transloco"),p()(),d(9,"div",6),N(10,"img",7),p(),d(11,"div",8),N(12,"img",9),d(13,"div",10)(14,"p")(15,"strong"),m(16),u(17,"transloco"),p(),m(18),p(),d(19,"p")(20,"strong"),m(21),u(22,"transloco"),p(),m(23),p(),d(24,"p")(25,"strong"),m(26),u(27,"transloco"),p(),m(28),p(),d(29,"p")(30,"strong"),m(31),u(32,"transloco"),p(),m(33),p(),d(34,"p")(35,"strong"),m(36),u(37,"transloco"),p(),m(38),u(39,"transloco"),p(),d(40,"p")(41,"strong"),m(42),u(43,"transloco"),p(),m(44),p()()()()()}if(n&2){let t=x();I("@slideInFromRight",void 0),r(4),h(" ",_(5,17,"perfilPaciente.titulo")," "),r(3),h(" \u{1F4C4} ",_(8,19,"perfilPaciente.descargarHistoria")," "),r(3),I("src",t.urlImagenFondo||"assets/imagenes/banerWelcomePage.webp",Y),r(2),I("src",t.urlImagenPerfil||"assets/imagenes/logo.svg",Y),r(4),D(_(17,21,"perfilPaciente.nombre")),r(2),h(" ",t.nombre," "),r(3),D(_(22,23,"perfilPaciente.apellido")),r(2),h(" ",t.apellido," "),r(3),D(_(27,25,"perfilPaciente.edad")),r(2),h(" ",t.edad," "),r(3),D(_(32,27,"perfilPaciente.dni")),r(2),h(" ",t.dni," "),r(3),D(_(37,29,"perfilPaciente.obraSocial")),r(2),h(" ",t.obraSocial||_(39,31,"perfilPaciente.noRegistrada")," "),r(4),D(_(43,33,"perfilPaciente.email")),r(2),h(" ",t.email," ")}}function ye(n,l){if(n&1){let t=B();d(0,"div",26),F("click",function(){let a=b(t).$implicit,v=x(4);return C(v.seleccionarEspecialidad(a))})("keydown.enter",function(){let a=b(t).$implicit,v=x(4);return C(v.seleccionarEspecialidad(a))})("keydown.space",function(a){let v=b(t).$implicit;return x(4).seleccionarEspecialidad(v),C(a.preventDefault())}),d(1,"div",16),N(2,"input",17),d(3,"div")(4,"p",18),m(5),p(),d(6,"p",19),m(7),u(8,"transloco"),p()()()()}if(n&2){let t=l.$implicit,s=x(4);G("border-azul",s.especialidadSeleccionada===t)("bg-azul-claro",s.especialidadSeleccionada===t),r(2),I("checked",s.especialidadSeleccionada===t),r(3),D(t),r(2),h(" ",q(8,7,"perfilPaciente.modal.consultasCount",X(10,_e,s.contarCitasPorEspecialidad(t)))," ")}}function Se(n,l){if(n&1&&(d(0,"p",23),m(1),u(2,"transloco"),p(),d(3,"div",24),te(4,ye,9,12,"div",25,ee),p()),n&2){let t=x(3);r(),h(" ",_(2,1,"perfilPaciente.modal.filtrarPorEspecialidad")," "),r(3),ie(t.especialidades)}}function Te(n,l){if(n&1){let t=B();d(0,"div",11),F("click",function(){b(t);let a=x(2);return C(a.cerrarModalDescarga())})("keydown.escape",function(){b(t);let a=x(2);return C(a.cerrarModalDescarga())}),d(1,"div",12),F("click",function(a){return b(t),C(a.stopPropagation())})("keydown",function(a){return b(t),C(a.stopPropagation())}),d(2,"h2",13),m(3),u(4,"transloco"),p(),d(5,"p",14),m(6),u(7,"transloco"),p(),d(8,"div",15),F("click",function(){b(t);let a=x(2);return C(a.seleccionarEspecialidad(null))})("keydown.enter",function(){b(t);let a=x(2);return C(a.seleccionarEspecialidad(null))})("keydown.space",function(a){return b(t),x(2).seleccionarEspecialidad(null),C(a.preventDefault())}),d(9,"div",16),N(10,"input",17),d(11,"div")(12,"p",18),m(13),u(14,"transloco"),p(),d(15,"p",19),m(16),u(17,"transloco"),p()()()(),O(18,Se,6,3),d(19,"div",20)(20,"button",21),F("click",function(){b(t);let a=x(2);return C(a.cerrarModalDescarga())}),m(21),u(22,"transloco"),p(),d(23,"button",22),F("click",function(){b(t);let a=x(2);return C(a.descargarHistoriaClinica())}),m(24),u(25,"transloco"),p()()()()}if(n&2){let t=x(2);r(3),h(" ",_(4,13,"perfilPaciente.modal.titulo")," "),r(3),h(" ",_(7,15,"perfilPaciente.modal.descripcion")," "),r(2),G("border-azul",t.especialidadSeleccionada===null)("bg-azul-claro",t.especialidadSeleccionada===null),r(2),I("checked",t.especialidadSeleccionada===null),r(3),h(" ",_(14,17,"perfilPaciente.modal.historiaCompleta")," "),r(3),h(" ",q(17,19,"perfilPaciente.modal.todasEspecialidades",X(26,_e,t.citas.length))," "),r(2),M(t.especialidades.length>0?18:-1),r(3),h(" ",_(22,22,"perfilPaciente.modal.cancelar")," "),r(2),I("disabled",t.especialidadSeleccionada===void 0),r(),h(" ",_(25,24,"perfilPaciente.modal.descargarPdf")," ")}}function Ee(n,l){if(n&1&&(O(0,we,45,35,"div",0),O(1,Te,26,28,"div",1)),n&2){let t=x();M(t.mostrarContenido?0:-1),r(),M(t.mostrarModalDescarga?1:-1)}}var he=class n{constructor(l,t,s,a){this.authSupabase=l;this.loadingOverlay=t;this.turnosService=s;this.exportarPdf=a;this.usuario$=this.authSupabase.user$}usuario$;citas=[];especialidades=[];mostrarModalDescarga=!1;especialidadSeleccionada=null;mostrarContenido=!1;ngOnInit(){return P(this,null,function*(){this.loadingOverlay.hide();let l=yield K(this.usuario$);l&&(console.log("Usuario cargado en ngOnInit:",l.urlImagenFondo),yield this.cargarHistorialClinico(l.id)),setTimeout(()=>{this.mostrarContenido=!0},100)})}cargarHistorialClinico(l){return P(this,null,function*(){try{this.citas=yield this.turnosService.obtenerCitasPaciente(l),this.citas=this.citas.filter(t=>t.estado==="completado"),this.especialidades=xe(this.citas),console.log(`Historia cl\xEDnica cargada: ${this.citas.length} citas`)}catch(t){console.error("Error al cargar historia cl\xEDnica:",t)}})}abrirModalDescarga(){if(this.citas.length===0){alert("No tienes citas completadas para generar la historia cl\xEDnica.");return}this.mostrarModalDescarga=!0}cerrarModalDescarga(){this.mostrarModalDescarga=!1,this.especialidadSeleccionada=null}seleccionarEspecialidad(l){this.especialidadSeleccionada=l}descargarHistoriaClinica(){return P(this,null,function*(){let l=yield K(this.usuario$);if(!l){alert("No se pudo obtener la informaci\xF3n del usuario.");return}try{yield fe(l,this.citas,this.exportarPdf,{especialidadFiltro:this.especialidadSeleccionada||void 0,incluirDatosDinamicos:!0}),this.cerrarModalDescarga()}catch(t){console.error("Error al generar PDF:",t),alert("Error al generar la historia cl\xEDnica. Por favor, intenta nuevamente.")}})}contarCitasPorEspecialidad(l){return this.citas.filter(t=>t.especialidadNombre===l).length}static \u0275fac=function(t){return new(t||n)(A(de),A(pe),A(ge),A(R))};static \u0275cmp=Z({type:n,selectors:[["app-perfil-paciente"]],decls:3,vars:3,consts:[[1,"h-full","w-full","overflow-hidden","p-1"],["role","dialog","aria-modal","true","tabindex","-1",1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/30","backdrop-blur-sm"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mb-6","flex","items-center","justify-between"],[1,"text-4xl","font-bold","text-azul-oscuro"],[1,"hover:bg-azul","rounded-lg","bg-azul-oscuro","px-6","py-3","font-semibold","text-white","shadow-lg","transition-all","hover:scale-105",3,"click"],[1,"mb-6","flex","items-center"],["alt","Portada","appTrackImage","",1,"h-70","w-full","rounded-2xl","object-cover",3,"src"],[1,"mb-8","flex","items-center","gap-8","pt-10","pl-10"],["alt","Avatar","appTrackImage","",1,"h-42","w-42","rounded-full","border-4","border-white","object-cover","shadow-md",3,"src"],[1,"grid","grid-cols-2","gap-x-1","gap-y-1","text-xl","font-normal","text-gray-700",2,"min-width","300px"],["role","dialog","aria-modal","true","tabindex","-1",1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/30","backdrop-blur-sm",3,"click","keydown.escape"],["role","document",1,"w-full","max-w-lg","rounded-xl","bg-white","p-8","shadow-2xl",3,"click","keydown"],[1,"mb-6","text-2xl","font-bold","text-azul-oscuro"],[1,"mb-4","text-gray-600"],["role","button","tabindex","0",1,"hover:border-azul","mb-3","cursor-pointer","rounded-lg","border-2","border-gray-300","p-4","transition-all","hover:bg-azul-claro",3,"click","keydown.enter","keydown.space"],[1,"flex","items-center"],["type","radio","name","especialidad",1,"mr-3","h-5","w-5",3,"checked"],[1,"font-semibold","text-azul-oscuro"],[1,"text-sm","text-gray-600"],[1,"mt-6","flex","gap-3"],[1,"flex-1","rounded-lg","border-2","border-gray-300","bg-white","px-4","py-3","font-semibold","text-gray-700","transition-all","hover:scale-105","hover:border-gray-400","hover:bg-gray-100","hover:shadow-md","active:scale-95",3,"click"],[1,"hover:bg-azul","flex-1","rounded-lg","bg-azul-oscuro","px-4","py-3","font-semibold","text-white","shadow-md","transition-all","hover:scale-105","hover:shadow-xl","active:scale-95","disabled:cursor-not-allowed","disabled:bg-gray-400","disabled:hover:scale-100",3,"click","disabled"],[1,"mt-4","mb-2","text-sm","font-semibold","text-gray-700"],[1,"max-h-80","overflow-y-auto","pr-2",2,"scrollbar-width","thin"],["role","button","tabindex","0",1,"hover:border-azul","mb-3","ml-4","cursor-pointer","rounded-lg","border-2","border-gray-300","p-4","transition-all","hover:bg-azul-claro",3,"border-azul","bg-azul-claro"],["role","button","tabindex","0",1,"hover:border-azul","mb-3","ml-4","cursor-pointer","rounded-lg","border-2","border-gray-300","p-4","transition-all","hover:bg-azul-claro",3,"click","keydown.enter","keydown.space"]],template:function(t,s){if(t&1&&(d(0,"app-loading-wrapper"),O(1,Ee,2,2),u(2,"async"),p()),t&2){let a;r(),M((a=_(2,1,s.usuario$))?1:-1,a)}},dependencies:[ae,ce,me,ue,oe,se],encapsulation:2,data:{animation:[ne("slideInFromRight",[le(":enter",[J({transform:"translateX(150%)",opacity:0}),re("600ms cubic-bezier(0.35, 0, 0.25, 1)",J({transform:"translateX(0)",opacity:1}))])])]}})};export{he as PerfilPaciente};
