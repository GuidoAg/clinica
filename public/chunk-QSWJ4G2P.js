import{a as _e,b as fe}from"./chunk-JXGM5RTB.js";import{a as xe}from"./chunk-VLDSBO4T.js";import{a as Q}from"./chunk-RTOFS77S.js";import{b as Z}from"./chunk-ISZQ6G3H.js";import"./chunk-GGQ7LRWG.js";import{c as H,d as L,f as F,g as q,i as ne,j as re}from"./chunk-P2GLRHRS.js";import{n as U}from"./chunk-M2F6BYP4.js";import{b as me}from"./chunk-VPTHVLTQ.js";import{b as G,c as $,k as pe}from"./chunk-YDT6XDAL.js";import"./chunk-LMZWYZYD.js";import"./chunk-UIGXKFJS.js";import{b as oe,c as R,g as z,h as ce,i as se,j as O,k as le,m as de,n as ue,x as N}from"./chunk-3XECLLOM.js";import"./chunk-FFHKXHWV.js";import{h as ie,i as ae,j as B}from"./chunk-DDKTLT4U.js";import{Ab as g,Eb as p,Gb as l,Oa as s,P as ee,Rb as W,Sb as V,Ta as k,Ub as c,Vb as E,Wb as x,Yb as y,Za as A,Zb as w,_b as P,ca as u,cc as j,da as m,eb as I,f as X,gc as M,hc as te,ic as D,na as b,nb as _,ob as f,qb as T,rb as h,sb as v,tb as C,ub as i,vb as n,wb as J}from"./chunk-PTIYVII4.js";import{j as S}from"./chunk-K4ALXBGI.js";var ye=()=>[1,2,3,4,5],ge=(r,t)=>t.valor;function we(r,t){if(r&1){let e=g();i(0,"button",23),p("click",function(o){let d=u(e).$implicit;return l().setCalificacion(d),m(o.stopPropagation())})("mouseenter",function(){let o=u(e).$implicit,d=l();return m(d.setHover(o))})("mouseleave",function(){u(e);let o=l();return m(o.setHover(0))}),c(1," \u2605 "),n()}if(r&2){let e=t.$implicit,a=l();V("text-yellow-400",e<=(a.estrellasHover||a.calificacionEstrellas))("text-gray-300",e>(a.estrellasHover||a.calificacionEstrellas))}}function Pe(r,t){if(r&1&&(i(0,"span",12),c(1),n()),r&2){let e=l();s(),x(" ",e.calificacionEstrellas," de 5 ")}}function Se(r,t){if(r&1){let e=g();i(0,"label",13)(1,"input",24),P("ngModelChange",function(o){u(e);let d=l();return w(d.seleccionRadio,o)||(d.seleccionRadio=o),m(o)}),n(),i(2,"span",25),c(3),n()()}if(r&2){let e=t.$implicit,a=l();s(),y("ngModel",a.seleccionRadio),C("value",e.valor),s(2),E(e.etiqueta)}}function ke(r,t){if(r&1){let e=g();i(0,"label",13)(1,"input",26),P("ngModelChange",function(o){let d=u(e).$implicit;return w(d.seleccionado,o)||(d.seleccionado=o),m(o)}),n(),i(2,"span",25),c(3),n()()}if(r&2){let e=t.$implicit;s(),y("ngModel",e.seleccionado),C("name","checkbox-"+e.valor),s(2),E(e.etiqueta)}}var K=class r{constructor(t){this.snackBar=t}cita;pacienteId;cerrar=new I;encuestaEnviada=new I;cargando=b(!1);experienciaGeneral="";calificacionEstrellas=0;estrellasHover=0;opcionesRadio=[{valor:"excelente",etiqueta:"Excelente"},{valor:"muy-bueno",etiqueta:"Muy bueno"},{valor:"bueno",etiqueta:"Bueno"},{valor:"regular",etiqueta:"Regular"},{valor:"malo",etiqueta:"Malo"}];seleccionRadio="";opcionesCheckbox=[{valor:"puntualidad",etiqueta:"Puntualidad",seleccionado:!1},{valor:"profesionalismo",etiqueta:"Profesionalismo",seleccionado:!1},{valor:"claridad",etiqueta:"Claridad en las explicaciones",seleccionado:!1},{valor:"empatia",etiqueta:"Empat\xEDa",seleccionado:!1},{valor:"instalaciones",etiqueta:"Instalaciones limpias",seleccionado:!1},{valor:"tiempo-espera",etiqueta:"Poco tiempo de espera",seleccionado:!1},{valor:"seguimiento",etiqueta:"Buen seguimiento",seleccionado:!1},{valor:"recomendaria",etiqueta:"Lo recomendar\xEDa",seleccionado:!1}];valorRango=50;setCalificacion(t){this.calificacionEstrellas=t}setHover(t){this.estrellasHover=t}getCheckboxSeleccionados(){return this.opcionesCheckbox.filter(t=>t.seleccionado).map(t=>t.valor).join(",")}validarFormulario(){return this.experienciaGeneral.trim()?this.calificacionEstrellas===0?(this.snackBar.open("Por favor, seleccione una calificaci\xF3n en estrellas.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]}),!1):this.seleccionRadio?this.getCheckboxSeleccionados()?!0:(this.snackBar.open("Por favor, seleccione al menos un aspecto destacado.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]}),!1):(this.snackBar.open("Por favor, seleccione una opci\xF3n de satisfacci\xF3n general.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]}),!1):(this.snackBar.open("Por favor, comparta su experiencia general.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]}),!1)}enviarEncuesta(){return S(this,null,function*(){if(this.validarFormulario()){this.cargando.set(!0);try{let{error:t}=yield G.from($.ENCUESTAS_PACIENTES).insert([{idPaciente:this.pacienteId,idEspecialista:this.cita.especialistaId,idCita:this.cita.citaId,especialidad:this.cita.especialidadNombre,textBox:this.experienciaGeneral.trim(),estrellas:this.calificacionEstrellas,radioButton:this.seleccionRadio,checkBox:this.getCheckboxSeleccionados(),rango:this.valorRango}]);if(t){console.error("Error al guardar encuesta:",t),this.snackBar.open("Ocurri\xF3 un error al enviar la encuesta.","Cerrar",{duration:4e3,panelClass:["bg-red-600","text-white"]});return}this.snackBar.open("Encuesta enviada exitosamente. \xA1Gracias!","Cerrar",{duration:3e3,panelClass:["bg-green-600","text-white"]}),this.encuestaEnviada.emit(),this.cerrarModal()}catch(t){console.error("Error inesperado:",t),this.snackBar.open("Ocurri\xF3 un error inesperado.","Cerrar",{duration:4e3,panelClass:["bg-red-600","text-white"]})}finally{this.cargando.set(!1)}}})}cerrarModal(){this.cerrar.emit()}static \u0275fac=function(e){return new(e||r)(k(U))};static \u0275cmp=A({type:r,selectors:[["app-encuesta-paciente"]],inputs:{cita:"cita",pacienteId:"pacienteId"},outputs:{cerrar:"cerrar",encuestaEnviada:"encuestaEnviada"},decls:57,vars:8,consts:[[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm"],["appClickFueraPopup","","tabindex","0","role","dialog","aria-modal","true",1,"max-h-[90vh]","w-full","max-w-2xl","overflow-y-auto","rounded-2xl","bg-white","p-8","shadow-lg",3,"clickFuera","click","mousedown","keydown"],[1,"mb-6","text-center","text-2xl","font-bold","text-azul-oscuro"],[1,"mb-6","text-center","text-sm","text-gray-600"],[1,"space-y-6",3,"ngSubmit"],[1,"space-y-2"],["for","experiencia",1,"block","text-sm","font-semibold","text-azul-oscuro"],[1,"text-red-500"],["id","experiencia","name","experiencia","rows","4","placeholder","Contanos sobre tu experiencia durante la consulta...",1,"w-full","resize-none","rounded-lg","border","border-gray-300","px-4","py-3","text-sm","focus:ring-2","focus:ring-azul-oscuro","focus:outline-none",3,"ngModelChange","ngModel"],[1,"block","text-sm","font-semibold","text-azul-oscuro"],[1,"flex","items-center","gap-2"],["type","button",1,"text-4xl","transition-transform","hover:scale-110","focus:outline-none",3,"text-yellow-400","text-gray-300"],[1,"ml-2","text-sm","text-gray-600"],[1,"flex","cursor-pointer","items-center","gap-2","rounded","px-2","py-1","hover:bg-gray-50"],[1,"grid","grid-cols-2","gap-2"],["for","rango",1,"block","text-sm","font-semibold","text-azul-oscuro"],[1,"space-y-3"],["id","rango","type","range","name","rango","min","1","max","100",1,"h-2","w-full","cursor-pointer","appearance-none","rounded-lg","bg-gray-200","accent-azul-oscuro",3,"ngModelChange","ngModel"],[1,"flex","items-center","justify-between","text-xs","text-gray-500"],[1,"text-lg","font-bold","text-azul-oscuro"],[1,"flex","items-center","justify-end","gap-3","border-t","pt-4"],["type","button",1,"rounded-lg","border","border-gray-300","bg-white","px-6","py-2","text-sm","text-gray-700","shadow-sm","hover:bg-gray-100","disabled:opacity-50",3,"click","disabled"],["type","submit",1,"rounded-lg","bg-azul-oscuro","px-6","py-2","text-sm","font-semibold","text-white","shadow","hover:bg-azul-oscuro/90","disabled:opacity-50",3,"disabled"],["type","button",1,"text-4xl","transition-transform","hover:scale-110","focus:outline-none",3,"click","mouseenter","mouseleave"],["type","radio","name","satisfaccion",1,"h-4","w-4","accent-azul-oscuro",3,"ngModelChange","ngModel","value"],[1,"text-sm","text-gray-700"],["type","checkbox",1,"h-4","w-4","accent-azul-oscuro",3,"ngModelChange","ngModel","name"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1),p("clickFuera",function(){return a.cerrarModal()})("click",function(d){return d.stopPropagation()})("mousedown",function(d){return d.stopPropagation()})("keydown",function(d){return d.stopPropagation()}),i(2,"h2",2),c(3," Encuesta de Satisfacci\xF3n "),n(),i(4,"p",3),c(5," Tu opini\xF3n es muy importante para nosotros. Por favor, tom\xE1 un momento para completar esta encuesta sobre tu experiencia. "),n(),i(6,"form",4),p("ngSubmit",function(d){return a.enviarEncuesta(),d.stopPropagation()}),i(7,"div",5)(8,"label",6),c(9," 1. \xBFC\xF3mo fue tu experiencia en la cita? "),i(10,"span",7),c(11,"*"),n()(),i(12,"textarea",8),P("ngModelChange",function(d){return w(a.experienciaGeneral,d)||(a.experienciaGeneral=d),d}),n()(),i(13,"div",5)(14,"div",9),c(15," 2. \xBFQu\xE9 calificaci\xF3n le dar\xEDas a la atenci\xF3n recibida? "),i(16,"span",7),c(17,"*"),n()(),i(18,"div",10),h(19,we,2,4,"button",11,T),_(21,Pe,2,1,"span",12),n()(),i(22,"div",5)(23,"div",9),c(24," 3. \xBFC\xF3mo calificar\xEDas tu satisfacci\xF3n general? "),i(25,"span",7),c(26,"*"),n()(),i(27,"div",5),h(28,Se,4,3,"label",13,ge),n()(),i(30,"div",5)(31,"div",9),c(32," 4. \xBFQu\xE9 aspectos destacar\xEDas de la atenci\xF3n? (pod\xE9s seleccionar varios) "),i(33,"span",7),c(34,"*"),n()(),i(35,"div",14),h(36,ke,4,3,"label",13,ge),n()(),i(38,"div",5)(39,"label",15),c(40," 5. \xBFQu\xE9 probabilidad hay de que recomiendes este servicio? (1-100) "),i(41,"span",7),c(42,"*"),n()(),i(43,"div",16)(44,"input",17),P("ngModelChange",function(d){return w(a.valorRango,d)||(a.valorRango=d),d}),n(),i(45,"div",18)(46,"span"),c(47,"Poco probable"),n(),i(48,"span",19),c(49),n(),i(50,"span"),c(51,"Muy probable"),n()()()(),i(52,"div",20)(53,"button",21),p("click",function(d){return a.cerrarModal(),d.stopPropagation()}),c(54," Cancelar "),n(),i(55,"button",22),c(56),n()()()()()),e&2&&(s(12),y("ngModel",a.experienciaGeneral),s(7),v(j(7,ye)),s(2),f(a.calificacionEstrellas>0?21:-1),s(7),v(a.opcionesRadio),s(8),v(a.opcionesCheckbox),s(8),y("ngModel",a.valorRango),s(5),E(a.valorRango),s(4),C("disabled",a.cargando()),s(2),C("disabled",a.cargando()),s(),x(" ",a.cargando()?"Enviando...":"Enviar Encuesta"," "))},dependencies:[B,N,le,R,ue,oe,de,z,ce,O,se,Q],styles:["input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{appearance:none;width:20px;height:20px;border-radius:50%;background:var(--color-azul-oscuro);cursor:pointer;transition:transform .2s}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb:hover{transform:scale(1.2)}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:var(--color-azul-oscuro);cursor:pointer;border:none;transition:transform .2s}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb:hover{transform:scale(1.2)}button[type=button][_ngcontent-%COMP%]{transition:all .2s ease-in-out}"]})};var Fe=()=>[1,2,3,4,5];function Ve(r,t){r&1&&(i(0,"div",6)(1,"div",7),c(2,"Cargando opciones..."),n()())}function Me(r,t){if(r&1){let e=g();i(0,"button",15),p("click",function(){u(e);let o=l(3);return m(o.mostrarFormularioCancelar=!0)}),c(1," Cancelar turno "),n()}}function Ae(r,t){if(r&1){let e=g();i(0,"button",16),p("click",function(){u(e);let o=l(3);return m(o.verResenia())}),c(1," Ver rese\xF1a "),n()}}function Ie(r,t){if(r&1){let e=g();i(0,"button",17),p("click",function(){u(e);let o=l(3);return m(o.mostrarFormularioCalificar=!0)}),c(1," Calificar atenci\xF3n "),n()}}function De(r,t){if(r&1){let e=g();i(0,"button",18),p("click",function(){u(e);let o=l(3);return m(o.verComentarioPaciente())}),c(1," Ver mi comentario "),n()}}function Be(r,t){if(r&1){let e=g();i(0,"button",19),p("click",function(){u(e);let o=l(3);return m(o.verComentarioEspecialista())}),c(1," Ver comentario especialista "),n()}}function Re(r,t){if(r&1){let e=g();i(0,"button",20),p("click",function(){u(e);let o=l(3);return m(o.abrirEncuesta())}),c(1," Cargar encuesta "),n()}}function ze(r,t){if(r&1){let e=g();i(0,"button",21),p("click",function(){u(e);let o=l(3);return m(o.verEncuesta())}),c(1," Ver encuesta "),n()}}function Oe(r,t){if(r&1&&(_(0,Me,2,0,"button",8),_(1,Ae,2,0,"button",9),_(2,Ie,2,0,"button",10),_(3,De,2,0,"button",11),_(4,Be,2,0,"button",12),_(5,Re,2,0,"button",13),_(6,ze,2,0,"button",14)),r&2){let e=l(2);f(e.puedeCancelar?0:-1),s(),f(e.puedeVerResenia?1:-1),s(),f(e.puedeCalificar?2:-1),s(),f(e.puedeVerComentarioPaciente?3:-1),s(),f(e.puedeVerComentarioEspecialista?4:-1),s(),f(e.puedeCargarEncuesta?5:-1),s(),f(e.puedeVerEncuesta?6:-1)}}function Ne(r,t){if(r&1&&(i(0,"div",2),_(1,Ve,3,0,"div",6)(2,Oe,7,7),n()),r&2){let e=l();s(),f(e.verificandoEncuesta()?1:2)}}function Le(r,t){if(r&1){let e=g();i(0,"div",2)(1,"textarea",22),P("ngModelChange",function(o){u(e);let d=l();return w(d.comentarioCancelar,o)||(d.comentarioCancelar=o),m(o)}),n(),i(2,"div",23)(3,"button",24),p("click",function(){u(e);let o=l();return m(o.cancelarAccionCancelar())}),c(4," Cancelar "),n(),i(5,"button",25),p("click",function(){u(e);let o=l();return m(o.confirmarCancelarTurno())}),c(6," Confirmar cancelaci\xF3n "),n()()()}if(r&2){let e=l();s(),y("ngModel",e.comentarioCancelar),s(4),C("disabled",!e.comentarioCancelar.trim()||e.cargando())}}function qe(r,t){if(r&1){let e=g();i(0,"div",2)(1,"textarea",26),P("ngModelChange",function(o){u(e);let d=l();return w(d.comentarioCalificar,o)||(d.comentarioCalificar=o),m(o)}),n(),i(2,"div",23)(3,"button",24),p("click",function(){u(e);let o=l();return m(o.cancelarAccionCalificar())}),c(4," Cancelar "),n(),i(5,"button",27),p("click",function(){u(e);let o=l();return m(o.confirmarCalificarAtencion())}),c(6," Enviar calificaci\xF3n "),n()()()}if(r&2){let e=l();s(),y("ngModel",e.comentarioCalificar),s(4),C("disabled",!e.comentarioCalificar.trim()||e.cargando())}}function We(r,t){if(r&1){let e=g();i(0,"div",3)(1,"h3",28),c(2," Rese\xF1a "),n(),i(3,"p",29),c(4),n(),i(5,"button",30),p("click",function(){u(e);let o=l();return m(o.volverDesdeVistaResenia())}),c(6," Volver "),n()()}if(r&2){let e=l();s(4),x(" ",e.cita.resenia||"No se ha dejado una rese\xF1a para este turno."," ")}}function je(r,t){if(r&1){let e=g();i(0,"div",3)(1,"h3",28),c(2," Mi Comentario sobre la Atenci\xF3n "),n(),i(3,"p",29),c(4),n(),i(5,"button",30),p("click",function(){u(e);let o=l();return m(o.volverDesdeVistaComentarioPaciente())}),c(6," Volver "),n()()}if(r&2){let e=l();s(4),E(e.cita.comentarioPaciente)}}function He(r,t){if(r&1){let e=g();i(0,"div",3)(1,"h3",28),c(2," Comentario del Especialista "),n(),i(3,"p",29),c(4),n(),i(5,"button",30),p("click",function(){u(e);let o=l();return m(o.volverDesdeVistaComentarioEspecialista())}),c(6," Volver "),n()()}if(r&2){let e=l();s(4),E(e.cita.comentarioEspecialista)}}function Ge(r,t){if(r&1&&(i(0,"span",46),c(1," \u2605 "),n()),r&2){let e=t.$implicit,a=l(2);V("text-yellow-400",e<=(a.encuestaExistente.estrellas||0))("text-gray-300",e>(a.encuestaExistente.estrellas||0))}}function $e(r,t){if(r&1&&(i(0,"span",41),c(1),n()),r&2){let e=t.$implicit;s(),x(" ",e," ")}}function Ue(r,t){if(r&1){let e=g();i(0,"div",4)(1,"h3",31),c(2," Encuesta de Satisfacci\xF3n "),n(),i(3,"div",32)(4,"div",33)(5,"p",34),c(6," 1. \xBFC\xF3mo fue tu experiencia en la cita? "),n(),i(7,"p",35),c(8),n()(),i(9,"div",33)(10,"p",34),c(11," 2. \xBFQu\xE9 calificaci\xF3n le dar\xEDas a la atenci\xF3n recibida? "),n(),i(12,"div",36),h(13,Ge,2,4,"span",37,T),i(15,"span",38),c(16),n()()(),i(17,"div",33)(18,"p",34),c(19," 3. \xBFC\xF3mo calificar\xEDas tu satisfacci\xF3n general? "),n(),i(20,"p",39),c(21),n()(),i(22,"div",33)(23,"p",34),c(24," 4. \xBFQu\xE9 aspectos destacar\xEDas de la atenci\xF3n? "),n(),i(25,"div",40),h(26,$e,2,1,"span",41,T),n()(),i(28,"div",33)(29,"p",34),c(30," 5. \xBFQu\xE9 probabilidad hay de que recomiendes este servicio? "),n(),i(31,"div",42)(32,"div",43),J(33,"div",44),n(),i(34,"span",45),c(35),n()()()(),i(36,"button",30),p("click",function(){u(e);let o=l();return m(o.volverDesdeVistaEncuesta())}),c(37," Volver "),n()()}if(r&2){let e=l();s(8),x(" ",e.encuestaExistente.textBox||"Sin respuesta"," "),s(5),v(j(6,Fe)),s(3),x(" ",e.encuestaExistente.estrellas," de 5 "),s(5),x(" ",e.obtenerEtiquetaRadio(e.encuestaExistente.radioButton)," "),s(5),v(e.obtenerEtiquetasCheckbox(e.encuestaExistente.checkBox)),s(7),W("width",e.encuestaExistente.rango||0,"%"),s(2),x(" ",e.encuestaExistente.rango,"/100 ")}}function Qe(r,t){if(r&1){let e=g();i(0,"app-encuesta-paciente",47),p("cerrar",function(){u(e);let o=l();return m(o.cerrarEncuesta())})("encuestaEnviada",function(){u(e);let o=l();return m(o.onEncuestaEnviada())}),n()}if(r&2){let e=l();C("cita",e.cita)("pacienteId",e.pacienteId)}}var Y=class r{constructor(t,e){this.turnos=t;this.snackBar=e}cita;pacienteId;cerrar=new I;accionRealizada=new I;cargando=b(!1);verificandoEncuesta=b(!0);mostrarFormularioCancelar=!1;mostrarFormularioCalificar=!1;mostrarFormularioResenia=!1;mostrarFormularioEncuesta=!1;mostrarVistaEncuesta=!1;mostrarVistaComentarioPaciente=!1;mostrarVistaComentarioEspecialista=!1;encuestaExistente=null;opcionesRadioMap={excelente:"Excelente","muy-bueno":"Muy bueno",bueno:"Bueno",regular:"Regular",malo:"Malo"};opcionesCheckboxMap={puntualidad:"Puntualidad",profesionalismo:"Profesionalismo",claridad:"Claridad en las explicaciones",empatia:"Empat\xEDa",instalaciones:"Instalaciones limpias","tiempo-espera":"Poco tiempo de espera",seguimiento:"Buen seguimiento",recomendaria:"Lo recomendar\xEDa"};comentarioCancelar="";comentarioCalificar="";ngOnInit(){return S(this,null,function*(){yield this.verificarEncuestaExistente()})}verificarEncuestaExistente(){return S(this,null,function*(){this.verificandoEncuesta.set(!0);try{let{data:t,error:e}=yield G.from($.ENCUESTAS_PACIENTES).select("*").eq("idCita",this.cita.citaId).single();if(e&&e.code!=="PGRST116"){console.error("Error al verificar encuesta:",e);return}this.encuestaExistente=t}catch(t){console.error("Error inesperado al verificar encuesta:",t)}finally{this.verificandoEncuesta.set(!1)}})}get puedeCancelar(){return this.cita.estado!=="completado"&&this.cita.estado!=="cancelado"&&this.cita.estado!=="rechazado"&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioResenia&&!this.mostrarVistaEncuesta&&!this.mostrarVistaComentarioPaciente}get puedeVerResenia(){return(this.cita.estado==="cancelado"||this.cita.estado==="rechazado"||this.cita.estado==="completado")&&!!this.cita.resenia&&this.cita.resenia.trim().length>0}get puedeCalificar(){let t=this.cita.comentarioPaciente&&this.cita.comentarioPaciente.trim().length>0;return this.cita.estado==="completado"&&!t&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioCancelar}get puedeVerComentarioPaciente(){return(this.cita.estado==="cancelado"||this.cita.estado==="completado")&&!!this.cita.comentarioPaciente&&this.cita.comentarioPaciente.trim().length>0&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioResenia&&!this.mostrarVistaEncuesta}get puedeVerComentarioEspecialista(){return(this.cita.estado==="cancelado"||this.cita.estado==="rechazado")&&!!this.cita.comentarioEspecialista&&this.cita.comentarioEspecialista.trim().length>0&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioResenia&&!this.mostrarVistaEncuesta&&!this.mostrarVistaComentarioPaciente}get puedeCargarEncuesta(){return this.cita.estado==="completado"&&!!this.cita.resenia&&this.cita.resenia.trim().length>0&&!this.encuestaExistente&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioResenia}get puedeVerEncuesta(){return this.cita.estado==="completado"&&!!this.encuestaExistente&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioResenia}cancelarAccionCancelar(){this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}confirmarCancelarTurno(){this.comentarioCancelar.trim()&&(this.cargando.set(!0),this.turnos.cancelarCitaPaciente(this.cita,this.comentarioCancelar.trim()).then(t=>{this.cargando.set(!1),t.success?(this.snackBar.open("Turno cancelado exitosamente.","Cerrar",{duration:3e3}),this.accionRealizada.emit("cancelado"),this.cerrar.emit()):this.snackBar.open(t.message??"Ocurri\xF3 un error","Cerrar",{duration:4e3})}).finally(()=>{this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}))}cancelarAccionCalificar(){this.mostrarFormularioCalificar=!1,this.comentarioCalificar=""}confirmarCalificarAtencion(){if(!this.comentarioCalificar.trim()){this.snackBar.open("Por favor, ingres\xE1 un comentario antes de enviar.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]});return}this.cargando.set(!0),this.turnos.cargarComentarioAtencion(this.cita,this.comentarioCalificar.trim()).then(t=>{this.cargando.set(!1),t.success?(this.snackBar.open("Atenci\xF3n calificada exitosamente.","Cerrar",{duration:3e3}),this.accionRealizada.emit("calificacion"),this.cerrar.emit()):this.snackBar.open(t.message??"Ocurri\xF3 un error","Cerrar",{duration:4e3})}).finally(()=>{this.mostrarFormularioCalificar=!1,this.comentarioCalificar=""})}verResenia(){this.mostrarFormularioResenia=!0}volverDesdeVistaResenia(){this.mostrarFormularioResenia=!1}verComentarioPaciente(){this.mostrarVistaComentarioPaciente=!0}volverDesdeVistaComentarioPaciente(){this.mostrarVistaComentarioPaciente=!1}verComentarioEspecialista(){this.mostrarVistaComentarioEspecialista=!0}volverDesdeVistaComentarioEspecialista(){this.mostrarVistaComentarioEspecialista=!1}abrirEncuesta(){this.mostrarFormularioEncuesta=!0}cerrarEncuesta(){this.mostrarFormularioEncuesta=!1}verEncuesta(){this.mostrarVistaEncuesta=!0}volverDesdeVistaEncuesta(){this.mostrarVistaEncuesta=!1}onEncuestaEnviada(){return S(this,null,function*(){this.mostrarFormularioEncuesta=!1,yield this.verificarEncuestaExistente(),this.accionRealizada.emit("encuesta")})}obtenerEtiquetaRadio(t){return t?this.opcionesRadioMap[t]||t:"Sin respuesta"}obtenerEtiquetasCheckbox(t){return t?t.split(",").map(e=>e.trim()).filter(e=>e).map(e=>this.opcionesCheckboxMap[e]||e):[]}cerrarModal(){this.cerrar.emit()}static \u0275fac=function(e){return new(e||r)(k(Z),k(U))};static \u0275cmp=A({type:r,selectors:[["app-acciones-paciente"]],inputs:{cita:"cita",pacienteId:"pacienteId"},outputs:{cerrar:"cerrar",accionRealizada:"accionRealizada"},decls:10,vars:8,consts:[["tabindex","0","role","button","aria-label","Cerrar modal",1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm"],["appClickFueraPopup","","tabindex","0","role","dialog","aria-modal","true",1,"fixed","top-1/2","left-1/2","z-50","w-full","max-w-md","-translate-x-1/2","-translate-y-1/2","transform","items-center","justify-center","rounded-2xl","bg-white","p-11","shadow-lg",3,"clickFuera"],[1,"flex","flex-col","gap-3"],[1,"flex","flex-col","items-center","gap-4","text-center"],[1,"flex","max-h-[70vh]","flex-col","gap-4","overflow-y-auto"],[3,"cita","pacienteId"],[1,"flex","items-center","justify-center","py-4"],[1,"text-sm","text-gray-500"],[1,"rounded-lg","bg-red-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-red-700"],[1,"rounded-lg","bg-blue-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-blue-700"],[1,"rounded-lg","bg-purple-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-purple-700"],[1,"rounded-lg","bg-indigo-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-indigo-700"],[1,"rounded-lg","bg-amber-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-amber-700"],[1,"rounded-lg","bg-green-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-green-700"],[1,"rounded-lg","bg-teal-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-teal-700"],[1,"rounded-lg","bg-red-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-red-700",3,"click"],[1,"rounded-lg","bg-blue-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-blue-700",3,"click"],[1,"rounded-lg","bg-purple-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-purple-700",3,"click"],[1,"rounded-lg","bg-indigo-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-indigo-700",3,"click"],[1,"rounded-lg","bg-amber-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-amber-700",3,"click"],[1,"rounded-lg","bg-green-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-green-700",3,"click"],[1,"rounded-lg","bg-teal-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-teal-700",3,"click"],["placeholder","Ingrese el motivo de cancelaci\xF3n","rows","3",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-red-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-3"],["type","button",1,"rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],["type","button",1,"rounded","bg-red-600","px-4","py-2","text-sm","font-semibold","text-white","hover:bg-red-700","disabled:opacity-50",3,"click","disabled"],["placeholder","Dej\xE1 un comentario sobre la atenci\xF3n recibida","rows","3",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-purple-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","button",1,"rounded","bg-purple-600","px-4","py-2","text-sm","font-semibold","text-white","hover:bg-purple-700","disabled:opacity-50",3,"click","disabled"],[1,"text-xl","font-bold","text-[color:var(--color-azul-oscuro)]"],[1,"px-2","text-gray-700","italic"],[1,"mt-4","rounded","bg-gray-300","px-4","py-2","text-sm","font-semibold","text-gray-800","hover:bg-gray-400",3,"click"],[1,"text-center","text-xl","font-bold","text-azul-oscuro"],[1,"space-y-4"],[1,"rounded-lg","bg-gray-50","p-4"],[1,"mb-2","text-sm","font-semibold","text-azul-oscuro"],[1,"text-sm","text-gray-700","italic"],[1,"flex","items-center","gap-1"],[1,"text-2xl",3,"text-yellow-400","text-gray-300"],[1,"ml-2","text-sm","text-gray-600"],[1,"text-sm","text-gray-700"],[1,"flex","flex-wrap","gap-2"],[1,"rounded-full","bg-azul-oscuro","px-3","py-1","text-xs","text-white"],[1,"flex","items-center","gap-3"],[1,"h-2","flex-1","rounded-full","bg-gray-200"],[1,"h-2","rounded-full","bg-azul-oscuro"],[1,"text-lg","font-bold","text-azul-oscuro"],[1,"text-2xl"],[3,"cerrar","encuestaEnviada","cita","pacienteId"]],template:function(e,a){e&1&&(J(0,"div",0),i(1,"div",1),p("clickFuera",function(){return a.cerrarModal()}),_(2,Ne,3,1,"div",2),_(3,Le,7,2,"div",2),_(4,qe,7,2,"div",2),_(5,We,7,1,"div",3),_(6,je,7,1,"div",3),_(7,He,7,1,"div",3),_(8,Ue,38,7,"div",4),n(),_(9,Qe,1,2,"app-encuesta-paciente",5)),e&2&&(s(2),f(!a.mostrarFormularioCancelar&&!a.mostrarFormularioCalificar&&!a.mostrarFormularioResenia&&!a.mostrarVistaEncuesta&&!a.mostrarVistaComentarioPaciente&&!a.mostrarVistaComentarioEspecialista?2:-1),s(),f(a.mostrarFormularioCancelar?3:-1),s(),f(a.mostrarFormularioCalificar?4:-1),s(),f(a.mostrarFormularioResenia?5:-1),s(),f(a.mostrarVistaComentarioPaciente?6:-1),s(),f(a.mostrarVistaComentarioEspecialista?7:-1),s(),f(a.mostrarVistaEncuesta&&a.encuestaExistente?8:-1),s(),f(a.mostrarFormularioEncuesta?9:-1))},dependencies:[B,N,R,z,O,Q,K],encapsulation:2})};function Ze(r,t){if(r&1){let e=g();i(0,"app-acciones-paciente",12),p("cerrar",function(){u(e);let o=l();return m(o.cerrarPopupAcciones())})("accionRealizada",function(){u(e);let o=l();return m(o.accionDesdeModal())}),n()}if(r&2){let e=l();C("cita",e.citaSeleccionada())("pacienteId",e.usuarioActual.id)}}function Ke(r,t){if(r&1&&(i(0,"th",11),c(1),n()),r&2){let e=t.$implicit;s(),E(e.label)}}function Ye(r,t){if(r&1&&(i(0,"div")(1,"strong"),c(2),n(),c(3),n()),r&2){let e=t.$implicit;s(2),x("",e.clave,":"),s(),x(" ",e.valor)}}function Je(r,t){if(r&1&&(i(0,"tr")(1,"td",20)(2,"div",21),h(3,Ye,4,2,"div",null,T),n()()()),r&2){let e=l().$implicit;C("@expandCollapse",void 0),s(3),v(e.datosDinamicos)}}function Xe(r,t){if(r&1){let e=g();i(0,"tr",13),p("click",function(){let o=u(e).$implicit,d=l(2);return m(d.toggleFilaExpandida(o.citaId))}),i(1,"td",14),c(2),n(),i(3,"td",14),c(4),M(5,"date"),n(),i(6,"td",15),c(7),M(8,"titlecase"),n(),i(9,"td",14),c(10),M(11,"unidadMedida"),n(),i(12,"td",14),c(13),M(14,"unidadMedida"),n(),i(15,"td",14),c(16),M(17,"unidadMedida"),n(),i(18,"td",14),c(19),M(20,"unidadMedida"),n(),i(21,"td",14),c(22),n(),i(23,"td",14),c(24),n(),i(25,"td",14),c(26),n(),i(27,"td",16)(28,"button",17),c(29),n()(),i(30,"td",18)(31,"button",19),p("click",function(){let o=u(e).$implicit,d=l(2);return m(d.abrirPopupAcciones(o))}),c(32," Acciones "),n()()(),_(33,Je,5,1,"tr")}if(r&2){let e=t.$implicit,a=l(2);W("background-color",a.filaExpandida()===e.citaId?"rgba(46, 64, 45, 0.2)":null),C("@fadeInRow",void 0),s(2),E(e.citaId),s(2),x(" ",D(5,16,e.fechaHora,"short")," "),s(2),C("appColorEstado",e.estado),s(),x(" ",te(8,19,e.estado)," "),s(3),x(" ",D(11,21,e.alturaCm,"altura")," "),s(3),x(" ",D(14,24,e.pesoKg,"peso")," "),s(3),x(" ",D(17,27,e.temperaturaC,"temperatura")," "),s(3),x(" ",D(20,30,e.presionArterial,"presion")," "),s(3),x(" ",e.pacienteNombreCompleto," "),s(2),x(" ",e.especialistaNombreCompleto," "),s(2),x(" ",e.especialidadNombre," "),s(3),x(" ",a.filaExpandida()===e.citaId?"Ocultar":"Mostrar"," "),s(4),f(a.filaExpandida()===e.citaId?33:-1)}}function et(r,t){if(r&1&&(i(0,"tbody"),h(1,Xe,34,33,null,null,T),n()),r&2){let e=l();C("@listStagger",void 0),s(),v(e.citasFiltradas)}}function tt(r,t){r&1&&(i(0,"tbody")(1,"tr")(2,"td",22),c(3," Cargando datos... "),n()()())}var ve=class r{constructor(t,e,a){this.turnosService=t;this.authSupabase=e;this.loading=a;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new X;citas=b([]);filaExpandida=b(null);cargando=b(!0);citaSeleccionada=b(null);ordenamiento=b("fecha");mostrarFilas=b(!1);mostrarPopupAcciones=!1;columnas=[{key:"citaId",label:"ID"},{key:"fechaHora",label:"Fecha/Hora"},{key:"estado",label:"Estado"},{key:"alturaCm",label:"Altura"},{key:"pesoKg",label:"Peso"},{key:"temperaturaC",label:"Temperatura"},{key:"presionArterial",label:"Presi\xF3n arterial"},{key:"pacienteNombreCompleto",label:"Paciente"},{key:"especialistaNombreCompleto",label:"Especialista"},{key:"especialidadNombre",label:"Especialidad"}];columnasConDatosDinamicos=[...this.columnas,{key:"datosDinamicos",label:"Datos din\xE1micos"}];_filtroValor=b("");_filtroTimeout=null;get filtroValorModel(){return this._filtroValor()}set filtroValorModel(t){this._filtroValor.set(t),this._filtroTimeout&&clearTimeout(this._filtroTimeout)}ngOnInit(){return S(this,null,function*(){this.usuario$.pipe(ee(this.destroy$)).subscribe(t=>{if(!t){this.usuarioActual=null;return}t.id=typeof t.id=="string"?Number(t.id):t.id,this.usuarioActual=t,this.cargarCitas()})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitas(){return S(this,null,function*(){this.cargando.set(!0),this.mostrarFilas.set(!1);try{if(this.usuarioActual?.id!=null){let t=yield this.turnosService.obtenerCitasPaciente(this.usuarioActual.id);this.citas.set(t)}}catch(t){console.error("Error al obtener citas",t)}finally{this.cargando.set(!1),setTimeout(()=>{this.mostrarFilas.set(!0)},10),this.loading.hide()}})}toggleFilaExpandida(t){this.filaExpandida.set(this.filaExpandida()===t?null:t)}get citasFiltradas(){let t=fe(this.citas(),this._filtroValor()),e=this.ordenamiento();return e==="fecha"?t=[...t].sort((a,o)=>new Date(o.fechaHora).getTime()-new Date(a.fechaHora).getTime()):e==="estado"&&(t=[...t].sort((a,o)=>a.estado.localeCompare(o.estado))),t}limpiarFiltro(){this._filtroValor.set(""),this.mostrarFilas.set(!1),setTimeout(()=>{this.mostrarFilas.set(!0)},10)}abrirPopupAcciones(t){this.citaSeleccionada.set(t),this.mostrarPopupAcciones=!0}cerrarPopupAcciones(){this.mostrarPopupAcciones=!1,this.citaSeleccionada.set(null)}accionDesdeModal(){this.cerrarPopupAcciones(),this.cargarCitas()}ordenarPorFecha(){this.ordenamiento.set("fecha"),this.mostrarFilas.set(!1),setTimeout(()=>{this.mostrarFilas.set(!0)},10)}ordenarPorEstado(){this.ordenamiento.set("estado"),this.mostrarFilas.set(!1),setTimeout(()=>{this.mostrarFilas.set(!0)},10)}static \u0275fac=function(e){return new(e||r)(k(Z),k(me),k(pe))};static \u0275cmp=A({type:r,selectors:[["app-mis-turnos-paciente"]],decls:21,vars:11,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-[color:var(--color-crema)]","p-6","shadow-inner"],[1,"mb-4","flex","flex-wrap","items-center","gap-3"],["for","filtro",1,"text-sm","font-semibold","text-[color:var(--color-azul-oscuro)]"],["id","filtro","type","text","placeholder","Ingres\xE1 filtro",1,"w-64","rounded","border","border-gray-300","px-3","py-1","text-sm","focus:ring-2","focus:ring-[color:var(--color-azul-oscuro)]","focus:outline-none",3,"ngModelChange","ngModel"],["type","button",1,"mr-6","rounded","bg-[color:var(--color-azul-oscuro)]","px-3","py-1","text-sm","font-semibold","text-white","shadow","transition-transform","hover:scale-105","hover:bg-[color:var(--color-azul-claro)]",3,"click"],["type","button",1,"rounded","px-3","py-1","text-sm","font-semibold","text-white","shadow","transition-transform","hover:scale-105",3,"click"],[1,"ml-auto"],[3,"cita","pacienteId"],[1,"min-w-full","border-collapse","border","border-gray-300","text-sm"],[1,"bg-[color:var(--color-azul-claro)]","text-[color:var(--color-azul-oscuro)]"],[1,"border","border-gray-300","px-3","py-2"],[3,"cerrar","accionRealizada","cita","pacienteId"],[1,"cursor-pointer","border","border-gray-300","transition-colors","duration-150","hover:bg-[color:var(--color-verde-claro)]",3,"click"],[1,"border","border-gray-300","px-3","py-1"],[1,"rounded","border","border-gray-300","px-3","py-1","text-center","font-semibold",3,"appColorEstado"],[1,"border","border-gray-300","px-3","py-1","text-center"],["type","button",1,"text-[color:var(--color-azul-oscuro)]","underline","hover:text-[color:var(--color-azul-claro)]"],[1,"border","border-gray-300","bg-green-200","px-3","py-1","text-center","hover:bg-green-500"],["type","button",1,"font-bold","text-[color:var(--color-azul-oscuro)]","hover:text-[color:var(--color-white)]",3,"click"],["colspan","11",1,"border","border-gray-300","bg-[color:var(--color-crema)]","px-3","py-2","text-[color:var(--color-azul-oscuro)]"],[1,"grid","grid-cols-2","gap-4"],["colspan","11",1,"border","border-gray-300","px-3","py-6","text-center","font-semibold","text-[color:var(--color-azul-oscuro)]"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),c(4," Filtrar: "),n(),i(5,"input",4),P("ngModelChange",function(d){return w(a.filtroValorModel,d)||(a.filtroValorModel=d),d}),n(),i(6,"button",5),p("click",function(){return a.limpiarFiltro()}),c(7," Limpiar Filtros "),n(),i(8,"button",6),p("click",function(){return a.ordenarPorFecha()}),c(9," \u{1F4C5} Ordenar por Fecha "),n(),i(10,"button",6),p("click",function(){return a.ordenarPorEstado()}),c(11," \u{1F3F7}\uFE0F Ordenar por Estado "),n(),i(12,"div",7),_(13,Ze,1,2,"app-acciones-paciente",8),n()(),i(14,"table",9)(15,"thead")(16,"tr",10),h(17,Ke,2,1,"th",11,T),n()(),_(19,et,3,1,"tbody")(20,tt,4,0,"tbody"),n()()()),e&2&&(s(5),y("ngModel",a.filtroValorModel),s(3),V("bg-green-600",a.ordenamiento()==="fecha")("bg-green-800",a.ordenamiento()!=="fecha"),s(2),V("bg-purple-600",a.ordenamiento()==="estado")("bg-purple-800",a.ordenamiento()!=="estado"),s(3),f(a.mostrarPopupAcciones&&a.citaSeleccionada()&&a.usuarioActual?13:-1),s(4),v(a.columnasConDatosDinamicos),s(2),f(!a.cargando()&&a.mostrarFilas()?19:20))},dependencies:[B,N,R,z,O,Y,_e,ie,ae,xe],encapsulation:2,data:{animation:[H("fadeInRow",[q(":enter",[F({opacity:0,transform:"translateY(-10px)"}),L("300ms ease-out",F({opacity:1,transform:"translateY(0)"}))])]),H("listStagger",[q(":enter",[ne(":enter",[F({opacity:0,transform:"translate(-20px, -10px)"}),re(50,[L("300ms ease-out",F({opacity:1,transform:"translate(0, 0)"}))])],{optional:!0})])]),H("expandCollapse",[q(":enter",[F({height:"0",opacity:0,overflow:"hidden"}),L("350ms ease-out",F({height:"*",opacity:1}))]),q(":leave",[F({height:"*",opacity:1}),L("250ms ease-in",F({height:"0",opacity:0}))])])]}})};export{ve as MisTurnosPaciente};
