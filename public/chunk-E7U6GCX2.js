import{a as X,b as Y}from"./chunk-DZUCOP4O.js";import{a as ee}from"./chunk-KLTD2K6X.js";import{a as P}from"./chunk-WZDOETQ3.js";import{a as Q}from"./chunk-EVSMGOY5.js";import{n as J}from"./chunk-4CBNAM3C.js";import{l as G}from"./chunk-ISKSCZVY.js";import"./chunk-X5YLR3NI.js";import"./chunk-J36EOOTC.js";import{c as M,g as V,j as I,v as Z,w as D,x as q}from"./chunk-ET4QANTK.js";import"./chunk-BJZ3VNWM.js";import{h as U,i as H,j as K}from"./chunk-EUZGYKR3.js";import{Db as p,Fb as s,Oa as o,P as j,Qb as W,Ta as C,Tb as l,Ub as B,Vb as d,Xb as k,Yb as S,Za as T,Zb as F,ca as m,da as u,eb as R,ec as v,f as O,fc as L,gc as h,na as b,nb as f,ob as x,pb as A,qb as w,rb as E,sb as y,tb as a,ub as r,vb as $,zb as g}from"./chunk-7RTQA4J5.js";import{i as z}from"./chunk-ODN5LVDJ.js";function ne(i,t){if(i&1){let e=g();a(0,"button",6),p("click",function(){m(e);let c=s(2);return u(c.mostrarFormularioCancelar=!0)}),l(1," Cancelar turno "),r()}}function le(i,t){if(i&1){let e=g();a(0,"button",7),p("click",function(){m(e);let c=s(2);return u(c.verResenia())}),l(1," Ver rese\xF1a "),r()}}function ce(i,t){if(i&1&&(a(0,"div",2),f(1,ne,2,0,"button",4),f(2,le,2,0,"button",5),r()),i&2){let e=s();o(),x(e.puedeCancelar?1:-1),o(),x(e.puedeVerResenia?2:-1)}}function se(i,t){if(i&1){let e=g();a(0,"div",2)(1,"textarea",8),F("ngModelChange",function(c){m(e);let _=s();return S(_.comentarioCancelar,c)||(_.comentarioCancelar=c),u(c)}),r(),a(2,"div",9)(3,"button",10),p("click",function(){m(e);let c=s();return u(c.cancelarAccionCancelar())}),l(4," Cancelar "),r(),a(5,"button",11),p("click",function(){m(e);let c=s();return u(c.confirmarCancelarTurno())}),l(6," Confirmar cancelaci\xF3n "),r()()()}if(i&2){let e=s();o(),k("ngModel",e.comentarioCancelar),o(4),y("disabled",!e.comentarioCancelar.trim()||e.cargando())}}function de(i,t){if(i&1){let e=g();a(0,"div",3)(1,"h3",12),l(2," Rese\xF1a "),r(),a(3,"p",13),l(4),r(),a(5,"button",14),p("click",function(){m(e);let c=s();return u(c.volverDesdeVistaResenia())}),l(6," Volver "),r()()}if(i&2){let e=s();o(4),d(" ",e.cita.resenia||"No se ha dejado una rese\xF1a para este turno."," ")}}var N=class i{constructor(t,e,n){this.turnos=t;this.fb=e;this.snackBar=n}cita;cerrar=new R;accionRealizada=new R;cargando=b(!1);mostrarFormularioCancelar=!1;mostrarFormularioResenia=!1;comentarioCancelar="";get puedeCancelar(){return this.cita.estado!=="completado"&&this.cita.estado!=="cancelado"&&this.cita.estado!=="aceptado"&&this.cita.estado!=="rechazado"&&!this.mostrarFormularioCancelar}get puedeVerResenia(){return!!this.cita.resenia&&this.cita.resenia.trim().length>0}cancelarAccionCancelar(){this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}confirmarCancelarTurno(){this.comentarioCancelar.trim()&&(this.cargando.set(!0),this.turnos.cancelarCitaEspecialista(this.cita,this.comentarioCancelar.trim()).then(t=>{this.cargando.set(!1),t.success?(this.snackBar.open("Turno cancelado exitosamente.","Cerrar",{duration:3e3}),this.accionRealizada.emit("cancelado"),this.cerrar.emit()):this.snackBar.open(t.message??"Ocurri\xF3 un error","Cerrar",{duration:4e3})}).finally(()=>{this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}))}verResenia(){this.mostrarFormularioResenia=!0}volverDesdeVistaResenia(){this.mostrarFormularioResenia=!1}cerrarModal(){this.cerrar.emit()}static \u0275fac=function(e){return new(e||i)(C(P),C(Z),C(J))};static \u0275cmp=T({type:i,selectors:[["app-acciones-admin"]],inputs:{cita:"cita"},outputs:{cerrar:"cerrar",accionRealizada:"accionRealizada"},decls:5,vars:3,consts:[["tabindex","0","role","button","aria-label","Cerrar modal",1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm"],["appClickFueraPopup","","tabindex","0","role","dialog","aria-modal","true",1,"fixed","top-1/2","left-1/2","z-50","w-full","max-w-md","-translate-x-1/2","-translate-y-1/2","transform","items-center","justify-center","rounded-2xl","bg-white","p-11","shadow-lg",3,"clickFuera"],[1,"flex","flex-col","gap-3"],[1,"flex","flex-col","items-center","gap-4","text-center"],[1,"rounded-lg","bg-gray-500","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-gray-800"],[1,"rounded-lg","bg-pink-400","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-pink-700"],[1,"rounded-lg","bg-gray-500","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-gray-800",3,"click"],[1,"rounded-lg","bg-pink-400","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-pink-700",3,"click"],["placeholder","Ingrese el motivo de cancelaci\xF3n","rows","3",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-red-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-3"],["type","button",1,"rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],["type","button",1,"rounded","bg-red-600","px-4","py-2","text-sm","font-semibold","text-white","hover:bg-red-800","disabled:opacity-50",3,"click","disabled"],[1,"text-xl","font-bold","text-[color:var(--color-azul-oscuro)]"],[1,"px-2","text-gray-700","italic"],[1,"mt-4","rounded","bg-gray-300","px-4","py-2","text-sm","font-semibold","text-gray-800","hover:bg-gray-400",3,"click"]],template:function(e,n){e&1&&($(0,"div",0),a(1,"div",1),p("clickFuera",function(){return n.cerrarModal()}),f(2,ce,3,2,"div",2),f(3,se,7,2,"div",2),f(4,de,7,1,"div",3),r()),e&2&&(o(2),x(!n.mostrarFormularioCancelar&&!n.mostrarFormularioResenia?2:-1),o(),x(n.mostrarFormularioCancelar?3:-1),o(),x(n.mostrarFormularioResenia?4:-1))},dependencies:[D,M,V,I,q,Q],encapsulation:2})};function me(i,t){if(i&1){let e=g();a(0,"app-acciones-admin",11),p("cerrar",function(){m(e);let c=s();return u(c.cerrarPopupAcciones())})("accionRealizada",function(){m(e);let c=s();return u(c.accionDesdeModal())}),r()}if(i&2){let e=s();y("cita",e.citaSeleccionada())}}function ue(i,t){if(i&1&&(a(0,"th",10),l(1),r()),i&2){let e=t.$implicit;o(),B(e.label)}}function pe(i,t){if(i&1&&(a(0,"div")(1,"strong"),l(2),r(),l(3),r()),i&2){let e=t.$implicit;o(2),d("",e.clave,":"),o(),d(" ",e.valor)}}function _e(i,t){if(i&1&&(a(0,"tr")(1,"td",19)(2,"div",20),w(3,pe,4,2,"div",null,A),r()()()),i&2){let e=s().$implicit;o(3),E(e.datosDinamicos)}}function fe(i,t){if(i&1){let e=g();a(0,"tr",12),p("click",function(){let c=m(e).$implicit,_=s(2);return u(_.toggleFilaExpandida(c.citaId))}),a(1,"td",13),l(2),r(),a(3,"td",13),l(4),v(5,"date"),r(),a(6,"td",14),l(7),v(8,"titlecase"),r(),a(9,"td",13),l(10),v(11,"unidadMedida"),r(),a(12,"td",13),l(13),v(14,"unidadMedida"),r(),a(15,"td",13),l(16),v(17,"unidadMedida"),r(),a(18,"td",13),l(19),v(20,"unidadMedida"),r(),a(21,"td",13),l(22),r(),a(23,"td",13),l(24),r(),a(25,"td",13),l(26),r(),a(27,"td",15)(28,"button",16),l(29),r()(),a(30,"td",17)(31,"button",18),p("click",function(){let c=m(e).$implicit,_=s(2);return u(_.abrirPopupAcciones(c))}),l(32," Acciones "),r()()(),f(33,_e,5,0,"tr")}if(i&2){let e=t.$implicit,n=s(2);W("background-color",n.filaExpandida()===e.citaId?"rgba(46, 64, 45, 0.2)":null),o(2),B(e.citaId),o(2),d(" ",h(5,15,e.fechaHora,"short")," "),o(2),y("appColorEstado",e.estado),o(),d(" ",L(8,18,e.estado)," "),o(3),d(" ",h(11,20,e.alturaCm,"altura")," "),o(3),d(" ",h(14,23,e.pesoKg,"peso")," "),o(3),d(" ",h(17,26,e.temperaturaC,"temperatura")," "),o(3),d(" ",h(20,29,e.presionArterial,"presion")," "),o(3),d(" ",e.pacienteNombreCompleto," "),o(2),d(" ",e.especialistaNombreCompleto," "),o(2),d(" ",e.especialidadNombre," "),o(3),d(" ",n.filaExpandida()===e.citaId?"Ocultar":"Mostrar"," "),o(4),x(n.filaExpandida()===e.citaId?33:-1)}}function xe(i,t){if(i&1&&w(0,fe,34,32,null,null,A),i&2){let e=s();E(e.citasFiltradas)}}function be(i,t){i&1&&(a(0,"tr")(1,"td",21),l(2," Cargando datos... "),r()())}var te=class i{constructor(t,e){this.turnosService=t;this.authSupabase=e;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new O;citas=b([]);filaExpandida=b(null);cargando=b(!0);citaSeleccionada=b(null);mostrarPopupAcciones=!1;columnas=[{key:"citaId",label:"ID"},{key:"fechaHora",label:"Fecha/Hora"},{key:"estado",label:"Estado"},{key:"alturaCm",label:"Altura"},{key:"pesoKg",label:"Peso"},{key:"temperaturaC",label:"Temperatura"},{key:"presionArterial",label:"Presi\xF3n arterial"},{key:"pacienteNombreCompleto",label:"Paciente"},{key:"especialistaNombreCompleto",label:"Especialista"},{key:"especialidadNombre",label:"Especialidad"}];columnasConDatosDinamicos=[...this.columnas,{key:"datosDinamicos",label:"Datos din\xE1micos"}];_filtroValor=b("");get filtroValorModel(){return this._filtroValor()}set filtroValorModel(t){this._filtroValor.set(t)}ngOnInit(){return z(this,null,function*(){this.usuario$.pipe(j(this.destroy$)).subscribe(t=>{if(!t){this.usuarioActual=null;return}t.id=typeof t.id=="string"?Number(t.id):t.id,this.usuarioActual=t,this.cargarCitas()})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitas(){return z(this,null,function*(){this.cargando.set(!0);try{if(this.usuarioActual?.id!=null){let t=yield this.turnosService.obtenerCitasConRegistro();this.citas.set(t)}}catch(t){console.error("Error al obtener citas",t)}finally{this.cargando.set(!1)}})}toggleFilaExpandida(t){this.filaExpandida.set(this.filaExpandida()===t?null:t)}get citasFiltradas(){return Y(this.citas(),this._filtroValor())}limpiarFiltro(){this._filtroValor.set("")}abrirPopupAcciones(t){this.citaSeleccionada.set(t),this.mostrarPopupAcciones=!0}cerrarPopupAcciones(){this.mostrarPopupAcciones=!1,this.citaSeleccionada.set(null)}accionDesdeModal(){this.cerrarPopupAcciones(),this.cargarCitas()}static \u0275fac=function(e){return new(e||i)(C(P),C(G))};static \u0275cmp=T({type:i,selectors:[["app-tabla-turnos"]],decls:18,vars:3,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-[color:var(--color-crema)]","p-6","shadow-inner"],[1,"mb-4","flex","flex-wrap","items-center","gap-3"],["for","filtro",1,"text-sm","font-semibold","text-[color:var(--color-azul-oscuro)]"],["id","filtro","type","text","placeholder","Ingres\xE1 filtro",1,"w-64","rounded","border","border-gray-300","px-3","py-1","text-sm","focus:ring-2","focus:ring-[color:var(--color-azul-oscuro)]","focus:outline-none",3,"ngModelChange","ngModel"],["type","button",1,"rounded","bg-[color:var(--color-azul-oscuro)]","px-3","py-1","text-sm","font-semibold","text-white","shadow","transition-transform","hover:scale-105","hover:bg-[color:var(--color-azul-claro)]",3,"click"],[1,"ml-auto"],[3,"cita"],[1,"min-w-full","border-collapse","border","border-gray-300","text-sm"],[1,"bg-[color:var(--color-azul-claro)]","text-[color:var(--color-azul-oscuro)]"],[1,"border","border-gray-300","px-3","py-2"],[3,"cerrar","accionRealizada","cita"],[1,"cursor-pointer","border","border-gray-300","transition-colors","duration-150","hover:bg-[color:var(--color-verde-claro)]",3,"click"],[1,"border","border-gray-300","px-3","py-1"],[1,"rounded","border","border-gray-300","px-3","py-1","text-center","font-semibold",3,"appColorEstado"],[1,"border","border-gray-300","px-3","py-1","text-center"],["type","button",1,"text-[color:var(--color-azul-oscuro)]","underline","hover:text-[color:var(--color-azul-claro)]"],[1,"border","border-gray-300","bg-green-200","px-3","py-1","text-center","hover:bg-green-500"],["type","button",1,"font-bold","text-[color:var(--color-azul-oscuro)]","hover:text-[color:var(--color-white)]",3,"click"],["colspan","11",1,"border","border-gray-300","bg-[color:var(--color-crema)]","px-3","py-2","text-[color:var(--color-azul-oscuro)]"],[1,"grid","grid-cols-2","gap-4"],["colspan","11",1,"border","border-gray-300","px-3","py-6","text-center","font-semibold","text-[color:var(--color-azul-oscuro)]"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),l(4," Filtrar: "),r(),a(5,"input",4),F("ngModelChange",function(_){return S(n.filtroValorModel,_)||(n.filtroValorModel=_),_}),r(),a(6,"button",5),p("click",function(){return n.limpiarFiltro()}),l(7," Limpiar "),r(),a(8,"div",6),f(9,me,1,1,"app-acciones-admin",7),r()(),a(10,"table",8)(11,"thead")(12,"tr",9),w(13,ue,2,1,"th",10,A),r()(),a(15,"tbody"),f(16,xe,2,0)(17,be,3,0,"tr"),r()()()()),e&2&&(o(5),k("ngModel",n.filtroValorModel),o(4),x(n.mostrarPopupAcciones&&n.citaSeleccionada()?9:-1),o(4),E(n.columnasConDatosDinamicos),o(3),x(n.cargando()?17:16))},dependencies:[K,D,M,V,I,N,X,U,H,ee],encapsulation:2})};export{te as TablaTurnos};
