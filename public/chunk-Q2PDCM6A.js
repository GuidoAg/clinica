import{a as ze,b as je,c as Be,d as qe,e as Ue,f as Le}from"./chunk-J3CQVAPC.js";import{a as Ce}from"./chunk-WHWTTNA5.js";import"./chunk-7WI5F5YR.js";import{a as Me,b as Pe,f as Oe,i as Ie,j as Ne,k as De}from"./chunk-ZW3EOS2F.js";import{f as ke,g as Te,n as Ae}from"./chunk-PSUGFJZX.js";import{a as B,b as q}from"./chunk-3RRXKLDM.js";import{k as Ve}from"./chunk-Z4223MVF.js";import"./chunk-LMZWYZYD.js";import"./chunk-FA34LLBW.js";import{c as z,e as h,g as j,h as ve,j as be,k as xe,l as Ee,o as ye,p as Fe,w as Se,x as we,y as Re}from"./chunk-AHNE7AS4.js";import{b as _e}from"./chunk-GQ5SPWAT.js";import{f as he,g as fe}from"./chunk-JPNAPRSS.js";import"./chunk-3BX3P6FI.js";import{e as N,j as D}from"./chunk-PUIB254N.js";import{$b as ue,Ab as k,Eb as v,Gb as u,Ma as ne,Na as le,Oa as s,Rb as ce,Sb as A,Ub as d,Vb as $,Wb as M,Yb as de,Z as R,Za as I,Zb as pe,_b as me,ca as f,da as C,ea as re,eb as se,ec as S,fc as ge,nb as p,ob as m,qb as L,rb as H,sa as oe,sb as G,tb as _,ub as n,vb as r,wb as b}from"./chunk-JXJDPNLJ.js";import{j as w}from"./chunk-K4ALXBGI.js";var Qe=(i,t)=>({"bg-green-500":i,"bg-red-500":t}),Je=(i,t)=>({"translate-x-2.5":i,"translate-x-0":t}),Ke=(i,t,e)=>({"text-green-600":i,"text-red-600":t,"text-orange-600":e});function Xe(i,t){i&1&&(n(0,"div",1),re(),n(1,"svg",12),b(2,"circle",13)(3,"path",14),r()())}function Ye(i,t){if(i&1&&b(0,"img",6),i&2){let e=u();_("src",e.captchaActual.imagenUrl,ne)}}function et(i,t){if(i&1&&(n(0,"p",11),d(1),r()),i&2){let e=u();_("ngClass",ge(2,Ke,e.captchaValido,!e.captchaValido,!e.captchaActivo)),s(),M(" ",e.mensajeVerificacion," ")}}var U=class i{captchaResuelto=new se;auth=R(q);captchas=[];captchaActual;userInput="";captchaValido=!1;mensajeVerificacion="";verificando=!1;cargado=!1;captchaActivo=!0;ngOnInit(){return w(this,null,function*(){yield this.cargarCaptchasDesdeSupabase()})}cargarCaptchasDesdeSupabase(){return w(this,null,function*(){try{if(this.captchas=yield this.auth.getCaptchas(),!this.captchas.length){console.error("No se pudieron cargar captchas");return}this.captchaActual=this.obtenerCaptchaAleatorio(),this.cargado=!0}catch(t){console.error("Error al cargar captchas:",t),this.cargado=!1}})}obtenerCaptchaAleatorio(){if(this.captchas.length<2)return this.captchas[0];let t;do{let e=Math.floor(Math.random()*this.captchas.length);t=this.captchas[e]}while(t===this.captchaActual);return t}verificarRespuesta(){return w(this,null,function*(){if(!this.captchaActual)return;if(!this.captchaActivo){this.captchaValido=!0,this.mensajeVerificacion="Captcha desactivado - Verificaci\xF3n omitida",this.captchaResuelto.emit(!0);return}this.mensajeVerificacion="",this.verificando=!0,yield new Promise(e=>setTimeout(e,500));let t=yield this.sha256(this.userInput.trim().toLowerCase());this.captchaValido=t===this.captchaActual.answerHash,this.mensajeVerificacion=this.captchaValido?"Respuesta correcta":"Respuesta incorrecta",this.verificando=!1,this.captchaResuelto.emit(this.captchaValido)})}sha256(t){return w(this,null,function*(){let e=new TextEncoder().encode(t),a=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(a)).map(g=>g.toString(16).padStart(2,"0")).join("")})}cambiarCaptcha(){this.captchaActual=this.obtenerCaptchaAleatorio(),this.userInput="",this.mensajeVerificacion=""}toggleCaptcha(){this.captchaActivo=!this.captchaActivo,this.userInput="",this.mensajeVerificacion="",this.captchaActivo?(this.captchaValido=!1,this.captchaResuelto.emit(!1)):(this.captchaValido=!0,this.captchaResuelto.emit(!0))}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-mi-captcha"]],outputs:{captchaResuelto:"captchaResuelto"},decls:14,vars:27,consts:[[1,"relative","w-[300px]","items-center","justify-center","align-middle","text-sm"],[1,"absolute","inset-0","z-10","flex","items-center","justify-center","bg-white/120","backdrop-blur-sm"],[1,"relative","rounded-lg","border","border-gray-300","bg-crema","p-4","shadow-sm"],["type","button",1,"absolute","top-1","right-1","z-20","flex","h-3","w-6","items-center","rounded-full","p-0.5","shadow-md","transition-colors","duration-300","hover:shadow-lg","focus:ring-1","focus:ring-offset-1","focus:outline-none",3,"click","ngClass","title"],[1,"h-2","w-2","transform","rounded-full","bg-white","shadow-sm","transition-transform","duration-300",3,"ngClass"],[1,"flex","flex-col","items-center","gap-2","pt-1","transition-all","duration-300"],["alt","captcha",1,"h-24","w-full","rounded","border","bg-white","object-contain",3,"src"],["placeholder","Escrib\xED lo que ves",1,"w-full","rounded","border","border-gray-300","bg-white","px-3","py-1.5","focus:ring-2","focus:ring-azul-oscuro","focus:outline-none","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],[1,"flex","w-full","justify-between","gap-2"],["type","button",1,"flex-1","rounded","bg-verde-claro","px-3","py-1.5","text-lg","text-white","hover:bg-verde-claro/80","disabled:cursor-not-allowed","disabled:opacity-50",3,"click","disabled"],["type","button",1,"flex-1","rounded","bg-azul-claro","px-3","py-1.5","text-lg","text-white","hover:bg-azul-claro/80","disabled:cursor-not-allowed","disabled:opacity-50",3,"click","disabled"],[1,"mt-1",3,"ngClass"],["viewBox","0 0 24 24","fill","none",1,"h-6","w-6","animate-spin","text-blue-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"]],template:function(e,a){e&1&&(n(0,"div",0),p(1,Xe,4,0,"div",1),n(2,"div",2)(3,"button",3),v("click",function(){return a.toggleCaptcha()}),b(4,"div",4),r(),n(5,"div",5),p(6,Ye,1,1,"img",6),n(7,"input",7),me("ngModelChange",function(c){return pe(a.userInput,c)||(a.userInput=c),c}),r(),n(8,"div",8)(9,"button",9),v("click",function(){return a.verificarRespuesta()}),d(10," Verificar "),r(),n(11,"button",10),v("click",function(){return a.cambiarCaptcha()}),d(12," Cambiar "),r()(),p(13,et,2,6,"p",11),r()()()),e&2&&(s(),m(a.verificando||!a.cargado?1:-1),s(2),A("focus:ring-green-500",a.captchaActivo)("focus:ring-red-500",!a.captchaActivo),_("title",ue(a.captchaActivo?"Captcha activado - Click para desactivar":"Captcha desactivado - Click para activar"))("ngClass",S(21,Qe,a.captchaActivo,!a.captchaActivo)),s(),_("ngClass",S(24,Je,a.captchaActivo,!a.captchaActivo)),s(),ce("filter",a.captchaActivo?"none":"blur(1px) brightness(1.1)"),A("opacity-50",a.verificando)("opacity-40",!a.captchaActivo),s(),m(a.captchaActual?6:-1),s(),de("ngModel",a.userInput),_("disabled",a.verificando||!a.captchaActivo),s(2),_("disabled",a.verificando||!a.captchaActivo),s(2),_("disabled",a.verificando||!a.captchaActivo),s(2),m(a.mensajeVerificacion?13:-1))},dependencies:[D,N,we,z,j,be],encapsulation:2})};var T=(i,t)=>({"mat-form-field-valid":i,"mat-form-field-invalid":t});function tt(i,t){if(i&1){let e=k();n(0,"div",2)(1,"p",4),d(2,"\xBFQu\xE9 tipo de usuario sos?"),r(),n(3,"div",5)(4,"div",6),v("click",function(){f(e);let o=u();return C(o.seleccionarTipo("paciente"))})("keyup.enter",function(){f(e);let o=u();return C(o.seleccionarTipo("paciente"))})("keyup.space",function(){f(e);let o=u();return C(o.seleccionarTipo("paciente"))}),n(5,"div",7),b(6,"img",8),n(7,"div",9)(8,"h3",10),d(9,"Paciente"),r()()()(),n(10,"div",11),v("click",function(){f(e);let o=u();return C(o.seleccionarTipo("especialista"))})("keyup.enter",function(){f(e);let o=u();return C(o.seleccionarTipo("especialista"))})("keyup.space",function(){f(e);let o=u();return C(o.seleccionarTipo("especialista"))}),n(11,"div",7),b(12,"img",12),n(13,"div",9)(14,"h3",10),d(15,"Especialista"),r()()()()()()}}function it(i,t){i&1&&(n(0,"mat-error"),d(1,"Campo obligatorio"),r())}function at(i,t){i&1&&(n(0,"mat-error"),d(1,"M\xEDnimo 2 caracteres"),r())}function rt(i,t){i&1&&(n(0,"mat-error"),d(1,"Solo letras"),r())}function ot(i,t){i&1&&(n(0,"mat-error"),d(1,"Campo obligatorio"),r())}function nt(i,t){i&1&&(n(0,"mat-error"),d(1,"M\xEDnimo 2 caracteres"),r())}function lt(i,t){i&1&&(n(0,"mat-error"),d(1,"Solo letras"),r())}function st(i,t){i&1&&(n(0,"mat-error"),d(1,"Campo obligatorio"),r())}function ct(i,t){i&1&&(n(0,"mat-error"),d(1,"M\xEDnimo 18"),r())}function dt(i,t){i&1&&(n(0,"mat-error"),d(1,"M\xE1ximo 99"),r())}function pt(i,t){i&1&&(n(0,"mat-error"),d(1,"Campo obligatorio"),r())}function mt(i,t){i&1&&(n(0,"mat-error"),d(1,"Debe contener 8 d\xEDgitos"),r())}function ut(i,t){if(i&1&&(n(0,"mat-option",33),d(1),r()),i&2){let e=t.$implicit;_("value",e),s(),$(e)}}function gt(i,t){i&1&&(n(0,"mat-error"),d(1,"Campo obligatorio"),r())}function _t(i,t){if(i&1&&(n(0,"mat-form-field",14)(1,"mat-label"),d(2,"Obra Social"),r(),n(3,"mat-select",32),H(4,ut,2,2,"mat-option",33,L),r(),p(6,gt,2,0,"mat-error"),r()),i&2){let e,a,o=u(2);_("ngClass",S(2,T,((e=o.registroForm.get("obraSocial"))==null?null:e.valid)&&(((e=o.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=o.registroForm.get("obraSocial"))==null?null:e.touched)),((e=o.registroForm.get("obraSocial"))==null?null:e.invalid)&&(((e=o.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=o.registroForm.get("obraSocial"))==null?null:e.touched)))),s(4),G(o.obraSocialOptions),s(2),m((a=o.registroForm.get("obraSocial"))!=null&&a.hasError("required")?6:-1)}}function ht(i,t){i&1&&(n(0,"mat-error"),d(1,"Campo obligatorio"),r())}function ft(i,t){i&1&&(n(0,"mat-error"),d(1,"Email inv\xE1lido"),r())}function Ct(i,t){i&1&&(n(0,"mat-error"),d(1,"Campo obligatorio"),r())}function vt(i,t){i&1&&(n(0,"mat-error"),d(1,"M\xEDnimo 7 caracteres"),r())}function bt(i,t){if(i&1){let e=k();n(0,"mat-checkbox",47),v("change",function(){let o=f(e).$implicit,c=u(4);return C(c.toggleEspecialidad(o.id))}),d(1),r()}if(i&2){let e=t.$implicit,a=u(4);_("checked",a.esEspecialidadSeleccionada(e.id)),s(),M(" ",e.nombre," ")}}function xt(i,t){i&1&&(n(0,"div",49),d(1,"M\xEDnimo 4 caracteres"),r())}function Et(i,t){i&1&&(n(0,"div",49),d(1," Solo letras y espacios permitidos "),r())}function yt(i,t){if(i&1){let e=k();n(0,"div",46)(1,"input",48),v("click",function(o){return f(e),C(o.stopPropagation())})("keyup.enter",function(o){return f(e),u(4).agregarNuevaEspecialidad(),C(o.stopPropagation())}),r(),p(2,xt,2,0,"div",49),p(3,Et,2,0,"div",49),n(4,"button",50),v("click",function(o){return f(e),u(4).agregarNuevaEspecialidad(),C(o.stopPropagation())}),d(5," \u2713 Confirmar y agregar "),r()()}if(i&2){let e,a,o,c=u(4);s(2),m((e=c.registroForm.get("nuevaEspecialidad"))!=null&&e.hasError("minlength")&&((e=c.registroForm.get("nuevaEspecialidad"))!=null&&e.touched)?2:-1),s(),m((a=c.registroForm.get("nuevaEspecialidad"))!=null&&a.hasError("pattern")&&((a=c.registroForm.get("nuevaEspecialidad"))!=null&&a.touched)?3:-1),s(),_("disabled",((o=c.registroForm.get("nuevaEspecialidad"))==null?null:o.invalid)||!(!((o=c.registroForm.get("nuevaEspecialidad"))==null||o.value==null)&&o.value.trim()))}}function Ft(i,t){if(i&1){let e=k();n(0,"div",41)(1,"div",42),H(2,bt,2,2,"mat-checkbox",43,L),r(),n(4,"div",44)(5,"button",45),v("click",function(o){return f(e),u(3).toggleMostrarNuevaEspecialidad(),C(o.stopPropagation())}),d(6),r(),p(7,yt,6,3,"div",46),r()()}if(i&2){let e=u(3);A("max-h-60",!e.mostrarCampoOtraEspecialidad)("max-h-96",e.mostrarCampoOtraEspecialidad),s(2),G(e.especialidadOptions),s(4),M(" ",e.mostrarCampoOtraEspecialidad?"\u2715 Cancelar":"+ Agregar nueva especialidad"," "),s(),m(e.mostrarCampoOtraEspecialidad?7:-1)}}function St(i,t){i&1&&(n(0,"div",40),d(1," Deb\xE9s seleccionar al menos una especialidad o agregar una nueva "),r())}function wt(i,t){if(i&1){let e=k();n(0,"div",21)(1,"div",34),d(2," Especialidades (seleccion\xE1 al menos una) "),r(),n(3,"div",35)(4,"div",36),v("click",function(o){f(e);let c=u(2);return C(c.toggleDesplegableEspecialidades(o))})("keyup.enter",function(o){f(e);let c=u(2);return C(c.toggleDesplegableEspecialidades(o))})("keyup.space",function(o){f(e);let c=u(2);return C(c.toggleDesplegableEspecialidades(o))}),n(5,"span",37),d(6),r(),n(7,"mat-icon",38),d(8),r()(),p(9,Ft,8,6,"div",39),r(),p(10,St,2,0,"div",40),r()}if(i&2){let e,a=u(2);s(4),A("border-azul-oscuro",a.desplegableEspecialidadesAbierto),s(2),M(" ",a.obtenerEspecialidadesSeleccionadasTexto()," "),s(2),$(a.desplegableEspecialidadesAbierto?"expand_less":"expand_more"),s(),m(a.desplegableEspecialidadesAbierto?9:-1),s(),m((e=a.registroForm.get("especialidadesSeleccionadas"))!=null&&e.hasError("alMenosUna")&&((e=a.registroForm.get("especialidadesSeleccionadas"))!=null&&e.touched)?10:-1)}}function Rt(i,t){i&1&&(n(0,"mat-error"),d(1," Debe seleccionar una imagen de perfil. "),r())}function Vt(i,t){i&1&&(n(0,"mat-error"),d(1," Solo se permiten archivos .jpg o .png "),r())}function kt(i,t){i&1&&(n(0,"mat-error"),d(1," Debe seleccionar una imagen de fondo. "),r())}function Tt(i,t){i&1&&(n(0,"mat-error"),d(1," Solo se permiten archivos .jpg o .png "),r())}function At(i,t){if(i&1){let e=k();n(0,"div",22)(1,"label",51),d(2,"Foto Fondo"),r(),n(3,"input",52),v("change",function(o){f(e);let c=u(2);return C(c.onFileSelected(o,"fondo"))}),r(),p(4,kt,2,0,"mat-error"),p(5,Tt,2,0,"mat-error"),r()}if(i&2){let e,a,o=u(2);s(4),m((e=o.registroForm.get("imagenFondo"))!=null&&e.hasError("required")?4:-1),s(),m((a=o.registroForm.get("imagen"))!=null&&a.hasError("invalidType")?5:-1)}}function Mt(i,t){i&1&&(n(0,"div",30),d(1," Debe resolver correctamente el CAPTCHA. "),r())}function Pt(i,t){if(i&1){let e=k();n(0,"div",3)(1,"form",13),v("ngSubmit",function(){f(e);let o=u();return C(o.registrar())}),n(2,"mat-form-field",14)(3,"mat-label"),d(4,"Nombre"),r(),b(5,"input",15),p(6,it,2,0,"mat-error"),p(7,at,2,0,"mat-error"),p(8,rt,2,0,"mat-error"),r(),n(9,"mat-form-field",14)(10,"mat-label"),d(11,"Apellido"),r(),b(12,"input",16),p(13,ot,2,0,"mat-error"),p(14,nt,2,0,"mat-error"),p(15,lt,2,0,"mat-error"),r(),n(16,"mat-form-field",14)(17,"mat-label"),d(18,"Edad"),r(),b(19,"input",17),p(20,st,2,0,"mat-error"),p(21,ct,2,0,"mat-error"),p(22,dt,2,0,"mat-error"),r(),n(23,"mat-form-field",14)(24,"mat-label"),d(25,"DNI"),r(),b(26,"input",18),p(27,pt,2,0,"mat-error"),p(28,mt,2,0,"mat-error"),r(),p(29,_t,7,5,"mat-form-field",14),n(30,"mat-form-field",14)(31,"mat-label"),d(32,"Email"),r(),b(33,"input",19),p(34,ht,2,0,"mat-error"),p(35,ft,2,0,"mat-error"),r(),n(36,"mat-form-field",14)(37,"mat-label"),d(38,"Contrase\xF1a"),r(),b(39,"input",20),p(40,Ct,2,0,"mat-error"),p(41,vt,2,0,"mat-error"),r(),p(42,wt,11,6,"div",21),n(43,"div",22)(44,"label",23),d(45,"Foto Perfil"),r(),n(46,"input",24),v("change",function(o){f(e);let c=u();return C(c.onFileSelected(o,"perfil"))}),r(),p(47,Rt,2,0,"mat-error"),p(48,Vt,2,0,"mat-error"),r(),p(49,At,6,2,"div",22),n(50,"div",25)(51,"button",26)(52,"span"),d(53,"Registrarse"),r()()(),n(54,"div",27)(55,"button",28),v("click",function(){f(e);let o=u();return C(o.tipoUsuario=null)}),d(56," Cambiar tipo de usuario "),r()(),n(57,"div",29),p(58,Mt,2,0,"div",30),n(59,"app-mi-captcha",31),v("captchaResuelto",function(o){f(e);let c=u();return C(c.onCaptchaResuelto(o))}),r()()()()}if(i&2){let e,a,o,c,g,V,P,O,x,W,Z,Q,E,J,K,y,X,Y,F,ee,te,ie,ae,l=u();s(),_("formGroup",l.registroForm),s(),_("ngClass",S(29,T,((e=l.registroForm.get("nombre"))==null?null:e.valid)&&(((e=l.registroForm.get("nombre"))==null?null:e.dirty)||((e=l.registroForm.get("nombre"))==null?null:e.touched)),((e=l.registroForm.get("nombre"))==null?null:e.invalid)&&(((e=l.registroForm.get("nombre"))==null?null:e.dirty)||((e=l.registroForm.get("nombre"))==null?null:e.touched)))),s(4),m((a=l.registroForm.get("nombre"))!=null&&a.hasError("required")?6:-1),s(),m((o=l.registroForm.get("nombre"))!=null&&o.hasError("minlength")?7:-1),s(),m((c=l.registroForm.get("nombre"))!=null&&c.hasError("pattern")?8:-1),s(),_("ngClass",S(32,T,((g=l.registroForm.get("apellido"))==null?null:g.valid)&&(((g=l.registroForm.get("apellido"))==null?null:g.dirty)||((g=l.registroForm.get("apellido"))==null?null:g.touched)),((g=l.registroForm.get("apellido"))==null?null:g.invalid)&&(((g=l.registroForm.get("apellido"))==null?null:g.dirty)||((g=l.registroForm.get("apellido"))==null?null:g.touched)))),s(4),m((V=l.registroForm.get("apellido"))!=null&&V.hasError("required")?13:-1),s(),m((P=l.registroForm.get("apellido"))!=null&&P.hasError("minlength")?14:-1),s(),m((O=l.registroForm.get("apellido"))!=null&&O.hasError("pattern")?15:-1),s(),_("ngClass",S(35,T,((x=l.registroForm.get("edad"))==null?null:x.valid)&&(((x=l.registroForm.get("edad"))==null?null:x.dirty)||((x=l.registroForm.get("edad"))==null?null:x.touched)),((x=l.registroForm.get("edad"))==null?null:x.invalid)&&(((x=l.registroForm.get("edad"))==null?null:x.dirty)||((x=l.registroForm.get("edad"))==null?null:x.touched)))),s(4),m((W=l.registroForm.get("edad"))!=null&&W.hasError("required")?20:-1),s(),m((Z=l.registroForm.get("edad"))!=null&&Z.hasError("min")?21:-1),s(),m((Q=l.registroForm.get("edad"))!=null&&Q.hasError("max")?22:-1),s(),_("ngClass",S(38,T,((E=l.registroForm.get("dni"))==null?null:E.valid)&&(((E=l.registroForm.get("dni"))==null?null:E.dirty)||((E=l.registroForm.get("dni"))==null?null:E.touched)),((E=l.registroForm.get("dni"))==null?null:E.invalid)&&(((E=l.registroForm.get("dni"))==null?null:E.dirty)||((E=l.registroForm.get("dni"))==null?null:E.touched)))),s(4),m((J=l.registroForm.get("dni"))!=null&&J.hasError("required")?27:-1),s(),m((K=l.registroForm.get("dni"))!=null&&K.hasError("pattern")?28:-1),s(),m(l.tipoUsuario==="paciente"?29:-1),s(),_("ngClass",S(41,T,((y=l.registroForm.get("mail"))==null?null:y.valid)&&(((y=l.registroForm.get("mail"))==null?null:y.dirty)||((y=l.registroForm.get("mail"))==null?null:y.touched)),((y=l.registroForm.get("mail"))==null?null:y.invalid)&&(((y=l.registroForm.get("mail"))==null?null:y.dirty)||((y=l.registroForm.get("mail"))==null?null:y.touched)))),s(4),m((X=l.registroForm.get("mail"))!=null&&X.hasError("required")?34:-1),s(),m((Y=l.registroForm.get("mail"))!=null&&Y.hasError("email")?35:-1),s(),_("ngClass",S(44,T,((F=l.registroForm.get("password"))==null?null:F.valid)&&(((F=l.registroForm.get("password"))==null?null:F.dirty)||((F=l.registroForm.get("password"))==null?null:F.touched)),((F=l.registroForm.get("password"))==null?null:F.invalid)&&(((F=l.registroForm.get("password"))==null?null:F.dirty)||((F=l.registroForm.get("password"))==null?null:F.touched)))),s(4),m((ee=l.registroForm.get("password"))!=null&&ee.hasError("required")?40:-1),s(),m((te=l.registroForm.get("password"))!=null&&te.hasError("minlength")?41:-1),s(),m(l.tipoUsuario==="especialista"?42:-1),s(5),m((ie=l.registroForm.get("imagenPerfil"))!=null&&ie.hasError("required")?47:-1),s(),m((ae=l.registroForm.get("imagen"))!=null&&ae.hasError("invalidType")?48:-1),s(),m(l.tipoUsuario==="paciente"?49:-1),s(2),_("disabled",l.registroForm.invalid),s(7),m(l.registroForm.errors!=null&&l.registroForm.errors.captchaInvalido&&l.registroForm.touched?58:-1)}}var He=class i{registroForm;tipoUsuario=null;obraSocialOptions=Le;especialidadOptions=[];especialidadesSeleccionadas=new Set;captchaEsValido=!1;mostrarCampoOtraEspecialidad=!1;desplegableEspecialidadesAbierto=!1;captchaValidoValidator=()=>()=>this.captchaEsValido?null:{captchaInvalido:!0};subEspecialidad;subReset;fb=R(Se);auth=R(q);snackBar=R(Ae);router=R(_e);loading=R(Ve);elementRef=R(oe);registerState=R(Ce);ngOnInit(){this.registroForm=this.fb.group({nombre:["",[h.required,h.minLength(2),h.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],apellido:["",[h.required,h.minLength(2),h.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],edad:[null,[h.required,h.min(18),h.max(99)]],dni:["",[h.required,h.pattern(/^\d{8}$/)]],obraSocial:[""],mail:["",[h.required,h.email]],password:["",[h.required,h.minLength(7)]],especialidadesSeleccionadas:[[]],nuevaEspecialidad:["",[h.minLength(4),h.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],imagenPerfil:[null,h.required],imagenFondo:[""]},{validators:this.captchaValidoValidator()}),this.subReset=this.registerState.reset$.subscribe(()=>{this.resetearFormulario()})}ngOnDestroy(){this.subEspecialidad&&this.subEspecialidad.unsubscribe(),this.subReset&&this.subReset.unsubscribe()}seleccionarTipo(t){return w(this,null,function*(){if(this.tipoUsuario=t,!!this.registroForm){if(t==="especialista")try{this.loading.show(),this.especialidadOptions=yield this.auth.obtenerEspecialidades(),this.especialidadesSeleccionadas.clear()}catch(e){console.error("Error al obtener especialidades:",e),this.snackBar.open("Error al cargar especialidades. Intente nuevamente.","Cerrar",{duration:3e3})}finally{this.loading.hide()}t==="paciente"?(this.registroForm.get("obraSocial")?.setValidators([h.required]),this.registroForm.get("imagenFondo")?.setValidators([h.required]),this.registroForm.get("especialidadesSeleccionadas")?.clearValidators(),this.registroForm.get("nuevaEspecialidad")?.clearValidators()):(this.registroForm.get("obraSocial")?.clearValidators(),this.registroForm.get("imagenFondo")?.clearValidators(),this.registroForm.get("especialidadesSeleccionadas")?.setValidators([this.alMenosUnaEspecialidadValidator()])),this.registroForm.get("obraSocial")?.updateValueAndValidity(),this.registroForm.get("imagenFondo")?.updateValueAndValidity(),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity()}})}alMenosUnaEspecialidadValidator(){return t=>{let e=t.value||[],a=this.registroForm?.get("nuevaEspecialidad")?.value;return e.length===0&&!a?{alMenosUna:!0}:null}}toggleEspecialidad(t){this.especialidadesSeleccionadas.has(t)?this.especialidadesSeleccionadas.delete(t):this.especialidadesSeleccionadas.add(t),this.actualizarEspecialidadesEnForm()}toggleMostrarNuevaEspecialidad(){this.mostrarCampoOtraEspecialidad=!this.mostrarCampoOtraEspecialidad,this.mostrarCampoOtraEspecialidad||this.registroForm.get("nuevaEspecialidad")?.setValue("")}normalizarNombre(t){return t=t.trim(),t&&t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}agregarNuevaEspecialidad(){let t=this.registroForm.get("nuevaEspecialidad"),e=t?.value?.trim();if(!e||t?.invalid){this.snackBar.open("Por favor, ingrese un nombre v\xE1lido para la especialidad.","Cerrar",{duration:3e3});return}let a=this.normalizarNombre(e);if(this.especialidadOptions.some(V=>V.nombre.toLowerCase()===a.toLowerCase())){this.snackBar.open("Esta especialidad ya existe. Por favor, selecci\xF3nela de la lista.","Cerrar",{duration:3e3});return}let c=-(this.especialidadOptions.length+1),g={id:c,nombre:a};this.especialidadOptions.push(g),this.especialidadesSeleccionadas.add(c),this.actualizarEspecialidadesEnForm(),t&&t.setValue(""),this.mostrarCampoOtraEspecialidad=!1,this.snackBar.open(`Especialidad "${a}" agregada y seleccionada.`,"Cerrar",{duration:3e3,panelClass:["bg-green-600","text-white"]})}toggleDesplegableEspecialidades(t){t&&t.stopPropagation(),this.desplegableEspecialidadesAbierto=!this.desplegableEspecialidadesAbierto}onClickOutside(t){if(!this.desplegableEspecialidadesAbierto)return;let e=t.target;this.elementRef.nativeElement.querySelector(".relative")?.contains(e)||(this.desplegableEspecialidadesAbierto=!1)}obtenerEspecialidadesSeleccionadasTexto(){return this.especialidadesSeleccionadas.size===0?"Ninguna seleccionada":Array.from(this.especialidadesSeleccionadas).map(e=>this.especialidadOptions.find(a=>a.id===e)?.nombre).filter(e=>e).join(", ")}esEspecialidadSeleccionada(t){return this.especialidadesSeleccionadas.has(t)}actualizarEspecialidadesEnForm(){let t=Array.from(this.especialidadesSeleccionadas);this.registroForm.get("especialidadesSeleccionadas")?.setValue(t),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity()}onFileSelected(t,e){let a=e==="perfil"?"imagenPerfil":"imagenFondo",o=t.target,c=this.registroForm.get(a);if(!o.files?.length){c.setValue(null),c.setErrors({required:!0});return}let g=o.files[0];if(!["image/jpeg","image/png","image/jpg"].includes(g.type)){c.setErrors({invalidType:!0});return}c.setValue(g),c.setErrors(null)}registrar(){return w(this,null,function*(){if(!(this.registroForm.invalid||!this.tipoUsuario)){this.loading.show();try{this.tipoUsuario==="paciente"?yield this.handleRegistroPaciente():yield this.handleRegistroEspecialista()}finally{this.loading.hide()}}})}handleRegistroPaciente(){return w(this,null,function*(){try{let t=this.registroForm.value,e=yield B(t.imagenPerfil),a=yield B(t.imagenFondo),o={nombre:t.nombre,apellido:t.apellido,edad:t.edad,dni:t.dni,obraSocial:t.obraSocial,mail:t.mail,contrasena:t.password,imagenPerfil:e,imagenFondo:a},c=yield this.auth.registerPaciente(o);c.errorCode?.toLowerCase()?.includes("error desconocido")?this.mostrarResultado(c.success,c.message):this.mostrarResultado(c.success,c.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar las im\xE1genes.")}})}handleRegistroEspecialista(){return w(this,null,function*(){try{let t=this.registroForm.value,e=yield B(t.imagenPerfil),a=[];t.especialidadesSeleccionadas&&t.especialidadesSeleccionadas.length>0&&t.especialidadesSeleccionadas.forEach(V=>{if(V>0)a.push(String(V));else{let P=this.especialidadOptions.find(O=>O.id===V);P&&a.push(P.nombre)}});let o={nombre:t.nombre,apellido:t.apellido,edad:t.edad,dni:t.dni,mail:t.mail,contrasena:t.password,especialidades:a,imagenPerfil:e},c=yield this.auth.registerEspecialista(o);c.errorCode?.toLowerCase()?.includes("error desconocido")?this.mostrarResultado(c.success,c.message):this.mostrarResultado(c.success,c.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar la imagen.")}})}mostrarResultado(t,e){if(!t){this.snackBar.open(e||"Ocurri\xF3 un error.","Cerrar",{duration:4e3,panelClass:["bg-red-600","text-white"]});return}this.tipoUsuario=null,this.router.navigate(["/welcome-page/confirmacion"])}onCaptchaResuelto(t){this.captchaEsValido=t,this.registroForm.updateValueAndValidity()}resetearFormulario(){this.tipoUsuario=null,this.especialidadesSeleccionadas.clear(),this.captchaEsValido=!1,this.mostrarCampoOtraEspecialidad=!1,this.desplegableEspecialidadesAbierto=!1,this.registroForm.reset(),this.especialidadOptions=this.especialidadOptions.filter(t=>t.id>0),window.scrollTo({top:0,behavior:"smooth"})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-register"]],hostBindings:function(e,a){e&1&&v("click",function(c){return a.onClickOutside(c)},le)},decls:5,vars:2,consts:[[1,"min-h-screen","bg-gray-200","pt-30","pb-60"],[1,"pb-1","text-center","text-4xl","font-bold","text-azul-oscuro"],[1,"pt-16","pb-30","text-center"],[1,"flex","justify-center","py-8"],[1,"mb-6","text-xl","text-gray-700"],[1,"flex","flex-col","items-center","gap-6"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Paciente",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],[1,"rounded-2xl","bg-white","shadow-lg"],["src","assets/imagenes/Registro/pacientes.webp","alt","Paciente",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"p-4"],[1,"text-xl","font-bold","text-azul-oscuro"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Especialista",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],["src","assets/imagenes/Registro/especialistas.webp","alt","Especialista",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"grid","w-full","max-w-2xl","grid-cols-1","gap-4","rounded-xl","bg-crema","p-8","shadow-lg","md:grid-cols-2",3,"ngSubmit","formGroup"],["appearance","fill",1,"col-span-1",3,"ngClass"],["matInput","","formControlName","nombre"],["matInput","","formControlName","apellido"],["matInput","","type","number","formControlName","edad"],["matInput","","formControlName","dni"],["matInput","","type","email","formControlName","mail"],["matInput","","type","password","formControlName","password"],[1,"col-span-2"],[1,"col-span-2","flex","flex-col","gap-2"],["for","fotoPerfil",1,"font-semibold","text-azul-oscuro"],["id","fotoPerfil","type","file","accept","image/*",1,"register-input",3,"change"],[1,"col-span-2","flex","justify-center"],["mat-raised-button","","color","primary","type","submit",1,"flex","items-center","justify-center","gap-2","rounded-full","bg-verde-oscuro","px-8","py-2","text-white","shadow-lg",3,"disabled"],[1,"col-span-2","mt-1","flex","justify-center"],["mat-button","","type","button",1,"text-sm","text-gray-600","underline",3,"click"],[1,"col-span-2","mt-1","flex","flex-col","items-center"],[1,"mb-2","text-center","text-sm","text-red-600"],[3,"captchaResuelto"],["formControlName","obraSocial"],[3,"value"],[1,"mb-1","text-sm","font-medium","text-azul-oscuro"],[1,"relative"],["tabindex","0",1,"flex","min-h-[56px]","cursor-pointer","items-center","rounded-md","border","border-gray-300","bg-white","px-4","py-3","transition-colors","hover:border-azul-oscuro",3,"click","keyup.enter","keyup.space"],[1,"flex-1","text-sm","text-gray-700"],[1,"text-gray-500"],[1,"absolute","top-full","right-0","left-0","z-10","mt-1","overflow-y-auto","rounded-lg","border","border-gray-300","bg-white","p-3","shadow-lg","transition-all","duration-300",3,"max-h-60","max-h-96"],[1,"mt-1","text-sm","text-red-600"],[1,"absolute","top-full","right-0","left-0","z-10","mt-1","overflow-y-auto","rounded-lg","border","border-gray-300","bg-white","p-3","shadow-lg","transition-all","duration-300"],[1,"space-y-2"],[1,"block","text-sm",3,"checked"],[1,"mt-3","border-t","pt-2"],["type","button","mat-button","",1,"w-full","text-left","text-sm","text-azul-oscuro",3,"click"],[1,"mt-2","space-y-2"],[1,"block","text-sm",3,"change","checked"],["formControlName","nuevaEspecialidad","placeholder","Nombre de la especialidad",1,"w-full","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:border-azul-oscuro","focus:outline-none",3,"click","keyup.enter"],[1,"text-xs","text-red-600"],["type","button","mat-raised-button","","color","primary",1,"w-full","text-sm",3,"click","disabled"],["for","fotoFondo",1,"font-semibold","text-azul-oscuro"],["id","fotoFondo","type","file","accept","image/*",1,"register-input",3,"change"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2",1),d(2,"Registro"),r(),p(3,tt,16,0,"div",2),p(4,Pt,60,47,"div",3),r()),e&2&&(s(3),m(!a.tipoUsuario&&a.registroForm?3:-1),s(),m(a.tipoUsuario&&a.registroForm?4:-1))},dependencies:[D,N,Re,xe,z,Ee,j,ve,ye,Fe,Ie,Oe,Me,Pe,De,Ne,Be,je,ze,Te,ke,fe,he,Ue,qe,U],styles:[".register-input[_ngcontent-%COMP%]{padding:12px 20px;margin:10px 0;border:2px solid #333;border-radius:6px;background-color:#222;color:#fff;font-size:16px;cursor:pointer;transition:all .3s ease}.register-input[_ngcontent-%COMP%]:hover{border-color:#92cc34;background-color:#2c2c2c}.register-input[_ngcontent-%COMP%]:focus{border-color:#19b44d;background-color:#2c2c2c;outline:none}.register-input[_ngcontent-%COMP%]::-webkit-file-upload-button{background-color:#fff;color:#fff;padding:8px 15px;border-radius:4px;border:none;cursor:pointer;font-size:14px;transition:background-color .3s ease}"]})};export{He as Register};
