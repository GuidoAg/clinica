import"./chunk-GGQ7LRWG.js";import{a as G}from"./chunk-YHDM7GGE.js";import{c as N,d as A,f as M,g as H,h as O,i as j,j as P}from"./chunk-P2GLRHRS.js";import{a as z,b as q}from"./chunk-2R7LN7ZU.js";import{n as W}from"./chunk-ZTAJVVXQ.js";import{a as L}from"./chunk-QYWCDNK3.js";import{c as U}from"./chunk-NSHH6JJ5.js";import"./chunk-X5YLR3NI.js";import"./chunk-Q4YNZBQ2.js";import"./chunk-HICRNNMR.js";import"./chunk-M3XRSK3P.js";import{Db as x,Fb as r,Ma as k,Oa as c,P as V,Rb as S,Ta as C,Tb as l,Ub as w,Vb as B,Wb as I,Za as $,ca as f,da as _,f as F,mc as v,na as d,nb as u,ob as m,pb as y,qb as T,rb as E,sb as D,tb as o,ub as s,vb as b,zb as g}from"./chunk-7RTQA4J5.js";import{i as h}from"./chunk-ODN5LVDJ.js";function R(i,t){if(i&1){let e=g();o(0,"button",8),x("click",function(){let n=f(e).$implicit,p=r(2);return _(p.seleccionarEspecialista(n))}),b(1,"img",9),o(2,"span",10),l(3),s()()}if(i&2){let e,a=t.$implicit,n=r(2);S("opacity-50",n.especialistaSeleccionado()&&n.especialistaSeleccionado().id!==a.id),c(),S("border-blue-600",((e=n.especialistaSeleccionado())==null?null:e.id)===a.id),D("src",a.imagenPerfil||"assets/default-avatar.png",k),c(2),I("",a.nombre," ",a.apellido)}}function X(i,t){if(i&1&&(o(0,"div")(1,"h2",5),l(2," Seleccion\xE1 un profesional "),s(),o(3,"div",6),T(4,R,4,7,"button",7,y),s()()),i&2){let e=r();c(4),E(e.especialistasValidados())}}function Y(i,t){i&1&&(o(0,"div",3)(1,"p",11),l(2," No se encontraron especialistas con fechas disponibles en los pr\xF3ximos 15 d\xEDas. "),s()())}function Z(i,t){if(i&1){let e=g();o(0,"button",14),x("click",function(){let n=f(e).$implicit,p=r(2);return _(p.seleccionarEspecialidad(n))}),b(1,"img",15),o(2,"span",16),l(3),s()()}if(i&2){let e,a=t.$implicit,n=r(2);S("border-blue-600",((e=n.especialidadSeleccionada())==null?null:e.id)===a.id)("opacity-50",n.especialidadSeleccionada()&&n.especialidadSeleccionada().id!==a.id),D("@especialidadAnimacion",void 0),c(),D("src",a.icono||"assets/default-icon.png",k),c(2),w(a.nombre)}}function ee(i,t){i&1&&(o(0,"p",13),l(1," No hay especialidades disponibles. "),s())}function ie(i,t){if(i&1&&(o(0,"div")(1,"h2",5),l(2," ---- Seleccion\xE1 una especialidad ---- "),s(),o(3,"div",6),T(4,Z,4,7,"button",12,y),s(),u(6,ee,2,0,"p",13),s()),i&2){let e=r();c(3),D("@listaAnimacion",void 0),c(),E(e.especialidades()),c(2),m(e.noHayEspecialidades()?6:-1)}}function te(i,t){if(i&1){let e=g();o(0,"button",19),x("click",function(){let n=f(e).$implicit,p=r(2);return _(p.seleccionarFecha(n))}),l(1),s()}if(i&2){let e=t.$implicit,a=r(2);S("bg-blue-600",a.fechaSeleccionada()===e)("text-white",a.fechaSeleccionada()===e),c(),B(" ",e," ")}}function ae(i,t){i&1&&(o(0,"p",13),l(1,"No hay d\xEDas disponibles."),s())}function ne(i,t){if(i&1&&(o(0,"div")(1,"h2",5),l(2," ---- Seleccion\xE1 un d\xEDa ---- "),s(),o(3,"div",17),T(4,te,2,5,"button",18,y),s(),u(6,ae,2,0,"p",13),s()),i&2){let e=r();c(4),E(e.fechasDisponibles()),c(2),m(e.noHayFechas()?6:-1)}}function oe(i,t){if(i&1){let e=g();o(0,"button",21),x("click",function(){let n=f(e).$implicit,p=r(2);return _(p.seleccionarHorario(n))}),l(1),s()}if(i&2){let e=t.$implicit,a=r(2);S("bg-green-500",a.horaSelecionada()===e)("text-white",a.horaSelecionada()===e),c(),B(" ",e," ")}}function se(i,t){i&1&&(o(0,"p",13),l(1," No hay turnos disponibles. "),s())}function ce(i,t){if(i&1&&(o(0,"div")(1,"h2",5),l(2," ---- Seleccion\xE1 un horario ---- "),s(),o(3,"div",17),T(4,oe,2,5,"button",20,y),s(),u(6,se,2,0,"p",13),s()),i&2){let e=r();c(4),E(e.horariosDisponibles()),c(2),m(e.noHayHorarios()?6:-1)}}function le(i,t){if(i&1){let e=g();o(0,"div",4)(1,"p",22),l(2," Seleccionaste: "),o(3,"strong"),l(4),s(),b(5,"br"),l(6," Especialidad: "),o(7,"strong"),l(8),s(),b(9,"br"),l(10," D\xEDa: "),o(11,"strong"),l(12),s(),b(13,"br"),l(14," Hora: "),o(15,"strong"),l(16),s()(),o(17,"div",23)(18,"button",24),x("click",function(){f(e);let n=r();return _(n.cargarCita())}),l(19," Confirmar "),s()()()}if(i&2){let e,a,n=r();c(4),I("",(e=n.especialistaSeleccionado())==null?null:e.nombre," ",(e=n.especialistaSeleccionado())==null?null:e.apellido),c(4),w((a=n.especialidadSeleccionada())==null?null:a.nombre),c(4),w(n.fechaSeleccionada()),c(4),w(n.horaSelecionada())}}var J=class i{constructor(t,e,a,n){this.turnosService=t;this.loadin=e;this.authSupabase=a;this.snackBar=n;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new F;especialistas=d([]);especialidades=d([]);fechasDisponibles=d([]);horariosDisponibles=d([]);especialistaSeleccionado=d(null);especialidadSeleccionada=d(null);fechaSeleccionada=d(null);horaSelecionada=d(null);especialidadesBuscadas=d(!1);diasBuscados=d(!1);horasBuscadas=d(!1);especialistasBuscados=d(!1);cargando=d(!1);especialistasValidados=v(()=>this.especialistas().filter(t=>t.validadoAdmin===!0));noHayEspecialistas=v(()=>this.especialistasBuscados()===!0&&this.especialistas().length===0);noHayEspecialidades=v(()=>this.especialistaSeleccionado()!==null&&this.especialidadesBuscadas()===!0&&this.especialidades().length===0);noHayFechas=v(()=>this.especialidadSeleccionada()!==null&&this.diasBuscados()===!0&&this.fechasDisponibles().length===0);noHayHorarios=v(()=>this.fechaSeleccionada()!==null&&this.horasBuscadas()===!0&&this.horariosDisponibles().length===0);ngOnInit(){return h(this,null,function*(){this.usuario$.pipe(V(this.destroy$)).subscribe(e=>{if(!e){this.usuarioActual=null;return}e.id=typeof e.id=="string"?Number(e.id):e.id,this.usuarioActual=e});let t=yield this.turnosService.obtenerEspecialistasConDisponibilidad();this.especialistas.set(t),this.especialistasBuscados.set(!0),this.loadin.hide()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}seleccionarEspecialista(t){return h(this,null,function*(){this.especialistaSeleccionado.set(t),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.fechasDisponibles.set([]),this.especialidadesBuscadas.set(!1),this.diasBuscados.set(!1),this.horasBuscadas.set(!1),this.cargando.set(!0);let e=yield this.turnosService.obtenerEspecialidadesDeEspecialista(t.id);this.especialidades.set(e),this.especialidadesBuscadas.set(!0),this.cargando.set(!1)})}seleccionarEspecialidad(t){return h(this,null,function*(){this.especialidadSeleccionada.set(t),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.cargando.set(!0);let e=yield this.turnosService.obtenerFechasConHorariosDisponibles(this.especialistaSeleccionado().id,t.duracion);this.fechasDisponibles.set(e),this.diasBuscados.set(!0),this.cargando.set(!1)})}seleccionarFecha(t){return h(this,null,function*(){this.horaSelecionada.set(null),this.fechaSeleccionada.set(t),this.cargando.set(!0);let e=yield this.turnosService.obtenerHorariosDisponibles(t,this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion);this.horariosDisponibles.set(e),this.horasBuscadas.set(!0),this.cargando.set(!1)})}seleccionarHorario(t){this.horaSelecionada.set(t)}cargarCita(){return h(this,null,function*(){let t=this.fechaSeleccionada(),e=this.horaSelecionada(),a=this.especialistaSeleccionado(),n=this.especialidadSeleccionada(),p=this.usuarioActual;if(!t||!e||!a||!n||!p){console.error("Datos incompletos para agendar la cita");return}let K={fechaHora:new Date(`${t}T${e}:00`),duracionMin:n.duracion,pacienteId:p.id,especialistaId:a.id,especialidadId:n.id,estado:"solicitado",comentarioPaciente:" ",comentarioEspecialista:" ",resenia:" "};try{yield this.turnosService.darAltaCita(K),this.snackBar.open("Cita agendada","exito",{duration:4e3,panelClass:["bg-blue-600","text-white"]}),this.especialistaSeleccionado.set(null),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null)}catch(Q){console.error("Error al cargar la cita:",Q),this.snackBar.open("Ups algo salio mal","error",{duration:4e3,panelClass:["bg-red-600","text-white"]}),this.especialistaSeleccionado.set(null),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null)}})}static \u0275fac=function(e){return new(e||i)(C(G),C(L),C(U),C(W))};static \u0275cmp=$({type:i,selectors:[["app-solicitar-turno"]],decls:10,vars:6,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mx-auto","max-w-4xl","space-y-8","p-4"],[1,"text-center"],[1,"mt-8","text-center"],[1,"mb-4","text-center","text-xl","font-semibold"],[1,"flex","flex-wrap","justify-center","gap-4"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"opacity-50"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"click"],["alt","profesional","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],[1,"text-center","text-sm"],[1,"text-lg","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","hover:bg-blue-50",3,"border-blue-600","opacity-50"],[1,"mt-4","text-center","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","hover:bg-blue-50",3,"click"],["alt","icono","appTrackImage","",1,"mb-2","h-10","w-10",3,"src"],[1,"text-center","text-xs"],[1,"flex","flex-wrap","justify-center","gap-2"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"bg-blue-600","text-white"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"click"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"bg-green-500","text-white"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"click"],[1,"text-sm","text-gray-600"],[1,"pt-4"],[1,"rounded","bg-blue-200","px-4","py-2","text-lg","font-medium","hover:bg-blue-300",3,"click"]],template:function(e,a){e&1&&(o(0,"app-loading-wrapper")(1,"div",0)(2,"div",1)(3,"div",2),u(4,X,6,0,"div"),u(5,Y,3,0,"div",3),u(6,ie,7,2,"div"),u(7,ne,7,1,"div"),u(8,ce,7,1,"div"),u(9,le,20,5,"div",4),s()()()()),e&2&&(c(4),m(a.especialistas().length?4:-1),c(),m(a.noHayEspecialistas()?5:-1),c(),m(a.especialistaSeleccionado()?6:-1),c(),m(a.especialidadSeleccionada()?7:-1),c(),m(a.fechaSeleccionada()?8:-1),c(),m(a.horaSelecionada()?9:-1))},dependencies:[z,q],encapsulation:2,data:{animation:[N("especialidadAnimacion",[H(":enter",[M({opacity:0,transform:"scale(0.5)"}),A("400ms cubic-bezier(0.34, 1.56, 0.64, 1)",M({opacity:1,transform:"scale(1)"}))])]),N("listaAnimacion",[H(":enter",[j("@especialidadAnimacion",P(150,O()),{optional:!0})])])]}})};export{J as SolicitarTurno};
