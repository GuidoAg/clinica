import{a as W}from"./chunk-MGGKR3HB.js";import{b as q}from"./chunk-ISZQ6G3H.js";import"./chunk-GGQ7LRWG.js";import{c as I,d as V,f as v,g as C,h as F,i as $,j as P}from"./chunk-P2GLRHRS.js";import{a as R,b as X}from"./chunk-WKNXHDPQ.js";import{n as Y}from"./chunk-M2F6BYP4.js";import{b as z}from"./chunk-VPTHVLTQ.js";import{k as L}from"./chunk-YDT6XDAL.js";import"./chunk-LMZWYZYD.js";import"./chunk-UIGXKFJS.js";import"./chunk-FFHKXHWV.js";import"./chunk-DDKTLT4U.js";import{Ab as b,Eb as x,Gb as d,Ma as M,Oa as o,P as O,Sb as f,Ta as E,Ub as r,Vb as k,Wb as H,Xb as N,Za as U,ca as S,da as g,f as j,na as p,nb as m,ob as h,oc as B,qb as w,rb as D,sb as A,tb as u,ub as s,vb as c,wb as _}from"./chunk-PTIYVII4.js";import{j as T}from"./chunk-K4ALXBGI.js";function Z(i,t){if(i&1){let e=b();s(0,"button",8),x("click",function(){let n=S(e).$implicit,l=d(3);return g(l.seleccionarPaciente(n))}),_(1,"img",9),s(2,"span",10),r(3),c()()}if(i&2){let e,a=t.$implicit,n=d(3);f("opacity-50",n.pacienteSeleccionado()&&n.pacienteSeleccionado().id!==a.id),u("@botonBounce",void 0),o(),f("border-blue-600",((e=n.pacienteSeleccionado())==null?null:e.id)===a.id),u("src",a.urlImagenPerfil||"assets/default-avatar.png",M),o(2),N("",a.nombre," ",a.apellido)}}function ee(i,t){if(i&1&&(s(0,"div")(1,"h2",5),r(2," Seleccion\xE1 un paciente "),c(),s(3,"div",6),D(4,Z,4,8,"button",7,w),c()()),i&2){let e=d(2);o(3),u("@listaStagger",void 0),o(),A(e.pacientes())}}function ie(i,t){if(i&1){let e=b();s(0,"button",8),x("click",function(){let n=S(e).$implicit,l=d(3);return g(l.seleccionarEspecialista(n))}),_(1,"img",11),s(2,"span",10),r(3),c()()}if(i&2){let e,a=t.$implicit,n=d(3);f("opacity-50",n.especialistaSeleccionado()&&n.especialistaSeleccionado().id!==a.id),u("@botonBounce",void 0),o(),f("border-blue-600",((e=n.especialistaSeleccionado())==null?null:e.id)===a.id),u("src",a.imagenPerfil||"assets/default-avatar.png",M),o(2),N("",a.nombre," ",a.apellido)}}function te(i,t){if(i&1&&(s(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un profesional ---- "),c(),s(3,"div",6),D(4,ie,4,8,"button",7,w),c()()),i&2){let e=d(2);o(3),u("@listaStagger",void 0),o(),A(e.especialistasValidados())}}function ae(i,t){i&1&&(s(0,"div",3)(1,"p",12),r(2," No se encontraron especialistas con fechas disponibles en los pr\xF3ximos 15 d\xEDas. "),c()())}function ne(i,t){if(i&1){let e=b();s(0,"button",15),x("click",function(){let n=S(e).$implicit,l=d(3);return g(l.seleccionarEspecialidad(n))}),_(1,"img",16),s(2,"span",17),r(3),c()()}if(i&2){let e,a=t.$implicit,n=d(3);f("border-blue-600",((e=n.especialidadSeleccionada())==null?null:e.id)===a.id)("opacity-50",n.especialidadSeleccionada()&&n.especialidadSeleccionada().id!==a.id),u("@especialidadAnimacion",void 0),o(),u("src",a.icono||"assets/default-icon.png",M),o(2),k(a.nombre)}}function oe(i,t){i&1&&(s(0,"p",14),r(1," No hay especialidades disponibles. "),c())}function se(i,t){if(i&1&&(s(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 una especialidad ---- "),c(),s(3,"div",6),D(4,ne,4,7,"button",13,w),c(),m(6,oe,2,0,"p",14),c()),i&2){let e=d(2);o(3),u("@listaAnimacion",void 0),o(),A(e.especialidades()),o(2),h(e.noHayEspecialidades()?6:-1)}}function ce(i,t){if(i&1){let e=b();s(0,"button",20),x("click",function(){let n=S(e).$implicit,l=d(3);return g(l.seleccionarFecha(n))}),r(1),c()}if(i&2){let e=t.$implicit,a=d(3);f("bg-blue-600",a.fechaSeleccionada()===e)("text-white",a.fechaSeleccionada()===e),u("@botonBounce",void 0),o(),H(" ",e," ")}}function re(i,t){i&1&&(s(0,"p",14),r(1,"No hay d\xEDas disponibles."),c())}function le(i,t){if(i&1&&(s(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un d\xEDa ---- "),c(),s(3,"div",18),D(4,ce,2,6,"button",19,w),c(),m(6,re,2,0,"p",14),c()),i&2){let e=d(2);o(3),u("@listaStagger",void 0),o(),A(e.fechasDisponibles()),o(2),h(e.noHayFechas()?6:-1)}}function de(i,t){if(i&1){let e=b();s(0,"button",22),x("click",function(){let n=S(e).$implicit,l=d(3);return g(l.seleccionarHorario(n))}),r(1),c()}if(i&2){let e=t.$implicit,a=d(3);f("bg-green-500",a.horaSelecionada()===e)("text-white",a.horaSelecionada()===e),u("@botonBounce",void 0),o(),H(" ",e," ")}}function pe(i,t){i&1&&(s(0,"p",14),r(1," No hay turnos disponibles. "),c())}function ue(i,t){if(i&1&&(s(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un horario ---- "),c(),s(3,"div",18),D(4,de,2,6,"button",21,w),c(),m(6,pe,2,0,"p",14),c()),i&2){let e=d(2);o(3),u("@listaStagger",void 0),o(),A(e.horariosDisponibles()),o(2),h(e.noHayHorarios()?6:-1)}}function me(i,t){if(i&1){let e=b();s(0,"div",4)(1,"p",23),r(2," Paciente: "),s(3,"strong"),r(4),c(),_(5,"br"),r(6," Especialista: "),s(7,"strong"),r(8),c(),_(9,"br"),r(10," Especialidad: "),s(11,"strong"),r(12),c(),_(13,"br"),r(14," D\xEDa: "),s(15,"strong"),r(16),c(),_(17,"br"),r(18," Hora: "),s(19,"strong"),r(20),c()(),s(21,"div",24)(22,"button",25),x("click",function(){S(e);let n=d(2);return g(n.cargarCita())}),r(23," Confirmar "),c()()()}if(i&2){let e,a,n,l=d(2);o(4),N("",(e=l.pacienteSeleccionado())==null?null:e.nombre," ",(e=l.pacienteSeleccionado())==null?null:e.apellido),o(4),N("",(a=l.especialistaSeleccionado())==null?null:a.nombre," ",(a=l.especialistaSeleccionado())==null?null:a.apellido),o(4),k((n=l.especialidadSeleccionada())==null?null:n.nombre),o(4),k(l.fechaSeleccionada()),o(4),k(l.horaSelecionada())}}function he(i,t){if(i&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),m(3,ee,6,1,"div"),m(4,te,6,1,"div"),m(5,ae,3,0,"div",3),m(6,se,7,2,"div"),m(7,le,7,2,"div"),m(8,ue,7,2,"div"),m(9,me,24,7,"div",4),c()()()),i&2){let e=d();u("@slideInFromRight",e.primeraVezAnimando),o(3),h(e.pacientes().length?3:-1),o(),h(e.pacienteSeleccionado()&&e.especialistas().length?4:-1),o(),h(e.pacienteSeleccionado()&&e.noHayEspecialistas()?5:-1),o(),h(e.especialistaSeleccionado()?6:-1),o(),h(e.pacienteSeleccionado()&&e.especialidadSeleccionada()?7:-1),o(),h(e.pacienteSeleccionado()&&e.fechaSeleccionada()?8:-1),o(),h(e.pacienteSeleccionado()&&e.horaSelecionada()?9:-1)}}var G=class i{constructor(t,e,a,n,l){this.turnosService=t;this.loadin=e;this.authSupabase=a;this.snackBar=n;this.usuariosService=l;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new j;especialistas=p([]);especialidades=p([]);fechasDisponibles=p([]);horariosDisponibles=p([]);especialistaSeleccionado=p(null);especialidadSeleccionada=p(null);fechaSeleccionada=p(null);horaSelecionada=p(null);especialidadesBuscadas=p(!1);diasBuscados=p(!1);horasBuscadas=p(!1);especialistasBuscados=p(!1);pacientes=p([]);pacienteSeleccionado=p(null);cargando=p(!1);mostrarContenido=!1;primeraVezAnimando=!0;especialistasValidados=B(()=>this.especialistas().filter(t=>t.validadoAdmin===!0));noHayEspecialistas=B(()=>this.especialistasBuscados()===!0&&this.especialistas().length===0);noHayEspecialidades=B(()=>this.especialistaSeleccionado()!==null&&this.especialidadesBuscadas()===!0&&this.especialidades().length===0);noHayFechas=B(()=>this.especialidadSeleccionada()!==null&&this.diasBuscados()===!0&&this.fechasDisponibles().length===0);noHayHorarios=B(()=>this.fechaSeleccionada()!==null&&this.horasBuscadas()===!0&&this.horariosDisponibles().length===0);ngOnInit(){return T(this,null,function*(){this.usuario$.pipe(O(this.destroy$)).subscribe(n=>{n&&(n.id=typeof n.id=="string"?Number(n.id):n.id,this.usuarioActual=n)});let[t,e]=yield Promise.all([this.turnosService.obtenerEspecialistas(),this.usuariosService.obtenerPacientesVerificados()]),a=t.filter(n=>n.validadoAdmin===!0&&n.activo===!0);this.loadin.hide(),setTimeout(()=>{this.mostrarContenido=!0,setTimeout(()=>{this.pacientes.set(e),this.especialistas.set(a),this.especialistasBuscados.set(!0)},200)},100)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}seleccionarPaciente(t){this.pacienteSeleccionado.set(t)}seleccionarEspecialista(t){return T(this,null,function*(){this.primeraVezAnimando=!1,this.especialistaSeleccionado.set(t),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.fechasDisponibles.set([]),this.especialidadesBuscadas.set(!1),this.diasBuscados.set(!1),this.horasBuscadas.set(!1),this.cargando.set(!0);let e=yield this.turnosService.obtenerEspecialidadesDeEspecialista(t.id);this.especialidades.set(e),this.especialidadesBuscadas.set(!0),this.cargando.set(!1)})}seleccionarEspecialidad(t){return T(this,null,function*(){this.especialidadSeleccionada.set(t),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.cargando.set(!0);let e=yield this.turnosService.obtenerFechasConHorariosDisponibles(this.especialistaSeleccionado().id,t.duracion,15,new Date,this.pacienteSeleccionado()?.id);this.fechasDisponibles.set(e),this.diasBuscados.set(!0),this.cargando.set(!1)})}seleccionarFecha(t){return T(this,null,function*(){this.horaSelecionada.set(null),this.fechaSeleccionada.set(t),this.cargando.set(!0);let e=yield this.turnosService.obtenerHorariosDisponibles(t,this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion,this.pacienteSeleccionado()?.id);this.horariosDisponibles.set(e),this.horasBuscadas.set(!0),this.cargando.set(!1)})}seleccionarHorario(t){this.horaSelecionada.set(t)}cargarCita(){return T(this,null,function*(){let t=this.fechaSeleccionada(),e=this.horaSelecionada(),a=this.especialistaSeleccionado(),n=this.especialidadSeleccionada(),l=this.pacienteSeleccionado();if(!t||!e||!a||!n||!l){console.error("Datos incompletos para agendar la cita");return}let J={fechaHora:new Date(`${t}T${e}:00`),duracionMin:n.duracion,pacienteId:l.id,especialistaId:a.id,especialidadId:n.id,estado:"solicitado",comentarioPaciente:" ",comentarioEspecialista:" ",resenia:" "};try{let y=yield this.turnosService.darAltaCita(J);if(y.success)this.snackBar.open("Cita agendada exitosamente","\u2713",{duration:4e3,panelClass:["bg-green-600","text-white"]}),this.pacienteSeleccionado.set(null),this.especialistaSeleccionado.set(null),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null);else{let K=y.errorCode==="horario_no_disponible"?"El horario seleccionado ya no est\xE1 disponible. Por favor, selecciona otro horario.":y.message||"No se pudo agendar la cita";if(this.snackBar.open(K,"\u2715",{duration:6e3,panelClass:["bg-red-600","text-white"]}),y.errorCode==="horario_no_disponible"){this.horaSelecionada.set(null),this.cargando.set(!0);let Q=yield this.turnosService.obtenerHorariosDisponibles(this.fechaSeleccionada(),this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion,this.pacienteSeleccionado()?.id);this.horariosDisponibles.set(Q),this.cargando.set(!1)}}}catch(y){console.error("Error al cargar la cita:",y),this.snackBar.open("Error inesperado al procesar la solicitud","\u2715",{duration:4e3,panelClass:["bg-red-600","text-white"]})}})}static \u0275fac=function(e){return new(e||i)(E(q),E(L),E(z),E(Y),E(W))};static \u0275cmp=U({type:i,selectors:[["app-solicitar-turno-admin"]],decls:2,vars:1,consts:[[1,"h-full","w-full","overflow-hidden","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mx-auto","max-w-4xl","space-y-8","p-4"],[1,"text-center"],[1,"mt-8","text-center"],[1,"mb-4","text-center","text-xl","font-semibold"],[1,"flex","flex-wrap","justify-center","gap-4"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"opacity-50"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"click"],["alt","paciente","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],[1,"text-center","text-sm"],["alt","profesional","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],[1,"text-lg","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","transition","hover:bg-blue-50",3,"border-blue-600","opacity-50"],[1,"mt-4","text-center","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","transition","hover:bg-blue-50",3,"click"],["alt","icono","appTrackImage","",1,"mb-2","h-10","w-10",3,"src"],[1,"text-center","text-xs"],[1,"flex","flex-wrap","justify-center","gap-2"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"bg-blue-600","text-white"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"click"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"bg-green-500","text-white"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"click"],[1,"text-sm","text-gray-600"],[1,"pt-4"],[1,"rounded","bg-blue-200","px-4","py-2","text-lg","font-medium","hover:bg-blue-300",3,"click"]],template:function(e,a){e&1&&(s(0,"app-loading-wrapper"),m(1,he,10,8,"div",0),c()),e&2&&(o(),h(a.mostrarContenido?1:-1))},dependencies:[R,X],encapsulation:2,data:{animation:[I("slideInFromRight",[C("true => false",[]),C("* => true",[v({transform:"translateX(150%)",opacity:0}),V("600ms cubic-bezier(0.35, 0, 0.25, 1)",v({transform:"translateX(0)",opacity:1}))])]),I("botonBounce",[C(":enter",[v({opacity:0,transform:"scale(0.3) translateY(-20px)"}),V("500ms cubic-bezier(0.68, -0.55, 0.265, 1.55)",v({opacity:1,transform:"scale(1) translateY(0)"}))])]),I("listaStagger",[C(":enter",[$("@botonBounce",P(80,F()),{optional:!0})])]),I("especialidadAnimacion",[C(":enter",[v({opacity:0,transform:"scale(0.5)"}),V("400ms cubic-bezier(0.34, 1.56, 0.64, 1)",v({opacity:1,transform:"scale(1)"}))])]),I("listaAnimacion",[C(":enter",[$("@especialidadAnimacion",P(150,F()),{optional:!0})])])]}})};export{G as SolicitarTurnoAdmin};
