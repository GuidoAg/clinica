import"./chunk-GGQ7LRWG.js";import{a as G}from"./chunk-LMLVVXX5.js";import{a as W}from"./chunk-RLM7BZDW.js";import{c as I,d as O,f as C,g as A,h as $,i as U,j as H}from"./chunk-E6MHVRGS.js";import{a as z,b as L}from"./chunk-ENSBJLBX.js";import{n as q}from"./chunk-YZVU7P4D.js";import{a as j}from"./chunk-XAJTSRQW.js";import{b as P}from"./chunk-4DVJJQNQ.js";import"./chunk-BSLYAFLW.js";import"./chunk-X5YLR3NI.js";import"./chunk-SGAKRYQ3.js";import"./chunk-VLNB4REZ.js";import{f as F,g as V,l as B}from"./chunk-MTWZV5NU.js";import{Cb as v,Eb as p,Ka as E,Ma as s,O as M,Qb as f,Ra as x,Sb as r,Tb as y,Ub as D,Vb as T,Xa as N,ab as m,ba as _,ca as b,f as k,kc as w,ma as u,pb as d,qb as o,rb as c,sb as h,yb as S}from"./chunk-EMRS3JRH.js";import{i as g}from"./chunk-ODN5LVDJ.js";function R(a,t){if(a&1){let e=S();o(0,"button",8),v("click",function(){let n=_(e).$implicit,l=p(2);return b(l.seleccionarPaciente(n))}),h(1,"img",9),o(2,"span",10),r(3),c()()}if(a&2){let e,i=t.$implicit,n=p(2);f("opacity-50",n.pacienteSeleccionado()&&n.pacienteSeleccionado().id!==i.id),s(),f("border-blue-600",((e=n.pacienteSeleccionado())==null?null:e.id)===i.id),d("src",i.urlImagenPerfil||"assets/default-avatar.png",E),s(2),T("",i.nombre," ",i.apellido)}}function X(a,t){if(a&1&&(o(0,"div")(1,"h2",5),r(2," Seleccion\xE1 un paciente "),c(),o(3,"div",6),m(4,R,4,7,"button",7),c()()),a&2){let e=p();s(4),d("ngForOf",e.pacientes())}}function Y(a,t){if(a&1){let e=S();o(0,"button",8),v("click",function(){let n=_(e).$implicit,l=p(2);return b(l.seleccionarEspecialista(n))}),h(1,"img",11),o(2,"span",10),r(3),c()()}if(a&2){let e,i=t.$implicit,n=p(2);f("opacity-50",n.especialistaSeleccionado()&&n.especialistaSeleccionado().id!==i.id),s(),f("border-blue-600",((e=n.especialistaSeleccionado())==null?null:e.id)===i.id),d("src",i.imagenPerfil||"assets/default-avatar.png",E),s(2),T("",i.nombre," ",i.apellido)}}function Z(a,t){if(a&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un profesional ---- "),c(),o(3,"div",6),m(4,Y,4,7,"button",7),c()()),a&2){let e=p();s(4),d("ngForOf",e.especialistasValidados())}}function ee(a,t){if(a&1){let e=S();o(0,"button",13),v("click",function(){let n=_(e).$implicit,l=p(2);return b(l.seleccionarEspecialidad(n))}),h(1,"img",14),o(2,"span",15),r(3),c()()}if(a&2){let e,i=t.$implicit,n=p(2);f("border-blue-600",((e=n.especialidadSeleccionada())==null?null:e.id)===i.id)("opacity-50",n.especialidadSeleccionada()&&n.especialidadSeleccionada().id!==i.id),d("@especialidadAnimacion",void 0),s(),d("src",i.icono||"assets/default-icon.png",E),s(2),y(i.nombre)}}function ie(a,t){if(a&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 una especialidad ---- "),c(),o(3,"div",6),m(4,ee,4,7,"button",12),c()()),a&2){let e=p();s(3),d("@listaAnimacion",void 0),s(),d("ngForOf",e.especialidades())}}function te(a,t){if(a&1){let e=S();o(0,"button",19),v("click",function(){let n=_(e).$implicit,l=p(2);return b(l.seleccionarFecha(n))}),r(1),c()}if(a&2){let e=t.$implicit,i=p(2);f("bg-blue-600",i.fechaSeleccionada()===e)("text-white",i.fechaSeleccionada()===e),s(),D(" ",e," ")}}function ae(a,t){a&1&&(o(0,"p",20),r(1," No hay d\xEDas disponibles. "),c())}function ne(a,t){if(a&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un d\xEDa ---- "),c(),o(3,"div",16),m(4,te,2,5,"button",17),c(),m(5,ae,2,0,"p",18),c()),a&2){let e=p();s(4),d("ngForOf",e.fechasDisponibles()),s(),d("ngIf",e.noHayFechas())}}function oe(a,t){if(a&1){let e=S();o(0,"button",22),v("click",function(){let n=_(e).$implicit,l=p(2);return b(l.seleccionarHorario(n))}),r(1),c()}if(a&2){let e=t.$implicit,i=p(2);f("bg-green-500",i.horaSelecionada()===e)("text-white",i.horaSelecionada()===e),s(),D(" ",e," ")}}function se(a,t){a&1&&(o(0,"p",20),r(1," No hay turnos disponibles. "),c())}function ce(a,t){if(a&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un horario ---- "),c(),o(3,"div",16),m(4,oe,2,5,"button",21),c(),m(5,se,2,0,"p",18),c()),a&2){let e=p();s(4),d("ngForOf",e.horariosDisponibles()),s(),d("ngIf",e.noHayHorarios())}}function re(a,t){if(a&1){let e=S();o(0,"div",23)(1,"p",24),r(2," Paciente: "),o(3,"strong"),r(4),c(),h(5,"br"),r(6," Especialista: "),o(7,"strong"),r(8),c(),h(9,"br"),r(10," Especialidad: "),o(11,"strong"),r(12),c(),h(13,"br"),r(14," D\xEDa: "),o(15,"strong"),r(16),c(),h(17,"br"),r(18," Hora: "),o(19,"strong"),r(20),c()(),o(21,"div",25)(22,"button",26),v("click",function(){_(e);let n=p();return b(n.cargarCita())}),r(23," Confirmar "),c()()()}if(a&2){let e,i,n,l=p();s(4),T("",(e=l.pacienteSeleccionado())==null?null:e.nombre," ",(e=l.pacienteSeleccionado())==null?null:e.apellido),s(4),T("",(i=l.especialistaSeleccionado())==null?null:i.nombre," ",(i=l.especialistaSeleccionado())==null?null:i.apellido),s(4),y((n=l.especialidadSeleccionada())==null?null:n.nombre),s(4),y(l.fechaSeleccionada()),s(4),y(l.horaSelecionada())}}var J=class a{constructor(t,e,i,n,l){this.turnosService=t;this.loadin=e;this.authSupabase=i;this.snackBar=n;this.usuariosService=l;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new k;especialistas=u([]);especialidades=u([]);fechasDisponibles=u([]);horariosDisponibles=u([]);especialistaSeleccionado=u(null);especialidadSeleccionada=u(null);fechaSeleccionada=u(null);horaSelecionada=u(null);especialidadesBuscadas=u(!1);diasBuscados=u(!1);horasBuscadas=u(!1);pacientes=u([]);pacienteSeleccionado=u(null);cargando=u(!1);especialistasValidados=w(()=>this.especialistas().filter(t=>t.validadoAdmin===!0));noHayEspecialidades=w(()=>this.especialistaSeleccionado()!==null&&this.especialidadesBuscadas()===!0&&this.especialidades().length===0);noHayFechas=w(()=>this.especialidadSeleccionada()!==null&&this.diasBuscados()===!0&&this.fechasDisponibles().length===0);noHayHorarios=w(()=>this.fechaSeleccionada()!==null&&this.horasBuscadas()===!0&&this.horariosDisponibles().length===0);ngOnInit(){return g(this,null,function*(){this.usuario$.pipe(M(this.destroy$)).subscribe(e=>{e&&(e.id=typeof e.id=="string"?Number(e.id):e.id,this.usuarioActual=e)}),this.especialistas.set(yield this.turnosService.obtenerEspecialistas());let t=yield this.usuariosService.obtenerTodosUsuarios();this.pacientes.set(t.filter(e=>e.rol==="paciente"&&e.emailVerificado===!0)),this.loadin.hide()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}seleccionarPaciente(t){this.pacienteSeleccionado.set(t)}seleccionarEspecialista(t){return g(this,null,function*(){this.especialistaSeleccionado.set(t),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.fechasDisponibles.set([]),this.especialidadesBuscadas.set(!1),this.diasBuscados.set(!1),this.horasBuscadas.set(!1),this.cargando.set(!0);let e=yield this.turnosService.obtenerEspecialidadesDeEspecialista(t.id);this.especialidades.set(e),this.especialidadesBuscadas.set(!0),this.cargando.set(!1)})}seleccionarEspecialidad(t){return g(this,null,function*(){this.especialidadSeleccionada.set(t),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.cargando.set(!0);let e=yield this.turnosService.calcularFechasDisponibles(this.especialistaSeleccionado().id);this.fechasDisponibles.set(e),this.diasBuscados.set(!0),this.cargando.set(!1)})}seleccionarFecha(t){return g(this,null,function*(){this.horaSelecionada.set(null),this.fechaSeleccionada.set(t),this.cargando.set(!0);let e=yield this.turnosService.obtenerHorariosDisponibles(t,this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion);this.horariosDisponibles.set(e),this.horasBuscadas.set(!0),this.cargando.set(!1)})}seleccionarHorario(t){this.horaSelecionada.set(t)}cargarCita(){return g(this,null,function*(){let t=this.fechaSeleccionada(),e=this.horaSelecionada(),i=this.especialistaSeleccionado(),n=this.especialidadSeleccionada(),l=this.pacienteSeleccionado();if(!t||!e||!i||!n||!l){console.error("Datos incompletos para agendar la cita");return}let K={fechaHora:new Date(`${t}T${e}:00`),duracionMin:n.duracion,pacienteId:l.id,especialistaId:i.id,especialidadId:n.id,estado:"solicitado",comentarioPaciente:" ",comentarioEspecialista:" ",resenia:" "};try{let Q=yield this.turnosService.darAltaCita(K);this.snackBar.open("Cita agendada","exito",{duration:4e3,panelClass:["bg-blue-600","text-white"]}),this.pacienteSeleccionado.set(null),this.especialistaSeleccionado.set(null),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null)}catch{this.snackBar.open("Ups algo salio mal","error",{duration:4e3,panelClass:["bg-red-600","text-white"]})}})}btenerPacientes(){return g(this,null,function*(){let e=(yield this.usuariosService.obtenerTodosUsuarios()).filter(i=>i.rol==="paciente")})}static \u0275fac=function(e){return new(e||a)(x(W),x(j),x(P),x(q),x(G))};static \u0275cmp=N({type:a,selectors:[["app-solicitar-turno-admin"]],decls:10,vars:6,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mx-auto","max-w-4xl","space-y-8","p-4"],[4,"ngIf"],["class","mt-8 text-center",4,"ngIf"],[1,"mb-4","text-center","text-xl","font-semibold"],[1,"flex","flex-wrap","justify-center","gap-4"],["class","flex flex-col items-center space-y-1 focus:outline-none",3,"opacity-50","click",4,"ngFor","ngForOf"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"click"],["alt","paciente","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],[1,"text-center","text-sm"],["alt","profesional","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],["class","flex h-21 w-21 flex-col items-center justify-center rounded-lg border bg-white shadow transition hover:bg-blue-50",3,"border-blue-600","opacity-50","click",4,"ngFor","ngForOf"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","transition","hover:bg-blue-50",3,"click"],["alt","icono","appTrackImage","",1,"mb-2","h-10","w-10",3,"src"],[1,"text-center","text-xs"],[1,"flex","flex-wrap","justify-center","gap-2"],["class","rounded bg-blue-100 px-4 py-2 text-sm font-medium hover:bg-blue-200",3,"bg-blue-600","text-white","click",4,"ngFor","ngForOf"],["class","mt-4 text-center text-red-500",4,"ngIf"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"click"],[1,"mt-4","text-center","text-red-500"],["class","h-12 w-16 rounded-lg bg-green-200 text-sm font-semibold hover:bg-green-300",3,"bg-green-500","text-white","click",4,"ngFor","ngForOf"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"click"],[1,"mt-8","text-center"],[1,"text-sm","text-gray-600"],[1,"pt-4"],[1,"rounded","bg-blue-200","px-4","py-2","text-lg","font-medium","hover:bg-blue-300",3,"click"]],template:function(e,i){e&1&&(o(0,"app-loading-wrapper")(1,"div",0)(2,"div",1)(3,"div",2),m(4,X,5,1,"div",3)(5,Z,5,1,"div",3)(6,ie,5,2,"div",3)(7,ne,6,2,"div",3)(8,ce,6,2,"div",3)(9,re,24,7,"div",4),c()()()()),e&2&&(s(4),d("ngIf",i.pacientes().length),s(),d("ngIf",i.pacienteSeleccionado()&&i.especialistas().length),s(),d("ngIf",i.especialistaSeleccionado()),s(),d("ngIf",i.pacienteSeleccionado()&&i.especialidadSeleccionada()),s(),d("ngIf",i.pacienteSeleccionado()&&i.fechaSeleccionada()),s(),d("ngIf",i.pacienteSeleccionado()&&i.horaSelecionada()))},dependencies:[B,F,V,z,L],encapsulation:2,data:{animation:[I("especialidadAnimacion",[A(":enter",[C({opacity:0,transform:"scale(0.5)"}),O("400ms cubic-bezier(0.34, 1.56, 0.64, 1)",C({opacity:1,transform:"scale(1)"}))])]),I("listaAnimacion",[A(":enter",[U("@especialidadAnimacion",H(150,$()),{optional:!0})])])]}})};export{J as SolicitarTurnoAdmin};
