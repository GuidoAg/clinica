import{a as Ae}from"./chunk-XF3OUTFH.js";import{a as Ce,b as Re}from"./chunk-LJPIDVEV.js";import{b as de}from"./chunk-3RRXKLDM.js";import{b as $,c as B,h as Ie,i as _e,k as Z}from"./chunk-Z4223MVF.js";import"./chunk-LMZWYZYD.js";import{b as Pe}from"./chunk-GQ5SPWAT.js";import{f as Me,g as De}from"./chunk-JPNAPRSS.js";import"./chunk-3BX3P6FI.js";import{g as ce,j as G}from"./chunk-PUIB254N.js";import{Ab as L,Eb as C,Gb as h,Kb as T,Lb as P,Mb as M,Oa as g,Ta as Y,Tb as Te,U as ye,Ub as r,Vb as ee,Wb as q,Xb as be,Z as w,Za as _,ca as S,da as y,ea as N,fa as O,gc as se,hc as le,n as Se,na as Q,nb as R,ob as k,rb as oe,sb as re,tb as X,ub as n,vb as o,wb as b,xb as F,yb as z,zb as V}from"./chunk-JXJDPNLJ.js";import{a as K,b as J,j as c}from"./chunk-K4ALXBGI.js";var D=class s{datosCache;datosCacheTimestamp;CACHE_DURATION_MS=180*1e3;precargarDatosEstadisticas(){return c(this,null,function*(){let i=Date.now();if(this.datosCache&&this.datosCacheTimestamp&&i-this.datosCacheTimestamp<this.CACHE_DURATION_MS)return;let[e,a,t,l]=yield Promise.all([$.from(B.CITAS).select("especialidad_id, paciente_id, especialista_id, estado, fecha_hora"),$.from(B.ESPECIALIDADES).select(Ie.BASICO),$.from(B.ESPECIALISTA_ESPECIALIDADES).select("especialidad_id, perfil_id"),$.from(B.PERFILES).select("id, nombre, apellido, rol")]);if(e.error||!e.data){console.error("[Supabase] Error al precargar citas:",e.error?.message);return}if(a.error||!a.data){console.error("[Supabase] Error al precargar especialidades:",a.error?.message);return}if(t.error||!t.data){console.error("[Supabase] Error al precargar relaciones especialistas:",t.error?.message);return}if(l.error||!l.data){console.error("[Supabase] Error al precargar perfiles:",l.error?.message);return}let d=[...new Set(e.data.map(u=>u.especialista_id).filter(u=>u!==null))],m=l.data.filter(u=>d.includes(u.id));this.datosCache={citas:e.data,especialidades:a.data,relacionesEspecialistas:t.data,perfilesMedicos:m,perfilesCompletos:l.data},this.datosCacheTimestamp=i})}obtenerDatosCache(){return c(this,null,function*(){return yield this.precargarDatosEstadisticas(),this.datosCache})}obtenerLogIngresos(){return c(this,null,function*(){let[i,e]=yield Promise.all([$.from(B.REGISTRO_INGRESOS).select(_e.BASICO).order("fecha_ingreso",{ascending:!1}),this.obtenerDatosCache()]);return i.error||!i.data?(console.error("[Supabase] Error al obtener log de ingresos:",i.error?.message),[]):i.data.map(a=>{let t=e.perfilesCompletos.find(l=>l.id===a.perfil_id);return{fecha:a.fecha_ingreso,nombre:t?.nombre??"Desconocido",apellido:t?.apellido??"",rol:t?.rol??"N/A"}})})}obtenerTurnosPorEspecialidad(){return c(this,null,function*(){let i=yield this.obtenerDatosCache(),e=[...new Set(i.citas.map(t=>t.especialidad_id).filter(t=>t!==null))],a=new Map;for(let t of i.citas)t.especialidad_id&&a.set(t.especialidad_id,(a.get(t.especialidad_id)??0)+1);return e.map(t=>({especialidad:i.especialidades.find(d=>d.id===t)?.nombre??"Sin especialidad",cantidad:a.get(t)??0}))})}obtenerPacientesPorEspecialidad(){return c(this,null,function*(){let i=yield this.obtenerDatosCache(),e=[...new Set(i.citas.map(t=>t.especialidad_id).filter(t=>t!==null))],a=new Map;for(let t of i.citas)!t.especialidad_id||!t.paciente_id||(a.has(t.especialidad_id)||a.set(t.especialidad_id,new Set),a.get(t.especialidad_id).add(t.paciente_id));return e.map(t=>{let l=i.especialidades.find(m=>m.id===t),d=a.get(t)?.size??0;return{especialidad:l?.nombre??"Sin especialidad",cantidad:d}})})}obtenerMedicosPorEspecialidad(){return c(this,null,function*(){let i=yield this.obtenerDatosCache(),e=[...new Set(i.relacionesEspecialistas.map(t=>t.especialidad_id).filter(t=>t!==null))],a=new Map;for(let t of i.relacionesEspecialistas)!t.especialidad_id||!t.perfil_id||(a.has(t.especialidad_id)||a.set(t.especialidad_id,new Set),a.get(t.especialidad_id).add(t.perfil_id));return e.map(t=>{let l=i.especialidades.find(m=>m.id===t),d=a.get(t)?.size??0;return{especialidad:l?.nombre??"Sin especialidad",cantidad:d}})})}obtenerCitasPorEstado(i){return c(this,null,function*(){let e=yield this.obtenerDatosCache(),a=i?e.citas.filter(l=>l.paciente_id===i):e.citas,t=new Map;for(let l of a)l.estado&&t.set(l.estado,(t.get(l.estado)??0)+1);return Object.values(Ce).map(l=>({estado:l,cantidad:t.get(l)??0}))})}obtenerPacientes(){return c(this,null,function*(){let i=yield this.obtenerDatosCache(),e=new Set(i.citas.map(a=>a.paciente_id).filter(a=>a!==null));return Array.from(e).map(a=>{let t=i.perfilesCompletos.find(l=>l.id===a);return t?{id:a,nombre:t.nombre??"",apellido:t.apellido??""}:null}).filter(a=>a!==null).sort((a,t)=>a.apellido.localeCompare(t.apellido))})}obtenerTurnosPorDia(){return c(this,null,function*(){let i=yield this.obtenerDatosCache(),e=new Map;for(let a of i.citas){let t=new Date(a.fecha_hora).toISOString().split("T")[0];e.set(t,(e.get(t)??0)+1)}return Array.from(e.entries()).map(([a,t])=>({fecha:a,cantidad:t})).sort((a,t)=>a.fecha.localeCompare(t.fecha))})}obtenerTurnosPorMedico(i,e){return c(this,null,function*(){let a=yield this.obtenerDatosCache(),t=a.citas.filter(l=>{if(!i||!e)return!0;let d=new Date(l.fecha_hora);return d>=new Date(i)&&d<=new Date(e)});return this.procesarTurnosPorMedico(t,a.perfilesMedicos,null)})}obtenerTurnosFinalizadosPorMedico(i,e){return c(this,null,function*(){let a=yield this.obtenerDatosCache(),t=a.citas.filter(l=>(!i||!e||new Date(l.fecha_hora)>=new Date(i)&&new Date(l.fecha_hora)<=new Date(e))&&l.estado==="completado");return this.procesarTurnosPorMedico(t,a.perfilesMedicos,null)})}procesarTurnosPorMedico(i,e,a){let t=a?i.filter(m=>m.estado===a):i,l=[...new Set(t.map(m=>m.especialista_id).filter(m=>m!==null))];if(l.length===0)return[];let d=new Map;for(let m of t)m.especialista_id&&d.set(m.especialista_id,(d.get(m.especialista_id)??0)+1);return l.map(m=>{let u=e.find(v=>v.id===m);return{nombre:u?`${u.nombre} ${u.apellido}`:"Desconocido",cantidad:d.get(m)??0}})}obtenerIngresosEspecialistas60Dias(){return c(this,null,function*(){return this.obtenerIngresosPorRol("especialista")})}obtenerIngresosPacientes60Dias(){return c(this,null,function*(){return this.obtenerIngresosPorRol("paciente")})}obtenerIngresosPorRol(i){return c(this,null,function*(){let e=new Date;e.setDate(e.getDate()-60);let a=e.toISOString(),[t,l]=yield Promise.all([$.from(B.REGISTRO_INGRESOS).select(_e.BASICO).gte("fecha_ingreso",a).order("fecha_ingreso",{ascending:!0}),this.obtenerDatosCache()]);if(t.error||!t.data)return console.error(`[Supabase] Error al obtener ingresos de ${i}:`,t.error?.message),{datos:[],maxY:40};let d=new Set(l.perfilesCompletos.filter(f=>f.rol===i).map(f=>f.id)),m=t.data.filter(f=>d.has(f.perfil_id)),u=new Map;for(let f of m){let x=new Date(f.fecha_ingreso),E=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}-${String(x.getDate()).padStart(2,"0")}`;u.set(E,(u.get(E)??0)+1)}let v=Array.from(u.entries()).map(([f,x])=>({fecha_hora:f,cantidad:x})),p=Math.max(...v.map(f=>f.cantidad),0),A=p===0?40:Math.ceil((p+1)/5)*5;return{datos:v,maxY:A}})}static \u0275fac=function(e){return new(e||s)};static \u0275prov=ye({token:s,factory:s.\u0275fac,providedIn:"root"})};var He=["canvas"],te=class s{estadisticas=w(D);canvasRef;ngAfterViewInit(){return c(this,null,function*(){let{Chart:i,BarElement:e,BarController:a,CategoryScale:t,LinearScale:l,Tooltip:d,Legend:m}=yield import("./chunk-DPEENRGO.js");i.register(e,a,t,l,d,m);let u=this.canvasRef.nativeElement,v=yield this.estadisticas.obtenerTurnosPorDia(),p=v.map(f=>f.fecha),A=v.map(f=>f.cantidad);new i(u,{type:"bar",data:{labels:p,datasets:[{label:"Turnos por D\xEDa",data:A,backgroundColor:"rgba(54, 162, 235, 0.7)"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}}}})})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-turnos-por-dia-chart"]],viewQuery:function(e,a){if(e&1&&T(He,7),e&2){let t;P(t=M())&&(a.canvasRef=t.first)}},decls:2,vars:0,consts:[["canvas",""],[1,"mx-auto","h-64","w-full"]],template:function(e,a){e&1&&V(0,"canvas",1,0)},encapsulation:2})};var Ne=["canvas"],ie=class s{estadisticas=w(D);chart;canvasRef;ngAfterViewInit(){this.render()}render(){return c(this,null,function*(){let{Chart:i,ArcElement:e,PieController:a,Tooltip:t,Legend:l}=yield import("./chunk-DPEENRGO.js");i.register(e,a,t,l);let d=yield this.estadisticas.obtenerTurnosPorEspecialidad(),m=d.map(p=>p.especialidad),u=d.map(p=>p.cantidad),v=this.canvasRef.nativeElement;this.chart?.destroy(),this.chart=new i(v,{type:"pie",data:{labels:m,datasets:[{label:"Turnos por Especialidad",data:u,backgroundColor:["rgba(255, 99, 132, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1}})})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-turnos-por-especialidad-chart"]],viewQuery:function(e,a){if(e&1&&T(Ne,7),e&2){let t;P(t=M())&&(a.canvasRef=t.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-64","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(F(0,"div",1),V(1,"canvas",2,0),z())},encapsulation:2})};var Qe=["canvas"],ae=class s{estadisticas=w(D);chart;canvasRef;render(i,e){return c(this,null,function*(){let{Chart:a,BarElement:t,BarController:l,CategoryScale:d,LinearScale:m,Tooltip:u,Legend:v}=yield import("./chunk-DPEENRGO.js");a.register(t,l,d,m,u,v);let p=yield this.estadisticas.obtenerTurnosPorMedico(i,e),A=p.map(E=>E.nombre),f=p.map(E=>E.cantidad),x=this.canvasRef.nativeElement;this.chart?.destroy(),this.chart=new a(x,{type:"bar",data:{labels:A,datasets:[{label:"Turnos por M\xE9dico",data:f,backgroundColor:"rgba(75, 192, 192, 0.7)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}}}})})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-turnos-por-medico-chart"]],viewQuery:function(e,a){if(e&1&&T(Qe,7),e&2){let t;P(t=M())&&(a.canvasRef=t.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-64","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(F(0,"div",1),V(1,"canvas",2,0),z())},encapsulation:2})};var je=["canvas"],ne=class s{estadisticas=w(D);chart;canvasRef;render(i,e){return c(this,null,function*(){let{Chart:a,BarElement:t,BarController:l,CategoryScale:d,LinearScale:m,Tooltip:u,Legend:v}=yield import("./chunk-DPEENRGO.js");a.register(t,l,d,m,u,v);let p=yield this.estadisticas.obtenerTurnosFinalizadosPorMedico(i,e),A=p.map(x=>x.nombre),f=p.map(x=>x.cantidad);this.chart?.destroy(),this.chart=new a(this.canvasRef.nativeElement,{type:"bar",data:{labels:A,datasets:[{label:"Turnos Finalizados por M\xE9dico",data:f,backgroundColor:"rgba(153, 102, 255, 0.7)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}}}})})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-turnos-finalizados-por-medico-chart"]],viewQuery:function(e,a){if(e&1&&T(je,7),e&2){let t;P(t=M())&&(a.canvasRef=t.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-64","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(F(0,"div",1),V(1,"canvas",2,0),z())},encapsulation:2})};var Oe=["canvas"],me=class s{estadisticas=w(D);chart;canvasRef;ngAfterViewInit(){this.render()}render(){return c(this,null,function*(){let{Chart:i,LineElement:e,LineController:a,PointElement:t,CategoryScale:l,LinearScale:d,Tooltip:m,Legend:u,Filler:v}=yield import("./chunk-DPEENRGO.js");i.register(e,a,t,l,d,m,u,v);let{datos:p,maxY:A}=yield this.estadisticas.obtenerIngresosEspecialistas60Dias(),f=p.map(I=>I.fecha_hora),x=p.map(I=>I.cantidad),E=this.canvasRef.nativeElement;this.chart?.destroy(),this.chart=new i(E,{type:"line",data:{labels:f,datasets:[{label:"Ingresos de Especialistas (\xFAltimos 60 d\xEDas)",data:x,borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.1)",borderWidth:2,fill:!0,tension:.4,pointRadius:2,pointHoverRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:A,ticks:{stepSize:5,precision:0}},x:{ticks:{maxTicksLimit:20,callback:function(I,W){let U=f[W];return U&&W%Math.ceil(f.length/20)===0?U:""}}}},plugins:{tooltip:{callbacks:{title:function(I){return I[0].label||""}}}}}})})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-ingresos-especialistas-chart"]],viewQuery:function(e,a){if(e&1&&T(Oe,7),e&2){let t;P(t=M())&&(a.canvasRef=t.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-80","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(F(0,"div",1),V(1,"canvas",2,0),z())},encapsulation:2})};var $e=["canvas"],pe=class s{estadisticas=w(D);chart;canvasRef;ngAfterViewInit(){this.render()}render(){return c(this,null,function*(){let{Chart:i,LineElement:e,LineController:a,PointElement:t,CategoryScale:l,LinearScale:d,Tooltip:m,Legend:u,Filler:v}=yield import("./chunk-DPEENRGO.js");i.register(e,a,t,l,d,m,u,v);let{datos:p,maxY:A}=yield this.estadisticas.obtenerIngresosPacientes60Dias(),f=p.map(I=>I.fecha_hora),x=p.map(I=>I.cantidad),E=this.canvasRef.nativeElement;this.chart?.destroy(),this.chart=new i(E,{type:"line",data:{labels:f,datasets:[{label:"Ingresos de Pacientes (\xFAltimos 60 d\xEDas)",data:x,borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.1)",borderWidth:2,fill:!0,tension:.4,pointRadius:2,pointHoverRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:A,ticks:{stepSize:5,precision:0}},x:{ticks:{maxTicksLimit:20,callback:function(I,W){let U=f[W];return U&&W%Math.ceil(f.length/20)===0?U:""}}}},plugins:{tooltip:{callbacks:{title:function(I){return I[0].label||""}}}}}})})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-ingresos-pacientes-chart"]],viewQuery:function(e,a){if(e&1&&T($e,7),e&2){let t;P(t=M())&&(a.canvasRef=t.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-80","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(F(0,"div",1),V(1,"canvas",2,0),z())},encapsulation:2})};var Be=["canvas"],ue=class s{estadisticas=w(D);chart;canvasRef;ngAfterViewInit(){this.render()}render(){return c(this,null,function*(){let{Chart:i,ArcElement:e,PieController:a,Tooltip:t,Legend:l}=yield import("./chunk-DPEENRGO.js");i.register(e,a,t,l);let d=yield this.estadisticas.obtenerPacientesPorEspecialidad(),m=d.map(p=>p.especialidad),u=d.map(p=>p.cantidad),v=this.canvasRef.nativeElement;this.chart?.destroy(),this.chart=new i(v,{type:"pie",data:{labels:m,datasets:[{label:"Pacientes por Especialidad",data:u,backgroundColor:["rgba(59, 130, 246, 0.7)","rgba(147, 51, 234, 0.7)","rgba(236, 72, 153, 0.7)","rgba(251, 146, 60, 0.7)","rgba(34, 197, 94, 0.7)","rgba(244, 63, 94, 0.7)","rgba(14, 165, 233, 0.7)","rgba(168, 85, 247, 0.7)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(p){let A=p.label||"",f=p.parsed||0;return`${A}: ${f} paciente${f!==1?"s":""}`}}}}}})})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-pacientes-por-especialidad-chart"]],viewQuery:function(e,a){if(e&1&&T(Be,7),e&2){let t;P(t=M())&&(a.canvasRef=t.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-64","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(F(0,"div",1),V(1,"canvas",2,0),z())},encapsulation:2})};var qe=["canvas"],fe=class s{estadisticas=w(D);chart;canvasRef;ngAfterViewInit(){this.render()}render(){return c(this,null,function*(){let{Chart:i,ArcElement:e,PieController:a,Tooltip:t,Legend:l}=yield import("./chunk-DPEENRGO.js");i.register(e,a,t,l);let d=yield this.estadisticas.obtenerMedicosPorEspecialidad(),m=d.map(p=>p.especialidad),u=d.map(p=>p.cantidad),v=this.canvasRef.nativeElement;this.chart?.destroy(),this.chart=new i(v,{type:"pie",data:{labels:m,datasets:[{label:"M\xE9dicos por Especialidad",data:u,backgroundColor:["rgba(99, 102, 241, 0.7)","rgba(236, 72, 153, 0.7)","rgba(34, 197, 94, 0.7)","rgba(251, 146, 60, 0.7)","rgba(14, 165, 233, 0.7)","rgba(168, 85, 247, 0.7)","rgba(245, 158, 11, 0.7)","rgba(239, 68, 68, 0.7)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(p){let A=p.label||"",f=p.parsed||0;return`${A}: ${f} m\xE9dico${f!==1?"s":""}`}}}}}})})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-medicos-por-especialidad-chart"]],viewQuery:function(e,a){if(e&1&&T(qe,7),e&2){let t;P(t=M())&&(a.canvasRef=t.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-64","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(F(0,"div",1),V(1,"canvas",2,0),z())},encapsulation:2})};var Ge=["canvas"],We=(s,i)=>i.id;function Ue(s,i){if(s&1){let e=L();n(0,"div",4)(1,"span",8),r(2),o(),n(3,"button",9),C("click",function(){S(e);let t=h();return y(t.limpiarFiltro())}),r(4," Ver todos "),o()()}if(s&2){let e=h();g(2),be(" Mostrando: ",e.pacienteSeleccionado().apellido,", ",e.pacienteSeleccionado().nombre," ")}}function Ye(s,i){if(s&1){let e=L();n(0,"button",19),C("click",function(){let t=S(e).$implicit,l=h(2);return y(l.seleccionarPaciente(t))}),r(1),o()}if(s&2){let e=i.$implicit;g(),be(" ",e.apellido,", ",e.nombre," ")}}function Ze(s,i){if(s&1){let e=L();n(0,"div",7)(1,"div",10),C("clickFuera",function(){S(e);let t=h();return y(t.cerrarPopup())}),n(2,"div",11)(3,"h3",12),r(4," Seleccionar Paciente "),o(),n(5,"button",13),C("click",function(){S(e);let t=h();return y(t.cerrarPopup())}),r(6," \u2715 "),o()(),n(7,"div",14)(8,"button",15),C("click",function(){S(e);let t=h();return y(t.seleccionarTodos())}),r(9," Mostrar todos los pacientes "),o()(),n(10,"div",16)(11,"div",17),oe(12,Ye,2,2,"button",18,We),o()()()()}if(s&2){let e=h();g(12),re(e.pacientes())}}var he=class s{estadisticas=w(D);chart;pacienteSeleccionado=Q(null);mostrarPopup=Q(!1);pacientes=Q([]);canvasRef;ngAfterViewInit(){this.cargarPacientes(),this.render()}cargarPacientes(){return c(this,null,function*(){let i=yield this.estadisticas.obtenerPacientes();this.pacientes.set(i)})}abrirSeleccionPaciente(){this.mostrarPopup.set(!0)}cerrarPopup(){this.mostrarPopup.set(!1)}seleccionarPaciente(i){this.pacienteSeleccionado.set(i),this.cerrarPopup(),this.render()}seleccionarTodos(){this.pacienteSeleccionado.set(null),this.cerrarPopup(),this.render()}limpiarFiltro(){this.pacienteSeleccionado.set(null),this.render()}render(){return c(this,null,function*(){let{Chart:i,BarElement:e,BarController:a,CategoryScale:t,LinearScale:l,Tooltip:d,Legend:m}=yield import("./chunk-DPEENRGO.js");i.register(e,a,t,l,d,m);let u=this.pacienteSeleccionado()?.id,v=yield this.estadisticas.obtenerCitasPorEstado(u),p=v.map(x=>x.estado),A=v.map(x=>x.cantidad),f=this.canvasRef.nativeElement;this.chart?.destroy(),this.chart=new i(f,{type:"bar",data:{labels:p,datasets:[{label:"Cantidad de Citas",data:A,backgroundColor:["rgba(59, 130, 246, 0.7)","rgba(34, 197, 94, 0.7)","rgba(239, 68, 68, 0.7)","rgba(249, 115, 22, 0.7)","rgba(16, 185, 129, 0.7)"],borderColor:["rgba(59, 130, 246, 1)","rgba(34, 197, 94, 1)","rgba(239, 68, 68, 1)","rgba(249, 115, 22, 1)","rgba(147, 51, 234, 1)","rgba(16, 185, 129, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(x){let E=x.parsed.y||0;return`Cantidad: ${E} cita${E!==1?"s":""}`}}}}}})})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-citas-por-estado-chart"]],viewQuery:function(e,a){if(e&1&&T(Ge,7),e&2){let t;P(t=M())&&(a.canvasRef=t.first)}},decls:9,vars:3,consts:[["canvas",""],[1,"relative"],[1,"mb-3","flex","items-center","justify-between"],[1,"rounded-lg","bg-indigo-600","px-4","py-2","text-sm","font-medium","text-white","transition-colors","hover:bg-indigo-700",3,"click"],[1,"flex","items-center","gap-2"],[1,"relative","h-64","w-full"],[1,"absolute","inset-0","h-full","w-full"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/30","backdrop-blur-sm"],[1,"text-sm","text-gray-600"],[1,"rounded-lg","bg-gray-200","px-3","py-1","text-sm","text-gray-700","transition-colors","hover:bg-gray-300",3,"click"],["appClickFueraPopup","",1,"w-full","max-w-md","rounded-lg","bg-white","p-6","shadow-xl",3,"clickFuera"],[1,"mb-4","flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600",3,"click"],[1,"mb-4"],[1,"w-full","rounded-lg","bg-indigo-100","px-4","py-2","text-sm","font-medium","text-indigo-700","transition-colors","hover:bg-indigo-200",3,"click"],[1,"rounded-lg","border","border-gray-200","bg-gray-50"],[1,"max-h-96","overflow-y-auto","p-2"],[1,"w-full","rounded-lg","px-4","py-2","text-left","text-sm","transition-colors","hover:bg-white","hover:shadow-sm"],[1,"w-full","rounded-lg","px-4","py-2","text-left","text-sm","transition-colors","hover:bg-white","hover:shadow-sm",3,"click"]],template:function(e,a){if(e&1){let t=L();n(0,"div",1)(1,"div",2)(2,"button",3),C("click",function(){return S(t),y(a.abrirSeleccionPaciente())}),r(3),o(),R(4,Ue,5,2,"div",4),o(),n(5,"div",5),b(6,"canvas",6,0),o(),R(8,Ze,14,0,"div",7),o()}e&2&&(g(3),q(" ",a.pacienteSeleccionado()?"Cambiar paciente":"Filtrar por paciente"," "),g(),k(a.pacienteSeleccionado()?4:-1),g(4),k(a.mostrarPopup()?8:-1))},dependencies:[G,Ae],encapsulation:2})};function Ke(s,i){if(s&1){let e=L();n(0,"div",8)(1,"section",9)(2,"div",10)(3,"div",11),N(),n(4,"svg",12),b(5,"path",13),o()(),O(),n(6,"div")(7,"h3",14),r(8,"Turnos por D\xEDa"),o(),n(9,"p",15),r(10,"Distribuci\xF3n diaria de turnos"),o()()(),n(11,"div",16),b(12,"app-turnos-por-dia-chart"),o()(),n(13,"section",9)(14,"div",10)(15,"div",17),N(),n(16,"svg",18),b(17,"path",19),o()(),O(),n(18,"div")(19,"h3",14),r(20," Turnos por Especialidad "),o(),n(21,"p",15),r(22,"Distribuci\xF3n por \xE1rea m\xE9dica"),o()()(),n(23,"div",16),b(24,"app-turnos-por-especialidad-chart"),o()(),n(25,"section",20)(26,"div",10)(27,"div",21),N(),n(28,"svg",22),b(29,"path",23),o()(),O(),n(30,"div",24)(31,"h3",14),r(32," Turnos por M\xE9dico "),o(),n(33,"p",15),r(34," Carga de trabajo por profesional "),o()()(),n(35,"div",25)(36,"label",26)(37,"span",27),r(38,"Desde:"),o(),n(39,"input",28),C("change",function(t){S(e);let l=h();return y(l.onDesdeTurnosMedicoChange(t))}),o()(),n(40,"label",26)(41,"span",27),r(42,"Hasta:"),o(),n(43,"input",28),C("change",function(t){S(e);let l=h();return y(l.onHastaTurnosMedicoChange(t))}),o()(),n(44,"button",29),C("click",function(){S(e);let t=h();return y(t.onAplicarTurnosMedico())}),r(45," Aplicar Filtro "),o()(),n(46,"div",16),b(47,"app-turnos-por-medico-chart"),o()(),n(48,"section",20)(49,"div",10)(50,"div",30),N(),n(51,"svg",31),b(52,"path",32),o()(),O(),n(53,"div",24)(54,"h3",14),r(55," Turnos Finalizados por M\xE9dico "),o(),n(56,"p",15),r(57," Consultas completadas exitosamente "),o()()(),n(58,"div",25)(59,"label",26)(60,"span",27),r(61,"Desde:"),o(),n(62,"input",28),C("change",function(t){S(e);let l=h();return y(l.onDesdeTurnosFinalizadosChange(t))}),o()(),n(63,"label",26)(64,"span",27),r(65,"Hasta:"),o(),n(66,"input",28),C("change",function(t){S(e);let l=h();return y(l.onHastaTurnosFinalizadosChange(t))}),o()(),n(67,"button",29),C("click",function(){S(e);let t=h();return y(t.onAplicarTurnosFinalizados())}),r(68," Aplicar Filtro "),o()(),n(69,"div",16),b(70,"app-turnos-finalizados-por-medico-chart"),o()(),n(71,"section",9)(72,"div",10)(73,"div",33),N(),n(74,"svg",34),b(75,"path",35),o()(),O(),n(76,"div")(77,"h3",14),r(78," Ingresos - Especialistas "),o(),n(79,"p",15),r(80,"\xDAltimos 60 d\xEDas (por d\xEDa)"),o()()(),n(81,"div",16),b(82,"app-ingresos-especialistas-chart"),o()(),n(83,"section",9)(84,"div",10)(85,"div",36),N(),n(86,"svg",37),b(87,"path",35),o()(),O(),n(88,"div")(89,"h3",14),r(90," Ingresos - Pacientes "),o(),n(91,"p",15),r(92,"\xDAltimos 60 d\xEDas (por d\xEDa)"),o()()(),n(93,"div",16),b(94,"app-ingresos-pacientes-chart"),o()(),n(95,"section",9)(96,"div",10)(97,"div",38),N(),n(98,"svg",39),b(99,"path",40),o()(),O(),n(100,"div")(101,"h3",14),r(102," Pacientes por Especialidad "),o(),n(103,"p",15),r(104,"Pacientes \xFAnicos con citas"),o()()(),n(105,"div",16),b(106,"app-pacientes-por-especialidad-chart"),o()(),n(107,"section",9)(108,"div",10)(109,"div",41),N(),n(110,"svg",42),b(111,"path",43),o()(),O(),n(112,"div")(113,"h3",14),r(114," M\xE9dicos por Especialidad "),o(),n(115,"p",15),r(116," Distribuci\xF3n del personal m\xE9dico "),o()()(),n(117,"div",16),b(118,"app-medicos-por-especialidad-chart"),o()(),n(119,"section",20)(120,"div",10)(121,"div",44),N(),n(122,"svg",45),b(123,"path",46),o()(),O(),n(124,"div")(125,"h3",14),r(126," Citas por Estado "),o(),n(127,"p",15),r(128," Distribuci\xF3n de citas seg\xFAn su estado actual "),o()()(),n(129,"div",16),b(130,"app-citas-por-estado-chart"),o()()()}if(s&2){let e=h();g(39),X("value",e.rangoTurnosPorMedico().desde),g(4),X("value",e.rangoTurnosPorMedico().hasta),g(19),X("value",e.rangoTurnosFinalizados().desde),g(4),X("value",e.rangoTurnosFinalizados().hasta)}}var ge=class s{loading=w(Z);estadisticas=w(D);datosCargados=Q(!1);rangoTurnosPorMedico=Q({desde:"2024-01-01",hasta:"2027-01-01"});rangoTurnosFinalizados=Q({desde:"2024-01-01",hasta:"2027-01-01"});turnosPorDiaChart;turnosPorEspecialidadChart;turnosPorMedicoChart;turnosFinalizadosChart;ngOnInit(){this.loading.show(),this.cargarDatosIniciales()}cargarDatosIniciales(){return c(this,null,function*(){try{yield this.estadisticas.precargarDatosEstadisticas(),this.datosCargados.set(!0),setTimeout(()=>this.cargarChartsConRangos(),0)}catch(i){console.error("Error precargando datos:",i),this.datosCargados.set(!0),this.loading.hide()}})}ngAfterViewInit(){}cargarChartsConRangos(){return c(this,null,function*(){try{yield Promise.all([this.cargarTurnosPorMedico(),this.cargarTurnosFinalizados()])}finally{this.loading.hide()}})}cargarTurnosPorMedico(){return c(this,null,function*(){let{desde:i,hasta:e}=this.rangoTurnosPorMedico();yield this.turnosPorMedicoChart?.render(i,e)})}cargarTurnosFinalizados(){return c(this,null,function*(){let{desde:i,hasta:e}=this.rangoTurnosFinalizados();yield this.turnosFinalizadosChart?.render(i,e)})}onDesdeTurnosMedicoChange(i){let e=i.target;this.rangoTurnosPorMedico.set(J(K({},this.rangoTurnosPorMedico()),{desde:e.value}))}onHastaTurnosMedicoChange(i){let e=i.target;this.rangoTurnosPorMedico.set(J(K({},this.rangoTurnosPorMedico()),{hasta:e.value}))}onAplicarTurnosMedico(){return c(this,null,function*(){this.loading.show();try{yield this.cargarTurnosPorMedico()}finally{this.loading.hide()}})}onDesdeTurnosFinalizadosChange(i){let e=i.target;this.rangoTurnosFinalizados.set(J(K({},this.rangoTurnosFinalizados()),{desde:e.value}))}onHastaTurnosFinalizadosChange(i){let e=i.target;this.rangoTurnosFinalizados.set(J(K({},this.rangoTurnosFinalizados()),{hasta:e.value}))}onAplicarTurnosFinalizados(){return c(this,null,function*(){this.loading.show();try{yield this.cargarTurnosFinalizados()}finally{this.loading.hide()}})}exportarEstadisticasPdf(){return c(this,null,function*(){this.loading.show();try{let{default:i}=yield import("./chunk-L7QLLNN3.js"),e=new i({orientation:"portrait",unit:"mm",format:"a4"}),a=e.internal.pageSize.getWidth(),t=e.internal.pageSize.getHeight(),l=20,d=E=>{e.setFillColor(41,98,255),e.rect(0,0,a,35,"F"),e.setFontSize(22),e.setTextColor(255,255,255),e.setFont("helvetica","bold"),e.text("INFORME DE ESTAD\xCDSTICAS",a/2,15,{align:"center"}),e.setFontSize(11),e.setFont("helvetica","normal"),e.text("Centro M\xE9dico - Panel Administrativo",a/2,23,{align:"center"});let I=new Date().toLocaleDateString("es-AR",{weekday:"long",year:"numeric",month:"long",day:"numeric"});e.setFontSize(9),e.text(I,a/2,29,{align:"center"}),e.setFontSize(8),e.setTextColor(150,150,150),e.text(`P\xE1gina ${E}`,a-15,t-10,{align:"right"})},m=E=>l+E>t-20?(e.addPage(),u++,d(u),l=45,!0):!1,u=1;d(u),l=45;let v=Array.from(document.querySelectorAll("canvas")),p=[{titulo:"Distribuci\xF3n de Turnos por D\xEDa",descripcion:"An\xE1lisis de la distribuci\xF3n de citas agendadas a lo largo de la semana, permitiendo identificar los d\xEDas de mayor demanda y optimizar la disponibilidad del personal m\xE9dico."},{titulo:"Turnos por Especialidad M\xE9dica",descripcion:"Visualizaci\xF3n de la demanda de servicios por \xE1rea de especializaci\xF3n, facilitando la planificaci\xF3n de recursos y la asignaci\xF3n eficiente de profesionales."},{titulo:"Carga de Trabajo por M\xE9dico",descripcion:"Distribuci\xF3n de turnos asignados a cada profesional m\xE9dico en el per\xEDodo seleccionado, permitiendo equilibrar la carga de trabajo y detectar posibles sobrecargas."},{titulo:"Turnos Finalizados por M\xE9dico",descripcion:"Registro de consultas completadas exitosamente por cada profesional, indicador clave de productividad y cumplimiento de agenda m\xE9dica."},{titulo:"Registro de Ingresos - Especialistas",descripcion:"Seguimiento temporal de la actividad de acceso al sistema por parte del personal m\xE9dico durante los \xFAltimos 60 d\xEDas, \xFAtil para monitorear el uso de la plataforma."},{titulo:"Registro de Ingresos - Pacientes",descripcion:"Seguimiento de la actividad de acceso al sistema por parte de los pacientes durante los \xFAltimos 60 d\xEDas, indicador de engagement y uso del portal de pacientes."},{titulo:"Pacientes \xDAnicos por Especialidad",descripcion:"Cantidad de pacientes individuales atendidos en cada especialidad m\xE9dica, m\xE9trica fundamental para evaluar la cobertura y alcance de los servicios ofrecidos."},{titulo:"Personal M\xE9dico por Especialidad",descripcion:"Distribuci\xF3n del equipo de profesionales seg\xFAn su \xE1rea de especializaci\xF3n, esencial para garantizar la cobertura adecuada de todas las especialidades."},{titulo:"Estado de las Citas M\xE9dicas",descripcion:"Clasificaci\xF3n de todas las citas seg\xFAn su estado actual (solicitadas, aceptadas, rechazadas, canceladas y completadas), herramienta clave para el seguimiento operativo."}];for(let E=0;E<v.length&&E<p.length;E++){let I=v[E],{titulo:W,descripcion:U}=p[E];m(90),e.setDrawColor(41,98,255),e.setLineWidth(.5),e.line(15,l,a-15,l),l+=5,e.setFontSize(14),e.setTextColor(41,98,255),e.setFont("helvetica","bold"),e.text(W,15,l),l+=8,e.setFontSize(9),e.setTextColor(80,80,80),e.setFont("helvetica","normal");let xe=e.splitTextToSize(U,a-30);e.text(xe,15,l),l+=xe.length*4+5,m(75),e.setDrawColor(220,220,220),e.setLineWidth(.3),e.roundedRect(13,l-2,a-26,72,2,2,"S");let Ve=I.toDataURL("image/png"),Fe=a-34,ze=I.height*Fe/I.width,Ee=Math.min(ze,68),we=I.width*Ee/I.height,Le=(a-we)/2;e.addImage(Ve,"PNG",Le,l,we,Ee),l+=82}l<t-50?l=t-45:(e.addPage(),u++,d(u),l=45),e.setDrawColor(41,98,255),e.setLineWidth(.5),e.line(15,l,a-15,l),l+=8,e.setFontSize(9),e.setTextColor(100,100,100),e.setFont("helvetica","italic");let f=e.splitTextToSize("Este informe ha sido generado autom\xE1ticamente por el Sistema de Gesti\xF3n del Centro M\xE9dico. Los datos reflejan el estado actual de las operaciones y est\xE1n sujetos a cambios en tiempo real.",a-30);e.text(f,a/2,l,{align:"center"});let x=new Date().toISOString().split("T")[0];e.save(`informe_estadisticas_${x}.pdf`)}catch(i){console.error("Error al exportar PDF:",i)}finally{this.loading.hide()}})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=_({type:s,selectors:[["app-home"]],viewQuery:function(e,a){if(e&1&&(T(te,5),T(ie,5),T(ae,5),T(ne,5)),e&2){let t;P(t=M())&&(a.turnosPorDiaChart=t.first),P(t=M())&&(a.turnosPorEspecialidadChart=t.first),P(t=M())&&(a.turnosPorMedicoChart=t.first),P(t=M())&&(a.turnosFinalizadosChart=t.first)}},decls:13,vars:1,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mb-8","flex","items-center","justify-between"],[1,"mb-2","text-4xl","font-bold","text-azul-oscuro"],[1,"text-gray-600"],[1,"flex","items-center","gap-2","rounded-lg","bg-red-500","px-6","py-3","text-sm","font-medium","text-white","shadow-md","transition-all","hover:bg-red-700","hover:shadow-lg","active:scale-95",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"grid","gap-6","lg:grid-cols-2"],[1,"rounded-xl","bg-white","p-6","shadow-lg","transition-all","hover:shadow-xl"],[1,"mb-4","flex","items-center","gap-3"],[1,"rounded-lg","bg-blue-100","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],[1,"text-xl","font-semibold","text-gray-800"],[1,"text-sm","text-gray-500"],[1,"rounded-lg","bg-gray-50","p-4"],[1,"rounded-lg","bg-purple-100","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-purple-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],[1,"rounded-xl","bg-white","p-6","shadow-lg","transition-all","hover:shadow-xl","lg:col-span-2"],[1,"rounded-lg","bg-teal-100","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-teal-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"],[1,"flex-1"],[1,"mb-4","flex","flex-wrap","items-center","gap-4","rounded-lg","bg-gray-50","p-4"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-medium","text-gray-700"],["type","date",1,"focus:ring-opacity-50","rounded-lg","border","border-gray-300","px-3","py-2","text-sm","shadow-sm","focus:border-azul-oscuro","focus:ring-2","focus:ring-azul-oscuro","focus:outline-none",3,"change","value"],[1,"ml-auto","rounded-lg","bg-azul-oscuro","px-6","py-2","text-sm","font-medium","text-white","shadow-md","transition-all","hover:bg-azul-claro","hover:shadow-lg","active:scale-95",3,"click"],[1,"rounded-lg","bg-green-100","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"rounded-lg","bg-indigo-100","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-indigo-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"],[1,"rounded-lg","bg-cyan-100","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-cyan-600"],[1,"rounded-lg","bg-pink-100","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-pink-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"],[1,"rounded-lg","bg-amber-100","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-amber-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"rounded-lg","bg-violet-100","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-violet-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),r(5," Panel de Estad\xEDsticas "),o(),n(6,"p",4),r(7," An\xE1lisis y m\xE9tricas del sistema en tiempo real "),o()(),n(8,"button",5),C("click",function(){return a.exportarEstadisticasPdf()}),N(),n(9,"svg",6),b(10,"path",7),o(),r(11," Exportar PDF "),o()(),R(12,Ke,131,4,"div",8),o()()),e&2&&(g(12),k(a.datosCargados()?12:-1))},dependencies:[G,te,ie,ae,ne,me,pe,ue,fe,he],encapsulation:2})};var et=(s,i)=>i.citaId;function tt(s,i){s&1&&(n(0,"div",5)(1,"div",7),b(2,"div",8),n(3,"p",4),r(4,"Cargando informaci\xF3n..."),o()()())}function it(s,i){if(s&1){let e=L();n(0,"button",31),C("click",function(){S(e);let t=h(4);return y(t.navegarA("solicitar-turnos"))}),r(1," Solicitar un turno "),o()}}function at(s,i){if(s&1&&(n(0,"div",13)(1,"mat-icon",28),r(2,"event_busy"),o(),n(3,"p",29),r(4),o(),R(5,it,2,0,"button",30),o()),s&2){let e=h(2);g(4),q(" ",e.rol==="paciente"?"No tienes turnos programados":"No tienes turnos pendientes"," "),g(),k(e.rol==="paciente"?5:-1)}}function nt(s,i){if(s&1&&(n(0,"mat-icon",29),r(1,"person"),o(),n(2,"span"),r(3),o()),s&2){let e=h().$implicit;g(3),ee(e.especialistaNombreCompleto)}}function ot(s,i){if(s&1&&(n(0,"mat-icon",29),r(1,"person"),o(),n(2,"span"),r(3),o()),s&2){let e=h().$implicit;g(3),ee(e.pacienteNombreCompleto)}}function rt(s,i){if(s&1){let e=L();n(0,"div",32)(1,"div",33)(2,"div",34)(3,"div",35)(4,"span",36),r(5),o(),n(6,"span",37),r(7),o()(),n(8,"div",38)(9,"mat-icon",29),r(10,"calendar_today"),o(),n(11,"span",39),r(12),o()(),n(13,"div",40)(14,"mat-icon",29),r(15,"schedule"),o(),n(16,"span"),r(17),o(),n(18,"span",41),r(19,"\u2022"),o(),R(20,nt,4,1)(21,ot,4,1),o()(),n(22,"button",42),C("click",function(){S(e);let t=h(3),l=h();return y(l.navegarA(t.rol==="paciente"?"mis-turnos-paciente":"mis-turnos-especialista"))}),r(23," Ver Detalles "),o()()()}if(s&2){let e=i.$implicit,a=h(3),t=h();g(4),Te(t.getEstadoClase(e.estado)),g(),q(" ",e.estado.charAt(0).toUpperCase()+e.estado.slice(1)," "),g(2),q(" ",e.especialidadNombre," "),g(5),q(" ",t.formatearFecha(e.fechaHora)," "),g(5),ee(t.formatearHora(e.fechaHora)),g(3),k(a.rol==="paciente"?20:21)}}function st(s,i){if(s&1&&(n(0,"div",14),oe(1,rt,24,7,"div",32,et),o()),s&2){let e=h(3);g(),re(e.proximosTurnos())}}function lt(s,i){if(s&1){let e=L();n(0,"button",43),C("click",function(){S(e);let t=h(3);return y(t.navegarA("solicitar-turnos"))}),n(1,"mat-icon",44),r(2,"add_circle"),o(),n(3,"div",45)(4,"p",46),r(5,"Solicitar Turno"),o(),n(6,"p",47),r(7,"Agenda una nueva cita"),o()()(),n(8,"button",43),C("click",function(){S(e);let t=h(3);return y(t.navegarA("mis-turnos-paciente"))}),n(9,"mat-icon",44),r(10,"list_alt"),o(),n(11,"div",45)(12,"p",46),r(13,"Mis Turnos"),o(),n(14,"p",47),r(15,"Ver historial completo"),o()()(),n(16,"button",43),C("click",function(){S(e);let t=h(3);return y(t.navegarA("perfil-paciente"))}),n(17,"mat-icon",44),r(18,"account_circle"),o(),n(19,"div",45)(20,"p",46),r(21,"Mi Perfil"),o(),n(22,"p",47),r(23,"Editar informaci\xF3n"),o()()()}}function ct(s,i){if(s&1){let e=L();n(0,"button",43),C("click",function(){S(e);let t=h(3);return y(t.navegarA("mis-turnos-especialista"))}),n(1,"mat-icon",44),r(2,"event_note"),o(),n(3,"div",45)(4,"p",46),r(5,"Mis Turnos"),o(),n(6,"p",47),r(7,"Ver agenda completa"),o()()(),n(8,"button",43),C("click",function(){S(e);let t=h(3);return y(t.navegarA("pacientes"))}),n(9,"mat-icon",44),r(10,"people"),o(),n(11,"div",45)(12,"p",46),r(13,"Mis Pacientes"),o(),n(14,"p",47),r(15,"Ver historial cl\xEDnico"),o()()(),n(16,"button",43),C("click",function(){S(e);let t=h(3);return y(t.navegarA("perfil-especialista"))}),n(17,"mat-icon",44),r(18,"account_circle"),o(),n(19,"div",45)(20,"p",46),r(21,"Mi Perfil"),o(),n(22,"p",47),r(23,"Configurar horarios"),o()()()}}function dt(s,i){s&1&&(n(0,"li",48)(1,"mat-icon",49),r(2,"check_circle"),o(),n(3,"span"),r(4,"Record\xE1 confirmar tus turnos con 24hs de anticipaci\xF3n"),o()(),n(5,"li",48)(6,"mat-icon",49),r(7,"check_circle"),o(),n(8,"span"),r(9,"Pod\xE9s cancelar turnos hasta 12hs antes"),o()(),n(10,"li",48)(11,"mat-icon",49),r(12,"check_circle"),o(),n(13,"span"),r(14,"No olvides completar las encuestas de satisfacci\xF3n"),o()())}function mt(s,i){s&1&&(n(0,"li",48)(1,"mat-icon",49),r(2,"check_circle"),o(),n(3,"span"),r(4,"Revis\xE1 tu agenda diariamente"),o()(),n(5,"li",48)(6,"mat-icon",49),r(7,"check_circle"),o(),n(8,"span"),r(9,"Complet\xE1 el registro m\xE9dico de cada consulta"),o()(),n(10,"li",48)(11,"mat-icon",49),r(12,"check_circle"),o(),n(13,"span"),r(14,"Manten\xE9 actualizada tu disponibilidad horaria"),o()())}function pt(s,i){if(s&1&&(n(0,"div",6)(1,"div",9)(2,"div",10)(3,"h2",11)(4,"mat-icon",12),r(5,"event_note"),o(),r(6," Pr\xF3ximos Turnos "),o()(),R(7,at,6,2,"div",13)(8,st,3,0,"div",14),o(),n(9,"div",9)(10,"h2",15)(11,"mat-icon",12),r(12,"flash_on"),o(),r(13," Acciones R\xE1pidas "),o(),n(14,"div",16),R(15,lt,24,0)(16,ct,24,0),o()(),n(17,"div",17)(18,"div",18)(19,"div",19)(20,"mat-icon",20),r(21,"info"),o(),n(22,"h3",21),r(23," Informaci\xF3n Importante "),o()(),n(24,"ul",22),R(25,dt,15,0)(26,mt,15,0),o()(),n(27,"div",23)(28,"div",19)(29,"mat-icon",24),r(30,"contact_support"),o(),n(31,"h3",21),r(32," \xBFNecesit\xE1s Ayuda? "),o()(),n(33,"p",25),r(34," Nuestro equipo est\xE1 disponible para asistirte con cualquier consulta o inconveniente. "),o(),n(35,"div",22)(36,"div",26)(37,"mat-icon",27),r(38,"email"),o(),n(39,"span"),r(40,"soporte@clinica.com"),o()(),n(41,"div",26)(42,"mat-icon",27),r(43,"phone"),o(),n(44,"span"),r(45,"0800-123-4567"),o()()()()()()),s&2){let e=h(),a=h();g(7),k(a.proximosTurnos().length===0?7:8),g(8),k(e.rol==="paciente"?15:e.rol==="especialista"?16:-1),g(10),k(e.rol==="paciente"?25:26)}}function ut(s,i){if(s&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4),o(),n(5,"p",4),r(6),o()(),R(7,tt,5,0,"div",5)(8,pt,46,3,"div",6),o()()),s&2){let e=h();g(4),q(" \xA1Bienvenido/a, ",i.nombre,"! "),g(2),ee(e.getFechaActual()),g(),k(e.cargando()?7:8)}}var ve=class s{constructor(i,e,a,t){this.authSupabase=i;this.turnosService=e;this.router=a;this.loading=t;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;realtimeChannel;proximosTurnos=Q([]);cargando=Q(!0);ngOnInit(){return c(this,null,function*(){this.usuarioActual=yield Se(this.usuario$),this.usuarioActual&&(yield this.cargarDatos(),this.suscribirseACambiosCitas())})}ngOnDestroy(){this.realtimeChannel&&$.removeChannel(this.realtimeChannel)}suscribirseACambiosCitas(){if(!this.usuarioActual?.id)return;let i=this.usuarioActual.id,e=this.usuarioActual.rol;this.realtimeChannel=$.channel("citas-changes").on("postgres_changes",{event:"*",schema:"public",table:B.CITAS,filter:e==="paciente"?`paciente_id=eq.${i}`:`especialista_id=eq.${i}`},()=>{this.cargarDatos()}).subscribe()}cargarDatos(){return c(this,null,function*(){if(this.usuarioActual?.id){this.cargando.set(!0);try{let i=[];this.usuarioActual.rol==="paciente"?i=yield this.turnosService.obtenerCitasPaciente(this.usuarioActual.id):this.usuarioActual.rol==="especialista"&&(i=yield this.turnosService.obtenerCitasEspecialista(this.usuarioActual.id)),this.proximosTurnos.set(this.turnosService.obtenerProximosTurnos(i,3))}catch(i){console.error("Error al cargar datos:",i)}finally{this.cargando.set(!1)}}})}formatearFecha(i){return new Date(i).toLocaleDateString("es-AR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}getFechaActual(){return new Date().toLocaleDateString("es-AR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}formatearHora(i){return new Date(i).toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"})}getEstadoClase(i){return{solicitado:"bg-yellow-100 text-yellow-800",aceptado:"bg-green-100 text-green-800",rechazado:"bg-red-100 text-red-800",cancelado:"bg-gray-100 text-gray-800",completado:"bg-blue-100 text-blue-800"}[i]||"bg-gray-100 text-gray-800"}navegarA(i){i!=="mis-turnos-especialista"&&i!=="pacientes"&&i!=="mis-turnos-paciente"&&this.loading.show();let e=`/home/${i}`;if(this.router.url===e){i!=="mis-turnos-especialista"&&this.loading.hide();return}this.router.navigate([e])}static \u0275fac=function(e){return new(e||s)(Y(de),Y(Re),Y(Pe),Y(Z))};static \u0275cmp=_({type:s,selectors:[["app-entrada"]],decls:2,vars:3,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mb-6"],[1,"mb-2","text-3xl","font-bold","text-azul-oscuro"],[1,"text-gray-600"],[1,"flex","items-center","justify-center","py-12"],[1,"mx-auto","max-w-6xl","space-y-6"],[1,"text-center"],[1,"mx-auto","mb-4","h-12","w-12","animate-spin","rounded-full","border-4","border-azul-oscuro","border-t-transparent"],[1,"rounded-lg","bg-white","p-6","shadow-md"],[1,"mb-4","flex","items-center","justify-between"],[1,"text-2xl","font-semibold","text-azul-oscuro"],[1,"mr-2","align-middle"],[1,"py-8","text-center","text-gray-500"],[1,"space-y-3"],[1,"mb-4","text-2xl","font-semibold","text-azul-oscuro"],[1,"grid","grid-cols-1","gap-4","md:grid-cols-2","lg:grid-cols-3"],[1,"grid","grid-cols-1","gap-4","md:grid-cols-2"],[1,"rounded-lg","bg-blue-50","p-6","shadow-md"],[1,"mb-3","flex","items-center","gap-2"],[1,"text-2xl","text-blue-600"],[1,"text-lg","font-semibold","text-azul-oscuro"],[1,"space-y-2","text-sm","text-gray-700"],[1,"rounded-lg","bg-green-50","p-6","shadow-md"],[1,"text-2xl","text-green-600"],[1,"mb-3","text-sm","text-gray-700"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-green-600"],[1,"mb-2","text-5xl","text-gray-300"],[1,"text-lg"],[1,"mt-4","rounded-lg","bg-azul-oscuro","px-6","py-2","font-medium","text-white","transition-colors","hover:bg-blue-700"],[1,"mt-4","rounded-lg","bg-azul-oscuro","px-6","py-2","font-medium","text-white","transition-colors","hover:bg-blue-700",3,"click"],[1,"rounded-lg","border","border-gray-200","bg-gray-50","p-4","transition-shadow","hover:shadow-md"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"mb-2","flex","items-center","gap-3"],[1,"rounded-full","px-3","py-1","text-xs","font-semibold"],[1,"text-sm","font-medium","text-gray-700"],[1,"mb-2","flex","items-center","gap-2","text-gray-700"],[1,"font-medium"],[1,"flex","items-center","gap-2","text-gray-600"],[1,"mx-2"],[1,"rounded-lg","bg-azul-oscuro","px-4","py-2","text-sm","font-medium","text-white","transition-colors","hover:bg-blue-700",3,"click"],[1,"flex","items-center","gap-3","rounded-lg","border-2","border-azul-oscuro","bg-white","p-4","transition-all","hover:bg-azul-oscuro","hover:text-white",3,"click"],[1,"text-3xl"],[1,"text-left"],[1,"font-semibold"],[1,"text-sm","opacity-75"],[1,"flex","items-start","gap-2"],[1,"text-sm","text-blue-600"]],template:function(e,a){if(e&1&&(R(0,ut,9,3,"div",0),se(1,"async")),e&2){let t;k((t=le(1,1,a.usuario$))?0:-1,t)}},dependencies:[G,De,Me,ce],encapsulation:2})};function ft(s,i){s&1&&b(0,"app-home")}function ht(s,i){s&1&&b(0,"app-entrada")}function gt(s,i){s&1&&R(0,ft,1,0,"app-home")(1,ht,1,0,"app-entrada"),s&2&&k(i.rol==="admin"?0:1)}var ke=class s{constructor(i){this.authSupabase=i;this.usuario$=this.authSupabase.user$}usuario$;loading=w(Z);ngAfterViewInit(){setTimeout(()=>{this.loading.hide()},0)}static \u0275fac=function(e){return new(e||s)(Y(de))};static \u0275cmp=_({type:s,selectors:[["app-home-router"]],decls:2,vars:3,template:function(e,a){if(e&1&&(R(0,gt,2,1),se(1,"async")),e&2){let t;k((t=le(1,1,a.usuario$))?0:-1,t)}},dependencies:[G,ge,ve,ce],encapsulation:2})};export{ke as HomeRouter};
