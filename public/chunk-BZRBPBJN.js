import{a as je,b as ze,c as qe,d as Be,e as Ue,f as Le}from"./chunk-ORNE3K7H.js";import{a as Ce}from"./chunk-45ZKO53K.js";import"./chunk-75QZAIKX.js";import{a as Me,b as Pe,f as Ie,i as Oe,j as Ne,k as De}from"./chunk-42WLO5Z2.js";import{f as Te,g as ke,n as Ae}from"./chunk-ZTAJVVXQ.js";import{a as Ve}from"./chunk-QYWCDNK3.js";import{b as j,c as z}from"./chunk-NSHH6JJ5.js";import"./chunk-X5YLR3NI.js";import"./chunk-Q4YNZBQ2.js";import{b as _e}from"./chunk-K32GGTJZ.js";import{f as he,g as fe}from"./chunk-DHRKF7SU.js";import{c as N,e as g,g as D,h as ve,j as be,k as xe,l as Ee,n as ye,o as Se,v as Fe,w as we,x as Re}from"./chunk-T6NMK5EM.js";import"./chunk-HICRNNMR.js";import{e as I,k as O}from"./chunk-M3XRSK3P.js";import{Db as v,Fb as u,Ma as ne,Na as le,Oa as s,Qb as ce,Rb as M,Tb as c,Ub as H,Vb as k,Xb as de,Yb as me,Z as R,Za as P,Zb as pe,_b as ue,ca as f,cc as F,da as C,dc as ge,ea as re,eb as se,nb as m,ob as p,pb as B,qb as U,rb as L,sa as oe,sb as _,tb as o,ub as r,vb as b,zb as V}from"./chunk-7RTQA4J5.js";import{i as w}from"./chunk-ODN5LVDJ.js";var Qe=(i,t)=>({"bg-green-500":i,"bg-red-500":t}),Je=(i,t)=>({"translate-x-2.5":i,"translate-x-0":t}),Ke=(i,t,e)=>({"text-green-600":i,"text-red-600":t,"text-orange-600":e});function Xe(i,t){i&1&&(o(0,"div",1),re(),o(1,"svg",12),b(2,"circle",13)(3,"path",14),r()())}function Ye(i,t){if(i&1&&b(0,"img",6),i&2){let e=u();_("src",e.captchaActual.imagenUrl,ne)}}function et(i,t){if(i&1&&(o(0,"p",11),c(1),r()),i&2){let e=u();_("ngClass",ge(2,Ke,e.captchaValido,!e.captchaValido,!e.captchaActivo)),s(),k(" ",e.mensajeVerificacion," ")}}var q=class i{captchaResuelto=new se;auth=R(z);captchas=[];captchaActual;userInput="";captchaValido=!1;mensajeVerificacion="";verificando=!1;cargado=!1;captchaActivo=!0;ngOnInit(){return w(this,null,function*(){yield this.cargarCaptchasDesdeSupabase()})}cargarCaptchasDesdeSupabase(){return w(this,null,function*(){try{if(this.captchas=yield this.auth.getCaptchas(),!this.captchas.length){console.error("No se pudieron cargar captchas");return}this.captchaActual=this.obtenerCaptchaAleatorio(),this.cargado=!0}catch(t){console.error("Error al cargar captchas:",t),this.cargado=!1}})}obtenerCaptchaAleatorio(){if(this.captchas.length<2)return this.captchas[0];let t;do{let e=Math.floor(Math.random()*this.captchas.length);t=this.captchas[e]}while(t===this.captchaActual);return t}verificarRespuesta(){return w(this,null,function*(){if(!this.captchaActual)return;if(!this.captchaActivo){this.captchaValido=!0,this.mensajeVerificacion="Captcha desactivado - Verificaci\xF3n omitida",this.captchaResuelto.emit(!0);return}this.mensajeVerificacion="",this.verificando=!0,yield new Promise(e=>setTimeout(e,500));let t=yield this.sha256(this.userInput.trim().toLowerCase());this.captchaValido=t===this.captchaActual.answerHash,this.mensajeVerificacion=this.captchaValido?"Respuesta correcta":"Respuesta incorrecta",this.verificando=!1,this.captchaResuelto.emit(this.captchaValido)})}sha256(t){return w(this,null,function*(){let e=new TextEncoder().encode(t),a=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(a)).map(h=>h.toString(16).padStart(2,"0")).join("")})}cambiarCaptcha(){this.captchaActual=this.obtenerCaptchaAleatorio(),this.userInput="",this.mensajeVerificacion=""}toggleCaptcha(){this.captchaActivo=!this.captchaActivo,this.userInput="",this.mensajeVerificacion="",this.captchaActivo?(this.captchaValido=!1,this.captchaResuelto.emit(!1)):(this.captchaValido=!0,this.captchaResuelto.emit(!0))}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-mi-captcha"]],outputs:{captchaResuelto:"captchaResuelto"},decls:14,vars:27,consts:[[1,"relative","w-[300px]","items-center","justify-center","align-middle","text-sm"],[1,"absolute","inset-0","z-10","flex","items-center","justify-center","bg-white/120","backdrop-blur-sm"],[1,"relative","rounded-lg","border","border-gray-300","bg-crema","p-4","shadow-sm"],["type","button",1,"absolute","top-1","right-1","z-20","flex","h-3","w-6","items-center","rounded-full","p-0.5","shadow-md","transition-colors","duration-300","hover:shadow-lg","focus:ring-1","focus:ring-offset-1","focus:outline-none",3,"click","ngClass","title"],[1,"h-2","w-2","transform","rounded-full","bg-white","shadow-sm","transition-transform","duration-300",3,"ngClass"],[1,"flex","flex-col","items-center","gap-2","pt-1","transition-all","duration-300"],["alt","captcha",1,"h-24","w-full","rounded","border","bg-white","object-contain",3,"src"],["placeholder","Escrib\xED lo que ves",1,"w-full","rounded","border","border-gray-300","bg-white","px-3","py-1.5","focus:ring-2","focus:ring-azul-oscuro","focus:outline-none","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],[1,"flex","w-full","justify-between","gap-2"],["type","button",1,"flex-1","rounded","bg-verde-claro","px-3","py-1.5","text-lg","text-white","hover:bg-verde-claro/80","disabled:cursor-not-allowed","disabled:opacity-50",3,"click","disabled"],["type","button",1,"flex-1","rounded","bg-azul-claro","px-3","py-1.5","text-lg","text-white","hover:bg-azul-claro/80","disabled:cursor-not-allowed","disabled:opacity-50",3,"click","disabled"],[1,"mt-1",3,"ngClass"],["viewBox","0 0 24 24","fill","none",1,"h-6","w-6","animate-spin","text-blue-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"]],template:function(e,a){e&1&&(o(0,"div",0),m(1,Xe,4,0,"div",1),o(2,"div",2)(3,"button",3),v("click",function(){return a.toggleCaptcha()}),b(4,"div",4),r(),o(5,"div",5),m(6,Ye,1,1,"img",6),o(7,"input",7),pe("ngModelChange",function(d){return me(a.userInput,d)||(a.userInput=d),d}),r(),o(8,"div",8)(9,"button",9),v("click",function(){return a.verificarRespuesta()}),c(10," Verificar "),r(),o(11,"button",10),v("click",function(){return a.cambiarCaptcha()}),c(12," Cambiar "),r()(),m(13,et,2,6,"p",11),r()()()),e&2&&(s(),p(a.verificando||!a.cargado?1:-1),s(2),M("focus:ring-green-500",a.captchaActivo)("focus:ring-red-500",!a.captchaActivo),_("title",ue(a.captchaActivo?"Captcha activado - Click para desactivar":"Captcha desactivado - Click para activar"))("ngClass",F(21,Qe,a.captchaActivo,!a.captchaActivo)),s(),_("ngClass",F(24,Je,a.captchaActivo,!a.captchaActivo)),s(),ce("filter",a.captchaActivo?"none":"blur(1px) brightness(1.1)"),M("opacity-50",a.verificando)("opacity-40",!a.captchaActivo),s(),p(a.captchaActual?6:-1),s(),de("ngModel",a.userInput),_("disabled",a.verificando||!a.captchaActivo),s(2),_("disabled",a.verificando||!a.captchaActivo),s(2),_("disabled",a.verificando||!a.captchaActivo),s(2),p(a.mensajeVerificacion?13:-1))},dependencies:[O,I,we,N,D,be],encapsulation:2})};var T=(i,t)=>({"mat-form-field-valid":i,"mat-form-field-invalid":t});function tt(i,t){if(i&1){let e=V();o(0,"div",2)(1,"p",4),c(2,"\xBFQu\xE9 tipo de usuario sos?"),r(),o(3,"div",5)(4,"div",6),v("click",function(){f(e);let n=u();return C(n.seleccionarTipo("paciente"))})("keyup.enter",function(){f(e);let n=u();return C(n.seleccionarTipo("paciente"))})("keyup.space",function(){f(e);let n=u();return C(n.seleccionarTipo("paciente"))}),o(5,"div",7),b(6,"img",8),o(7,"div",9)(8,"h3",10),c(9,"Paciente"),r()()()(),o(10,"div",11),v("click",function(){f(e);let n=u();return C(n.seleccionarTipo("especialista"))})("keyup.enter",function(){f(e);let n=u();return C(n.seleccionarTipo("especialista"))})("keyup.space",function(){f(e);let n=u();return C(n.seleccionarTipo("especialista"))}),o(11,"div",7),b(12,"img",12),o(13,"div",9)(14,"h3",10),c(15,"Especialista"),r()()()()()()}}function it(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function at(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xEDnimo 2 caracteres"),r())}function rt(i,t){i&1&&(o(0,"mat-error"),c(1,"Solo letras"),r())}function ot(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function nt(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xEDnimo 2 caracteres"),r())}function lt(i,t){i&1&&(o(0,"mat-error"),c(1,"Solo letras"),r())}function st(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function ct(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xEDnimo 18"),r())}function dt(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xE1ximo 99"),r())}function mt(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function pt(i,t){i&1&&(o(0,"mat-error"),c(1,"Debe contener 8 d\xEDgitos"),r())}function ut(i,t){if(i&1&&(o(0,"mat-option",33),c(1),r()),i&2){let e=t.$implicit;_("value",e),s(),H(e)}}function gt(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function _t(i,t){if(i&1&&(o(0,"mat-form-field",14)(1,"mat-label"),c(2,"Obra Social"),r(),o(3,"mat-select",32),U(4,ut,2,2,"mat-option",33,B),r(),m(6,gt,2,0,"mat-error"),r()),i&2){let e,a,n=u(2);_("ngClass",F(2,T,((e=n.registroForm.get("obraSocial"))==null?null:e.valid)&&(((e=n.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=n.registroForm.get("obraSocial"))==null?null:e.touched)),((e=n.registroForm.get("obraSocial"))==null?null:e.invalid)&&(((e=n.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=n.registroForm.get("obraSocial"))==null?null:e.touched)))),s(4),L(n.obraSocialOptions),s(2),p((a=n.registroForm.get("obraSocial"))!=null&&a.hasError("required")?6:-1)}}function ht(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function ft(i,t){i&1&&(o(0,"mat-error"),c(1,"Email inv\xE1lido"),r())}function Ct(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function vt(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xEDnimo 7 caracteres"),r())}function bt(i,t){if(i&1){let e=V();o(0,"mat-checkbox",46),v("change",function(){let n=f(e).$implicit,d=u(4);return C(d.toggleEspecialidad(n.id))}),c(1),r()}if(i&2){let e=t.$implicit,a=u(4);_("checked",a.esEspecialidadSeleccionada(e.id)),s(),k(" ",e.nombre," ")}}function xt(i,t){i&1&&(o(0,"div",48),c(1,"M\xEDnimo 2 caracteres"),r())}function Et(i,t){i&1&&(o(0,"div",48),c(1," Solo letras y espacios "),r())}function yt(i,t){if(i&1){let e=V();o(0,"div",45)(1,"input",47),v("click",function(n){return f(e),C(n.stopPropagation())}),r(),m(2,xt,2,0,"div",48),m(3,Et,2,0,"div",48),r()}if(i&2){let e,a,n=u(4);s(2),p((e=n.registroForm.get("nuevaEspecialidad"))!=null&&e.hasError("minlength")?2:-1),s(),p((a=n.registroForm.get("nuevaEspecialidad"))!=null&&a.hasError("pattern")?3:-1)}}function St(i,t){if(i&1){let e=V();o(0,"div",39)(1,"div",41),U(2,bt,2,2,"mat-checkbox",42,B),r(),o(4,"div",43)(5,"button",44),v("click",function(n){return f(e),u(3).toggleMostrarNuevaEspecialidad(),C(n.stopPropagation())}),c(6),r(),m(7,yt,4,2,"div",45),r()()}if(i&2){let e=u(3);s(2),L(e.especialidadOptions),s(4),k(" ",e.mostrarCampoOtraEspecialidad?"\u2715 Cancelar":"+ Agregar nueva especialidad"," "),s(),p(e.mostrarCampoOtraEspecialidad?7:-1)}}function Ft(i,t){i&1&&(o(0,"div",40),c(1," Deb\xE9s seleccionar al menos una especialidad o agregar una nueva "),r())}function wt(i,t){if(i&1){let e=V();o(0,"div",21)(1,"div",34),c(2," Especialidades (seleccion\xE1 al menos una) "),r(),o(3,"div",35)(4,"div",36),v("click",function(n){f(e);let d=u(2);return C(d.toggleDesplegableEspecialidades(n))})("keyup.enter",function(n){f(e);let d=u(2);return C(d.toggleDesplegableEspecialidades(n))})("keyup.space",function(n){f(e);let d=u(2);return C(d.toggleDesplegableEspecialidades(n))}),o(5,"span",37),c(6),r(),o(7,"mat-icon",38),c(8),r()(),m(9,St,8,2,"div",39),r(),m(10,Ft,2,0,"div",40),r()}if(i&2){let e,a=u(2);s(4),M("border-azul-oscuro",a.desplegableEspecialidadesAbierto),s(2),k(" ",a.obtenerEspecialidadesSeleccionadasTexto()," "),s(2),H(a.desplegableEspecialidadesAbierto?"expand_less":"expand_more"),s(),p(a.desplegableEspecialidadesAbierto?9:-1),s(),p((e=a.registroForm.get("especialidadesSeleccionadas"))!=null&&e.hasError("alMenosUna")&&((e=a.registroForm.get("especialidadesSeleccionadas"))!=null&&e.touched)?10:-1)}}function Rt(i,t){i&1&&(o(0,"mat-error"),c(1," Debe seleccionar una imagen de perfil. "),r())}function Vt(i,t){i&1&&(o(0,"mat-error"),c(1," Solo se permiten archivos .jpg o .png "),r())}function Tt(i,t){i&1&&(o(0,"mat-error"),c(1," Debe seleccionar una imagen de fondo. "),r())}function kt(i,t){i&1&&(o(0,"mat-error"),c(1," Solo se permiten archivos .jpg o .png "),r())}function At(i,t){if(i&1){let e=V();o(0,"div",22)(1,"label",49),c(2,"Foto Fondo"),r(),o(3,"input",50),v("change",function(n){f(e);let d=u(2);return C(d.onFileSelected(n,"fondo"))}),r(),m(4,Tt,2,0,"mat-error"),m(5,kt,2,0,"mat-error"),r()}if(i&2){let e,a,n=u(2);s(4),p((e=n.registroForm.get("imagenFondo"))!=null&&e.hasError("required")?4:-1),s(),p((a=n.registroForm.get("imagen"))!=null&&a.hasError("invalidType")?5:-1)}}function Mt(i,t){i&1&&(o(0,"div",30),c(1," Debe resolver correctamente el CAPTCHA. "),r())}function Pt(i,t){if(i&1){let e=V();o(0,"div",3)(1,"form",13),v("ngSubmit",function(){f(e);let n=u();return C(n.registrar())}),o(2,"mat-form-field",14)(3,"mat-label"),c(4,"Nombre"),r(),b(5,"input",15),m(6,it,2,0,"mat-error"),m(7,at,2,0,"mat-error"),m(8,rt,2,0,"mat-error"),r(),o(9,"mat-form-field",14)(10,"mat-label"),c(11,"Apellido"),r(),b(12,"input",16),m(13,ot,2,0,"mat-error"),m(14,nt,2,0,"mat-error"),m(15,lt,2,0,"mat-error"),r(),o(16,"mat-form-field",14)(17,"mat-label"),c(18,"Edad"),r(),b(19,"input",17),m(20,st,2,0,"mat-error"),m(21,ct,2,0,"mat-error"),m(22,dt,2,0,"mat-error"),r(),o(23,"mat-form-field",14)(24,"mat-label"),c(25,"DNI"),r(),b(26,"input",18),m(27,mt,2,0,"mat-error"),m(28,pt,2,0,"mat-error"),r(),m(29,_t,7,5,"mat-form-field",14),o(30,"mat-form-field",14)(31,"mat-label"),c(32,"Email"),r(),b(33,"input",19),m(34,ht,2,0,"mat-error"),m(35,ft,2,0,"mat-error"),r(),o(36,"mat-form-field",14)(37,"mat-label"),c(38,"Contrase\xF1a"),r(),b(39,"input",20),m(40,Ct,2,0,"mat-error"),m(41,vt,2,0,"mat-error"),r(),m(42,wt,11,6,"div",21),o(43,"div",22)(44,"label",23),c(45,"Foto Perfil"),r(),o(46,"input",24),v("change",function(n){f(e);let d=u();return C(d.onFileSelected(n,"perfil"))}),r(),m(47,Rt,2,0,"mat-error"),m(48,Vt,2,0,"mat-error"),r(),m(49,At,6,2,"div",22),o(50,"div",25)(51,"button",26)(52,"span"),c(53,"Registrarse"),r()()(),o(54,"div",27)(55,"button",28),v("click",function(){f(e);let n=u();return C(n.tipoUsuario=null)}),c(56," Cambiar tipo de usuario "),r()(),o(57,"div",29),m(58,Mt,2,0,"div",30),o(59,"app-mi-captcha",31),v("captchaResuelto",function(n){f(e);let d=u();return C(d.onCaptchaResuelto(n))}),r()()()()}if(i&2){let e,a,n,d,h,A,G,$,x,W,Z,Q,E,J,K,y,X,Y,S,ee,te,ie,ae,l=u();s(),_("formGroup",l.registroForm),s(),_("ngClass",F(29,T,((e=l.registroForm.get("nombre"))==null?null:e.valid)&&(((e=l.registroForm.get("nombre"))==null?null:e.dirty)||((e=l.registroForm.get("nombre"))==null?null:e.touched)),((e=l.registroForm.get("nombre"))==null?null:e.invalid)&&(((e=l.registroForm.get("nombre"))==null?null:e.dirty)||((e=l.registroForm.get("nombre"))==null?null:e.touched)))),s(4),p((a=l.registroForm.get("nombre"))!=null&&a.hasError("required")?6:-1),s(),p((n=l.registroForm.get("nombre"))!=null&&n.hasError("minlength")?7:-1),s(),p((d=l.registroForm.get("nombre"))!=null&&d.hasError("pattern")?8:-1),s(),_("ngClass",F(32,T,((h=l.registroForm.get("apellido"))==null?null:h.valid)&&(((h=l.registroForm.get("apellido"))==null?null:h.dirty)||((h=l.registroForm.get("apellido"))==null?null:h.touched)),((h=l.registroForm.get("apellido"))==null?null:h.invalid)&&(((h=l.registroForm.get("apellido"))==null?null:h.dirty)||((h=l.registroForm.get("apellido"))==null?null:h.touched)))),s(4),p((A=l.registroForm.get("apellido"))!=null&&A.hasError("required")?13:-1),s(),p((G=l.registroForm.get("apellido"))!=null&&G.hasError("minlength")?14:-1),s(),p(($=l.registroForm.get("apellido"))!=null&&$.hasError("pattern")?15:-1),s(),_("ngClass",F(35,T,((x=l.registroForm.get("edad"))==null?null:x.valid)&&(((x=l.registroForm.get("edad"))==null?null:x.dirty)||((x=l.registroForm.get("edad"))==null?null:x.touched)),((x=l.registroForm.get("edad"))==null?null:x.invalid)&&(((x=l.registroForm.get("edad"))==null?null:x.dirty)||((x=l.registroForm.get("edad"))==null?null:x.touched)))),s(4),p((W=l.registroForm.get("edad"))!=null&&W.hasError("required")?20:-1),s(),p((Z=l.registroForm.get("edad"))!=null&&Z.hasError("min")?21:-1),s(),p((Q=l.registroForm.get("edad"))!=null&&Q.hasError("max")?22:-1),s(),_("ngClass",F(38,T,((E=l.registroForm.get("dni"))==null?null:E.valid)&&(((E=l.registroForm.get("dni"))==null?null:E.dirty)||((E=l.registroForm.get("dni"))==null?null:E.touched)),((E=l.registroForm.get("dni"))==null?null:E.invalid)&&(((E=l.registroForm.get("dni"))==null?null:E.dirty)||((E=l.registroForm.get("dni"))==null?null:E.touched)))),s(4),p((J=l.registroForm.get("dni"))!=null&&J.hasError("required")?27:-1),s(),p((K=l.registroForm.get("dni"))!=null&&K.hasError("pattern")?28:-1),s(),p(l.tipoUsuario==="paciente"?29:-1),s(),_("ngClass",F(41,T,((y=l.registroForm.get("mail"))==null?null:y.valid)&&(((y=l.registroForm.get("mail"))==null?null:y.dirty)||((y=l.registroForm.get("mail"))==null?null:y.touched)),((y=l.registroForm.get("mail"))==null?null:y.invalid)&&(((y=l.registroForm.get("mail"))==null?null:y.dirty)||((y=l.registroForm.get("mail"))==null?null:y.touched)))),s(4),p((X=l.registroForm.get("mail"))!=null&&X.hasError("required")?34:-1),s(),p((Y=l.registroForm.get("mail"))!=null&&Y.hasError("email")?35:-1),s(),_("ngClass",F(44,T,((S=l.registroForm.get("password"))==null?null:S.valid)&&(((S=l.registroForm.get("password"))==null?null:S.dirty)||((S=l.registroForm.get("password"))==null?null:S.touched)),((S=l.registroForm.get("password"))==null?null:S.invalid)&&(((S=l.registroForm.get("password"))==null?null:S.dirty)||((S=l.registroForm.get("password"))==null?null:S.touched)))),s(4),p((ee=l.registroForm.get("password"))!=null&&ee.hasError("required")?40:-1),s(),p((te=l.registroForm.get("password"))!=null&&te.hasError("minlength")?41:-1),s(),p(l.tipoUsuario==="especialista"?42:-1),s(5),p((ie=l.registroForm.get("imagenPerfil"))!=null&&ie.hasError("required")?47:-1),s(),p((ae=l.registroForm.get("imagen"))!=null&&ae.hasError("invalidType")?48:-1),s(),p(l.tipoUsuario==="paciente"?49:-1),s(2),_("disabled",l.registroForm.invalid),s(7),p(l.registroForm.errors!=null&&l.registroForm.errors.captchaInvalido&&l.registroForm.touched?58:-1)}}var He=class i{registroForm;tipoUsuario=null;obraSocialOptions=Le;especialidadOptions=[];especialidadesSeleccionadas=new Set;captchaEsValido=!1;mostrarCampoOtraEspecialidad=!1;desplegableEspecialidadesAbierto=!1;captchaValidoValidator=()=>()=>this.captchaEsValido?null:{captchaInvalido:!0};subEspecialidad;subReset;fb=R(Fe);auth=R(z);snackBar=R(Ae);router=R(_e);loading=R(Ve);elementRef=R(oe);registerState=R(Ce);ngOnInit(){this.registroForm=this.fb.group({nombre:["",[g.required,g.minLength(2),g.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],apellido:["",[g.required,g.minLength(2),g.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],edad:[null,[g.required,g.min(18),g.max(99)]],dni:["",[g.required,g.pattern(/^\d{8}$/)]],obraSocial:[""],mail:["",[g.required,g.email]],password:["",[g.required,g.minLength(7)]],especialidadesSeleccionadas:[[]],nuevaEspecialidad:["",[g.minLength(2),g.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],imagenPerfil:[null,g.required],imagenFondo:[""]},{validators:this.captchaValidoValidator()}),this.subReset=this.registerState.reset$.subscribe(()=>{this.resetearFormulario()})}ngOnDestroy(){this.subEspecialidad&&this.subEspecialidad.unsubscribe(),this.subReset&&this.subReset.unsubscribe()}seleccionarTipo(t){return w(this,null,function*(){if(this.tipoUsuario=t,!!this.registroForm){if(t==="especialista")try{this.loading.show(),this.especialidadOptions=yield this.auth.obtenerEspecialidades()}catch(e){console.error("Error al obtener especialidades:",e),this.snackBar.open("Error al cargar especialidades. Intente nuevamente.","Cerrar",{duration:3e3})}finally{this.loading.hide()}t==="paciente"?(this.registroForm.get("obraSocial")?.setValidators([g.required]),this.registroForm.get("imagenFondo")?.setValidators([g.required]),this.registroForm.get("especialidadesSeleccionadas")?.clearValidators(),this.registroForm.get("nuevaEspecialidad")?.clearValidators()):(this.registroForm.get("obraSocial")?.clearValidators(),this.registroForm.get("imagenFondo")?.clearValidators(),this.registroForm.get("especialidadesSeleccionadas")?.setValidators([this.alMenosUnaEspecialidadValidator()])),this.registroForm.get("obraSocial")?.updateValueAndValidity(),this.registroForm.get("imagenFondo")?.updateValueAndValidity(),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity()}})}alMenosUnaEspecialidadValidator(){return t=>{let e=t.value||[],a=this.registroForm?.get("nuevaEspecialidad")?.value;return e.length===0&&!a?{alMenosUna:!0}:null}}toggleEspecialidad(t){this.especialidadesSeleccionadas.has(t)?this.especialidadesSeleccionadas.delete(t):this.especialidadesSeleccionadas.add(t),this.actualizarEspecialidadesEnForm()}toggleMostrarNuevaEspecialidad(){this.mostrarCampoOtraEspecialidad=!this.mostrarCampoOtraEspecialidad,this.mostrarCampoOtraEspecialidad||this.registroForm.get("nuevaEspecialidad")?.setValue("")}toggleDesplegableEspecialidades(t){t&&t.stopPropagation(),this.desplegableEspecialidadesAbierto=!this.desplegableEspecialidadesAbierto}onClickOutside(t){if(!this.desplegableEspecialidadesAbierto)return;let e=t.target;this.elementRef.nativeElement.querySelector(".relative")?.contains(e)||(this.desplegableEspecialidadesAbierto=!1)}obtenerEspecialidadesSeleccionadasTexto(){return this.especialidadesSeleccionadas.size===0?"Ninguna seleccionada":Array.from(this.especialidadesSeleccionadas).map(e=>this.especialidadOptions.find(a=>a.id===e)?.nombre).filter(e=>e).join(", ")}esEspecialidadSeleccionada(t){return this.especialidadesSeleccionadas.has(t)}actualizarEspecialidadesEnForm(){let t=Array.from(this.especialidadesSeleccionadas);this.registroForm.get("especialidadesSeleccionadas")?.setValue(t),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity()}onFileSelected(t,e){let a=e==="perfil"?"imagenPerfil":"imagenFondo",n=t.target,d=this.registroForm.get(a);if(!n.files?.length){d.setValue(null),d.setErrors({required:!0});return}let h=n.files[0];if(!["image/jpeg","image/png","image/jpg"].includes(h.type)){d.setErrors({invalidType:!0});return}d.setValue(h),d.setErrors(null)}registrar(){return w(this,null,function*(){if(!(this.registroForm.invalid||!this.tipoUsuario)){this.loading.show();try{this.tipoUsuario==="paciente"?yield this.handleRegistroPaciente():yield this.handleRegistroEspecialista()}finally{this.loading.hide()}}})}handleRegistroPaciente(){return w(this,null,function*(){try{let t=this.registroForm.value,e=yield j(t.imagenPerfil),a=yield j(t.imagenFondo),n={nombre:t.nombre,apellido:t.apellido,edad:t.edad,dni:t.dni,obraSocial:t.obraSocial,mail:t.mail,contrasena:t.password,imagenPerfil:e,imagenFondo:a},d=yield this.auth.registerPaciente(n);d.errorCode?.toLowerCase()?.includes("error desconocido")?this.mostrarResultado(d.success,d.message):this.mostrarResultado(d.success,d.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar las im\xE1genes.")}})}handleRegistroEspecialista(){return w(this,null,function*(){try{let t=this.registroForm.value,e=yield j(t.imagenPerfil),a=[];t.especialidadesSeleccionadas&&t.especialidadesSeleccionadas.length>0&&a.push(...t.especialidadesSeleccionadas.map(A=>String(A))),t.nuevaEspecialidad&&t.nuevaEspecialidad.trim()&&a.push(t.nuevaEspecialidad.trim());let n={nombre:t.nombre,apellido:t.apellido,edad:t.edad,dni:t.dni,mail:t.mail,contrasena:t.password,especialidades:a,imagenPerfil:e},d=yield this.auth.registerEspecialista(n);d.errorCode?.toLowerCase()?.includes("error desconocido")?this.mostrarResultado(d.success,d.message):this.mostrarResultado(d.success,d.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar la imagen.")}})}mostrarResultado(t,e){if(!t){this.snackBar.open(e||"Ocurri\xF3 un error.","Cerrar",{duration:4e3,panelClass:["bg-red-600","text-white"]});return}this.tipoUsuario=null,this.router.navigate(["/welcome-page/confirmacion"])}onCaptchaResuelto(t){this.captchaEsValido=t,this.registroForm.updateValueAndValidity()}resetearFormulario(){this.tipoUsuario=null,this.especialidadesSeleccionadas.clear(),this.captchaEsValido=!1,this.mostrarCampoOtraEspecialidad=!1,this.desplegableEspecialidadesAbierto=!1,this.registroForm.reset(),window.scrollTo({top:0,behavior:"smooth"})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-register"]],hostBindings:function(e,a){e&1&&v("click",function(d){return a.onClickOutside(d)},le)},decls:5,vars:2,consts:[[1,"min-h-screen","bg-gray-200","pt-30","pb-60"],[1,"pb-1","text-center","text-4xl","font-bold","text-azul-oscuro"],[1,"pt-16","pb-30","text-center"],[1,"flex","justify-center","py-8"],[1,"mb-6","text-xl","text-gray-700"],[1,"flex","flex-col","items-center","gap-6"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Paciente",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],[1,"rounded-2xl","bg-white","shadow-lg"],["src","assets/imagenes/Registro/pacientes.webp","alt","Paciente",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"p-4"],[1,"text-xl","font-bold","text-azul-oscuro"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Especialista",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],["src","assets/imagenes/Registro/especialistas.webp","alt","Especialista",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"grid","w-full","max-w-2xl","grid-cols-1","gap-4","rounded-xl","bg-crema","p-8","shadow-lg","md:grid-cols-2",3,"ngSubmit","formGroup"],["appearance","fill",1,"col-span-1",3,"ngClass"],["matInput","","formControlName","nombre"],["matInput","","formControlName","apellido"],["matInput","","type","number","formControlName","edad"],["matInput","","formControlName","dni"],["matInput","","type","email","formControlName","mail"],["matInput","","type","password","formControlName","password"],[1,"col-span-2"],[1,"col-span-2","flex","flex-col","gap-2"],["for","fotoPerfil",1,"font-semibold","text-azul-oscuro"],["id","fotoPerfil","type","file","accept","image/*",1,"register-input",3,"change"],[1,"col-span-2","flex","justify-center","pt-4"],["mat-raised-button","","color","primary","type","submit",1,"flex","items-center","justify-center","gap-2","rounded-full","bg-verde-oscuro","px-8","py-2","text-white","shadow-lg",3,"disabled"],[1,"col-span-2","mt-1","flex","justify-center"],["mat-button","","type","button",1,"text-sm","text-gray-600","underline",3,"click"],[1,"col-span-2","mt-1","flex","flex-col","items-center"],[1,"mb-2","text-center","text-sm","text-red-600"],[3,"captchaResuelto"],["formControlName","obraSocial"],[3,"value"],[1,"mb-1","text-sm","font-medium","text-azul-oscuro"],[1,"relative"],["tabindex","0",1,"flex","min-h-[56px]","cursor-pointer","items-center","rounded-md","border","border-gray-300","bg-white","px-4","py-3","transition-colors","hover:border-azul-oscuro",3,"click","keyup.enter","keyup.space"],[1,"flex-1","text-sm","text-gray-700"],[1,"text-gray-500"],[1,"absolute","top-full","right-0","left-0","z-10","mt-1","max-h-60","overflow-y-auto","rounded-lg","border","border-gray-300","bg-white","p-3","shadow-lg"],[1,"mt-1","text-sm","text-red-600"],[1,"space-y-2"],[1,"block","text-sm",3,"checked"],[1,"mt-3","border-t","pt-2"],["type","button","mat-button","",1,"w-full","text-left","text-sm","text-azul-oscuro",3,"click"],[1,"mt-2"],[1,"block","text-sm",3,"change","checked"],["formControlName","nuevaEspecialidad","placeholder","Nombre de la especialidad",1,"w-full","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:border-azul-oscuro","focus:outline-none",3,"click"],[1,"mt-1","text-xs","text-red-600"],["for","fotoFondo",1,"font-semibold","text-azul-oscuro"],["id","fotoFondo","type","file","accept","image/*",1,"register-input",3,"change"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"h2",1),c(2,"Registro"),r(),m(3,tt,16,0,"div",2),m(4,Pt,60,47,"div",3),r()),e&2&&(s(3),p(!a.tipoUsuario&&a.registroForm?3:-1),s(),p(a.tipoUsuario&&a.registroForm?4:-1))},dependencies:[O,I,Re,xe,N,Ee,D,ve,ye,Se,Oe,Ie,Me,Pe,De,Ne,qe,ze,je,ke,Te,fe,he,Ue,Be,q],styles:[".register-input[_ngcontent-%COMP%]{padding:12px 20px;margin:10px 0;border:2px solid #333;border-radius:6px;background-color:#222;color:#fff;font-size:16px;cursor:pointer;transition:all .3s ease}.register-input[_ngcontent-%COMP%]:hover{border-color:#92cc34;background-color:#2c2c2c}.register-input[_ngcontent-%COMP%]:focus{border-color:#19b44d;background-color:#2c2c2c;outline:none}.register-input[_ngcontent-%COMP%]::-webkit-file-upload-button{background-color:#fff;color:#fff;padding:8px 15px;border-radius:4px;border:none;cursor:pointer;font-size:14px;transition:background-color .3s ease}"]})};export{He as Register};
