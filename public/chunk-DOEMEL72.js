import{a as qe,b as Le,c as He,d as Ge,e as $e,f as We}from"./chunk-OEAEX47P.js";import{a as Ee}from"./chunk-BTTD6JAY.js";import"./chunk-GDOWQPYA.js";import{a as Oe,b as Ne,f as ze,i as je,j as Ue,k as De}from"./chunk-3UR3VXRF.js";import{f as Ae,g as Me,n as Be}from"./chunk-M2F6BYP4.js";import{a as L,b as H}from"./chunk-VPTHVLTQ.js";import{k as Ie}from"./chunk-YDT6XDAL.js";import"./chunk-LMZWYZYD.js";import"./chunk-UIGXKFJS.js";import{c as D,e as C,g as q,h as ye,j as Fe,k as Se,l as we,o as Re,p as Ve,w as ke,x as Pe,y as Te}from"./chunk-3XECLLOM.js";import{b as fe}from"./chunk-FGBWPZOQ.js";import{f as xe,g as be}from"./chunk-MYA2PN56.js";import{b as ve,c as Ce}from"./chunk-JYNQ7DY3.js";import"./chunk-FFHKXHWV.js";import{e as j,j as U}from"./chunk-DDKTLT4U.js";import{$b as _e,Ab as A,Eb as E,Gb as _,Ma as se,Na as ce,Oa as a,Rb as pe,Sb as B,Ub as d,Vb as h,Wb as y,Yb as me,Z as T,Za as z,Zb as ue,_b as ge,ca as x,da as b,ea as ne,eb as de,ec as k,fc as he,gc as p,hc as m,nb as u,ob as g,qb as $,rb as W,sa as le,sb as Z,tb as v,ub as l,vb as o,wb as F}from"./chunk-PTIYVII4.js";import{j as P}from"./chunk-K4ALXBGI.js";var Ye=(t,i)=>({"bg-green-500":t,"bg-red-500":i}),ei=(t,i)=>({"translate-x-2.5":t,"translate-x-0":i}),ii=(t,i,e)=>({"text-green-600":t,"text-red-600":i,"text-orange-600":e});function ti(t,i){t&1&&(l(0,"div",1),ne(),l(1,"svg",12),F(2,"circle",13)(3,"path",14),o()())}function ai(t,i){if(t&1&&F(0,"img",6),t&2){let e=_();v("src",e.captchaActual.imagenUrl,se)}}function ri(t,i){if(t&1&&(l(0,"p",11),d(1),o()),t&2){let e=_();v("ngClass",he(2,ii,e.captchaValido,!e.captchaValido,!e.captchaActivo)),a(),y(" ",e.mensajeVerificacion," ")}}var G=class t{captchaResuelto=new de;auth=T(H);captchas=[];captchaActual;userInput="";captchaValido=!1;mensajeVerificacion="";verificando=!1;cargado=!1;captchaActivo=!0;ngOnInit(){return P(this,null,function*(){yield this.cargarCaptchasDesdeSupabase()})}cargarCaptchasDesdeSupabase(){return P(this,null,function*(){try{if(this.captchas=yield this.auth.getCaptchas(),!this.captchas.length){console.error("No se pudieron cargar captchas");return}this.captchaActual=this.obtenerCaptchaAleatorio(),this.cargado=!0}catch(i){console.error("Error al cargar captchas:",i),this.cargado=!1}})}obtenerCaptchaAleatorio(){if(this.captchas.length<2)return this.captchas[0];let i;do{let e=Math.floor(Math.random()*this.captchas.length);i=this.captchas[e]}while(i===this.captchaActual);return i}verificarRespuesta(){return P(this,null,function*(){if(!this.captchaActual)return;if(!this.captchaActivo){this.captchaValido=!0,this.mensajeVerificacion="Captcha desactivado - Verificaci\xF3n omitida",this.captchaResuelto.emit(!0);return}this.mensajeVerificacion="",this.verificando=!0,yield new Promise(e=>setTimeout(e,500));let i=yield this.sha256(this.userInput.trim().toLowerCase());this.captchaValido=i===this.captchaActual.answerHash,this.mensajeVerificacion=this.captchaValido?"Respuesta correcta":"Respuesta incorrecta",this.verificando=!1,this.captchaResuelto.emit(this.captchaValido)})}sha256(i){return P(this,null,function*(){let e=new TextEncoder().encode(i),r=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(r)).map(f=>f.toString(16).padStart(2,"0")).join("")})}cambiarCaptcha(){this.captchaActual=this.obtenerCaptchaAleatorio(),this.userInput="",this.mensajeVerificacion=""}toggleCaptcha(){this.captchaActivo=!this.captchaActivo,this.userInput="",this.mensajeVerificacion="",this.captchaActivo?(this.captchaValido=!1,this.captchaResuelto.emit(!1)):(this.captchaValido=!0,this.captchaResuelto.emit(!0))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=z({type:t,selectors:[["app-mi-captcha"]],outputs:{captchaResuelto:"captchaResuelto"},decls:14,vars:27,consts:[[1,"relative","w-[300px]","items-center","justify-center","align-middle","text-sm"],[1,"absolute","inset-0","z-10","flex","items-center","justify-center","bg-white/120","backdrop-blur-sm"],[1,"relative","rounded-lg","border","border-gray-300","bg-crema","p-4","shadow-sm"],["type","button",1,"absolute","top-1","right-1","z-20","flex","h-3","w-6","items-center","rounded-full","p-0.5","shadow-md","transition-colors","duration-300","hover:shadow-lg","focus:ring-1","focus:ring-offset-1","focus:outline-none",3,"click","ngClass","title"],[1,"h-2","w-2","transform","rounded-full","bg-white","shadow-sm","transition-transform","duration-300",3,"ngClass"],[1,"flex","flex-col","items-center","gap-2","pt-1","transition-all","duration-300"],["alt","captcha",1,"h-24","w-full","rounded","border","bg-white","object-contain",3,"src"],["placeholder","Escrib\xED lo que ves",1,"w-full","rounded","border","border-gray-300","bg-white","px-3","py-1.5","focus:ring-2","focus:ring-azul-oscuro","focus:outline-none","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],[1,"flex","w-full","justify-between","gap-2"],["type","button",1,"flex-1","rounded","bg-verde-claro","px-3","py-1.5","text-lg","text-white","hover:bg-verde-claro/80","disabled:cursor-not-allowed","disabled:opacity-50",3,"click","disabled"],["type","button",1,"flex-1","rounded","bg-azul-claro","px-3","py-1.5","text-lg","text-white","hover:bg-azul-claro/80","disabled:cursor-not-allowed","disabled:opacity-50",3,"click","disabled"],[1,"mt-1",3,"ngClass"],["viewBox","0 0 24 24","fill","none",1,"h-6","w-6","animate-spin","text-blue-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"]],template:function(e,r){e&1&&(l(0,"div",0),u(1,ti,4,0,"div",1),l(2,"div",2)(3,"button",3),E("click",function(){return r.toggleCaptcha()}),F(4,"div",4),o(),l(5,"div",5),u(6,ai,1,1,"img",6),l(7,"input",7),ge("ngModelChange",function(c){return ue(r.userInput,c)||(r.userInput=c),c}),o(),l(8,"div",8)(9,"button",9),E("click",function(){return r.verificarRespuesta()}),d(10," Verificar "),o(),l(11,"button",10),E("click",function(){return r.cambiarCaptcha()}),d(12," Cambiar "),o()(),u(13,ri,2,6,"p",11),o()()()),e&2&&(a(),g(r.verificando||!r.cargado?1:-1),a(2),B("focus:ring-green-500",r.captchaActivo)("focus:ring-red-500",!r.captchaActivo),v("title",_e(r.captchaActivo?"Captcha activado - Click para desactivar":"Captcha desactivado - Click para activar"))("ngClass",k(21,Ye,r.captchaActivo,!r.captchaActivo)),a(),v("ngClass",k(24,ei,r.captchaActivo,!r.captchaActivo)),a(),pe("filter",r.captchaActivo?"none":"blur(1px) brightness(1.1)"),B("opacity-50",r.verificando)("opacity-40",!r.captchaActivo),a(),g(r.captchaActual?6:-1),a(),me("ngModel",r.userInput),v("disabled",r.verificando||!r.captchaActivo),a(2),v("disabled",r.verificando||!r.captchaActivo),a(2),v("disabled",r.verificando||!r.captchaActivo),a(2),g(r.mensajeVerificacion?13:-1))},dependencies:[U,j,Pe,D,q,Fe],encapsulation:2})};var M=(t,i)=>({"mat-form-field-valid":t,"mat-form-field-invalid":i});function oi(t,i){if(t&1){let e=A();l(0,"div",2)(1,"p",4),d(2),p(3,"transloco"),o(),l(4,"div",5)(5,"div",6),E("click",function(){x(e);let n=_();return b(n.seleccionarTipo("paciente"))})("keyup.enter",function(){x(e);let n=_();return b(n.seleccionarTipo("paciente"))})("keyup.space",function(){x(e);let n=_();return b(n.seleccionarTipo("paciente"))}),l(6,"div",7),F(7,"img",8),l(8,"div",9)(9,"h3",10),d(10),p(11,"transloco"),o()()()(),l(12,"div",11),E("click",function(){x(e);let n=_();return b(n.seleccionarTipo("especialista"))})("keyup.enter",function(){x(e);let n=_();return b(n.seleccionarTipo("especialista"))})("keyup.space",function(){x(e);let n=_();return b(n.seleccionarTipo("especialista"))}),l(13,"div",7),F(14,"img",12),l(15,"div",9)(16,"h3",10),d(17),p(18,"transloco"),o()()()()()()}t&2&&(a(2),y(" ",m(3,3,"registerPage.tipoUsuario")," "),a(8),y(" ",m(11,5,"registerPage.paciente")," "),a(7),y(" ",m(18,7,"registerPage.especialista")," "))}function ni(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.campoObligatorio")))}function li(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.minimo2Caracteres")))}function si(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.soloLetras")))}function ci(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.campoObligatorio")))}function di(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.minimo2Caracteres")))}function pi(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.soloLetras")))}function mi(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.campoObligatorio")))}function ui(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.minimo18")))}function gi(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.maximo99")))}function _i(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.campoObligatorio")))}function hi(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.dni8Digitos")))}function fi(t,i){if(t&1&&(l(0,"mat-option",33),d(1),o()),t&2){let e=i.$implicit;v("value",e),a(),h(e)}}function vi(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.campoObligatorio")))}function Ci(t,i){if(t&1&&(l(0,"mat-form-field",14)(1,"mat-label"),d(2),p(3,"transloco"),o(),l(4,"mat-select",32),W(5,fi,2,2,"mat-option",33,$),o(),u(7,vi,3,3,"mat-error"),o()),t&2){let e,r,n=_(2);v("ngClass",k(5,M,((e=n.registroForm.get("obraSocial"))==null?null:e.valid)&&(((e=n.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=n.registroForm.get("obraSocial"))==null?null:e.touched)),((e=n.registroForm.get("obraSocial"))==null?null:e.invalid)&&(((e=n.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=n.registroForm.get("obraSocial"))==null?null:e.touched)))),a(2),h(m(3,3,"registerPage.campos.obraSocial")),a(3),Z(n.obraSocialOptions),a(2),g((r=n.registroForm.get("obraSocial"))!=null&&r.hasError("required")?7:-1)}}function xi(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.campoObligatorio")))}function bi(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.emailInvalido")))}function Ei(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.campoObligatorio")))}function yi(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),h(m(2,1,"registerPage.errores.minimo7Caracteres")))}function Fi(t,i){if(t&1){let e=A();l(0,"mat-checkbox",47),E("change",function(){let n=x(e).$implicit,c=_(4);return b(c.toggleEspecialidad(n.id))}),d(1),o()}if(t&2){let e=i.$implicit,r=_(4);v("checked",r.esEspecialidadSeleccionada(e.id)),a(),y(" ",e.nombre," ")}}function Si(t,i){t&1&&(l(0,"div",49),d(1,"M\xEDnimo 4 caracteres"),o())}function wi(t,i){t&1&&(l(0,"div",49),d(1," Solo letras y espacios permitidos "),o())}function Ri(t,i){if(t&1){let e=A();l(0,"div",46)(1,"input",48),E("click",function(n){return x(e),b(n.stopPropagation())})("keyup.enter",function(n){return x(e),_(4).agregarNuevaEspecialidad(),b(n.stopPropagation())}),o(),u(2,Si,2,0,"div",49),u(3,wi,2,0,"div",49),l(4,"button",50),E("click",function(n){return x(e),_(4).agregarNuevaEspecialidad(),b(n.stopPropagation())}),d(5," \u2713 Confirmar y agregar "),o()()}if(t&2){let e,r,n,c=_(4);a(2),g((e=c.registroForm.get("nuevaEspecialidad"))!=null&&e.hasError("minlength")&&((e=c.registroForm.get("nuevaEspecialidad"))!=null&&e.touched)?2:-1),a(),g((r=c.registroForm.get("nuevaEspecialidad"))!=null&&r.hasError("pattern")&&((r=c.registroForm.get("nuevaEspecialidad"))!=null&&r.touched)?3:-1),a(),v("disabled",((n=c.registroForm.get("nuevaEspecialidad"))==null?null:n.invalid)||!(!((n=c.registroForm.get("nuevaEspecialidad"))==null||n.value==null)&&n.value.trim()))}}function Vi(t,i){if(t&1){let e=A();l(0,"div",41)(1,"div",42),W(2,Fi,2,2,"mat-checkbox",43,$),o(),l(4,"div",44)(5,"button",45),E("click",function(n){return x(e),_(3).toggleMostrarNuevaEspecialidad(),b(n.stopPropagation())}),d(6),o(),u(7,Ri,6,3,"div",46),o()()}if(t&2){let e=_(3);B("max-h-60",!e.mostrarCampoOtraEspecialidad)("max-h-96",e.mostrarCampoOtraEspecialidad),a(2),Z(e.especialidadOptions),a(4),y(" ",e.mostrarCampoOtraEspecialidad?"\u2715 Cancelar":"+ Agregar nueva especialidad"," "),a(),g(e.mostrarCampoOtraEspecialidad?7:-1)}}function ki(t,i){t&1&&(l(0,"div",40),d(1),p(2,"transloco"),o()),t&2&&(a(),y(" ",m(2,1,"registerPage.errores.alMenosUnaEspecialidad")," "))}function Pi(t,i){if(t&1){let e=A();l(0,"div",21)(1,"div",34),d(2),p(3,"transloco"),o(),l(4,"div",35)(5,"div",36),E("click",function(n){x(e);let c=_(2);return b(c.toggleDesplegableEspecialidades(n))})("keyup.enter",function(n){x(e);let c=_(2);return b(c.toggleDesplegableEspecialidades(n))})("keyup.space",function(n){x(e);let c=_(2);return b(c.toggleDesplegableEspecialidades(n))}),l(6,"span",37),d(7),o(),l(8,"mat-icon",38),d(9),o()(),u(10,Vi,8,6,"div",39),o(),u(11,ki,3,3,"div",40),o()}if(t&2){let e,r=_(2);a(2),y(" ",m(3,7,"registerPage.campos.especialidades")," "),a(3),B("border-azul-oscuro",r.desplegableEspecialidadesAbierto),a(2),y(" ",r.obtenerEspecialidadesSeleccionadasTexto()," "),a(2),h(r.desplegableEspecialidadesAbierto?"expand_less":"expand_more"),a(),g(r.desplegableEspecialidadesAbierto?10:-1),a(),g((e=r.registroForm.get("especialidadesSeleccionadas"))!=null&&e.hasError("alMenosUna")&&((e=r.registroForm.get("especialidadesSeleccionadas"))!=null&&e.touched)?11:-1)}}function Ti(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),y(" ",m(2,1,"registerPage.errores.seleccionarImagenPerfil")," "))}function Ii(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),y(" ",m(2,1,"registerPage.errores.soloJpgPng")," "))}function Ai(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),y(" ",m(2,1,"registerPage.errores.seleccionarImagenFondo")," "))}function Mi(t,i){t&1&&(l(0,"mat-error"),d(1),p(2,"transloco"),o()),t&2&&(a(),y(" ",m(2,1,"registerPage.errores.soloJpgPng")," "))}function Bi(t,i){if(t&1){let e=A();l(0,"div",22)(1,"label",51),d(2),p(3,"transloco"),o(),l(4,"input",52),E("change",function(n){x(e);let c=_(2);return b(c.onFileSelected(n,"fondo"))}),o(),u(5,Ai,3,3,"mat-error"),u(6,Mi,3,3,"mat-error"),o()}if(t&2){let e,r,n=_(2);a(2),h(m(3,3,"registerPage.campos.fotoFondo")),a(3),g((e=n.registroForm.get("imagenFondo"))!=null&&e.hasError("required")?5:-1),a(),g((r=n.registroForm.get("imagen"))!=null&&r.hasError("invalidType")?6:-1)}}function Oi(t,i){t&1&&(l(0,"div",30),d(1),p(2,"transloco"),o()),t&2&&(a(),y(" ",m(2,1,"registerPage.errores.resolverCaptcha")," "))}function Ni(t,i){if(t&1){let e=A();l(0,"div",3)(1,"form",13),E("ngSubmit",function(){x(e);let n=_();return b(n.registrar())}),l(2,"mat-form-field",14)(3,"mat-label"),d(4),p(5,"transloco"),o(),F(6,"input",15),u(7,ni,3,3,"mat-error"),u(8,li,3,3,"mat-error"),u(9,si,3,3,"mat-error"),o(),l(10,"mat-form-field",14)(11,"mat-label"),d(12),p(13,"transloco"),o(),F(14,"input",16),u(15,ci,3,3,"mat-error"),u(16,di,3,3,"mat-error"),u(17,pi,3,3,"mat-error"),o(),l(18,"mat-form-field",14)(19,"mat-label"),d(20),p(21,"transloco"),o(),F(22,"input",17),u(23,mi,3,3,"mat-error"),u(24,ui,3,3,"mat-error"),u(25,gi,3,3,"mat-error"),o(),l(26,"mat-form-field",14)(27,"mat-label"),d(28),p(29,"transloco"),o(),F(30,"input",18),u(31,_i,3,3,"mat-error"),u(32,hi,3,3,"mat-error"),o(),u(33,Ci,8,8,"mat-form-field",14),l(34,"mat-form-field",14)(35,"mat-label"),d(36),p(37,"transloco"),o(),F(38,"input",19),u(39,xi,3,3,"mat-error"),u(40,bi,3,3,"mat-error"),o(),l(41,"mat-form-field",14)(42,"mat-label"),d(43),p(44,"transloco"),o(),F(45,"input",20),u(46,Ei,3,3,"mat-error"),u(47,yi,3,3,"mat-error"),o(),u(48,Pi,12,9,"div",21),l(49,"div",22)(50,"label",23),d(51),p(52,"transloco"),o(),l(53,"input",24),E("change",function(n){x(e);let c=_();return b(c.onFileSelected(n,"perfil"))}),o(),u(54,Ti,3,3,"mat-error"),u(55,Ii,3,3,"mat-error"),o(),u(56,Bi,7,5,"div",22),l(57,"div",25)(58,"button",26)(59,"span"),d(60),p(61,"transloco"),o()()(),l(62,"div",27)(63,"button",28),E("click",function(){x(e);let n=_();return b(n.tipoUsuario=null)}),d(64),p(65,"transloco"),o()(),l(66,"div",29),u(67,Oi,3,3,"div",30),l(68,"app-mi-captcha",31),E("captchaResuelto",function(n){x(e);let c=_();return b(c.onCaptchaResuelto(n))}),o()()()()}if(t&2){let e,r,n,c,f,I,O,N,S,J,K,Q,w,X,Y,R,ee,ie,V,te,ae,re,oe,s=_();a(),v("formGroup",s.registroForm),a(),v("ngClass",k(56,M,((e=s.registroForm.get("nombre"))==null?null:e.valid)&&(((e=s.registroForm.get("nombre"))==null?null:e.dirty)||((e=s.registroForm.get("nombre"))==null?null:e.touched)),((e=s.registroForm.get("nombre"))==null?null:e.invalid)&&(((e=s.registroForm.get("nombre"))==null?null:e.dirty)||((e=s.registroForm.get("nombre"))==null?null:e.touched)))),a(2),h(m(5,38,"registerPage.campos.nombre")),a(3),g((r=s.registroForm.get("nombre"))!=null&&r.hasError("required")?7:-1),a(),g((n=s.registroForm.get("nombre"))!=null&&n.hasError("minlength")?8:-1),a(),g((c=s.registroForm.get("nombre"))!=null&&c.hasError("pattern")?9:-1),a(),v("ngClass",k(59,M,((f=s.registroForm.get("apellido"))==null?null:f.valid)&&(((f=s.registroForm.get("apellido"))==null?null:f.dirty)||((f=s.registroForm.get("apellido"))==null?null:f.touched)),((f=s.registroForm.get("apellido"))==null?null:f.invalid)&&(((f=s.registroForm.get("apellido"))==null?null:f.dirty)||((f=s.registroForm.get("apellido"))==null?null:f.touched)))),a(2),h(m(13,40,"registerPage.campos.apellido")),a(3),g((I=s.registroForm.get("apellido"))!=null&&I.hasError("required")?15:-1),a(),g((O=s.registroForm.get("apellido"))!=null&&O.hasError("minlength")?16:-1),a(),g((N=s.registroForm.get("apellido"))!=null&&N.hasError("pattern")?17:-1),a(),v("ngClass",k(62,M,((S=s.registroForm.get("edad"))==null?null:S.valid)&&(((S=s.registroForm.get("edad"))==null?null:S.dirty)||((S=s.registroForm.get("edad"))==null?null:S.touched)),((S=s.registroForm.get("edad"))==null?null:S.invalid)&&(((S=s.registroForm.get("edad"))==null?null:S.dirty)||((S=s.registroForm.get("edad"))==null?null:S.touched)))),a(2),h(m(21,42,"registerPage.campos.edad")),a(3),g((J=s.registroForm.get("edad"))!=null&&J.hasError("required")?23:-1),a(),g((K=s.registroForm.get("edad"))!=null&&K.hasError("min")?24:-1),a(),g((Q=s.registroForm.get("edad"))!=null&&Q.hasError("max")?25:-1),a(),v("ngClass",k(65,M,((w=s.registroForm.get("dni"))==null?null:w.valid)&&(((w=s.registroForm.get("dni"))==null?null:w.dirty)||((w=s.registroForm.get("dni"))==null?null:w.touched)),((w=s.registroForm.get("dni"))==null?null:w.invalid)&&(((w=s.registroForm.get("dni"))==null?null:w.dirty)||((w=s.registroForm.get("dni"))==null?null:w.touched)))),a(2),h(m(29,44,"registerPage.campos.dni")),a(3),g((X=s.registroForm.get("dni"))!=null&&X.hasError("required")?31:-1),a(),g((Y=s.registroForm.get("dni"))!=null&&Y.hasError("pattern")?32:-1),a(),g(s.tipoUsuario==="paciente"?33:-1),a(),v("ngClass",k(68,M,((R=s.registroForm.get("mail"))==null?null:R.valid)&&(((R=s.registroForm.get("mail"))==null?null:R.dirty)||((R=s.registroForm.get("mail"))==null?null:R.touched)),((R=s.registroForm.get("mail"))==null?null:R.invalid)&&(((R=s.registroForm.get("mail"))==null?null:R.dirty)||((R=s.registroForm.get("mail"))==null?null:R.touched)))),a(2),h(m(37,46,"registerPage.campos.email")),a(3),g((ee=s.registroForm.get("mail"))!=null&&ee.hasError("required")?39:-1),a(),g((ie=s.registroForm.get("mail"))!=null&&ie.hasError("email")?40:-1),a(),v("ngClass",k(71,M,((V=s.registroForm.get("password"))==null?null:V.valid)&&(((V=s.registroForm.get("password"))==null?null:V.dirty)||((V=s.registroForm.get("password"))==null?null:V.touched)),((V=s.registroForm.get("password"))==null?null:V.invalid)&&(((V=s.registroForm.get("password"))==null?null:V.dirty)||((V=s.registroForm.get("password"))==null?null:V.touched)))),a(2),h(m(44,48,"registerPage.campos.contrasena")),a(3),g((te=s.registroForm.get("password"))!=null&&te.hasError("required")?46:-1),a(),g((ae=s.registroForm.get("password"))!=null&&ae.hasError("minlength")?47:-1),a(),g(s.tipoUsuario==="especialista"?48:-1),a(3),h(m(52,50,"registerPage.campos.fotoPerfil")),a(3),g((re=s.registroForm.get("imagenPerfil"))!=null&&re.hasError("required")?54:-1),a(),g((oe=s.registroForm.get("imagen"))!=null&&oe.hasError("invalidType")?55:-1),a(),g(s.tipoUsuario==="paciente"?56:-1),a(2),v("disabled",s.registroForm.invalid),a(2),h(m(61,52,"registerPage.registrarse")),a(4),y(" ",m(65,54,"registerPage.cambiarTipoUsuario")," "),a(3),g(s.registroForm.errors!=null&&s.registroForm.errors.captchaInvalido&&s.registroForm.touched?67:-1)}}var Ze=class t{registroForm;tipoUsuario=null;obraSocialOptions=We;especialidadOptions=[];especialidadesSeleccionadas=new Set;captchaEsValido=!1;mostrarCampoOtraEspecialidad=!1;desplegableEspecialidadesAbierto=!1;captchaValidoValidator=()=>()=>this.captchaEsValido?null:{captchaInvalido:!0};subEspecialidad;subReset;fb=T(ke);auth=T(H);snackBar=T(Be);router=T(fe);loading=T(Ie);elementRef=T(le);registerState=T(Ee);ngOnInit(){this.registroForm=this.fb.group({nombre:["",[C.required,C.minLength(2),C.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],apellido:["",[C.required,C.minLength(2),C.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],edad:[null,[C.required,C.min(18),C.max(99)]],dni:["",[C.required,C.pattern(/^\d{8}$/)]],obraSocial:[""],mail:["",[C.required,C.email]],password:["",[C.required,C.minLength(7)]],especialidadesSeleccionadas:[[]],nuevaEspecialidad:["",[C.minLength(4),C.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],imagenPerfil:[null,C.required],imagenFondo:[""]},{validators:this.captchaValidoValidator()}),this.subReset=this.registerState.reset$.subscribe(()=>{this.resetearFormulario()})}ngOnDestroy(){this.subEspecialidad&&this.subEspecialidad.unsubscribe(),this.subReset&&this.subReset.unsubscribe()}seleccionarTipo(i){return P(this,null,function*(){if(this.tipoUsuario=i,!!this.registroForm){if(i==="especialista")try{this.loading.show(),this.especialidadOptions=yield this.auth.obtenerEspecialidades(),this.especialidadesSeleccionadas.clear()}catch(e){console.error("Error al obtener especialidades:",e),this.snackBar.open("Error al cargar especialidades. Intente nuevamente.","Cerrar",{duration:3e3})}finally{this.loading.hide()}i==="paciente"?(this.registroForm.get("obraSocial")?.setValidators([C.required]),this.registroForm.get("imagenFondo")?.setValidators([C.required]),this.registroForm.get("especialidadesSeleccionadas")?.clearValidators(),this.registroForm.get("nuevaEspecialidad")?.clearValidators()):(this.registroForm.get("obraSocial")?.clearValidators(),this.registroForm.get("imagenFondo")?.clearValidators(),this.registroForm.get("especialidadesSeleccionadas")?.setValidators([this.alMenosUnaEspecialidadValidator()])),this.registroForm.get("obraSocial")?.updateValueAndValidity(),this.registroForm.get("imagenFondo")?.updateValueAndValidity(),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity()}})}alMenosUnaEspecialidadValidator(){return i=>{let e=i.value||[],r=this.registroForm?.get("nuevaEspecialidad")?.value;return e.length===0&&!r?{alMenosUna:!0}:null}}toggleEspecialidad(i){this.especialidadesSeleccionadas.has(i)?this.especialidadesSeleccionadas.delete(i):this.especialidadesSeleccionadas.add(i),this.actualizarEspecialidadesEnForm()}toggleMostrarNuevaEspecialidad(){this.mostrarCampoOtraEspecialidad=!this.mostrarCampoOtraEspecialidad,this.mostrarCampoOtraEspecialidad||this.registroForm.get("nuevaEspecialidad")?.setValue("")}normalizarNombre(i){return i=i.trim(),i&&i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()}agregarNuevaEspecialidad(){let i=this.registroForm.get("nuevaEspecialidad"),e=i?.value?.trim();if(!e||i?.invalid){this.snackBar.open("Por favor, ingrese un nombre v\xE1lido para la especialidad.","Cerrar",{duration:3e3});return}let r=this.normalizarNombre(e);if(this.especialidadOptions.some(I=>I.nombre.toLowerCase()===r.toLowerCase())){this.snackBar.open("Esta especialidad ya existe. Por favor, selecci\xF3nela de la lista.","Cerrar",{duration:3e3});return}let c=-(this.especialidadOptions.length+1),f={id:c,nombre:r};this.especialidadOptions.push(f),this.especialidadesSeleccionadas.add(c),this.actualizarEspecialidadesEnForm(),i&&i.setValue(""),this.mostrarCampoOtraEspecialidad=!1,this.snackBar.open(`Especialidad "${r}" agregada y seleccionada.`,"Cerrar",{duration:3e3,panelClass:["bg-green-600","text-white"]})}toggleDesplegableEspecialidades(i){i&&i.stopPropagation(),this.desplegableEspecialidadesAbierto=!this.desplegableEspecialidadesAbierto}onClickOutside(i){if(!this.desplegableEspecialidadesAbierto)return;let e=i.target;this.elementRef.nativeElement.querySelector(".relative")?.contains(e)||(this.desplegableEspecialidadesAbierto=!1)}obtenerEspecialidadesSeleccionadasTexto(){return this.especialidadesSeleccionadas.size===0?"Ninguna seleccionada":Array.from(this.especialidadesSeleccionadas).map(e=>this.especialidadOptions.find(r=>r.id===e)?.nombre).filter(e=>e).join(", ")}esEspecialidadSeleccionada(i){return this.especialidadesSeleccionadas.has(i)}actualizarEspecialidadesEnForm(){let i=Array.from(this.especialidadesSeleccionadas);this.registroForm.get("especialidadesSeleccionadas")?.setValue(i),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity()}onFileSelected(i,e){let r=e==="perfil"?"imagenPerfil":"imagenFondo",n=i.target,c=this.registroForm.get(r);if(!n.files?.length){c.setValue(null),c.setErrors({required:!0});return}let f=n.files[0];if(!["image/jpeg","image/png","image/jpg"].includes(f.type)){c.setErrors({invalidType:!0});return}c.setValue(f),c.setErrors(null)}registrar(){return P(this,null,function*(){if(!(this.registroForm.invalid||!this.tipoUsuario)){this.loading.show();try{this.tipoUsuario==="paciente"?yield this.handleRegistroPaciente():yield this.handleRegistroEspecialista()}finally{this.loading.hide()}}})}handleRegistroPaciente(){return P(this,null,function*(){try{let i=this.registroForm.value,e=yield L(i.imagenPerfil),r=yield L(i.imagenFondo),n={nombre:i.nombre,apellido:i.apellido,edad:i.edad,dni:i.dni,obraSocial:i.obraSocial,mail:i.mail,contrasena:i.password,imagenPerfil:e,imagenFondo:r},c=yield this.auth.registerPaciente(n);c.errorCode?.toLowerCase()?.includes("error desconocido")?this.mostrarResultado(c.success,c.message):this.mostrarResultado(c.success,c.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar las im\xE1genes.")}})}handleRegistroEspecialista(){return P(this,null,function*(){try{let i=this.registroForm.value,e=yield L(i.imagenPerfil),r=[];i.especialidadesSeleccionadas&&i.especialidadesSeleccionadas.length>0&&i.especialidadesSeleccionadas.forEach(I=>{if(I>0)r.push(String(I));else{let O=this.especialidadOptions.find(N=>N.id===I);O&&r.push(O.nombre)}});let n={nombre:i.nombre,apellido:i.apellido,edad:i.edad,dni:i.dni,mail:i.mail,contrasena:i.password,especialidades:r,imagenPerfil:e},c=yield this.auth.registerEspecialista(n);c.errorCode?.toLowerCase()?.includes("error desconocido")?this.mostrarResultado(c.success,c.message):this.mostrarResultado(c.success,c.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar la imagen.")}})}mostrarResultado(i,e){if(!i){this.snackBar.open(e||"Ocurri\xF3 un error.","Cerrar",{duration:4e3,panelClass:["bg-red-600","text-white"]});return}this.tipoUsuario=null,this.router.navigate(["/welcome-page/confirmacion"])}onCaptchaResuelto(i){this.captchaEsValido=i,this.registroForm.updateValueAndValidity()}resetearFormulario(){this.tipoUsuario=null,this.especialidadesSeleccionadas.clear(),this.captchaEsValido=!1,this.mostrarCampoOtraEspecialidad=!1,this.desplegableEspecialidadesAbierto=!1,this.registroForm.reset(),this.especialidadOptions=this.especialidadOptions.filter(i=>i.id>0),window.scrollTo({top:0,behavior:"smooth"})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=z({type:t,selectors:[["app-register"]],hostBindings:function(e,r){e&1&&E("click",function(c){return r.onClickOutside(c)},ce)},decls:6,vars:5,consts:[[1,"min-h-screen","bg-gray-200","pt-30","pb-60"],[1,"pb-1","text-center","text-4xl","font-bold","text-azul-oscuro"],[1,"pt-16","pb-30","text-center"],[1,"flex","justify-center","py-8"],[1,"mb-6","text-xl","text-gray-700"],[1,"flex","flex-col","items-center","gap-6"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Paciente",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],[1,"rounded-2xl","bg-white","shadow-lg"],["src","assets/imagenes/Registro/pacientes.webp","alt","Paciente",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"p-4"],[1,"text-xl","font-bold","text-azul-oscuro"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Especialista",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],["src","assets/imagenes/Registro/especialistas.webp","alt","Especialista",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"grid","w-full","max-w-2xl","grid-cols-1","gap-4","rounded-xl","bg-crema","p-8","shadow-lg","md:grid-cols-2",3,"ngSubmit","formGroup"],["appearance","fill",1,"col-span-1",3,"ngClass"],["matInput","","formControlName","nombre"],["matInput","","formControlName","apellido"],["matInput","","type","number","formControlName","edad"],["matInput","","formControlName","dni"],["matInput","","type","email","formControlName","mail"],["matInput","","type","password","formControlName","password"],[1,"col-span-2"],[1,"col-span-2","flex","flex-col","gap-2"],["for","fotoPerfil",1,"font-semibold","text-azul-oscuro"],["id","fotoPerfil","type","file","accept","image/*",1,"register-input",3,"change"],[1,"col-span-2","flex","justify-center"],["mat-raised-button","","color","primary","type","submit",1,"flex","items-center","justify-center","gap-2","rounded-full","bg-verde-oscuro","px-8","py-2","text-white","shadow-lg",3,"disabled"],[1,"col-span-2","mt-1","flex","justify-center"],["mat-button","","type","button",1,"text-sm","text-gray-600","underline",3,"click"],[1,"col-span-2","mt-1","flex","flex-col","items-center"],[1,"mb-2","text-center","text-sm","text-red-600"],[3,"captchaResuelto"],["formControlName","obraSocial"],[3,"value"],[1,"mb-1","text-sm","font-medium","text-azul-oscuro"],[1,"relative"],["tabindex","0",1,"flex","min-h-[56px]","cursor-pointer","items-center","rounded-md","border","border-gray-300","bg-white","px-4","py-3","transition-colors","hover:border-azul-oscuro",3,"click","keyup.enter","keyup.space"],[1,"flex-1","text-sm","text-gray-700"],[1,"text-gray-500"],[1,"absolute","top-full","right-0","left-0","z-10","mt-1","overflow-y-auto","rounded-lg","border","border-gray-300","bg-white","p-3","shadow-lg","transition-all","duration-300",3,"max-h-60","max-h-96"],[1,"mt-1","text-sm","text-red-600"],[1,"absolute","top-full","right-0","left-0","z-10","mt-1","overflow-y-auto","rounded-lg","border","border-gray-300","bg-white","p-3","shadow-lg","transition-all","duration-300"],[1,"space-y-2"],[1,"block","text-sm",3,"checked"],[1,"mt-3","border-t","pt-2"],["type","button","mat-button","",1,"w-full","text-left","text-sm","text-azul-oscuro",3,"click"],[1,"mt-2","space-y-2"],[1,"block","text-sm",3,"change","checked"],["formControlName","nuevaEspecialidad","placeholder","Nombre de la especialidad",1,"w-full","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:border-azul-oscuro","focus:outline-none",3,"click","keyup.enter"],[1,"text-xs","text-red-600"],["type","button","mat-raised-button","","color","primary",1,"w-full","text-sm",3,"click","disabled"],["for","fotoFondo",1,"font-semibold","text-azul-oscuro"],["id","fotoFondo","type","file","accept","image/*",1,"register-input",3,"change"]],template:function(e,r){e&1&&(l(0,"div",0)(1,"h2",1),d(2),p(3,"transloco"),o(),u(4,oi,19,9,"div",2),u(5,Ni,69,74,"div",3),o()),e&2&&(a(2),y(" ",m(3,3,"registerPage.titulo")," "),a(2),g(!r.tipoUsuario&&r.registroForm?4:-1),a(),g(r.tipoUsuario&&r.registroForm?5:-1))},dependencies:[U,j,Te,Se,D,we,q,ye,Re,Ve,je,ze,Oe,Ne,De,Ue,He,Le,qe,Me,Ae,be,xe,$e,Ge,G,Ce,ve],styles:[".register-input[_ngcontent-%COMP%]{padding:12px 20px;margin:10px 0;border:2px solid #333;border-radius:6px;background-color:#222;color:#fff;font-size:16px;cursor:pointer;transition:all .3s ease}.register-input[_ngcontent-%COMP%]:hover{border-color:#92cc34;background-color:#2c2c2c}.register-input[_ngcontent-%COMP%]:focus{border-color:#19b44d;background-color:#2c2c2c;outline:none}.register-input[_ngcontent-%COMP%]::-webkit-file-upload-button{background-color:#fff;color:#fff;padding:8px 15px;border-radius:4px;border:none;cursor:pointer;font-size:14px;transition:background-color .3s ease}"]})};export{Ze as Register};
