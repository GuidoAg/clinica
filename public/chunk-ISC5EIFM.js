import{a as Me,b as Ae,c as Oe,d as Pe,e as Ne,f as De}from"./chunk-6KN4ELJ7.js";import"./chunk-5DPQWRQM.js";import{a as we,b as Re,f as Ve,i as Ie,j as Te,k as ke}from"./chunk-HAQFI63Z.js";import{f as Fe,g as Se,n as Ce}from"./chunk-YZVU7P4D.js";import{a as ye}from"./chunk-XAJTSRQW.js";import{a as j,b as z}from"./chunk-4DVJJQNQ.js";import"./chunk-BSLYAFLW.js";import"./chunk-X5YLR3NI.js";import"./chunk-SGAKRYQ3.js";import{b as de}from"./chunk-QQD6G2CA.js";import{e as me,f as pe}from"./chunk-A42ZMED3.js";import"./chunk-VLNB4REZ.js";import{c as N,e as g,g as D,h as ue,j as ge,k as _e,l as fe,n as he,o as ve,v as xe,w as be,x as Ee}from"./chunk-E2BOE3LX.js";import{e as A,f as ce,g as O,l as P}from"./chunk-MTWZV5NU.js";import{Cb as v,Eb as p,Ka as re,La as ae,Ma as s,Qb as M,Sb as d,Tb as U,Ub as I,Wb as ne,Xa as k,Xb as le,Y as w,Yb as se,ab as u,ba as f,bc as C,ca as h,cb as oe,da as te,pb as c,qb as o,ra as ie,rb as a,sb as F,yb as R}from"./chunk-EMRS3JRH.js";import{i as S}from"./chunk-ODN5LVDJ.js";var Le=(i,t)=>({"text-green-600":i,"text-red-600":t});function He(i,t){i&1&&(o(0,"div",10),te(),o(1,"svg",11),F(2,"circle",12)(3,"path",13),a()())}function Ge(i,t){if(i&1&&(o(0,"p",14),d(1),a()),i&2){let e=p();c("ngClass",C(2,Le,e.captchaValido,!e.captchaValido)),s(),I(" ",e.mensajeVerificacion," ")}}var q=class i{captchaResuelto=new oe;auth=w(z);captchas=[];captchaActual;userInput="";captchaValido=!1;mensajeVerificacion="";verificando=!1;cargado=!1;ngOnInit(){return S(this,null,function*(){yield this.cargarCaptchasDesdeSupabase()})}cargarCaptchasDesdeSupabase(){return S(this,null,function*(){if(this.captchas=yield this.auth.getCaptchas(),!this.captchas.length){console.error("No se pudieron cargar captchas");return}this.captchaActual=this.obtenerCaptchaAleatorio(),this.cargado=!0})}obtenerCaptchaAleatorio(){if(this.captchas.length<2)return this.captchas[0];let t;do{let e=Math.floor(Math.random()*this.captchas.length);t=this.captchas[e]}while(t===this.captchaActual);return t}verificarRespuesta(){return S(this,null,function*(){this.mensajeVerificacion="",this.verificando=!0,yield new Promise(e=>setTimeout(e,500));let t=yield this.sha256(this.userInput.trim().toLowerCase());this.captchaValido=t===this.captchaActual.answerHash,this.mensajeVerificacion=this.captchaValido?"\u2705 Respuesta correcta":"\u274C Respuesta incorrecta",this.verificando=!1,this.captchaResuelto.emit(this.captchaValido)})}sha256(t){return S(this,null,function*(){let e=new TextEncoder().encode(t),r=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(r)).map(_=>_.toString(16).padStart(2,"0")).join("")})}cambiarCaptcha(){this.captchaActual=this.obtenerCaptchaAleatorio(),this.userInput="",this.mensajeVerificacion=""}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-mi-captcha"]],outputs:{captchaResuelto:"captchaResuelto"},decls:12,vars:9,consts:[[1,"relative","w-[300px]","items-center","justify-center","align-middle","text-sm"],["class","absolute inset-0 z-10 flex items-center justify-center bg-white/120 backdrop-blur-sm",4,"ngIf"],[1,"rounded-lg","border","border-gray-300","bg-crema","p-4","shadow-sm"],[1,"flex","flex-col","items-center","gap-2"],["alt","captcha",1,"h-24","w-full","rounded","border","bg-white","object-contain",3,"src"],["placeholder","Escrib\xED lo que ves",1,"w-full","rounded","border","border-gray-300","bg-white","px-3","py-1.5","focus:ring-2","focus:ring-azul-oscuro","focus:outline-none",3,"ngModelChange","ngModel","disabled"],[1,"flex","w-full","justify-between","gap-2"],[1,"flex-1","rounded","bg-verde-claro","px-3","py-1.5","text-lg","text-white","hover:bg-verde-claro/80","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","rounded","bg-azul-claro","px-3","py-1.5","text-lg","text-white","hover:bg-azul-claro/80","disabled:opacity-50",3,"click","disabled"],["class","mt-1",3,"ngClass",4,"ngIf"],[1,"absolute","inset-0","z-10","flex","items-center","justify-center","bg-white/120","backdrop-blur-sm"],["viewBox","0 0 24 24","fill","none",1,"h-6","w-6","animate-spin","text-blue-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"mt-1",3,"ngClass"]],template:function(e,r){e&1&&(o(0,"div",0),u(1,He,4,0,"div",1),o(2,"div",2)(3,"div",3),F(4,"img",4),o(5,"input",5),se("ngModelChange",function(m){return le(r.userInput,m)||(r.userInput=m),m}),a(),o(6,"div",6)(7,"button",7),v("click",function(){return r.verificarRespuesta()}),d(8," Verificar "),a(),o(9,"button",8),v("click",function(){return r.cambiarCaptcha()}),d(10," Cambiar "),a()(),u(11,Ge,2,5,"p",9),a()()()),e&2&&(s(),c("ngIf",r.verificando||!r.cargado),s(2),M("opacity-50",r.verificando),s(),c("src",r.captchaActual.imagenUrl,re),s(),ne("ngModel",r.userInput),c("disabled",r.verificando),s(2),c("disabled",r.verificando),s(2),c("disabled",r.verificando),s(2),c("ngIf",r.mensajeVerificacion))},dependencies:[P,A,O,be,N,D,ge],encapsulation:2})};var V=(i,t)=>({"mat-form-field-valid":i,"mat-form-field-invalid":t});function $e(i,t){if(i&1){let e=R();o(0,"div",4)(1,"p",5),d(2,"\xBFQu\xE9 tipo de usuario sos?"),a(),o(3,"div",6)(4,"div",7),v("click",function(){f(e);let n=p();return h(n.seleccionarTipo("paciente"))})("keyup.enter",function(){f(e);let n=p();return h(n.seleccionarTipo("paciente"))})("keyup.space",function(){f(e);let n=p();return h(n.seleccionarTipo("paciente"))}),o(5,"div",8),F(6,"img",9),o(7,"div",10)(8,"h3",11),d(9,"Paciente"),a()()()(),o(10,"div",12),v("click",function(){f(e);let n=p();return h(n.seleccionarTipo("especialista"))})("keyup.enter",function(){f(e);let n=p();return h(n.seleccionarTipo("especialista"))})("keyup.space",function(){f(e);let n=p();return h(n.seleccionarTipo("especialista"))}),o(11,"div",8),F(12,"img",13),o(13,"div",10)(14,"h3",11),d(15,"Especialista"),a()()()()()()}}function We(i,t){i&1&&(o(0,"mat-error"),d(1,"Campo obligatorio"),a())}function Ze(i,t){i&1&&(o(0,"mat-error"),d(1,"M\xEDnimo 2 caracteres"),a())}function Qe(i,t){i&1&&(o(0,"mat-error"),d(1,"Solo letras"),a())}function Je(i,t){i&1&&(o(0,"mat-error"),d(1,"Campo obligatorio"),a())}function Ke(i,t){i&1&&(o(0,"mat-error"),d(1,"M\xEDnimo 2 caracteres"),a())}function Xe(i,t){i&1&&(o(0,"mat-error"),d(1,"Solo letras"),a())}function Ye(i,t){i&1&&(o(0,"mat-error"),d(1,"Campo obligatorio"),a())}function et(i,t){i&1&&(o(0,"mat-error"),d(1,"M\xEDnimo 18"),a())}function tt(i,t){i&1&&(o(0,"mat-error"),d(1,"M\xE1ximo 99"),a())}function it(i,t){i&1&&(o(0,"mat-error"),d(1,"Campo obligatorio"),a())}function rt(i,t){i&1&&(o(0,"mat-error"),d(1,"Debe contener 8 d\xEDgitos"),a())}function at(i,t){if(i&1&&(o(0,"mat-option",39),d(1),a()),i&2){let e=t.$implicit;c("value",e),s(),U(e)}}function ot(i,t){i&1&&(o(0,"mat-error"),d(1,"Campo obligatorio"),a())}function nt(i,t){if(i&1&&(o(0,"mat-form-field",16)(1,"mat-label"),d(2,"Obra Social"),a(),o(3,"mat-select",37),u(4,at,2,2,"mat-option",38),a(),u(5,ot,2,0,"mat-error",18),a()),i&2){let e,r,n=p(2);c("ngClass",C(3,V,((e=n.registroForm.get("obraSocial"))==null?null:e.valid)&&(((e=n.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=n.registroForm.get("obraSocial"))==null?null:e.touched)),((e=n.registroForm.get("obraSocial"))==null?null:e.invalid)&&(((e=n.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=n.registroForm.get("obraSocial"))==null?null:e.touched)))),s(4),c("ngForOf",n.obraSocialOptions),s(),c("ngIf",(r=n.registroForm.get("obraSocial"))==null?null:r.hasError("required"))}}function lt(i,t){i&1&&(o(0,"mat-error"),d(1,"Campo obligatorio"),a())}function st(i,t){i&1&&(o(0,"mat-error"),d(1,"Email inv\xE1lido"),a())}function ct(i,t){i&1&&(o(0,"mat-error"),d(1,"Campo obligatorio"),a())}function dt(i,t){i&1&&(o(0,"mat-error"),d(1,"M\xEDnimo 7 caracteres"),a())}function mt(i,t){if(i&1){let e=R();o(0,"mat-checkbox",54),v("change",function(){let n=f(e).$implicit,m=p(4);return h(m.toggleEspecialidad(n.id))}),d(1),a()}if(i&2){let e=t.$implicit,r=p(4);c("checked",r.esEspecialidadSeleccionada(e.id)),s(),I(" ",e.nombre," ")}}function pt(i,t){i&1&&(o(0,"div",58),d(1," M\xEDnimo 2 caracteres "),a())}function ut(i,t){i&1&&(o(0,"div",58),d(1," Solo letras y espacios "),a())}function gt(i,t){if(i&1){let e=R();o(0,"div",55)(1,"input",56),v("click",function(n){return f(e),h(n.stopPropagation())}),a(),u(2,pt,2,0,"div",57)(3,ut,2,0,"div",57),a()}if(i&2){let e,r,n=p(4);s(2),c("ngIf",(e=n.registroForm.get("nuevaEspecialidad"))==null?null:e.hasError("minlength")),s(),c("ngIf",(r=n.registroForm.get("nuevaEspecialidad"))==null?null:r.hasError("pattern"))}}function _t(i,t){if(i&1){let e=R();o(0,"div",48)(1,"div",49),u(2,mt,2,2,"mat-checkbox",50),a(),o(3,"div",51)(4,"button",52),v("click",function(n){return f(e),p(3).toggleMostrarNuevaEspecialidad(),h(n.stopPropagation())}),d(5),a(),u(6,gt,4,2,"div",53),a()()}if(i&2){let e=p(3);s(2),c("ngForOf",e.especialidadOptions),s(3),I(" ",e.mostrarCampoOtraEspecialidad?"\u2715 Cancelar":"+ Agregar nueva especialidad"," "),s(),c("ngIf",e.mostrarCampoOtraEspecialidad)}}function ft(i,t){i&1&&(o(0,"div",59),d(1," Deb\xE9s seleccionar al menos una especialidad o agregar una nueva "),a())}function ht(i,t){if(i&1){let e=R();o(0,"div",40)(1,"div",41),d(2," Especialidades (seleccion\xE1 al menos una) "),a(),o(3,"div",42)(4,"div",43),v("click",function(n){f(e);let m=p(2);return h(m.toggleDesplegableEspecialidades(n))})("keyup.enter",function(n){f(e);let m=p(2);return h(m.toggleDesplegableEspecialidades(n))})("keyup.space",function(n){f(e);let m=p(2);return h(m.toggleDesplegableEspecialidades(n))}),o(5,"span",44),d(6),a(),o(7,"mat-icon",45),d(8),a()(),u(9,_t,7,3,"div",46),a(),u(10,ft,2,0,"div",47),a()}if(i&2){let e,r=p(2);s(4),M("border-azul-oscuro",r.desplegableEspecialidadesAbierto),s(2),I(" ",r.obtenerEspecialidadesSeleccionadasTexto()," "),s(2),U(r.desplegableEspecialidadesAbierto?"expand_less":"expand_more"),s(),c("ngIf",r.desplegableEspecialidadesAbierto),s(),c("ngIf",((e=r.registroForm.get("especialidadesSeleccionadas"))==null?null:e.hasError("alMenosUna"))&&((e=r.registroForm.get("especialidadesSeleccionadas"))==null?null:e.touched))}}function vt(i,t){i&1&&(o(0,"mat-error"),d(1," Debe seleccionar una imagen de perfil. "),a())}function xt(i,t){i&1&&(o(0,"mat-error"),d(1," Solo se permiten archivos .jpg o .png "),a())}function bt(i,t){i&1&&(o(0,"mat-error"),d(1," Debe seleccionar una imagen de fondo. "),a())}function Et(i,t){i&1&&(o(0,"mat-error"),d(1," Solo se permiten archivos .jpg o .png "),a())}function yt(i,t){if(i&1){let e=R();o(0,"div",26)(1,"label",60),d(2,"Foto Fondo"),a(),o(3,"input",61),v("change",function(n){f(e);let m=p(2);return h(m.onFileSelected(n,"fondo"))}),a(),u(4,bt,2,0,"mat-error",18)(5,Et,2,0,"mat-error",18),a()}if(i&2){let e,r,n=p(2);s(4),c("ngIf",(e=n.registroForm.get("imagenFondo"))==null?null:e.hasError("required")),s(),c("ngIf",(r=n.registroForm.get("imagen"))==null?null:r.hasError("invalidType"))}}function Ft(i,t){i&1&&(o(0,"div",62),d(1," Debe resolver correctamente el CAPTCHA. "),a())}function St(i,t){if(i&1){let e=R();o(0,"div",14)(1,"form",15),v("ngSubmit",function(){f(e);let n=p();return h(n.registrar())}),o(2,"mat-form-field",16)(3,"mat-label"),d(4,"Nombre"),a(),F(5,"input",17),u(6,We,2,0,"mat-error",18)(7,Ze,2,0,"mat-error",18)(8,Qe,2,0,"mat-error",18),a(),o(9,"mat-form-field",16)(10,"mat-label"),d(11,"Apellido"),a(),F(12,"input",19),u(13,Je,2,0,"mat-error",18)(14,Ke,2,0,"mat-error",18)(15,Xe,2,0,"mat-error",18),a(),o(16,"mat-form-field",16)(17,"mat-label"),d(18,"Edad"),a(),F(19,"input",20),u(20,Ye,2,0,"mat-error",18)(21,et,2,0,"mat-error",18)(22,tt,2,0,"mat-error",18),a(),o(23,"mat-form-field",16)(24,"mat-label"),d(25,"DNI"),a(),F(26,"input",21),u(27,it,2,0,"mat-error",18)(28,rt,2,0,"mat-error",18),a(),u(29,nt,6,6,"mat-form-field",22),o(30,"mat-form-field",16)(31,"mat-label"),d(32,"Email"),a(),F(33,"input",23),u(34,lt,2,0,"mat-error",18)(35,st,2,0,"mat-error",18),a(),o(36,"mat-form-field",16)(37,"mat-label"),d(38,"Contrase\xF1a"),a(),F(39,"input",24),u(40,ct,2,0,"mat-error",18)(41,dt,2,0,"mat-error",18),a(),u(42,ht,11,6,"div",25),o(43,"div",26)(44,"label",27),d(45,"Foto Perfil"),a(),o(46,"input",28),v("change",function(n){f(e);let m=p();return h(m.onFileSelected(n,"perfil"))}),a(),u(47,vt,2,0,"mat-error",18)(48,xt,2,0,"mat-error",18),a(),u(49,yt,6,2,"div",29),o(50,"div",30)(51,"button",31)(52,"span"),d(53,"Registrarse"),a()()(),o(54,"div",32)(55,"button",33),v("click",function(){f(e);let n=p();return h(n.tipoUsuario=null)}),d(56," Cambiar tipo de usuario "),a()(),o(57,"div",34),u(58,Ft,2,0,"div",35),o(59,"app-mi-captcha",36),v("captchaResuelto",function(n){f(e);let m=p();return h(m.onCaptchaResuelto(n))}),a()()()()}if(i&2){let e,r,n,m,_,T,B,L,x,H,G,$,b,W,Z,E,Q,J,y,K,X,Y,ee,l=p();s(),c("formGroup",l.registroForm),s(),c("ngClass",C(29,V,((e=l.registroForm.get("nombre"))==null?null:e.valid)&&(((e=l.registroForm.get("nombre"))==null?null:e.dirty)||((e=l.registroForm.get("nombre"))==null?null:e.touched)),((e=l.registroForm.get("nombre"))==null?null:e.invalid)&&(((e=l.registroForm.get("nombre"))==null?null:e.dirty)||((e=l.registroForm.get("nombre"))==null?null:e.touched)))),s(4),c("ngIf",(r=l.registroForm.get("nombre"))==null?null:r.hasError("required")),s(),c("ngIf",(n=l.registroForm.get("nombre"))==null?null:n.hasError("minlength")),s(),c("ngIf",(m=l.registroForm.get("nombre"))==null?null:m.hasError("pattern")),s(),c("ngClass",C(32,V,((_=l.registroForm.get("apellido"))==null?null:_.valid)&&(((_=l.registroForm.get("apellido"))==null?null:_.dirty)||((_=l.registroForm.get("apellido"))==null?null:_.touched)),((_=l.registroForm.get("apellido"))==null?null:_.invalid)&&(((_=l.registroForm.get("apellido"))==null?null:_.dirty)||((_=l.registroForm.get("apellido"))==null?null:_.touched)))),s(4),c("ngIf",(T=l.registroForm.get("apellido"))==null?null:T.hasError("required")),s(),c("ngIf",(B=l.registroForm.get("apellido"))==null?null:B.hasError("minlength")),s(),c("ngIf",(L=l.registroForm.get("apellido"))==null?null:L.hasError("pattern")),s(),c("ngClass",C(35,V,((x=l.registroForm.get("edad"))==null?null:x.valid)&&(((x=l.registroForm.get("edad"))==null?null:x.dirty)||((x=l.registroForm.get("edad"))==null?null:x.touched)),((x=l.registroForm.get("edad"))==null?null:x.invalid)&&(((x=l.registroForm.get("edad"))==null?null:x.dirty)||((x=l.registroForm.get("edad"))==null?null:x.touched)))),s(4),c("ngIf",(H=l.registroForm.get("edad"))==null?null:H.hasError("required")),s(),c("ngIf",(G=l.registroForm.get("edad"))==null?null:G.hasError("min")),s(),c("ngIf",($=l.registroForm.get("edad"))==null?null:$.hasError("max")),s(),c("ngClass",C(38,V,((b=l.registroForm.get("dni"))==null?null:b.valid)&&(((b=l.registroForm.get("dni"))==null?null:b.dirty)||((b=l.registroForm.get("dni"))==null?null:b.touched)),((b=l.registroForm.get("dni"))==null?null:b.invalid)&&(((b=l.registroForm.get("dni"))==null?null:b.dirty)||((b=l.registroForm.get("dni"))==null?null:b.touched)))),s(4),c("ngIf",(W=l.registroForm.get("dni"))==null?null:W.hasError("required")),s(),c("ngIf",(Z=l.registroForm.get("dni"))==null?null:Z.hasError("pattern")),s(),c("ngIf",l.tipoUsuario==="paciente"),s(),c("ngClass",C(41,V,((E=l.registroForm.get("mail"))==null?null:E.valid)&&(((E=l.registroForm.get("mail"))==null?null:E.dirty)||((E=l.registroForm.get("mail"))==null?null:E.touched)),((E=l.registroForm.get("mail"))==null?null:E.invalid)&&(((E=l.registroForm.get("mail"))==null?null:E.dirty)||((E=l.registroForm.get("mail"))==null?null:E.touched)))),s(4),c("ngIf",(Q=l.registroForm.get("mail"))==null?null:Q.hasError("required")),s(),c("ngIf",(J=l.registroForm.get("mail"))==null?null:J.hasError("email")),s(),c("ngClass",C(44,V,((y=l.registroForm.get("password"))==null?null:y.valid)&&(((y=l.registroForm.get("password"))==null?null:y.dirty)||((y=l.registroForm.get("password"))==null?null:y.touched)),((y=l.registroForm.get("password"))==null?null:y.invalid)&&(((y=l.registroForm.get("password"))==null?null:y.dirty)||((y=l.registroForm.get("password"))==null?null:y.touched)))),s(4),c("ngIf",(K=l.registroForm.get("password"))==null?null:K.hasError("required")),s(),c("ngIf",(X=l.registroForm.get("password"))==null?null:X.hasError("minlength")),s(),c("ngIf",l.tipoUsuario==="especialista"),s(5),c("ngIf",(Y=l.registroForm.get("imagenPerfil"))==null?null:Y.hasError("required")),s(),c("ngIf",(ee=l.registroForm.get("imagen"))==null?null:ee.hasError("invalidType")),s(),c("ngIf",l.tipoUsuario==="paciente"),s(2),c("disabled",l.registroForm.invalid),s(7),c("ngIf",(l.registroForm.errors==null?null:l.registroForm.errors.captchaInvalido)&&l.registroForm.touched)}}var je=class i{registroForm;tipoUsuario=null;obraSocialOptions=De;especialidadOptions=[];especialidadesSeleccionadas=new Set;captchaEsValido=!1;mostrarCampoOtraEspecialidad=!1;desplegableEspecialidadesAbierto=!1;captchaValidoValidator=()=>()=>this.captchaEsValido?null:{captchaInvalido:!0};subEspecialidad;fb=w(xe);auth=w(z);snackBar=w(Ce);router=w(de);loading=w(ye);elementRef=w(ie);ngOnInit(){return S(this,null,function*(){try{this.loading.show(),this.especialidadOptions=yield this.auth.obtenerEspecialidades(),this.registroForm=this.fb.group({nombre:["",[g.required,g.minLength(2),g.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],apellido:["",[g.required,g.minLength(2),g.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],edad:[null,[g.required,g.min(18),g.max(99)]],dni:["",[g.required,g.pattern(/^\d{8}$/)]],obraSocial:[""],mail:["",[g.required,g.email]],password:["",[g.required,g.minLength(7)]],especialidadesSeleccionadas:[[]],nuevaEspecialidad:["",[g.minLength(2),g.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],imagenPerfil:[null,g.required],imagenFondo:[""]},{validators:this.captchaValidoValidator()})}catch{console.error("Error al cargar especialidades")}finally{this.loading.hide()}})}ngOnDestroy(){this.subEspecialidad&&this.subEspecialidad.unsubscribe()}seleccionarTipo(t){this.tipoUsuario=t,this.registroForm&&(t==="paciente"?(this.registroForm.get("obraSocial")?.setValidators([g.required]),this.registroForm.get("imagenFondo")?.setValidators([g.required]),this.registroForm.get("especialidadesSeleccionadas")?.clearValidators(),this.registroForm.get("nuevaEspecialidad")?.clearValidators()):(this.registroForm.get("obraSocial")?.clearValidators(),this.registroForm.get("imagenFondo")?.clearValidators(),this.registroForm.get("especialidadesSeleccionadas")?.setValidators([this.alMenosUnaEspecialidadValidator()])),this.registroForm.get("obraSocial")?.updateValueAndValidity(),this.registroForm.get("imagenFondo")?.updateValueAndValidity(),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity())}alMenosUnaEspecialidadValidator(){return t=>{let e=t.value||[],r=this.registroForm?.get("nuevaEspecialidad")?.value;return e.length===0&&!r?{alMenosUna:!0}:null}}toggleEspecialidad(t){this.especialidadesSeleccionadas.has(t)?this.especialidadesSeleccionadas.delete(t):this.especialidadesSeleccionadas.add(t),this.actualizarEspecialidadesEnForm()}toggleMostrarNuevaEspecialidad(){this.mostrarCampoOtraEspecialidad=!this.mostrarCampoOtraEspecialidad,this.mostrarCampoOtraEspecialidad||this.registroForm.get("nuevaEspecialidad")?.setValue("")}toggleDesplegableEspecialidades(t){t&&t.stopPropagation(),this.desplegableEspecialidadesAbierto=!this.desplegableEspecialidadesAbierto}onClickOutside(t){if(!this.desplegableEspecialidadesAbierto)return;let e=t.target;this.elementRef.nativeElement.querySelector(".relative")?.contains(e)||(this.desplegableEspecialidadesAbierto=!1)}obtenerEspecialidadesSeleccionadasTexto(){return this.especialidadesSeleccionadas.size===0?"Ninguna seleccionada":Array.from(this.especialidadesSeleccionadas).map(e=>this.especialidadOptions.find(r=>r.id===e)?.nombre).filter(e=>e).join(", ")}esEspecialidadSeleccionada(t){return this.especialidadesSeleccionadas.has(t)}actualizarEspecialidadesEnForm(){let t=Array.from(this.especialidadesSeleccionadas);this.registroForm.get("especialidadesSeleccionadas")?.setValue(t),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity()}onFileSelected(t,e){let r=e==="perfil"?"imagenPerfil":"imagenFondo",n=t.target,m=this.registroForm.get(r);if(!n.files?.length){m.setValue(null),m.setErrors({required:!0});return}let _=n.files[0];if(!["image/jpeg","image/png","image/jpg"].includes(_.type)){m.setErrors({invalidType:!0});return}m.setValue(_),m.setErrors(null)}registrar(){return S(this,null,function*(){if(!(this.registroForm.invalid||!this.tipoUsuario)){this.loading.show();try{this.tipoUsuario==="paciente"?yield this.handleRegistroPaciente():yield this.handleRegistroEspecialista()}finally{this.loading.hide()}}})}handleRegistroPaciente(){return S(this,null,function*(){try{let t=this.registroForm.value,e=yield j(t.imagenPerfil),r=yield j(t.imagenFondo),n={nombre:t.nombre,apellido:t.apellido,edad:t.edad,dni:t.dni,obraSocial:t.obraSocial,mail:t.mail,contrasena:t.password,imagenPerfil:e,imagenFondo:r},m=yield this.auth.registerPaciente(n),_=m.errorCode?.toLowerCase();console.log(m.errorCode),_?.includes("error desconocido")?this.mostrarResultado(m.success,m.message):this.mostrarResultado(m.success,m.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar las im\xE1genes.")}})}handleRegistroEspecialista(){return S(this,null,function*(){try{let t=this.registroForm.value,e=yield j(t.imagenPerfil),r=[];t.especialidadesSeleccionadas&&t.especialidadesSeleccionadas.length>0&&r.push(...t.especialidadesSeleccionadas.map(T=>String(T))),t.nuevaEspecialidad&&t.nuevaEspecialidad.trim()&&r.push(t.nuevaEspecialidad.trim());let n={nombre:t.nombre,apellido:t.apellido,edad:t.edad,dni:t.dni,mail:t.mail,contrasena:t.password,especialidades:r,imagenPerfil:e},m=yield this.auth.registerEspecialista(n);m.errorCode?.toLowerCase()?.includes("error desconocido")?this.mostrarResultado(m.success,m.message):this.mostrarResultado(m.success,m.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar la imagen.")}})}mostrarResultado(t,e){if(!t){this.snackBar.open(e||"Ocurri\xF3 un error.","Cerrar",{duration:4e3,panelClass:["bg-red-600","text-white"]});return}this.tipoUsuario=null,this.router.navigate(["/welcome-page/confirmacion"])}onCaptchaResuelto(t){this.captchaEsValido=t,this.registroForm.updateValueAndValidity()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-register"]],hostBindings:function(e,r){e&1&&v("click",function(m){return r.onClickOutside(m)},ae)},decls:5,vars:2,consts:[[1,"min-h-screen","bg-gray-200","pt-30","pb-60"],[1,"pb-1","text-center","text-4xl","font-bold","text-azul-oscuro"],["class","pt-16 pb-30 text-center",4,"ngIf"],["class","flex justify-center py-8",4,"ngIf"],[1,"pt-16","pb-30","text-center"],[1,"mb-6","text-xl","text-gray-700"],[1,"flex","flex-col","items-center","gap-6"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Paciente",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],[1,"rounded-2xl","bg-white","shadow-lg"],["src","assets/imagenes/Registro/pacientes.jpg","alt","Paciente",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"p-4"],[1,"text-xl","font-bold","text-azul-oscuro"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Especialista",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],["src","assets/imagenes/Registro/especialistas.jpg","alt","Especialista",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"flex","justify-center","py-8"],[1,"grid","w-full","max-w-2xl","grid-cols-1","gap-4","rounded-xl","bg-crema","p-8","shadow-lg","md:grid-cols-2",3,"ngSubmit","formGroup"],["appearance","fill",1,"col-span-1",3,"ngClass"],["matInput","","formControlName","nombre"],[4,"ngIf"],["matInput","","formControlName","apellido"],["matInput","","type","number","formControlName","edad"],["matInput","","formControlName","dni"],["appearance","fill","class","col-span-1",3,"ngClass",4,"ngIf"],["matInput","","type","email","formControlName","mail"],["matInput","","type","password","formControlName","password"],["class","col-span-2",4,"ngIf"],[1,"col-span-2","flex","flex-col","gap-2"],["for","fotoPerfil",1,"font-semibold","text-azul-oscuro"],["id","fotoPerfil","type","file","accept","image/*",1,"register-input",3,"change"],["class","col-span-2 flex flex-col gap-2",4,"ngIf"],[1,"col-span-2","flex","justify-center","pt-4"],["mat-raised-button","","color","primary","type","submit",1,"flex","items-center","justify-center","gap-2","rounded-full","bg-verde-oscuro","px-8","py-2","text-white","shadow-lg",3,"disabled"],[1,"col-span-2","mt-1","flex","justify-center"],["mat-button","","type","button",1,"text-sm","text-gray-600","underline",3,"click"],[1,"col-span-2","mt-1","flex","flex-col","items-center"],["class","mb-2 text-center text-sm text-red-600",4,"ngIf"],[3,"captchaResuelto"],["formControlName","obraSocial"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"col-span-2"],[1,"mb-1","text-sm","font-medium","text-azul-oscuro"],[1,"relative"],["tabindex","0",1,"flex","min-h-[56px]","cursor-pointer","items-center","rounded-md","border","border-gray-300","bg-white","px-4","py-3","transition-colors","hover:border-azul-oscuro",3,"click","keyup.enter","keyup.space"],[1,"flex-1","text-sm","text-gray-700"],[1,"text-gray-500"],["class","absolute top-full right-0 left-0 z-10 mt-1 max-h-60 overflow-y-auto rounded-lg border border-gray-300 bg-white p-3 shadow-lg",4,"ngIf"],["class","mt-1 text-sm text-red-600",4,"ngIf"],[1,"absolute","top-full","right-0","left-0","z-10","mt-1","max-h-60","overflow-y-auto","rounded-lg","border","border-gray-300","bg-white","p-3","shadow-lg"],[1,"space-y-2"],["class","block text-sm",3,"checked","change",4,"ngFor","ngForOf"],[1,"mt-3","border-t","pt-2"],["type","button","mat-button","",1,"w-full","text-left","text-sm","text-azul-oscuro",3,"click"],["class","mt-2",4,"ngIf"],[1,"block","text-sm",3,"change","checked"],[1,"mt-2"],["formControlName","nuevaEspecialidad","placeholder","Nombre de la especialidad",1,"w-full","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:border-azul-oscuro","focus:outline-none",3,"click"],["class","mt-1 text-xs text-red-600",4,"ngIf"],[1,"mt-1","text-xs","text-red-600"],[1,"mt-1","text-sm","text-red-600"],["for","fotoFondo",1,"font-semibold","text-azul-oscuro"],["id","fotoFondo","type","file","accept","image/*",1,"register-input",3,"change"],[1,"mb-2","text-center","text-sm","text-red-600"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"h2",1),d(2,"Registro"),a(),u(3,$e,16,0,"div",2)(4,St,60,47,"div",3),a()),e&2&&(s(3),c("ngIf",!r.tipoUsuario&&r.registroForm),s(),c("ngIf",r.tipoUsuario&&r.registroForm))},dependencies:[P,A,ce,O,Ee,_e,N,fe,D,ue,he,ve,Ie,Ve,we,Re,ke,Te,Oe,Ae,Me,Se,Fe,pe,me,Ne,Pe,q],styles:[".register-input[_ngcontent-%COMP%]{padding:12px 20px;margin:10px 0;border:2px solid #333;border-radius:6px;background-color:#222;color:#fff;font-size:16px;cursor:pointer;transition:all .3s ease}.register-input[_ngcontent-%COMP%]:hover{border-color:#92cc34;background-color:#2c2c2c}.register-input[_ngcontent-%COMP%]:focus{border-color:#19b44d;background-color:#2c2c2c;outline:none}.register-input[_ngcontent-%COMP%]::-webkit-file-upload-button{background-color:#fff;color:#fff;padding:8px 15px;border-radius:4px;border:none;cursor:pointer;font-size:14px;transition:background-color .3s ease}"]})};export{je as Register};
