import"./chunk-GGQ7LRWG.js";import{a as Y}from"./chunk-VT36IDP6.js";import{a as R}from"./chunk-ENUDGQHA.js";import{c as z,d as $,f as C,g as k}from"./chunk-E6MHVRGS.js";import{b as L}from"./chunk-OJPJNVHA.js";import"./chunk-PAEHXDDS.js";import"./chunk-X5YLR3NI.js";import{w as X}from"./chunk-5MFN5EJ7.js";import{i as H,j}from"./chunk-YGECKIT7.js";import{Cb as P,Db as u,Ka as U,Ma as r,O as F,Ob as V,Ra as v,Rb as a,Sb as B,Tb as l,Ub as _,Xa as N,ba as S,bc as T,ca as y,dc as D,f as A,lb as m,ma as g,mb as p,nb as E,ob as f,pb as x,qb as O,ub as o,vb as t,wb as w,xb as I,yb as M}from"./chunk-ZQYZ5UVW.js";import{i as b}from"./chunk-ODN5LVDJ.js";function Q(i,n){i&1&&(o(0,"div")(1,"p",3),a(2,"Cargando pacientes..."),t()())}function W(i,n){if(i&1&&w(0,"img",7),i&2){let e=u().$implicit;M("src",e.paciente.urlImagenPerfil,U)}}function Z(i,n){if(i&1&&(o(0,"li"),a(1),T(2,"date"),t()),i&2){let e=n.$implicit;r(),_(" \u2022 ",D(2,2,e.fechaHora,"short")," \u2013 ",e.especialidadNombre," ")}}function ee(i,n){if(i&1){let e=I();o(0,"div",6),P("click",function(){let c=S(e).$implicit,h=u(2);return y(h.seleccionarPaciente(c))}),m(1,W,1,1,"img",7),o(2,"div",8)(3,"p",9),a(4),t(),o(5,"p",10),a(6),t(),o(7,"p"),a(8),t(),o(9,"p"),a(10),t(),o(11,"p",11),a(12,"\xDAltimos 3 turnos:"),t(),o(13,"ul",12),f(14,Z,3,5,"li",null,E),t(),o(16,"button",13),a(17," Ver historia cl\xEDnica "),t()()()}if(i&2){let e=n.$implicit;r(),p(e.paciente.urlImagenPerfil?1:-1),r(3),_(" ",e.paciente.nombre," ",e.paciente.apellido," "),r(2),B(e.paciente.email),r(2),l("DNI: ",e.paciente.dni),r(2),l("Edad: ",e.paciente.edad),r(4),x(e.citas)}}function te(i,n){if(i&1&&(o(0,"div",2),f(1,ee,18,6,"div",5,E),t()),i&2){let e=u();r(),x(e.pacientesConCitas)}}function ie(i,n){i&1&&(o(0,"div",3),a(1," No se encontraron pacientes atendidos. "),t())}function ne(i,n){if(i&1&&(o(0,"li"),a(1),t()),i&2){let e=n.$implicit;r(),_(" ",e.clave,": ",e.valor," ")}}function ae(i,n){if(i&1&&(o(0,"div")(1,"p")(2,"strong"),a(3,"Fecha:"),t(),a(4),T(5,"date"),t(),o(6,"p")(7,"strong"),a(8,"Especialidad:"),t(),a(9),t(),o(10,"p")(11,"strong"),a(12,"Altura:"),t(),a(13),t(),o(14,"p")(15,"strong"),a(16,"Peso:"),t(),a(17),t(),o(18,"p")(19,"strong"),a(20,"Temperatura:"),t(),a(21),t(),o(22,"p")(23,"strong"),a(24,"Presi\xF3n arterial:"),t(),a(25),t(),o(26,"p")(27,"strong"),a(28,"Datos din\xE1micos:"),t()(),o(29,"ul",16),f(30,ne,2,2,"li",null,E),t(),w(32,"br"),t()),i&2){let e=n.$implicit;r(4),l(" ",D(5,6,e.fechaHora,"short")),r(5),l(" ",e.especialidadNombre),r(4),l(" ",e.alturaCm," cm"),r(4),l(" ",e.pesoKg," kg"),r(4),l(" ",e.temperaturaC," \xB0C"),r(4),l(" ",e.presionArterial),r(5),x(e.datosDinamicos)}}function oe(i,n){if(i&1){let e=I();o(0,"div",4)(1,"button",14),P("click",function(){S(e);let c=u();return y(c.cerrarHistoriaClinica())}),a(2," \u2190 Volver a pacientes "),t(),o(3,"h2",15),a(4),t(),f(5,ae,33,9,"div",null,E),t()}if(i&2){let e,s,c=u();O("@slideInRight",void 0),r(4),_(" Historia cl\xEDnica de ",(e=c.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.nombre," ",(e=c.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.apellido," "),r(),x((s=c.pacienteSeleccionado())==null?null:s.citas)}}var K=class i{constructor(n,e,s){this.turnosService=n;this.authSupabase=e;this.usuariosService=s;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new A;citas=g([]);cargando=g(!0);pacientesConCitas=[];pacienteSeleccionado=g(null);ngOnInit(){this.usuario$.pipe(F(this.destroy$)).subscribe(n=>b(this,null,function*(){if(!n){this.usuarioActual=null;return}n.id=typeof n.id=="string"?Number(n.id):n.id,this.usuarioActual=n,yield this.cargarCitasYPacientes()}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitasYPacientes(){return b(this,null,function*(){this.cargando.set(!0);try{if(this.usuarioActual?.id==null){this.pacientesConCitas=[],this.cargando.set(!1);return}let e=(yield this.turnosService.obtenerCitasEspecialista(this.usuarioActual.id)).filter(d=>d.estado==="completado"),s=new Map;for(let d of e)s.has(d.pacienteId)||s.set(d.pacienteId,[]),s.get(d.pacienteId).push(d);let h=(yield this.usuariosService.obtenerTodosUsuarios()).filter(d=>d.rol==="paciente");this.pacientesConCitas=h.filter(d=>s.has(d.id)).map(d=>{let q=s.get(d.id).sort((G,J)=>new Date(J.fechaHora).getTime()-new Date(G.fechaHora).getTime()).slice(0,3);return{paciente:d,citas:q}})}catch(n){console.error("Error cargando citas y pacientes",n),this.pacientesConCitas=[]}finally{this.cargando.set(!1)}})}seleccionarPaciente(n){this.pacienteSeleccionado.set(n)}cerrarHistoriaClinica(){this.pacienteSeleccionado.set(null)}static \u0275fac=function(e){return new(e||i)(v(R),v(L),v(Y))};static \u0275cmp=N({type:i,selectors:[["app-pacientes"]],decls:6,vars:6,consts:[[1,"flex","h-full","w-full","gap-4","p-1"],[1,"h-full","min-w-0","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","pb-6","shadow-inner","transition-all","duration-700","ease-in-out"],[1,"flex","flex-wrap","justify-start","gap-6"],[1,"text-center","text-gray-500"],[1,"w-full","translate-x-0","rounded-2xl","bg-white","p-10","transition-all","duration-700","ease-in-out","md:w-[35%]"],[1,"h-auto","w-[300px]","cursor-pointer","rounded-lg","border","border-gray-300","bg-white","p-4","shadow-sm","transition","hover:shadow-md"],[1,"h-auto","w-[300px]","cursor-pointer","rounded-lg","border","border-gray-300","bg-white","p-4","shadow-sm","transition","hover:shadow-md",3,"click"],["alt","Avatar","appTrackImage","",1,"mb-2","h-14","w-14","rounded-full","object-cover",3,"src"],[1,"text-sm"],[1,"font-semibold","text-azul-oscuro"],[1,"text-gray-600"],[1,"mt-2","font-semibold","text-gray-700"],[1,"list-inside","list-disc","text-sm","text-gray-600"],["type","button",1,"mt-3","rounded","bg-indigo-600","px-3","py-1","text-sm","font-semibold","text-white","transition","hover:bg-indigo-700"],[1,"mb-4","self-start","rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","transition","hover:bg-gray-100",3,"click"],[1,"mb-4","text-xl","font-semibold","text-azul-oscuro"],[1,"list-inside","list-disc","text-sm"]],template:function(e,s){e&1&&(o(0,"div",0)(1,"div",1),m(2,Q,3,0,"div"),m(3,te,3,0,"div",2),m(4,ie,2,0,"div",3),t(),m(5,oe,7,3,"div",4),t()),e&2&&(r(),V("width",s.pacienteSeleccionado()?"65%":"100%"),r(),p(s.cargando()?2:-1),r(),p(!s.cargando()&&s.pacientesConCitas.length>0?3:-1),r(),p(!s.cargando()&&s.pacientesConCitas.length===0?4:-1),r(),p(s.pacienteSeleccionado()?5:-1))},dependencies:[j,X,H],encapsulation:2,data:{animation:[z("slideInRight",[k(":enter",[C({transform:"translateX(100%)",opacity:0}),$("600ms ease-in-out",C({transform:"translateX(0)",opacity:1}))]),k(":leave",[$("400ms ease-in",C({transform:"translateX(100%)",opacity:0}))])])]}})};export{K as Pacientes};
