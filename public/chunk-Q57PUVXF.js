import"./chunk-GGQ7LRWG.js";import{a as K}from"./chunk-EZBJPSTF.js";import{a as Y}from"./chunk-WSULEND5.js";import{c as X,d as k,f as y,g as $}from"./chunk-P2GLRHRS.js";import{b as R}from"./chunk-ZSNERKQC.js";import"./chunk-QU5QNJKE.js";import"./chunk-X5YLR3NI.js";import{w as L}from"./chunk-T6NMK5EM.js";import{j,k as z}from"./chunk-M3XRSK3P.js";import{Ab as M,Eb as I,Fb as m,Ma as U,Oa as r,P as A,Qb as B,Ta as b,Tb as a,Ub as H,Vb as d,Wb as v,Za as V,ca as g,da as C,ec as T,f as F,gc as D,mb as N,na as h,nb as p,ob as u,pb as _,qb as f,rb as x,sb as O,wb as o,xb as t,yb as w,zb as P}from"./chunk-7RTQA4J5.js";import{i as S}from"./chunk-ODN5LVDJ.js";function W(i,n){i&1&&(o(0,"div")(1,"p",3),a(2,"Cargando pacientes..."),t()())}function Z(i,n){if(i&1&&w(0,"img",7),i&2){let e=m().$implicit;M("src",e.paciente.urlImagenPerfil,U)}}function ee(i,n){if(i&1&&(o(0,"li"),a(1),T(2,"date"),t()),i&2){let e=n.$implicit;r(),v(" \u2022 ",D(2,2,e.fechaHora,"short")," \u2013 ",e.especialidadNombre," ")}}function te(i,n){if(i&1){let e=P();o(0,"div",6),I("click",function(){let c=g(e).$implicit,E=m(2);return C(E.seleccionarPaciente(c))})("keyup.enter",function(){let c=g(e).$implicit,E=m(2);return C(E.seleccionarPaciente(c))}),p(1,Z,1,1,"img",7),o(2,"div",8)(3,"p",9),a(4),t(),o(5,"p",10),a(6),t(),o(7,"p"),a(8),t(),o(9,"p"),a(10),t(),o(11,"p",11),a(12,"\xDAltimos 3 turnos:"),t(),o(13,"ul",12),f(14,ee,3,5,"li",null,_),t(),o(16,"button",13),a(17," Ver historia cl\xEDnica "),t()()()}if(i&2){let e=n.$implicit;N("aria-label","Ver detalles de "+e.paciente.nombre),r(),u(e.paciente.urlImagenPerfil?1:-1),r(3),v(" ",e.paciente.nombre," ",e.paciente.apellido," "),r(2),H(e.paciente.email),r(2),d("DNI: ",e.paciente.dni),r(2),d("Edad: ",e.paciente.edad),r(4),x(e.citas)}}function ie(i,n){if(i&1&&(o(0,"div",2),f(1,te,18,7,"div",5,_),t()),i&2){let e=m();r(),x(e.pacientesConCitas)}}function ne(i,n){i&1&&(o(0,"div",3),a(1," No se encontraron pacientes atendidos. "),t())}function ae(i,n){if(i&1&&(o(0,"li"),a(1),t()),i&2){let e=n.$implicit;r(),v("",e.clave,": ",e.valor)}}function oe(i,n){if(i&1&&(o(0,"div")(1,"p")(2,"strong"),a(3,"Fecha:"),t(),a(4),T(5,"date"),t(),o(6,"p")(7,"strong"),a(8,"Especialidad:"),t(),a(9),t(),o(10,"p")(11,"strong"),a(12,"Altura:"),t(),a(13),t(),o(14,"p")(15,"strong"),a(16,"Peso:"),t(),a(17),t(),o(18,"p")(19,"strong"),a(20,"Temperatura:"),t(),a(21),t(),o(22,"p")(23,"strong"),a(24,"Presi\xF3n arterial:"),t(),a(25),t(),o(26,"p")(27,"strong"),a(28,"Datos din\xE1micos:"),t()(),o(29,"ul",16),f(30,ae,2,2,"li",null,_),t(),w(32,"br"),t()),i&2){let e=n.$implicit;r(4),d(" ",D(5,6,e.fechaHora,"short")),r(5),d(" ",e.especialidadNombre),r(4),d(" ",e.alturaCm," cm"),r(4),d(" ",e.pesoKg," kg"),r(4),d(" ",e.temperaturaC," \xB0C"),r(4),d(" ",e.presionArterial),r(5),x(e.datosDinamicos)}}function re(i,n){if(i&1){let e=P();o(0,"div",4)(1,"button",14),I("click",function(){g(e);let c=m();return C(c.cerrarHistoriaClinica())}),a(2," \u2190 Volver a pacientes "),t(),o(3,"h2",15),a(4),t(),f(5,oe,33,9,"div",null,_),t()}if(i&2){let e,s,c=m();O("@slideInRight",void 0),r(4),v(" Historia cl\xEDnica de ",(e=c.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.nombre," ",(e=c.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.apellido," "),r(),x((s=c.pacienteSeleccionado())==null?null:s.citas)}}var q=class i{constructor(n,e,s){this.turnosService=n;this.authSupabase=e;this.usuariosService=s;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new F;citas=h([]);cargando=h(!0);pacientesConCitas=[];pacienteSeleccionado=h(null);ngOnInit(){this.usuario$.pipe(A(this.destroy$)).subscribe(n=>S(this,null,function*(){if(!n){this.usuarioActual=null;return}n.id=typeof n.id=="string"?Number(n.id):n.id,this.usuarioActual=n,yield this.cargarCitasYPacientes()}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitasYPacientes(){return S(this,null,function*(){this.cargando.set(!0);try{if(this.usuarioActual?.id==null){this.pacientesConCitas=[],this.cargando.set(!1);return}let e=(yield this.turnosService.obtenerCitasEspecialista(this.usuarioActual.id)).filter(l=>l.estado==="completado"),s=new Map;for(let l of e)s.has(l.pacienteId)||s.set(l.pacienteId,[]),s.get(l.pacienteId).push(l);let E=(yield this.usuariosService.obtenerTodosUsuarios()).filter(l=>l.rol==="paciente");this.pacientesConCitas=E.filter(l=>s.has(l.id)).map(l=>{let G=s.get(l.id).sort((J,Q)=>new Date(Q.fechaHora).getTime()-new Date(J.fechaHora).getTime()).slice(0,3);return{paciente:l,citas:G}})}catch(n){console.error("Error cargando citas y pacientes",n),this.pacientesConCitas=[]}finally{this.cargando.set(!1)}})}seleccionarPaciente(n){this.pacienteSeleccionado.set(n)}cerrarHistoriaClinica(){this.pacienteSeleccionado.set(null)}static \u0275fac=function(e){return new(e||i)(b(Y),b(R),b(K))};static \u0275cmp=V({type:i,selectors:[["app-pacientes"]],decls:6,vars:6,consts:[[1,"flex","h-full","w-full","gap-4","p-1"],[1,"h-full","min-w-0","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","pb-6","shadow-inner","transition-all","duration-700","ease-in-out"],[1,"flex","flex-wrap","justify-start","gap-6"],[1,"text-center","text-gray-500"],[1,"w-full","translate-x-0","rounded-2xl","bg-white","p-10","transition-all","duration-700","ease-in-out","md:w-[35%]"],["tabindex","0","role","button",1,"h-auto","w-[300px]","cursor-pointer","rounded-lg","border","border-gray-300","bg-white","p-4","shadow-sm","transition","hover:shadow-md"],["tabindex","0","role","button",1,"h-auto","w-[300px]","cursor-pointer","rounded-lg","border","border-gray-300","bg-white","p-4","shadow-sm","transition","hover:shadow-md",3,"click","keyup.enter"],["alt","Avatar","appTrackImage","",1,"mb-2","h-14","w-14","rounded-full","object-cover",3,"src"],[1,"text-sm"],[1,"font-semibold","text-azul-oscuro"],[1,"text-gray-600"],[1,"mt-2","font-semibold","text-gray-700"],[1,"list-inside","list-disc","text-sm","text-gray-600"],["type","button",1,"mt-3","rounded","bg-indigo-600","px-3","py-1","text-sm","font-semibold","text-white","transition","hover:bg-indigo-700"],[1,"mb-4","self-start","rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","transition","hover:bg-gray-100",3,"click"],[1,"mb-4","text-xl","font-semibold","text-azul-oscuro"],[1,"list-inside","list-disc","text-sm"]],template:function(e,s){e&1&&(o(0,"div",0)(1,"div",1),p(2,W,3,0,"div"),p(3,ie,3,0,"div",2),p(4,ne,2,0,"div",3),t(),p(5,re,7,3,"div",4),t()),e&2&&(r(),B("width",s.pacienteSeleccionado()?"65%":"100%"),r(),u(s.cargando()?2:-1),r(),u(!s.cargando()&&s.pacientesConCitas.length>0?3:-1),r(),u(!s.cargando()&&s.pacientesConCitas.length===0?4:-1),r(),u(s.pacienteSeleccionado()?5:-1))},dependencies:[z,L,j],encapsulation:2,data:{animation:[X("slideInRight",[$(":enter",[y({transform:"translateX(100%)",opacity:0}),k("600ms ease-in-out",y({transform:"translateX(0)",opacity:1}))]),$(":leave",[k("400ms ease-in",y({transform:"translateX(100%)",opacity:0}))])])]}})};export{q as Pacientes};
