import"./chunk-GGQ7LRWG.js";import{a as G}from"./chunk-RLM7BZDW.js";import{c as I,d as $,f as k,g as N,h as A,i as j,j as P}from"./chunk-E6MHVRGS.js";import{a as z,b as q}from"./chunk-ENSBJLBX.js";import{n as W}from"./chunk-YZVU7P4D.js";import{a as L}from"./chunk-XAJTSRQW.js";import{b as U}from"./chunk-4DVJJQNQ.js";import"./chunk-BSLYAFLW.js";import"./chunk-X5YLR3NI.js";import"./chunk-SGAKRYQ3.js";import"./chunk-VLNB4REZ.js";import{f as O,g as H,l as V}from"./chunk-MTWZV5NU.js";import{Cb as x,Eb as d,Ka as w,Ma as c,O as M,Qb as S,Ra as v,Sb as r,Tb as y,Ub as D,Vb as C,Xa as B,ab as m,ba as f,ca as g,f as F,kc as T,ma as p,pb as l,qb as o,rb as s,sb as b,yb as _}from"./chunk-EMRS3JRH.js";import{i as h}from"./chunk-ODN5LVDJ.js";function Q(t,i){if(t&1){let e=_();o(0,"button",8),x("click",function(){let n=f(e).$implicit,u=d(2);return g(u.seleccionarEspecialista(n))}),b(1,"img",9),o(2,"span",10),r(3),s()()}if(t&2){let e,a=i.$implicit,n=d(2);S("opacity-50",n.especialistaSeleccionado()&&n.especialistaSeleccionado().id!==a.id),c(),S("border-blue-600",((e=n.especialistaSeleccionado())==null?null:e.id)===a.id),l("src",a.imagenPerfil||"assets/default-avatar.png",w),c(2),C("",a.nombre," ",a.apellido)}}function R(t,i){if(t&1&&(o(0,"div")(1,"h2",5),r(2," Seleccion\xE1 un profesional "),s(),o(3,"div",6),m(4,Q,4,7,"button",7),s()()),t&2){let e=d();c(4),l("ngForOf",e.especialistasValidados())}}function X(t,i){if(t&1){let e=_();o(0,"button",13),x("click",function(){let n=f(e).$implicit,u=d(2);return g(u.seleccionarEspecialidad(n))}),b(1,"img",14),o(2,"span",15),r(3),s()()}if(t&2){let e,a=i.$implicit,n=d(2);S("border-blue-600",((e=n.especialidadSeleccionada())==null?null:e.id)===a.id)("opacity-50",n.especialidadSeleccionada()&&n.especialidadSeleccionada().id!==a.id),l("@especialidadAnimacion",void 0),c(),l("src",a.icono||"assets/default-icon.png",w),c(2),y(a.nombre)}}function Y(t,i){t&1&&(o(0,"p",16),r(1," No hay especialidades disponibles. "),s())}function Z(t,i){if(t&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 una especialidad ---- "),s(),o(3,"div",6),m(4,X,4,7,"button",11),s(),m(5,Y,2,0,"p",12),s()),t&2){let e=d();c(3),l("@listaAnimacion",void 0),c(),l("ngForOf",e.especialidades()),c(),l("ngIf",e.noHayEspecialidades())}}function ee(t,i){if(t&1){let e=_();o(0,"button",19),x("click",function(){let n=f(e).$implicit,u=d(2);return g(u.seleccionarFecha(n))}),r(1),s()}if(t&2){let e=i.$implicit,a=d(2);S("bg-blue-600",a.fechaSeleccionada()===e)("text-white",a.fechaSeleccionada()===e),c(),D(" ",e," ")}}function ie(t,i){t&1&&(o(0,"p",16),r(1," No hay d\xEDas disponibles. "),s())}function te(t,i){if(t&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un d\xEDa ---- "),s(),o(3,"div",17),m(4,ee,2,5,"button",18),s(),m(5,ie,2,0,"p",12),s()),t&2){let e=d();c(4),l("ngForOf",e.fechasDisponibles()),c(),l("ngIf",e.noHayFechas())}}function ae(t,i){if(t&1){let e=_();o(0,"button",21),x("click",function(){let n=f(e).$implicit,u=d(2);return g(u.seleccionarHorario(n))}),r(1),s()}if(t&2){let e=i.$implicit,a=d(2);S("bg-green-500",a.horaSelecionada()===e)("text-white",a.horaSelecionada()===e),c(),D(" ",e," ")}}function ne(t,i){t&1&&(o(0,"p",16),r(1," No hay turnos disponibles. "),s())}function oe(t,i){if(t&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un horario ---- "),s(),o(3,"div",17),m(4,ae,2,5,"button",20),s(),m(5,ne,2,0,"p",12),s()),t&2){let e=d();c(4),l("ngForOf",e.horariosDisponibles()),c(),l("ngIf",e.noHayHorarios())}}function se(t,i){if(t&1){let e=_();o(0,"div",22)(1,"p",23),r(2," Seleccionaste: "),o(3,"strong"),r(4),s(),b(5,"br"),r(6," Especialidad: "),o(7,"strong"),r(8),s(),b(9,"br"),r(10," D\xEDa: "),o(11,"strong"),r(12),s(),b(13,"br"),r(14," Hora: "),o(15,"strong"),r(16),s()(),o(17,"div",24)(18,"button",25),x("click",function(){f(e);let n=d();return g(n.cargarCita())}),r(19," Confirmar "),s()()()}if(t&2){let e,a,n=d();c(4),C("",(e=n.especialistaSeleccionado())==null?null:e.nombre," ",(e=n.especialistaSeleccionado())==null?null:e.apellido),c(4),y((a=n.especialidadSeleccionada())==null?null:a.nombre),c(4),y(n.fechaSeleccionada()),c(4),y(n.horaSelecionada())}}var J=class t{constructor(i,e,a,n){this.turnosService=i;this.loadin=e;this.authSupabase=a;this.snackBar=n;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new F;especialistas=p([]);especialidades=p([]);fechasDisponibles=p([]);horariosDisponibles=p([]);especialistaSeleccionado=p(null);especialidadSeleccionada=p(null);fechaSeleccionada=p(null);horaSelecionada=p(null);especialidadesBuscadas=p(!1);diasBuscados=p(!1);horasBuscadas=p(!1);cargando=p(!1);especialistasValidados=T(()=>this.especialistas().filter(i=>i.validadoAdmin===!0));noHayEspecialidades=T(()=>this.especialistaSeleccionado()!==null&&this.especialidadesBuscadas()===!0&&this.especialidades().length===0);noHayFechas=T(()=>this.especialidadSeleccionada()!==null&&this.diasBuscados()===!0&&this.fechasDisponibles().length===0);noHayHorarios=T(()=>this.fechaSeleccionada()!==null&&this.horasBuscadas()===!0&&this.horariosDisponibles().length===0);ngOnInit(){return h(this,null,function*(){this.usuario$.pipe(M(this.destroy$)).subscribe(i=>{if(!i){this.usuarioActual=null;return}i.id=typeof i.id=="string"?Number(i.id):i.id,this.usuarioActual=i}),this.especialistas.set(yield this.turnosService.obtenerEspecialistas()),this.loadin.hide()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}seleccionarEspecialista(i){return h(this,null,function*(){this.especialistaSeleccionado.set(i),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.fechasDisponibles.set([]),this.especialidadesBuscadas.set(!1),this.diasBuscados.set(!1),this.horasBuscadas.set(!1),this.cargando.set(!0);let e=yield this.turnosService.obtenerEspecialidadesDeEspecialista(i.id);this.especialidades.set(e),this.especialidadesBuscadas.set(!0),this.cargando.set(!1)})}seleccionarEspecialidad(i){return h(this,null,function*(){this.especialidadSeleccionada.set(i),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.cargando.set(!0);let e=yield this.turnosService.calcularFechasDisponibles(this.especialistaSeleccionado().id);this.fechasDisponibles.set(e),this.diasBuscados.set(!0),this.cargando.set(!1)})}seleccionarFecha(i){return h(this,null,function*(){this.horaSelecionada.set(null),this.fechaSeleccionada.set(i),this.cargando.set(!0);let e=yield this.turnosService.obtenerHorariosDisponibles(i,this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion);this.horariosDisponibles.set(e),this.horasBuscadas.set(!0),this.cargando.set(!1)})}seleccionarHorario(i){this.horaSelecionada.set(i)}cargarCita(){return h(this,null,function*(){let i=this.fechaSeleccionada(),e=this.horaSelecionada(),a=this.especialistaSeleccionado(),n=this.especialidadSeleccionada(),u=this.usuarioActual;if(!i||!e||!a||!n||!u){console.error("Datos incompletos para agendar la cita");return}let K={fechaHora:new Date(`${i}T${e}:00`),duracionMin:n.duracion,pacienteId:u.id,especialistaId:a.id,especialidadId:n.id,estado:"solicitado",comentarioPaciente:" ",comentarioEspecialista:" ",resenia:" "};try{let E=yield this.turnosService.darAltaCita(K);console.log("Cita creada exitosamente",E),this.snackBar.open("Cita agendada","exito",{duration:4e3,panelClass:["bg-blue-600","text-white"]}),this.especialistaSeleccionado.set(null),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null)}catch(E){console.error("Error al cargar la cita:",E),this.snackBar.open("Ups algo salio mal","error",{duration:4e3,panelClass:["bg-red-600","text-white"]}),this.especialistaSeleccionado.set(null),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null)}})}static \u0275fac=function(e){return new(e||t)(v(G),v(L),v(U),v(W))};static \u0275cmp=B({type:t,selectors:[["app-solicitar-turno"]],decls:9,vars:5,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mx-auto","max-w-4xl","space-y-8","p-4"],[4,"ngIf"],["class","mt-8 text-center",4,"ngIf"],[1,"mb-4","text-center","text-xl","font-semibold"],[1,"flex","flex-wrap","justify-center","gap-4"],["class","flex flex-col items-center space-y-1 focus:outline-none",3,"opacity-50","click",4,"ngFor","ngForOf"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"click"],["alt","profesional","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],[1,"text-center","text-sm"],["class","flex h-21 w-21 flex-col items-center justify-center rounded-lg border bg-white shadow hover:bg-blue-50",3,"border-blue-600","opacity-50","click",4,"ngFor","ngForOf"],["class","mt-4 text-center text-red-500",4,"ngIf"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","hover:bg-blue-50",3,"click"],["alt","icono","appTrackImage","",1,"mb-2","h-10","w-10",3,"src"],[1,"text-center","text-xs"],[1,"mt-4","text-center","text-red-500"],[1,"flex","flex-wrap","justify-center","gap-2"],["class","rounded bg-blue-100 px-4 py-2 text-sm font-medium hover:bg-blue-200",3,"bg-blue-600","text-white","click",4,"ngFor","ngForOf"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"click"],["class","h-12 w-16 rounded-lg bg-green-200 text-sm font-semibold hover:bg-green-300",3,"bg-green-500","text-white","click",4,"ngFor","ngForOf"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"click"],[1,"mt-8","text-center"],[1,"text-sm","text-gray-600"],[1,"pt-4"],[1,"rounded","bg-blue-200","px-4","py-2","text-lg","font-medium","hover:bg-blue-300",3,"click"]],template:function(e,a){e&1&&(o(0,"app-loading-wrapper")(1,"div",0)(2,"div",1)(3,"div",2),m(4,R,5,1,"div",3)(5,Z,6,3,"div",3)(6,te,6,2,"div",3)(7,oe,6,2,"div",3)(8,se,20,5,"div",4),s()()()()),e&2&&(c(4),l("ngIf",a.especialistas().length),c(),l("ngIf",a.especialistaSeleccionado()),c(),l("ngIf",a.especialidadSeleccionada()),c(),l("ngIf",a.fechaSeleccionada()),c(),l("ngIf",a.horaSelecionada()))},dependencies:[V,O,H,z,q],encapsulation:2,data:{animation:[I("especialidadAnimacion",[N(":enter",[k({opacity:0,transform:"scale(0.5)"}),$("400ms cubic-bezier(0.34, 1.56, 0.64, 1)",k({opacity:1,transform:"scale(1)"}))])]),I("listaAnimacion",[N(":enter",[j("@especialidadAnimacion",P(150,A()),{optional:!0})])])]}})};export{J as SolicitarTurno};
