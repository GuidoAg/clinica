import"./chunk-GGQ7LRWG.js";import{a as q}from"./chunk-4UEOIUG4.js";import{a as K}from"./chunk-KLTD2K6X.js";import{a as Y}from"./chunk-WZDOETQ3.js";import{c as L,d as D,f as w,g as k}from"./chunk-P2GLRHRS.js";import{l as R}from"./chunk-ISKSCZVY.js";import"./chunk-X5YLR3NI.js";import{w as X}from"./chunk-ET4QANTK.js";import{i as j,j as z}from"./chunk-EUZGYKR3.js";import{Ab as B,Eb as T,Fb as m,Ma as A,Oa as r,P as M,Qb as N,Ta as S,Tb as o,Ub as H,Vb as c,Wb as C,Za as F,ca as h,da as b,ec as p,f as $,gc as u,mb as U,na as y,nb as E,ob as f,pb as x,qb as v,rb as g,sb as O,wb as a,xb as t,yb as V,zb as I}from"./chunk-7RTQA4J5.js";import{i as P}from"./chunk-ODN5LVDJ.js";function Z(i,n){i&1&&(a(0,"div")(1,"p",3),o(2,"Cargando pacientes..."),t()())}function ee(i,n){if(i&1&&V(0,"img",7),i&2){let e=m().$implicit;B("src",e.paciente.urlImagenPerfil,A)}}function te(i,n){if(i&1&&(a(0,"li"),o(1),p(2,"date"),t()),i&2){let e=n.$implicit;r(),C(" \u2022 ",u(2,2,e.fechaHora,"short")," \u2013 ",e.especialidadNombre," ")}}function ie(i,n){if(i&1){let e=I();a(0,"div",6),T("click",function(){let l=h(e).$implicit,_=m(2);return b(_.seleccionarPaciente(l))})("keyup.enter",function(){let l=h(e).$implicit,_=m(2);return b(_.seleccionarPaciente(l))}),E(1,ee,1,1,"img",7),a(2,"div",8)(3,"p",9),o(4),t(),a(5,"p",10),o(6),t(),a(7,"p"),o(8),t(),a(9,"p"),o(10),t(),a(11,"p",11),o(12,"\xDAltimos 3 turnos:"),t(),a(13,"ul",12),v(14,te,3,5,"li",null,x),t(),a(16,"button",13),o(17," Ver historia cl\xEDnica "),t()()()}if(i&2){let e=n.$implicit;U("aria-label","Ver detalles de "+e.paciente.nombre),r(),f(e.paciente.urlImagenPerfil?1:-1),r(3),C(" ",e.paciente.nombre," ",e.paciente.apellido," "),r(2),H(e.paciente.email),r(2),c("DNI: ",e.paciente.dni),r(2),c("Edad: ",e.paciente.edad),r(4),g(e.citas)}}function ne(i,n){if(i&1&&(a(0,"div",2),v(1,ie,18,7,"div",5,x),t()),i&2){let e=m();r(),g(e.pacientesConCitas)}}function ae(i,n){i&1&&(a(0,"div",3),o(1," No se encontraron pacientes atendidos. "),t())}function oe(i,n){if(i&1&&(a(0,"li"),o(1),t()),i&2){let e=n.$implicit;r(),C("",e.clave,": ",e.valor)}}function re(i,n){if(i&1&&(a(0,"div",17)(1,"p")(2,"strong"),o(3,"Fecha:"),t(),o(4),p(5,"date"),t(),a(6,"p")(7,"strong"),o(8,"Especialidad:"),t(),o(9),t(),a(10,"p")(11,"strong"),o(12,"Altura:"),t(),o(13),p(14,"unidadMedida"),t(),a(15,"p")(16,"strong"),o(17,"Peso:"),t(),o(18),p(19,"unidadMedida"),t(),a(20,"p")(21,"strong"),o(22,"Temperatura:"),t(),o(23),p(24,"unidadMedida"),t(),a(25,"p")(26,"strong"),o(27,"Presi\xF3n arterial:"),t(),o(28),p(29,"unidadMedida"),t(),a(30,"p")(31,"strong"),o(32,"Datos din\xE1micos:"),t()(),a(33,"ul",18),v(34,oe,2,2,"li",null,x),t()()),i&2){let e=n.$implicit;r(4),c(" ",u(5,6,e.fechaHora,"short")),r(5),c(" ",e.especialidadNombre),r(4),c(" ",u(14,9,e.alturaCm,"altura")," "),r(5),c(" ",u(19,12,e.pesoKg,"peso")),r(5),c(" ",u(24,15,e.temperaturaC,"temperatura")," "),r(5),c(" ",u(29,18,e.presionArterial,"presion")," "),r(6),g(e.datosDinamicos)}}function de(i,n){if(i&1){let e=I();a(0,"div",4)(1,"button",14),T("click",function(){h(e);let l=m();return b(l.cerrarHistoriaClinica())}),o(2," \u2190 Volver a pacientes "),t(),a(3,"h2",15),o(4),t(),a(5,"div",16),v(6,re,36,21,"div",17,x),t()()}if(i&2){let e,d,l=m();O("@slideInRight",void 0),r(4),C(" Historia cl\xEDnica de ",(e=l.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.nombre," ",(e=l.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.apellido," "),r(2),g((d=l.pacienteSeleccionado())==null?null:d.citas)}}var G=class i{constructor(n,e,d){this.turnosService=n;this.authSupabase=e;this.usuariosService=d;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new $;citas=y([]);cargando=y(!0);pacientesConCitas=[];pacienteSeleccionado=y(null);ngOnInit(){this.usuario$.pipe(M(this.destroy$)).subscribe(n=>P(this,null,function*(){if(!n){this.usuarioActual=null;return}n.id=typeof n.id=="string"?Number(n.id):n.id,this.usuarioActual=n,yield this.cargarCitasYPacientes()}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitasYPacientes(){return P(this,null,function*(){this.cargando.set(!0);try{if(this.usuarioActual?.id==null){this.pacientesConCitas=[],this.cargando.set(!1);return}let e=(yield this.turnosService.obtenerCitasEspecialista(this.usuarioActual.id)).filter(s=>s.estado==="completado"),d=new Map;for(let s of e)d.has(s.pacienteId)||d.set(s.pacienteId,[]),d.get(s.pacienteId).push(s);let _=(yield this.usuariosService.obtenerTodosUsuarios()).filter(s=>s.rol==="paciente");this.pacientesConCitas=_.filter(s=>d.has(s.id)).map(s=>{let J=d.get(s.id).sort((Q,W)=>new Date(W.fechaHora).getTime()-new Date(Q.fechaHora).getTime()).slice(0,3);return{paciente:s,citas:J}})}catch(n){console.error("Error cargando citas y pacientes",n),this.pacientesConCitas=[]}finally{this.cargando.set(!1)}})}seleccionarPaciente(n){this.pacienteSeleccionado.set(n)}cerrarHistoriaClinica(){this.pacienteSeleccionado.set(null)}static \u0275fac=function(e){return new(e||i)(S(Y),S(R),S(q))};static \u0275cmp=F({type:i,selectors:[["app-pacientes"]],decls:6,vars:6,consts:[[1,"flex","h-full","w-full","gap-4","p-1"],[1,"h-full","min-w-0","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","pb-6","shadow-inner","transition-all","duration-700","ease-in-out"],[1,"flex","flex-wrap","justify-start","gap-6"],[1,"text-center","text-gray-500"],[1,"flex","h-full","w-full","flex-col","overflow-hidden","rounded-2xl","bg-white","p-6","transition-all","duration-700","ease-in-out","md:w-[35%]"],["tabindex","0","role","button",1,"h-auto","w-[300px]","cursor-pointer","rounded-lg","border","border-gray-300","bg-white","p-4","shadow-sm","transition","hover:shadow-md"],["tabindex","0","role","button",1,"h-auto","w-[300px]","cursor-pointer","rounded-lg","border","border-gray-300","bg-white","p-4","shadow-sm","transition","hover:shadow-md",3,"click","keyup.enter"],["alt","Avatar","appTrackImage","",1,"mb-2","h-14","w-14","rounded-full","object-cover",3,"src"],[1,"text-sm"],[1,"font-semibold","text-azul-oscuro"],[1,"text-gray-600"],[1,"mt-2","font-semibold","text-gray-700"],[1,"list-inside","list-disc","text-sm","text-gray-600"],["type","button",1,"mt-3","rounded","bg-indigo-600","px-3","py-1","text-sm","font-semibold","text-white","transition","hover:bg-indigo-700"],[1,"mb-4","self-start","rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","transition","hover:bg-gray-100",3,"click"],[1,"mb-4","text-xl","font-semibold","text-azul-oscuro"],[1,"overflow-y-auto","pr-2"],[1,"mb-4","rounded","border","border-gray-200","bg-gray-50","p-4"],[1,"list-inside","list-disc","text-sm"]],template:function(e,d){e&1&&(a(0,"div",0)(1,"div",1),E(2,Z,3,0,"div"),E(3,ne,3,0,"div",2),E(4,ae,2,0,"div",3),t(),E(5,de,8,3,"div",4),t()),e&2&&(r(),N("width",d.pacienteSeleccionado()?"65%":"100%"),r(),f(d.cargando()?2:-1),r(),f(!d.cargando()&&d.pacientesConCitas.length>0?3:-1),r(),f(!d.cargando()&&d.pacientesConCitas.length===0?4:-1),r(),f(d.pacienteSeleccionado()?5:-1))},dependencies:[z,X,j,K],encapsulation:2,data:{animation:[L("slideInRight",[k(":enter",[w({transform:"translateX(100%)",opacity:0}),D("600ms ease-in-out",w({transform:"translateX(0)",opacity:1}))]),k(":leave",[D("400ms ease-in",w({transform:"translateX(100%)",opacity:0}))])])]}})};export{G as Pacientes};
