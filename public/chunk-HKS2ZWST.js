import{a as O}from"./chunk-QYWCDNK3.js";import{b as P}from"./chunk-QU5QNJKE.js";import"./chunk-X5YLR3NI.js";import{Db as L,Jb as u,Kb as f,Lb as h,Oa as B,Tb as T,U as q,Z as v,Za as b,na as j,sb as N,tb as y,ub as m,vb as M,wb as S,xb as F,yb as E}from"./chunk-7RTQA4J5.js";import{a as V,b as k,i as d}from"./chunk-ODN5LVDJ.js";var C=class l{obtenerLogIngresos(){return d(this,null,function*(){let{data:t,error:e}=yield P.from("registro_ingresos").select("fecha_ingreso, perfil_id").order("fecha_ingreso",{ascending:!1});if(e||!t)return console.error("[Supabase] Error al obtener log de ingresos:",e?.message),[];let a=[...new Set(t.map(s=>s.perfil_id).filter(Boolean))],{data:r,error:o}=yield P.from("perfiles").select("id, nombre, apellido, rol").in("id",a);return o||!r?(console.error("[Supabase] Error al obtener perfiles:",o?.message),[]):t.map(s=>{let n=r.find(p=>p.id===s.perfil_id);return{fecha:s.fecha_ingreso,nombre:n?.nombre??"Desconocido",apellido:n?.apellido??"",rol:n?.rol??"N/A"}})})}obtenerTurnosPorEspecialidad(){return d(this,null,function*(){let{data:t,error:e}=yield P.from("citas").select("especialidad_id");if(e||!t)return console.error("[Supabase] Error al obtener turnos por especialidad:",e?.message),[];let a=[...new Set(t.map(n=>n.especialidad_id).filter(Boolean))],{data:r,error:o}=yield P.from("especialidades").select("id, nombre").in("id",a);if(o||!r)return console.error("[Supabase] Error al obtener especialidades:",o?.message),[];let s=new Map;for(let n of t)n.especialidad_id&&s.set(n.especialidad_id,(s.get(n.especialidad_id)??0)+1);return a.map(n=>({especialidad:r.find(i=>i.id===n)?.nombre??"Sin especialidad",cantidad:s.get(n)??0}))})}obtenerTurnosPorDia(){return d(this,null,function*(){let{data:t,error:e}=yield P.from("citas").select("fecha_hora");if(e||!t)return console.error("[Supabase] Error al obtener turnos por d\xEDa:",e?.message),[];let a=new Map;for(let r of t){let o=new Date(r.fecha_hora).toISOString().split("T")[0];a.set(o,(a.get(o)??0)+1)}return Array.from(a.entries()).map(([r,o])=>({fecha:r,cantidad:o}))})}obtenerTurnosPorMedico(t,e){return d(this,null,function*(){let{data:a,error:r}=yield P.from("citas").select("especialista_id").gte("fecha_hora",t).lte("fecha_hora",e);if(r||!a)return console.error("[Supabase] Error al obtener turnos por m\xE9dico:",r?.message),[];let o=[...new Set(a.map(i=>i.especialista_id).filter(Boolean))],{data:s,error:n}=yield P.from("perfiles").select("id, nombre, apellido").in("id",o);if(n||!s)return console.error("[Supabase] Error al obtener perfiles:",n?.message),[];let p=new Map;for(let i of a)i.especialista_id&&p.set(i.especialista_id,(p.get(i.especialista_id)??0)+1);return o.map(i=>{let c=s.find(w=>w.id===i);return{nombre:c?`${c.nombre} ${c.apellido}`:"Desconocido",cantidad:p.get(i)??0}})})}obtenerTurnosFinalizadosPorMedico(t,e){return d(this,null,function*(){let{data:a,error:r}=yield P.from("citas").select("especialista_id, estado").eq("estado","completado").gte("fecha_hora",t).lte("fecha_hora",e);if(r||!a)return console.error("[Supabase] Error al obtener turnos finalizados por m\xE9dico:",r?.message),[];let o=[...new Set(a.map(i=>i.especialista_id).filter(Boolean))],{data:s,error:n}=yield P.from("perfiles").select("id, nombre, apellido").in("id",o);if(n||!s)return console.error("[Supabase] Error al obtener perfiles:",n?.message),[];let p=new Map;for(let i of a)i.especialista_id&&p.set(i.especialista_id,(p.get(i.especialista_id)??0)+1);return o.map(i=>{let c=s.find(w=>w.id===i);return{nombre:c?`${c.nombre} ${c.apellido}`:"Desconocido",cantidad:p.get(i)??0}})})}static \u0275fac=function(e){return new(e||l)};static \u0275prov=q({token:l,factory:l.\u0275fac,providedIn:"root"})};var Z=["canvas"],R=class l{estadisticas=v(C);canvasRef;ngAfterViewInit(){return d(this,null,function*(){let{Chart:t,BarElement:e,BarController:a,CategoryScale:r,LinearScale:o,Tooltip:s,Legend:n}=yield import("./chunk-MBHQL6GC.js");t.register(e,a,r,o,s,n);let p=this.canvasRef.nativeElement,i=yield this.estadisticas.obtenerTurnosPorDia(),c=i.map(g=>g.fecha),w=i.map(g=>g.cantidad);new t(p,{type:"bar",data:{labels:c,datasets:[{label:"Turnos por D\xEDa",data:w,backgroundColor:"rgba(54, 162, 235, 0.7)"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}}}})})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=b({type:l,selectors:[["app-turnos-por-dia-chart"]],viewQuery:function(e,a){if(e&1&&u(Z,7),e&2){let r;f(r=h())&&(a.canvasRef=r.first)}},decls:2,vars:0,consts:[["canvas",""],[1,"mx-auto","h-64","w-full"]],template:function(e,a){e&1&&E(0,"canvas",1,0)},encapsulation:2})};var $=["canvas"],A=class l{estadisticas=v(C);chart;canvasRef;ngAfterViewInit(){this.render()}render(){return d(this,null,function*(){let{Chart:t,ArcElement:e,PieController:a,Tooltip:r,Legend:o}=yield import("./chunk-MBHQL6GC.js");t.register(e,a,r,o);let s=yield this.estadisticas.obtenerTurnosPorEspecialidad(),n=s.map(c=>c.especialidad),p=s.map(c=>c.cantidad),i=this.canvasRef.nativeElement;this.chart?.destroy(),this.chart=new t(i,{type:"pie",data:{labels:n,datasets:[{label:"Turnos por Especialidad",data:p,backgroundColor:["rgba(255, 99, 132, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1}})})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=b({type:l,selectors:[["app-turnos-por-especialidad-chart"]],viewQuery:function(e,a){if(e&1&&u($,7),e&2){let r;f(r=h())&&(a.canvasRef=r.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-64","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(S(0,"div",1),E(1,"canvas",2,0),F())},encapsulation:2})};var Y=["canvas"],x=class l{estadisticas=v(C);chart;canvasRef;render(t,e){return d(this,null,function*(){let{Chart:a,BarElement:r,BarController:o,CategoryScale:s,LinearScale:n,Tooltip:p,Legend:i}=yield import("./chunk-MBHQL6GC.js");a.register(r,o,s,n,p,i);let c=yield this.estadisticas.obtenerTurnosPorMedico(t,e),w=c.map(D=>D.nombre),g=c.map(D=>D.cantidad),_=this.canvasRef.nativeElement;this.chart?.destroy(),this.chart=new a(_,{type:"bar",data:{labels:w,datasets:[{label:"Turnos por M\xE9dico",data:g,backgroundColor:"rgba(75, 192, 192, 0.7)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}}}})})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=b({type:l,selectors:[["app-turnos-por-medico-chart"]],viewQuery:function(e,a){if(e&1&&u(Y,7),e&2){let r;f(r=h())&&(a.canvasRef=r.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-64","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(S(0,"div",1),E(1,"canvas",2,0),F())},encapsulation:2})};var G=["canvas"],z=class l{estadisticas=v(C);chart;canvasRef;render(t,e){return d(this,null,function*(){let{Chart:a,BarElement:r,BarController:o,CategoryScale:s,LinearScale:n,Tooltip:p,Legend:i}=yield import("./chunk-MBHQL6GC.js");a.register(r,o,s,n,p,i);let c=yield this.estadisticas.obtenerTurnosFinalizadosPorMedico(t,e),w=c.map(_=>_.nombre),g=c.map(_=>_.cantidad);this.chart?.destroy(),this.chart=new a(this.canvasRef.nativeElement,{type:"bar",data:{labels:w,datasets:[{label:"Turnos Finalizados por M\xE9dico",data:g,backgroundColor:"rgba(153, 102, 255, 0.7)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}}}})})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=b({type:l,selectors:[["app-turnos-finalizados-por-medico-chart"]],viewQuery:function(e,a){if(e&1&&u(G,7),e&2){let r;f(r=h())&&(a.canvasRef=r.first)}},decls:3,vars:0,consts:[["canvas",""],[1,"relative","h-64","w-full"],[1,"absolute","inset-0","h-full","w-full"]],template:function(e,a){e&1&&(S(0,"div",1),E(1,"canvas",2,0),F())},encapsulation:2})};var J=["canvas"],H=class l{estadisticas=v(C);canvas;ngAfterViewInit(){this.render()}render(){return d(this,null,function*(){let{Chart:t,BarElement:e,BarController:a,CategoryScale:r,LinearScale:o,Tooltip:s,Legend:n}=yield import("./chunk-MBHQL6GC.js");t.register(e,a,r,o,s,n);let i=(yield this.estadisticas.obtenerLogIngresos()).reduce((g,_)=>{let D=_.fecha.split("T")[0];return g[D]=(g[D]||0)+1,g},{}),c=Object.keys(i).sort(),w=c.map(g=>i[g]);new t(this.canvas.nativeElement,{type:"bar",data:{labels:c,datasets:[{label:"Ingresos al Sistema por D\xEDa",data:w,backgroundColor:"rgba(255, 159, 64, 0.7)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}}}})})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=b({type:l,selectors:[["app-log-ingreso-chart"]],viewQuery:function(e,a){if(e&1&&u(J,7),e&2){let r;f(r=h())&&(a.canvas=r.first)}},decls:2,vars:0,consts:[["canvas",""],[1,"mx-auto","h-64","w-full","max-w-xl"]],template:function(e,a){e&1&&E(0,"canvas",1,0)},encapsulation:2})};var W=class l{loading=v(O);rangoFechas=j({desde:"",hasta:""});turnosPorDiaChart;turnosPorEspecialidadChart;turnosPorMedicoChart;turnosFinalizadosChart;ngOnInit(){this.rangoFechas.set({desde:this.fechaDesdeInicioDeAnio(),hasta:this.fechaHastaFinDeAnio()})}ngAfterViewInit(){this.cargarDatos()}cargarDatos(){return d(this,null,function*(){this.loading.show();try{yield Promise.all([this.cargarTurnosPorMedico(),this.cargarTurnosFinalizados()])}finally{this.loading.hide()}})}onRangoFechasChange(){return d(this,null,function*(){this.loading.show();try{yield Promise.all([this.cargarTurnosPorMedico(),this.cargarTurnosFinalizados()])}finally{this.loading.hide()}})}cargarTurnosPorMedico(){return d(this,null,function*(){let{desde:t,hasta:e}=this.rangoFechas();yield this.turnosPorMedicoChart?.render(t,e)})}cargarTurnosFinalizados(){return d(this,null,function*(){let{desde:t,hasta:e}=this.rangoFechas();yield this.turnosFinalizadosChart?.render(t,e)})}onDesdeChange(t){let e=t.target;this.rangoFechas.set(k(V({},this.rangoFechas()),{desde:e.value}))}onHastaChange(t){let e=t.target;this.rangoFechas.set(k(V({},this.rangoFechas()),{hasta:e.value}))}fechaDesdeInicioDeAnio(){let t=new Date;return new Date(t.getFullYear(),0,1).toISOString().split("T")[0]}fechaHastaFinDeAnio(){let t=new Date;return new Date(t.getFullYear(),11,31).toISOString().split("T")[0]}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=b({type:l,selectors:[["app-home"]],viewQuery:function(e,a){if(e&1&&(u(R,5),u(A,5),u(x,5),u(z,5)),e&2){let r;f(r=h())&&(a.turnosPorDiaChart=r.first),f(r=h())&&(a.turnosPorEspecialidadChart=r.first),f(r=h())&&(a.turnosPorMedicoChart=r.first),f(r=h())&&(a.turnosFinalizadosChart=r.first)}},decls:32,vars:2,consts:[[1,"space-y-8","overflow-auto","p-4","text-sm"],[1,"text-2xl","font-bold","text-azul-oscuro"],[1,"mb-2","text-lg","font-semibold"],[1,"mb-4","flex","flex-wrap","items-center","gap-4"],["type","date",1,"rounded","border","px-2","py-1",3,"change","value"],[1,"hover:bg-azul-700","rounded","bg-azul-oscuro","px-3","py-1","text-white",3,"click"]],template:function(e,a){e&1&&(y(0,"div",0)(1,"h2",1),T(2,"Estad\xEDsticas del Sistema"),m(),y(3,"section")(4,"h3",2),T(5,"Turnos por D\xEDa"),m(),M(6,"app-turnos-por-dia-chart"),m(),y(7,"section")(8,"h3",2),T(9,"Turnos por Especialidad"),m(),M(10,"app-turnos-por-especialidad-chart"),m(),y(11,"section")(12,"h3",2),T(13,"Turnos por M\xE9dico"),m(),y(14,"div",3)(15,"label"),T(16," Desde: "),y(17,"input",4),L("change",function(o){return a.onDesdeChange(o)}),m()(),y(18,"label"),T(19," Hasta: "),y(20,"input",4),L("change",function(o){return a.onHastaChange(o)}),m()(),y(21,"button",5),L("click",function(){return a.onRangoFechasChange()}),T(22," Aplicar "),m()(),M(23,"app-turnos-por-medico-chart"),m(),y(24,"section")(25,"h3",2),T(26,"Turnos Finalizados por M\xE9dico"),m(),M(27,"app-turnos-finalizados-por-medico-chart"),m(),y(28,"section")(29,"h3",2),T(30,"Log de Ingresos"),m(),M(31,"app-log-ingreso-chart"),m()()),e&2&&(B(17),N("value",a.rangoFechas().desde),B(3),N("value",a.rangoFechas().hasta))},dependencies:[R,A,x,z,H],encapsulation:2})};export{W as Home};
