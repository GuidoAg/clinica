import"./chunk-GGQ7LRWG.js";import{a as K}from"./chunk-WZDOETQ3.js";import{c as M,d as P,f as A,g as V,h as j,i as L,j as U}from"./chunk-P2GLRHRS.js";import{a as q,b as G}from"./chunk-2R7LN7ZU.js";import{n as J}from"./chunk-4CBNAM3C.js";import{a as z}from"./chunk-QYWCDNK3.js";import{l as W}from"./chunk-ISKSCZVY.js";import"./chunk-X5YLR3NI.js";import"./chunk-J36EOOTC.js";import"./chunk-BJZ3VNWM.js";import"./chunk-EUZGYKR3.js";import{Db as x,Fb as l,Ma as I,Oa as r,P as $,Rb as v,Ta as C,Tb as c,Ub as k,Vb as N,Wb as H,Za as O,ca as b,da as g,f as F,mc as y,na as d,nb as m,ob as h,pb as T,qb as E,rb as w,sb as D,tb as o,ub as s,vb as _,zb as S}from"./chunk-7RTQA4J5.js";import{i as p}from"./chunk-ODN5LVDJ.js";function B(t,a){return p(this,null,function*(){t.set(!0);try{return yield a()}finally{t.set(!1)}})}function Z(t,a){if(t&1){let e=S();o(0,"button",8),x("click",function(){let n=b(e).$implicit,u=l(2);return g(u.seleccionarEspecialista(n))}),_(1,"img",9),o(2,"span",10),c(3),s()()}if(t&2){let e,i=a.$implicit,n=l(2);v("opacity-50",n.especialistaSeleccionado()&&n.especialistaSeleccionado().id!==i.id),r(),v("border-blue-600",((e=n.especialistaSeleccionado())==null?null:e.id)===i.id),D("src",i.imagenPerfil||"assets/default-avatar.png",I),r(2),H("",i.nombre," ",i.apellido)}}function ee(t,a){if(t&1&&(o(0,"div")(1,"h2",5),c(2," Seleccion\xE1 un profesional "),s(),o(3,"div",6),E(4,Z,4,7,"button",7,T),s()()),t&2){let e=l();r(4),w(e.especialistasValidados())}}function ie(t,a){t&1&&(o(0,"div",3)(1,"p",11),c(2," No se encontraron especialistas con fechas disponibles en los pr\xF3ximos 15 d\xEDas. "),s()())}function te(t,a){if(t&1){let e=S();o(0,"button",14),x("click",function(){let n=b(e).$implicit,u=l(2);return g(u.seleccionarEspecialidad(n))}),_(1,"img",15),o(2,"span",16),c(3),s()()}if(t&2){let e,i=a.$implicit,n=l(2);v("border-blue-600",((e=n.especialidadSeleccionada())==null?null:e.id)===i.id)("opacity-50",n.especialidadSeleccionada()&&n.especialidadSeleccionada().id!==i.id),D("@especialidadAnimacion",void 0),r(),D("src",i.icono||"assets/default-icon.png",I),r(2),k(i.nombre)}}function ae(t,a){t&1&&(o(0,"p",13),c(1," No hay especialidades disponibles. "),s())}function ne(t,a){if(t&1&&(o(0,"div")(1,"h2",5),c(2," ---- Seleccion\xE1 una especialidad ---- "),s(),o(3,"div",6),E(4,te,4,7,"button",12,T),s(),m(6,ae,2,0,"p",13),s()),t&2){let e=l();r(3),D("@listaAnimacion",void 0),r(),w(e.especialidades()),r(2),h(e.noHayEspecialidades()?6:-1)}}function oe(t,a){if(t&1){let e=S();o(0,"button",19),x("click",function(){let n=b(e).$implicit,u=l(2);return g(u.seleccionarFecha(n))}),c(1),s()}if(t&2){let e=a.$implicit,i=l(2);v("bg-blue-600",i.fechaSeleccionada()===e)("text-white",i.fechaSeleccionada()===e),r(),N(" ",e," ")}}function se(t,a){t&1&&(o(0,"p",13),c(1,"No hay d\xEDas disponibles."),s())}function re(t,a){if(t&1&&(o(0,"div")(1,"h2",5),c(2," ---- Seleccion\xE1 un d\xEDa ---- "),s(),o(3,"div",17),E(4,oe,2,5,"button",18,T),s(),m(6,se,2,0,"p",13),s()),t&2){let e=l();r(4),w(e.fechasDisponibles()),r(2),h(e.noHayFechas()?6:-1)}}function ce(t,a){if(t&1){let e=S();o(0,"button",21),x("click",function(){let n=b(e).$implicit,u=l(2);return g(u.seleccionarHorario(n))}),c(1),s()}if(t&2){let e=a.$implicit,i=l(2);v("bg-green-500",i.horaSelecionada()===e)("text-white",i.horaSelecionada()===e),r(),N(" ",e," ")}}function le(t,a){t&1&&(o(0,"p",13),c(1," No hay turnos disponibles. "),s())}function de(t,a){if(t&1&&(o(0,"div")(1,"h2",5),c(2," ---- Seleccion\xE1 un horario ---- "),s(),o(3,"div",17),E(4,ce,2,5,"button",20,T),s(),m(6,le,2,0,"p",13),s()),t&2){let e=l();r(4),w(e.horariosDisponibles()),r(2),h(e.noHayHorarios()?6:-1)}}function pe(t,a){if(t&1){let e=S();o(0,"div",4)(1,"p",22),c(2," Seleccionaste: "),o(3,"strong"),c(4),s(),_(5,"br"),c(6," Especialidad: "),o(7,"strong"),c(8),s(),_(9,"br"),c(10," D\xEDa: "),o(11,"strong"),c(12),s(),_(13,"br"),c(14," Hora: "),o(15,"strong"),c(16),s()(),o(17,"div",23)(18,"button",24),x("click",function(){b(e);let n=l();return g(n.cargarCita())}),c(19," Confirmar "),s()()()}if(t&2){let e,i,n=l();r(4),H("",(e=n.especialistaSeleccionado())==null?null:e.nombre," ",(e=n.especialistaSeleccionado())==null?null:e.apellido),r(4),k((i=n.especialidadSeleccionada())==null?null:i.nombre),r(4),k(n.fechaSeleccionada()),r(4),k(n.horaSelecionada())}}var Q=class t{constructor(a,e,i,n){this.turnosService=a;this.loadin=e;this.authSupabase=i;this.snackBar=n;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new F;especialistas=d([]);especialidades=d([]);fechasDisponibles=d([]);horariosDisponibles=d([]);especialistaSeleccionado=d(null);especialidadSeleccionada=d(null);fechaSeleccionada=d(null);horaSelecionada=d(null);especialidadesBuscadas=d(!1);diasBuscados=d(!1);horasBuscadas=d(!1);especialistasBuscados=d(!1);cargando=d(!1);especialistasValidados=y(()=>this.especialistas().filter(a=>a.validadoAdmin===!0));noHayEspecialistas=y(()=>this.especialistasBuscados()===!0&&this.especialistas().length===0);noHayEspecialidades=y(()=>this.especialistaSeleccionado()!==null&&this.especialidadesBuscadas()===!0&&this.especialidades().length===0);noHayFechas=y(()=>this.especialidadSeleccionada()!==null&&this.diasBuscados()===!0&&this.fechasDisponibles().length===0);noHayHorarios=y(()=>this.fechaSeleccionada()!==null&&this.horasBuscadas()===!0&&this.horariosDisponibles().length===0);ngOnInit(){return p(this,null,function*(){this.usuario$.pipe($(this.destroy$)).subscribe(i=>{if(!i){this.usuarioActual=null;return}i.id=typeof i.id=="string"?Number(i.id):i.id,this.usuarioActual=i});let e=(yield this.turnosService.obtenerEspecialistas()).filter(i=>i.validadoAdmin===!0&&i.activo===!0);this.especialistas.set(e),this.especialistasBuscados.set(!0),this.loadin.hide()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}seleccionarEspecialista(a){return p(this,null,function*(){this.especialistaSeleccionado.set(a),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.fechasDisponibles.set([]),this.especialidadesBuscadas.set(!1),this.diasBuscados.set(!1),this.horasBuscadas.set(!1),yield B(this.cargando,()=>p(this,null,function*(){let e=yield this.turnosService.obtenerEspecialidadesDeEspecialista(a.id);this.especialidades.set(e),this.especialidadesBuscadas.set(!0)}))})}seleccionarEspecialidad(a){return p(this,null,function*(){this.especialidadSeleccionada.set(a),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),yield B(this.cargando,()=>p(this,null,function*(){let e=yield this.turnosService.obtenerFechasConHorariosDisponibles(this.especialistaSeleccionado().id,a.duracion,15,new Date,this.usuarioActual?.id);this.fechasDisponibles.set(e),this.diasBuscados.set(!0)}))})}seleccionarFecha(a){return p(this,null,function*(){this.horaSelecionada.set(null),this.fechaSeleccionada.set(a),yield B(this.cargando,()=>p(this,null,function*(){let e=yield this.turnosService.obtenerHorariosDisponibles(a,this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion,this.usuarioActual?.id);this.horariosDisponibles.set(e),this.horasBuscadas.set(!0)}))})}seleccionarHorario(a){this.horaSelecionada.set(a)}cargarCita(){return p(this,null,function*(){let a=this.fechaSeleccionada(),e=this.horaSelecionada(),i=this.especialistaSeleccionado(),n=this.especialidadSeleccionada(),u=this.usuarioActual;if(!a||!e||!i||!n||!u){console.error("Datos incompletos para agendar la cita");return}let R={fechaHora:new Date(`${a}T${e}:00`),duracionMin:n.duracion,pacienteId:u.id,especialistaId:i.id,especialidadId:n.id,estado:"solicitado",comentarioPaciente:" ",comentarioEspecialista:" ",resenia:" "};try{let f=yield this.turnosService.darAltaCita(R);if(f.success)this.snackBar.open("Cita agendada exitosamente","\u2713",{duration:4e3,panelClass:["bg-green-600","text-white"]}),this.especialistaSeleccionado.set(null),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null);else{let X=f.errorCode==="horario_no_disponible"?"El horario seleccionado ya no est\xE1 disponible. Por favor, selecciona otro horario.":f.message||"No se pudo agendar la cita";this.snackBar.open(X,"\u2715",{duration:6e3,panelClass:["bg-red-600","text-white"]}),f.errorCode==="horario_no_disponible"&&(this.horaSelecionada.set(null),yield B(this.cargando,()=>p(this,null,function*(){let Y=yield this.turnosService.obtenerHorariosDisponibles(this.fechaSeleccionada(),this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion,this.usuarioActual?.id);this.horariosDisponibles.set(Y)})))}}catch(f){console.error("Error al cargar la cita:",f),this.snackBar.open("Error inesperado al procesar la solicitud","\u2715",{duration:4e3,panelClass:["bg-red-600","text-white"]})}})}static \u0275fac=function(e){return new(e||t)(C(K),C(z),C(W),C(J))};static \u0275cmp=O({type:t,selectors:[["app-solicitar-turno"]],decls:10,vars:6,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mx-auto","max-w-4xl","space-y-8","p-4"],[1,"text-center"],[1,"mt-8","text-center"],[1,"mb-4","text-center","text-xl","font-semibold"],[1,"flex","flex-wrap","justify-center","gap-4"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"opacity-50"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"click"],["alt","profesional","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],[1,"text-center","text-sm"],[1,"text-lg","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","hover:bg-blue-50",3,"border-blue-600","opacity-50"],[1,"mt-4","text-center","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","hover:bg-blue-50",3,"click"],["alt","icono","appTrackImage","",1,"mb-2","h-10","w-10",3,"src"],[1,"text-center","text-xs"],[1,"flex","flex-wrap","justify-center","gap-2"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"bg-blue-600","text-white"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"click"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"bg-green-500","text-white"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"click"],[1,"text-sm","text-gray-600"],[1,"pt-4"],[1,"rounded","bg-blue-200","px-4","py-2","text-lg","font-medium","hover:bg-blue-300",3,"click"]],template:function(e,i){e&1&&(o(0,"app-loading-wrapper")(1,"div",0)(2,"div",1)(3,"div",2),m(4,ee,6,0,"div"),m(5,ie,3,0,"div",3),m(6,ne,7,2,"div"),m(7,re,7,1,"div"),m(8,de,7,1,"div"),m(9,pe,20,5,"div",4),s()()()()),e&2&&(r(4),h(i.especialistas().length?4:-1),r(),h(i.noHayEspecialistas()?5:-1),r(),h(i.especialistaSeleccionado()?6:-1),r(),h(i.especialidadSeleccionada()?7:-1),r(),h(i.fechaSeleccionada()?8:-1),r(),h(i.horaSelecionada()?9:-1))},dependencies:[q,G],encapsulation:2,data:{animation:[M("especialidadAnimacion",[V(":enter",[A({opacity:0,transform:"scale(0.5)"}),P("400ms cubic-bezier(0.34, 1.56, 0.64, 1)",A({opacity:1,transform:"scale(1)"}))])]),M("listaAnimacion",[V(":enter",[L("@especialidadAnimacion",U(150,j()),{optional:!0})])])]}})};export{Q as SolicitarTurno};
