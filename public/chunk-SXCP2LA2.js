import{a as re,b as ne}from"./chunk-DZUCOP4O.js";import{a as ae}from"./chunk-KLTD2K6X.js";import{a as N}from"./chunk-WZDOETQ3.js";import{a as ie}from"./chunk-EVSMGOY5.js";import{n as te}from"./chunk-4CBNAM3C.js";import{l as ee}from"./chunk-ISKSCZVY.js";import"./chunk-X5YLR3NI.js";import"./chunk-J36EOOTC.js";import{c as V,e as y,g as A,h as K,j as I,k as Q,n as J,o as X,v as Y,w as D,x as Z}from"./chunk-ET4QANTK.js";import"./chunk-BJZ3VNWM.js";import{h as q,i as U,j as H}from"./chunk-EUZGYKR3.js";import{Db as m,Fb as s,Oa as c,P as $,Qb as L,Ta as h,Tb as l,Ub as j,Vb as p,Xb as E,Yb as F,Za as P,Zb as T,ca as d,da as u,eb as O,ec as v,f as W,fc as G,gc as w,na as C,nb as f,ob as _,pb as k,qb as S,rb as M,sb as b,tb as r,ub as n,vb as R,zb as g}from"./chunk-7RTQA4J5.js";import{i as B}from"./chunk-ODN5LVDJ.js";function ue(i,t){if(i&1){let e=g();r(0,"button",9),m("click",function(){d(e);let o=s(2);return u(o.mostrarFormularioCancelar=!0)}),l(1," Cancelar turno "),n()}}function me(i,t){if(i&1){let e=g();r(0,"button",10),m("click",function(){d(e);let o=s(2);return u(o.verResenia())}),l(1," Ver rese\xF1a "),n()}}function pe(i,t){if(i&1){let e=g();r(0,"button",11),m("click",function(){d(e);let o=s(2);return u(o.mostrarFormularioEncuesta=!0)}),l(1," Completar encuesta "),n()}}function fe(i,t){if(i&1){let e=g();r(0,"button",12),m("click",function(){d(e);let o=s(2);return u(o.mostrarFormularioCalificar=!0)}),l(1," Calificar atenci\xF3n "),n()}}function _e(i,t){if(i&1&&(r(0,"div",2),f(1,ue,2,0,"button",5),f(2,me,2,0,"button",6),f(3,pe,2,0,"button",7),f(4,fe,2,0,"button",8),n()),i&2){let e=s();c(),_(e.puedeCancelar?1:-1),c(),_(e.puedeVerResenia?2:-1),c(),_(e.puedeCompletarEncuesta?3:-1),c(),_(e.puedeCalificar?4:-1)}}function xe(i,t){if(i&1){let e=g();r(0,"div",2)(1,"textarea",13),T("ngModelChange",function(o){d(e);let x=s();return F(x.comentarioCancelar,o)||(x.comentarioCancelar=o),u(o)}),n(),r(2,"div",14)(3,"button",15),m("click",function(){d(e);let o=s();return u(o.cancelarAccionCancelar())}),l(4," Cancelar "),n(),r(5,"button",16),m("click",function(){d(e);let o=s();return u(o.confirmarCancelarTurno())}),l(6," Confirmar cancelaci\xF3n "),n()()()}if(i&2){let e=s();c(),E("ngModel",e.comentarioCancelar),c(4),b("disabled",!e.comentarioCancelar.trim()||e.cargando())}}function ge(i,t){if(i&1){let e=g();r(0,"form",17),m("ngSubmit",function(){d(e);let o=s();return u(o.enviarEncuesta())}),r(1,"h3",18),l(2,"Encuesta"),n(),R(3,"input",19)(4,"input",20)(5,"textarea",21)(6,"textarea",22)(7,"textarea",23),r(8,"div",24)(9,"button",15),m("click",function(){d(e);let o=s();return u(o.cancelarAccionEncuesta())}),l(10," Cancelar "),n(),r(11,"button",25),l(12," Enviar encuesta "),n()()()}if(i&2){let e=s();b("formGroup",e.encuestaForm),c(11),b("disabled",e.encuestaForm.invalid||e.cargando())}}function Ce(i,t){if(i&1){let e=g();r(0,"div",2)(1,"textarea",26),T("ngModelChange",function(o){d(e);let x=s();return F(x.comentarioCalificar,o)||(x.comentarioCalificar=o),u(o)}),n(),r(2,"div",14)(3,"button",15),m("click",function(){d(e);let o=s();return u(o.cancelarAccionCalificar())}),l(4," Cancelar "),n(),r(5,"button",27),m("click",function(){d(e);let o=s();return u(o.confirmarCalificarAtencion())}),l(6," Enviar calificaci\xF3n "),n()()()}if(i&2){let e=s();c(),E("ngModel",e.comentarioCalificar),c(4),b("disabled",!e.comentarioCalificar.trim()||e.cargando())}}function be(i,t){if(i&1){let e=g();r(0,"div",4)(1,"h3",28),l(2," Rese\xF1a "),n(),r(3,"p",29),l(4),n(),r(5,"button",30),m("click",function(){d(e);let o=s();return u(o.volverDesdeVistaResenia())}),l(6," Volver "),n()()}if(i&2){let e=s();c(4),p(" ",e.cita.resenia||"No se ha dejado una rese\xF1a para este turno."," ")}}var z=class i{constructor(t,e,a){this.turnos=t;this.fb=e;this.snackBar=a}cita;cerrar=new O;accionRealizada=new O;cargando=C(!1);mostrarFormularioCancelar=!1;mostrarFormularioEncuesta=!1;mostrarFormularioCalificar=!1;mostrarFormularioResenia=!1;comentarioCancelar="";comentarioCalificar="";encuestaForm;ngOnInit(){this.encuestaForm=this.fb.group({nombre:["",y.required],telefono:["",[y.required,y.pattern(/^\d+$/)]],pregunta1:["",y.required],pregunta2:["",y.required],pregunta3:["",y.required]})}get puedeCancelar(){return this.cita.estado!=="completado"&&this.cita.estado!=="cancelado"&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioEncuesta&&!this.mostrarFormularioCalificar}get puedeVerResenia(){return!!this.cita.resenia&&this.cita.resenia.trim().length>0}get puedeCompletarEncuesta(){return this.cita.estado==="completado"&&(!this.cita.resenia||this.cita.resenia.trim()==="")&&this.puedeVerResenia&&!this.mostrarFormularioEncuesta&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioCalificar}get puedeCalificar(){return this.cita.estado==="completado"&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioEncuesta}cancelarAccionCancelar(){this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}confirmarCancelarTurno(){this.comentarioCancelar.trim()&&(this.cargando.set(!0),this.turnos.cancelarCitaPaciente(this.cita,this.comentarioCancelar.trim()).then(t=>{this.cargando.set(!1),t.success?(this.snackBar.open("Turno cancelado exitosamente.","Cerrar",{duration:3e3}),this.accionRealizada.emit("cancelado"),this.cerrar.emit()):this.snackBar.open(t.message??"Ocurri\xF3 un error","Cerrar",{duration:4e3})}).finally(()=>{this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}))}mostrarEncuesta(){this.mostrarFormularioEncuesta=!0}cancelarAccionEncuesta(){this.mostrarFormularioEncuesta=!1,this.encuestaForm.reset()}enviarEncuesta(){if(this.encuestaForm.invalid)return;this.cargando.set(!0);let t=this.encuestaForm.value;t.id=this.cita.citaId,this.turnos.cargarEncuesta(this.cita,t).then(e=>{this.cargando.set(!1),e.success?(this.snackBar.open("Encuesta registrada exitosamente.","Cerrar",{duration:3e3}),this.accionRealizada.emit("encuesta"),this.cerrar.emit()):this.snackBar.open(e.message??"Ocurri\xF3 un error","Cerrar",{duration:4e3})}).finally(()=>{this.mostrarFormularioEncuesta=!1,this.encuestaForm.reset()})}cancelarAccionCalificar(){this.mostrarFormularioCalificar=!1,this.comentarioCalificar=""}confirmarCalificarAtencion(){this.comentarioCalificar.trim()&&(this.cargando.set(!0),this.turnos.cargarComentarioAtencion(this.cita,this.comentarioCalificar.trim()).then(t=>{this.cargando.set(!1),t.success?(this.snackBar.open("Atenci\xF3n calificada exitosamente.","Cerrar",{duration:3e3}),this.accionRealizada.emit("calificacion"),this.cerrar.emit()):this.snackBar.open(t.message??"Ocurri\xF3 un error","Cerrar",{duration:4e3})}).finally(()=>{this.mostrarFormularioCalificar=!1,this.comentarioCalificar=""}))}verResenia(){this.mostrarFormularioResenia=!0}volverDesdeVistaResenia(){this.mostrarFormularioResenia=!1}cerrarModal(){this.cerrar.emit()}static \u0275fac=function(e){return new(e||i)(h(N),h(Y),h(te))};static \u0275cmp=P({type:i,selectors:[["app-acciones-paciente"]],inputs:{cita:"cita"},outputs:{cerrar:"cerrar",accionRealizada:"accionRealizada"},decls:7,vars:5,consts:[["tabindex","0","role","button","aria-label","Cerrar modal",1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm"],["appClickFueraPopup","","tabindex","0","role","dialog","aria-modal","true",1,"fixed","top-1/2","left-1/2","z-50","w-full","max-w-md","-translate-x-1/2","-translate-y-1/2","transform","items-center","justify-center","rounded-2xl","bg-white","p-11","shadow-lg",3,"clickFuera"],[1,"flex","flex-col","gap-3"],[1,"flex","flex-col","gap-3",3,"formGroup"],[1,"flex","flex-col","items-center","gap-4","text-center"],[1,"rounded-lg","bg-red-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-red-700"],[1,"rounded-lg","bg-blue-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-blue-700"],[1,"rounded-lg","bg-green-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-green-700"],[1,"rounded-lg","bg-purple-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-purple-700"],[1,"rounded-lg","bg-red-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-red-700",3,"click"],[1,"rounded-lg","bg-blue-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-blue-700",3,"click"],[1,"rounded-lg","bg-green-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-green-700",3,"click"],[1,"rounded-lg","bg-purple-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-purple-700",3,"click"],["placeholder","Ingrese el motivo de cancelaci\xF3n","rows","3",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-red-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-3"],["type","button",1,"rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],["type","button",1,"rounded","bg-red-600","px-4","py-2","text-sm","font-semibold","text-white","hover:bg-red-700","disabled:opacity-50",3,"click","disabled"],[1,"flex","flex-col","gap-3",3,"ngSubmit","formGroup"],[1,"mb-2","text-lg","font-semibold","text-gray-700"],["formControlName","nombre","type","text","placeholder","Tu nombre",1,"w-full","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-green-500","focus:outline-none"],["formControlName","telefono","type","tel","placeholder","Tu tel\xE9fono",1,"w-full","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-green-500","focus:outline-none"],["formControlName","pregunta1","placeholder","\xBFC\xF3mo calificar\xEDas el trato recibido?","rows","2",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-green-500","focus:outline-none"],["formControlName","pregunta2","placeholder","\xBFQuedaste conforme con el diagn\xF3stico?","rows","2",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-green-500","focus:outline-none"],["formControlName","pregunta3","placeholder","\xBFVolver\xEDas a atenderte con este especialista?","rows","2",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-green-500","focus:outline-none"],[1,"mt-3","flex","justify-end","gap-3"],["type","submit",1,"rounded","bg-green-600","px-4","py-2","text-sm","font-semibold","text-white","hover:bg-green-700","disabled:opacity-50",3,"disabled"],["placeholder","Dej\xE1 un comentario sobre la atenci\xF3n recibida","rows","3",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-purple-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","button",1,"rounded","bg-purple-600","px-4","py-2","text-sm","font-semibold","text-white","hover:bg-purple-700","disabled:opacity-50",3,"click","disabled"],[1,"text-xl","font-bold","text-[color:var(--color-azul-oscuro)]"],[1,"px-2","text-gray-700","italic"],[1,"mt-4","rounded","bg-gray-300","px-4","py-2","text-sm","font-semibold","text-gray-800","hover:bg-gray-400",3,"click"]],template:function(e,a){e&1&&(R(0,"div",0),r(1,"div",1),m("clickFuera",function(){return a.cerrarModal()}),f(2,_e,5,4,"div",2),f(3,xe,7,2,"div",2),f(4,ge,13,2,"form",3),f(5,Ce,7,2,"div",2),f(6,be,7,1,"div",4),n()),e&2&&(c(2),_(!a.mostrarFormularioCancelar&&!a.mostrarFormularioEncuesta&&!a.mostrarFormularioCalificar&&!a.mostrarFormularioResenia?2:-1),c(),_(a.mostrarFormularioCancelar?3:-1),c(),_(a.mostrarFormularioEncuesta?4:-1),c(),_(a.mostrarFormularioCalificar?5:-1),c(),_(a.mostrarFormularioResenia?6:-1))},dependencies:[D,Q,V,A,K,I,Z,J,X,ie],encapsulation:2})};function he(i,t){if(i&1){let e=g();r(0,"app-acciones-paciente",11),m("cerrar",function(){d(e);let o=s();return u(o.cerrarPopupAcciones())})("accionRealizada",function(){d(e);let o=s();return u(o.accionDesdeModal())}),n()}if(i&2){let e=s();b("cita",e.citaSeleccionada())}}function ve(i,t){if(i&1&&(r(0,"th",10),l(1),n()),i&2){let e=t.$implicit;c(),j(e.label)}}function ye(i,t){if(i&1&&(r(0,"div")(1,"strong"),l(2),n(),l(3),n()),i&2){let e=t.$implicit;c(2),p("",e.clave,":"),c(),p(" ",e.valor)}}function we(i,t){if(i&1&&(r(0,"tr")(1,"td",19)(2,"div",20),S(3,ye,4,2,"div",null,k),n()()()),i&2){let e=s().$implicit;c(3),M(e.datosDinamicos)}}function Ee(i,t){if(i&1){let e=g();r(0,"tr",12),m("click",function(){let o=d(e).$implicit,x=s(2);return u(x.toggleFilaExpandida(o.citaId))}),r(1,"td",13),l(2),n(),r(3,"td",13),l(4),v(5,"date"),n(),r(6,"td",14),l(7),v(8,"titlecase"),n(),r(9,"td",13),l(10),v(11,"unidadMedida"),n(),r(12,"td",13),l(13),v(14,"unidadMedida"),n(),r(15,"td",13),l(16),v(17,"unidadMedida"),n(),r(18,"td",13),l(19),v(20,"unidadMedida"),n(),r(21,"td",13),l(22),n(),r(23,"td",13),l(24),n(),r(25,"td",13),l(26),n(),r(27,"td",15)(28,"button",16),l(29),n()(),r(30,"td",17)(31,"button",18),m("click",function(){let o=d(e).$implicit,x=s(2);return u(x.abrirPopupAcciones(o))}),l(32," Acciones "),n()()(),f(33,we,5,0,"tr")}if(i&2){let e=t.$implicit,a=s(2);L("background-color",a.filaExpandida()===e.citaId?"rgba(46, 64, 45, 0.2)":null),c(2),j(e.citaId),c(2),p(" ",w(5,15,e.fechaHora,"short")," "),c(2),b("appColorEstado",e.estado),c(),p(" ",G(8,18,e.estado)," "),c(3),p(" ",w(11,20,e.alturaCm,"altura")," "),c(3),p(" ",w(14,23,e.pesoKg,"peso")," "),c(3),p(" ",w(17,26,e.temperaturaC,"temperatura")," "),c(3),p(" ",w(20,29,e.presionArterial,"presion")," "),c(3),p(" ",e.pacienteNombreCompleto," "),c(2),p(" ",e.especialistaNombreCompleto," "),c(2),p(" ",e.especialidadNombre," "),c(3),p(" ",a.filaExpandida()===e.citaId?"Ocultar":"Mostrar"," "),c(4),_(a.filaExpandida()===e.citaId?33:-1)}}function Fe(i,t){if(i&1&&S(0,Ee,34,32,null,null,k),i&2){let e=s();M(e.citasFiltradas)}}function Te(i,t){i&1&&(r(0,"tr")(1,"td",21),l(2," Cargando datos... "),n()())}var oe=class i{constructor(t,e){this.turnosService=t;this.authSupabase=e;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new W;citas=C([]);filaExpandida=C(null);cargando=C(!0);citaSeleccionada=C(null);mostrarPopupAcciones=!1;columnas=[{key:"citaId",label:"ID"},{key:"fechaHora",label:"Fecha/Hora"},{key:"estado",label:"Estado"},{key:"alturaCm",label:"Altura"},{key:"pesoKg",label:"Peso"},{key:"temperaturaC",label:"Temperatura"},{key:"presionArterial",label:"Presi\xF3n arterial"},{key:"pacienteNombreCompleto",label:"Paciente"},{key:"especialistaNombreCompleto",label:"Especialista"},{key:"especialidadNombre",label:"Especialidad"}];columnasConDatosDinamicos=[...this.columnas,{key:"datosDinamicos",label:"Datos din\xE1micos"}];_filtroValor=C("");get filtroValorModel(){return this._filtroValor()}set filtroValorModel(t){this._filtroValor.set(t)}ngOnInit(){return B(this,null,function*(){this.usuario$.pipe($(this.destroy$)).subscribe(t=>{if(!t){this.usuarioActual=null;return}t.id=typeof t.id=="string"?Number(t.id):t.id,this.usuarioActual=t,this.cargarCitas()})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitas(){return B(this,null,function*(){this.cargando.set(!0);try{if(this.usuarioActual?.id!=null){let t=yield this.turnosService.obtenerCitasPaciente(this.usuarioActual.id);this.citas.set(t)}}catch(t){console.error("Error al obtener citas",t)}finally{this.cargando.set(!1)}})}toggleFilaExpandida(t){this.filaExpandida.set(this.filaExpandida()===t?null:t)}get citasFiltradas(){return ne(this.citas(),this._filtroValor())}limpiarFiltro(){this._filtroValor.set("")}abrirPopupAcciones(t){this.citaSeleccionada.set(t),this.mostrarPopupAcciones=!0}cerrarPopupAcciones(){this.mostrarPopupAcciones=!1,this.citaSeleccionada.set(null)}accionDesdeModal(){this.cerrarPopupAcciones(),this.cargarCitas()}static \u0275fac=function(e){return new(e||i)(h(N),h(ee))};static \u0275cmp=P({type:i,selectors:[["app-mis-turnos-paciente"]],decls:18,vars:3,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-[color:var(--color-crema)]","p-6","shadow-inner"],[1,"mb-4","flex","flex-wrap","items-center","gap-3"],["for","filtro",1,"text-sm","font-semibold","text-[color:var(--color-azul-oscuro)]"],["id","filtro","type","text","placeholder","Ingres\xE1 filtro",1,"w-64","rounded","border","border-gray-300","px-3","py-1","text-sm","focus:ring-2","focus:ring-[color:var(--color-azul-oscuro)]","focus:outline-none",3,"ngModelChange","ngModel"],["type","button",1,"rounded","bg-[color:var(--color-azul-oscuro)]","px-3","py-1","text-sm","font-semibold","text-white","shadow","transition-transform","hover:scale-105","hover:bg-[color:var(--color-azul-claro)]",3,"click"],[1,"ml-auto"],[3,"cita"],[1,"min-w-full","border-collapse","border","border-gray-300","text-sm"],[1,"bg-[color:var(--color-azul-claro)]","text-[color:var(--color-azul-oscuro)]"],[1,"border","border-gray-300","px-3","py-2"],[3,"cerrar","accionRealizada","cita"],[1,"cursor-pointer","border","border-gray-300","transition-colors","duration-150","hover:bg-[color:var(--color-verde-claro)]",3,"click"],[1,"border","border-gray-300","px-3","py-1"],[1,"rounded","border","border-gray-300","px-3","py-1","text-center","font-semibold",3,"appColorEstado"],[1,"border","border-gray-300","px-3","py-1","text-center"],["type","button",1,"text-[color:var(--color-azul-oscuro)]","underline","hover:text-[color:var(--color-azul-claro)]"],[1,"border","border-gray-300","bg-green-200","px-3","py-1","text-center","hover:bg-green-500"],["type","button",1,"font-bold","text-[color:var(--color-azul-oscuro)]","hover:text-[color:var(--color-white)]",3,"click"],["colspan","11",1,"border","border-gray-300","bg-[color:var(--color-crema)]","px-3","py-2","text-[color:var(--color-azul-oscuro)]"],[1,"grid","grid-cols-2","gap-4"],["colspan","11",1,"border","border-gray-300","px-3","py-6","text-center","font-semibold","text-[color:var(--color-azul-oscuro)]"]],template:function(e,a){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),l(4," Filtrar: "),n(),r(5,"input",4),T("ngModelChange",function(x){return F(a.filtroValorModel,x)||(a.filtroValorModel=x),x}),n(),r(6,"button",5),m("click",function(){return a.limpiarFiltro()}),l(7," Limpiar "),n(),r(8,"div",6),f(9,he,1,1,"app-acciones-paciente",7),n()(),r(10,"table",8)(11,"thead")(12,"tr",9),S(13,ve,2,1,"th",10,k),n()(),r(15,"tbody"),f(16,Fe,2,0)(17,Te,3,0,"tr"),n()()()()),e&2&&(c(5),E("ngModel",a.filtroValorModel),c(4),_(a.mostrarPopupAcciones&&a.citaSeleccionada()?9:-1),c(4),M(a.columnasConDatosDinamicos),c(3),_(a.cargando()?17:16))},dependencies:[H,D,V,A,I,z,re,q,U,ae],encapsulation:2})};export{oe as MisTurnosPaciente};
