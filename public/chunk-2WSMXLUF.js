import{a as R}from"./chunk-MGGKR3HB.js";import{a as Q}from"./chunk-VLDSBO4T.js";import{b as J}from"./chunk-ISZQ6G3H.js";import"./chunk-GGQ7LRWG.js";import{c as L,d as Y,f as D,g as z}from"./chunk-P2GLRHRS.js";import{b as q}from"./chunk-VPTHVLTQ.js";import{k as G}from"./chunk-YDT6XDAL.js";import"./chunk-LMZWYZYD.js";import{x as K}from"./chunk-3XECLLOM.js";import{i as H,j}from"./chunk-DDKTLT4U.js";import{Ab as w,Bb as V,Fb as I,Gb as m,Ma as $,Oa as d,P as M,Rb as T,Sb as A,Ta as g,Ub as r,Vb as B,Wb as c,Xb as b,Za as O,ca as S,da as y,f as k,gc as p,ic as u,mb as F,na as _,nb as E,ob as f,qb as x,rb as C,sb as h,tb as U,xb as a,yb as t,zb as N}from"./chunk-PTIYVII4.js";import{j as P}from"./chunk-K4ALXBGI.js";function te(n,i){n&1&&(a(0,"div")(1,"p",3),r(2,"Cargando pacientes..."),t()())}function ie(n,i){if(n&1&&N(0,"img",7),n&2){let e=m().$implicit;V("src",e.paciente.urlImagenPerfil,$)}}function ne(n,i){if(n&1&&(a(0,"li"),r(1),p(2,"date"),t()),n&2){let e=i.$implicit;d(),b(" \u2022 ",u(2,2,e.fechaHora,"short")," \u2013 ",e.especialidadNombre," ")}}function ae(n,i){if(n&1){let e=w();a(0,"div",6),I("click",function(){let l=S(e).$implicit,v=m(2);return y(v.seleccionarPaciente(l))})("keyup.enter",function(){let l=S(e).$implicit,v=m(2);return y(v.seleccionarPaciente(l))}),E(1,ie,1,1,"img",7),a(2,"div",8)(3,"p",9),r(4),t(),a(5,"p",10),r(6),t(),a(7,"p"),r(8),t(),a(9,"p"),r(10),t(),a(11,"p",11),r(12,"\xDAltimos 3 turnos:"),t(),a(13,"ul",12),C(14,ne,3,5,"li",null,x),t(),a(16,"button",13),r(17," Ver historia cl\xEDnica "),t()()()}if(n&2){let e=i.$implicit,o=m(2);A("pointer-events-none",o.panelAnimando()),U("@scaleIn",void 0),F("aria-label","Ver detalles de "+e.paciente.nombre),d(),f(e.paciente.urlImagenPerfil?1:-1),d(3),b(" ",e.paciente.nombre," ",e.paciente.apellido," "),d(2),B(e.paciente.email),d(2),c("DNI: ",e.paciente.dni),d(2),c("Edad: ",e.paciente.edad),d(4),h(e.citas)}}function oe(n,i){if(n&1&&(a(0,"div",2),C(1,ae,18,10,"div",5,x),t()),n&2){let e=m();d(),h(e.pacientesConCitas)}}function re(n,i){n&1&&(a(0,"div",3),r(1," No se encontraron pacientes atendidos. "),t())}function de(n,i){if(n&1&&(a(0,"li"),r(1),t()),n&2){let e=i.$implicit;d(),b("",e.clave,": ",e.valor)}}function se(n,i){if(n&1&&(a(0,"div",17)(1,"p")(2,"strong"),r(3,"Fecha:"),t(),r(4),p(5,"date"),t(),a(6,"p")(7,"strong"),r(8,"Especialidad:"),t(),r(9),t(),a(10,"p")(11,"strong"),r(12,"Altura:"),t(),r(13),p(14,"unidadMedida"),t(),a(15,"p")(16,"strong"),r(17,"Peso:"),t(),r(18),p(19,"unidadMedida"),t(),a(20,"p")(21,"strong"),r(22,"Temperatura:"),t(),r(23),p(24,"unidadMedida"),t(),a(25,"p")(26,"strong"),r(27,"Presi\xF3n arterial:"),t(),r(28),p(29,"unidadMedida"),t(),a(30,"p")(31,"strong"),r(32,"Datos din\xE1micos:"),t()(),a(33,"ul",18),C(34,de,2,2,"li",null,x),t()()),n&2){let e=i.$implicit;d(4),c(" ",u(5,6,e.fechaHora,"short")),d(5),c(" ",e.especialidadNombre),d(4),c(" ",u(14,9,e.alturaCm,"altura")," "),d(5),c(" ",u(19,12,e.pesoKg,"peso")),d(5),c(" ",u(24,15,e.temperaturaC,"temperatura")," "),d(5),c(" ",u(29,18,e.presionArterial,"presion")," "),d(6),h(e.datosDinamicos)}}function le(n,i){if(n&1){let e=w();a(0,"button",14),I("click",function(){S(e);let l=m();return y(l.cerrarHistoriaClinica())}),r(1," \u2190 Volver a pacientes "),t(),a(2,"h2",15),r(3),t(),a(4,"div",16),C(5,se,36,21,"div",17,x),t()}if(n&2){let e,o,l=m();d(3),b(" Historia cl\xEDnica de ",(e=l.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.nombre," ",(e=l.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.apellido," "),d(2),h((o=l.pacienteSeleccionado())==null?null:o.citas)}}var W=class n{constructor(i,e,o,l){this.turnosService=i;this.authSupabase=e;this.usuariosService=o;this.loading=l;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new k;citas=_([]);cargando=_(!0);pacientesConCitas=[];pacienteSeleccionado=_(null);panelAnimando=_(!1);ngOnInit(){this.usuario$.pipe(M(this.destroy$)).subscribe(i=>P(this,null,function*(){if(!i){this.usuarioActual=null;return}i.id=typeof i.id=="string"?Number(i.id):i.id,this.usuarioActual=i,yield this.cargarCitasYPacientes()}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitasYPacientes(){return P(this,null,function*(){this.cargando.set(!0);try{if(this.usuarioActual?.id==null){this.pacientesConCitas=[],this.cargando.set(!1);return}let e=(yield this.turnosService.obtenerCitasEspecialista(this.usuarioActual.id)).filter(s=>s.estado==="completado"),o=new Map;for(let s of e)o.has(s.pacienteId)||o.set(s.pacienteId,[]),o.get(s.pacienteId).push(s);let v=(yield this.usuariosService.obtenerTodosUsuarios()).filter(s=>s.rol==="paciente");this.pacientesConCitas=v.filter(s=>o.has(s.id)).map(s=>{let X=o.get(s.id).sort((Z,ee)=>new Date(ee.fechaHora).getTime()-new Date(Z.fechaHora).getTime()).slice(0,3);return{paciente:s,citas:X}})}catch(i){console.error("Error cargando citas y pacientes",i),this.pacientesConCitas=[]}finally{this.cargando.set(!1),this.loading.hide()}})}seleccionarPaciente(i){if(this.pacienteSeleccionado()!==null){this.pacienteSeleccionado.set(i);return}this.panelAnimando.set(!0),this.pacienteSeleccionado.set(i),setTimeout(()=>{this.panelAnimando.set(!1)},700)}cerrarHistoriaClinica(){this.panelAnimando.set(!0),this.pacienteSeleccionado.set(null),setTimeout(()=>{this.panelAnimando.set(!1)},700)}static \u0275fac=function(e){return new(e||n)(g(J),g(q),g(R),g(G))};static \u0275cmp=O({type:n,selectors:[["app-pacientes"]],decls:7,vars:14,consts:[[1,"flex","h-full","w-full","gap-4","p-1"],[1,"h-full","min-w-0","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","pb-6","shadow-inner","transition-all","duration-700","ease-in-out"],[1,"grid","gap-6","transition-all","duration-700","ease-in-out",2,"grid-template-columns","repeat(auto-fill, minmax(300px, 1fr))"],[1,"text-center","text-gray-500"],[1,"flex","h-full","flex-col","overflow-hidden","rounded-2xl","bg-white","p-6","transition-all","duration-700","ease-in-out"],["tabindex","0","role","button",1,"h-auto","cursor-pointer","rounded-lg","border","border-gray-300","bg-white","p-4","shadow-sm","transition-all","duration-700","ease-in-out","hover:shadow-md",3,"pointer-events-none"],["tabindex","0","role","button",1,"h-auto","cursor-pointer","rounded-lg","border","border-gray-300","bg-white","p-4","shadow-sm","transition-all","duration-700","ease-in-out","hover:shadow-md",3,"click","keyup.enter"],["alt","Avatar","appTrackImage","",1,"mb-2","h-14","w-14","rounded-full","object-cover",3,"src"],[1,"text-sm"],[1,"font-semibold","text-azul-oscuro"],[1,"text-gray-600"],[1,"mt-2","font-semibold","text-gray-700"],[1,"list-inside","list-disc","text-sm","text-gray-600"],["type","button",1,"mt-3","rounded","bg-indigo-600","px-3","py-1","text-sm","font-semibold","text-white","transition","hover:bg-indigo-700"],[1,"mb-4","self-start","rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","transition","hover:bg-gray-100",3,"click"],[1,"mb-4","text-xl","font-semibold","text-azul-oscuro"],[1,"overflow-y-auto","pr-2"],[1,"mb-4","rounded","border","border-gray-200","bg-gray-50","p-4"],[1,"list-inside","list-disc","text-sm"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1),E(2,te,3,0,"div"),E(3,oe,3,0,"div",2),E(4,re,2,0,"div",3),t(),a(5,"div",4),E(6,le,7,2),t()()),e&2&&(d(),T("width",o.pacienteSeleccionado()?"65%":"100%"),d(),f(o.cargando()?2:-1),d(),f(!o.cargando()&&o.pacientesConCitas.length>0?3:-1),d(),f(!o.cargando()&&o.pacientesConCitas.length===0?4:-1),d(),T("width",o.pacienteSeleccionado()?"35%":"0")("opacity",o.pacienteSeleccionado()?"1":"0")("padding",o.pacienteSeleccionado()?"1.5rem":"0"),A("pointer-events-none",!o.pacienteSeleccionado()),d(),f(o.pacienteSeleccionado()?6:-1))},dependencies:[j,K,H,Q],encapsulation:2,data:{animation:[L("scaleIn",[z(":enter",[D({transform:"scale(0.3)",opacity:0}),Y("600ms ease-out",D({transform:"scale(1)",opacity:1}))])])]}})};export{W as Pacientes};
