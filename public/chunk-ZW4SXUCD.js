import"./chunk-GGQ7LRWG.js";import{a as J}from"./chunk-R7XW6IVE.js";import{a as G}from"./chunk-YHDM7GGE.js";import{c as B,d as $,f as N,g as M,h as U,i as P,j as O}from"./chunk-P2GLRHRS.js";import{a as z,b as q}from"./chunk-2R7LN7ZU.js";import{n as W}from"./chunk-ZTAJVVXQ.js";import{a as L}from"./chunk-QYWCDNK3.js";import{c as j}from"./chunk-NSHH6JJ5.js";import"./chunk-X5YLR3NI.js";import"./chunk-Q4YNZBQ2.js";import"./chunk-HICRNNMR.js";import"./chunk-M3XRSK3P.js";import{Db as x,Fb as d,Ma as I,Oa as s,P as V,Rb as _,Ta as v,Tb as r,Ub as D,Vb as k,Wb as A,Za as F,ca as S,da as b,f as H,mc as w,na as p,nb as u,ob as m,pb as C,qb as T,rb as y,sb as E,tb as o,ub as c,vb as h,zb as g}from"./chunk-7RTQA4J5.js";import{i as f}from"./chunk-ODN5LVDJ.js";function R(t,a){if(t&1){let e=g();o(0,"button",8),x("click",function(){let n=S(e).$implicit,l=d(2);return b(l.seleccionarPaciente(n))}),h(1,"img",9),o(2,"span",10),r(3),c()()}if(t&2){let e,i=a.$implicit,n=d(2);_("opacity-50",n.pacienteSeleccionado()&&n.pacienteSeleccionado().id!==i.id),s(),_("border-blue-600",((e=n.pacienteSeleccionado())==null?null:e.id)===i.id),E("src",i.urlImagenPerfil||"assets/default-avatar.png",I),s(2),A("",i.nombre," ",i.apellido)}}function X(t,a){if(t&1&&(o(0,"div")(1,"h2",5),r(2," Seleccion\xE1 un paciente "),c(),o(3,"div",6),T(4,R,4,7,"button",7,C),c()()),t&2){let e=d();s(4),y(e.pacientes())}}function Y(t,a){if(t&1){let e=g();o(0,"button",8),x("click",function(){let n=S(e).$implicit,l=d(2);return b(l.seleccionarEspecialista(n))}),h(1,"img",11),o(2,"span",10),r(3),c()()}if(t&2){let e,i=a.$implicit,n=d(2);_("opacity-50",n.especialistaSeleccionado()&&n.especialistaSeleccionado().id!==i.id),s(),_("border-blue-600",((e=n.especialistaSeleccionado())==null?null:e.id)===i.id),E("src",i.imagenPerfil||"assets/default-avatar.png",I),s(2),A("",i.nombre," ",i.apellido)}}function Z(t,a){if(t&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un profesional ---- "),c(),o(3,"div",6),T(4,Y,4,7,"button",7,C),c()()),t&2){let e=d();s(4),y(e.especialistasValidados())}}function ee(t,a){t&1&&(o(0,"div",3)(1,"p",12),r(2," No se encontraron especialistas con fechas disponibles en los pr\xF3ximos 15 d\xEDas. "),c()())}function ie(t,a){if(t&1){let e=g();o(0,"button",15),x("click",function(){let n=S(e).$implicit,l=d(2);return b(l.seleccionarEspecialidad(n))}),h(1,"img",16),o(2,"span",17),r(3),c()()}if(t&2){let e,i=a.$implicit,n=d(2);_("border-blue-600",((e=n.especialidadSeleccionada())==null?null:e.id)===i.id)("opacity-50",n.especialidadSeleccionada()&&n.especialidadSeleccionada().id!==i.id),E("@especialidadAnimacion",void 0),s(),E("src",i.icono||"assets/default-icon.png",I),s(2),D(i.nombre)}}function te(t,a){t&1&&(o(0,"p",14),r(1," No hay especialidades disponibles. "),c())}function ae(t,a){if(t&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 una especialidad ---- "),c(),o(3,"div",6),T(4,ie,4,7,"button",13,C),c(),u(6,te,2,0,"p",14),c()),t&2){let e=d();s(3),E("@listaAnimacion",void 0),s(),y(e.especialidades()),s(2),m(e.noHayEspecialidades()?6:-1)}}function ne(t,a){if(t&1){let e=g();o(0,"button",20),x("click",function(){let n=S(e).$implicit,l=d(2);return b(l.seleccionarFecha(n))}),r(1),c()}if(t&2){let e=a.$implicit,i=d(2);_("bg-blue-600",i.fechaSeleccionada()===e)("text-white",i.fechaSeleccionada()===e),s(),k(" ",e," ")}}function oe(t,a){t&1&&(o(0,"p",14),r(1,"No hay d\xEDas disponibles."),c())}function se(t,a){if(t&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un d\xEDa ---- "),c(),o(3,"div",18),T(4,ne,2,5,"button",19,C),c(),u(6,oe,2,0,"p",14),c()),t&2){let e=d();s(4),y(e.fechasDisponibles()),s(2),m(e.noHayFechas()?6:-1)}}function ce(t,a){if(t&1){let e=g();o(0,"button",22),x("click",function(){let n=S(e).$implicit,l=d(2);return b(l.seleccionarHorario(n))}),r(1),c()}if(t&2){let e=a.$implicit,i=d(2);_("bg-green-500",i.horaSelecionada()===e)("text-white",i.horaSelecionada()===e),s(),k(" ",e," ")}}function re(t,a){t&1&&(o(0,"p",14),r(1," No hay turnos disponibles. "),c())}function le(t,a){if(t&1&&(o(0,"div")(1,"h2",5),r(2," ---- Seleccion\xE1 un horario ---- "),c(),o(3,"div",18),T(4,ce,2,5,"button",21,C),c(),u(6,re,2,0,"p",14),c()),t&2){let e=d();s(4),y(e.horariosDisponibles()),s(2),m(e.noHayHorarios()?6:-1)}}function de(t,a){if(t&1){let e=g();o(0,"div",4)(1,"p",23),r(2," Paciente: "),o(3,"strong"),r(4),c(),h(5,"br"),r(6," Especialista: "),o(7,"strong"),r(8),c(),h(9,"br"),r(10," Especialidad: "),o(11,"strong"),r(12),c(),h(13,"br"),r(14," D\xEDa: "),o(15,"strong"),r(16),c(),h(17,"br"),r(18," Hora: "),o(19,"strong"),r(20),c()(),o(21,"div",24)(22,"button",25),x("click",function(){S(e);let n=d();return b(n.cargarCita())}),r(23," Confirmar "),c()()()}if(t&2){let e,i,n,l=d();s(4),A("",(e=l.pacienteSeleccionado())==null?null:e.nombre," ",(e=l.pacienteSeleccionado())==null?null:e.apellido),s(4),A("",(i=l.especialistaSeleccionado())==null?null:i.nombre," ",(i=l.especialistaSeleccionado())==null?null:i.apellido),s(4),D((n=l.especialidadSeleccionada())==null?null:n.nombre),s(4),D(l.fechaSeleccionada()),s(4),D(l.horaSelecionada())}}var K=class t{constructor(a,e,i,n,l){this.turnosService=a;this.loadin=e;this.authSupabase=i;this.snackBar=n;this.usuariosService=l;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new H;especialistas=p([]);especialidades=p([]);fechasDisponibles=p([]);horariosDisponibles=p([]);especialistaSeleccionado=p(null);especialidadSeleccionada=p(null);fechaSeleccionada=p(null);horaSelecionada=p(null);especialidadesBuscadas=p(!1);diasBuscados=p(!1);horasBuscadas=p(!1);especialistasBuscados=p(!1);pacientes=p([]);pacienteSeleccionado=p(null);cargando=p(!1);especialistasValidados=w(()=>this.especialistas().filter(a=>a.validadoAdmin===!0));noHayEspecialistas=w(()=>this.especialistasBuscados()===!0&&this.especialistas().length===0);noHayEspecialidades=w(()=>this.especialistaSeleccionado()!==null&&this.especialidadesBuscadas()===!0&&this.especialidades().length===0);noHayFechas=w(()=>this.especialidadSeleccionada()!==null&&this.diasBuscados()===!0&&this.fechasDisponibles().length===0);noHayHorarios=w(()=>this.fechaSeleccionada()!==null&&this.horasBuscadas()===!0&&this.horariosDisponibles().length===0);ngOnInit(){return f(this,null,function*(){this.usuario$.pipe(V(this.destroy$)).subscribe(i=>{i&&(i.id=typeof i.id=="string"?Number(i.id):i.id,this.usuarioActual=i)});let a=yield this.turnosService.obtenerEspecialistasConDisponibilidad();this.especialistas.set(a),this.especialistasBuscados.set(!0);let e=yield this.usuariosService.obtenerTodosUsuarios();this.pacientes.set(e.filter(i=>i.rol==="paciente"&&i.emailVerificado===!0)),this.loadin.hide()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}seleccionarPaciente(a){this.pacienteSeleccionado.set(a)}seleccionarEspecialista(a){return f(this,null,function*(){this.especialistaSeleccionado.set(a),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.fechasDisponibles.set([]),this.especialidadesBuscadas.set(!1),this.diasBuscados.set(!1),this.horasBuscadas.set(!1),this.cargando.set(!0);let e=yield this.turnosService.obtenerEspecialidadesDeEspecialista(a.id);this.especialidades.set(e),this.especialidadesBuscadas.set(!0),this.cargando.set(!1)})}seleccionarEspecialidad(a){return f(this,null,function*(){this.especialidadSeleccionada.set(a),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.cargando.set(!0);let e=yield this.turnosService.obtenerFechasConHorariosDisponibles(this.especialistaSeleccionado().id,a.duracion);this.fechasDisponibles.set(e),this.diasBuscados.set(!0),this.cargando.set(!1)})}seleccionarFecha(a){return f(this,null,function*(){this.horaSelecionada.set(null),this.fechaSeleccionada.set(a),this.cargando.set(!0);let e=yield this.turnosService.obtenerHorariosDisponibles(a,this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion);this.horariosDisponibles.set(e),this.horasBuscadas.set(!0),this.cargando.set(!1)})}seleccionarHorario(a){this.horaSelecionada.set(a)}cargarCita(){return f(this,null,function*(){let a=this.fechaSeleccionada(),e=this.horaSelecionada(),i=this.especialistaSeleccionado(),n=this.especialidadSeleccionada(),l=this.pacienteSeleccionado();if(!a||!e||!i||!n||!l){console.error("Datos incompletos para agendar la cita");return}let Q={fechaHora:new Date(`${a}T${e}:00`),duracionMin:n.duracion,pacienteId:l.id,especialistaId:i.id,especialidadId:n.id,estado:"solicitado",comentarioPaciente:" ",comentarioEspecialista:" ",resenia:" "};try{yield this.turnosService.darAltaCita(Q),this.snackBar.open("Cita agendada","exito",{duration:4e3,panelClass:["bg-blue-600","text-white"]}),this.pacienteSeleccionado.set(null),this.especialistaSeleccionado.set(null),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null)}catch{this.snackBar.open("Ups algo salio mal","error",{duration:4e3,panelClass:["bg-red-600","text-white"]})}})}btenerPacientes(){return f(this,null,function*(){(yield this.usuariosService.obtenerTodosUsuarios()).filter(e=>e.rol==="paciente")})}static \u0275fac=function(e){return new(e||t)(v(G),v(L),v(j),v(W),v(J))};static \u0275cmp=F({type:t,selectors:[["app-solicitar-turno-admin"]],decls:11,vars:7,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mx-auto","max-w-4xl","space-y-8","p-4"],[1,"text-center"],[1,"mt-8","text-center"],[1,"mb-4","text-center","text-xl","font-semibold"],[1,"flex","flex-wrap","justify-center","gap-4"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"opacity-50"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"click"],["alt","paciente","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],[1,"text-center","text-sm"],["alt","profesional","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],[1,"text-lg","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","transition","hover:bg-blue-50",3,"border-blue-600","opacity-50"],[1,"mt-4","text-center","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","transition","hover:bg-blue-50",3,"click"],["alt","icono","appTrackImage","",1,"mb-2","h-10","w-10",3,"src"],[1,"text-center","text-xs"],[1,"flex","flex-wrap","justify-center","gap-2"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"bg-blue-600","text-white"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"click"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"bg-green-500","text-white"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"click"],[1,"text-sm","text-gray-600"],[1,"pt-4"],[1,"rounded","bg-blue-200","px-4","py-2","text-lg","font-medium","hover:bg-blue-300",3,"click"]],template:function(e,i){e&1&&(o(0,"app-loading-wrapper")(1,"div",0)(2,"div",1)(3,"div",2),u(4,X,6,0,"div"),u(5,Z,6,0,"div"),u(6,ee,3,0,"div",3),u(7,ae,7,2,"div"),u(8,se,7,1,"div"),u(9,le,7,1,"div"),u(10,de,24,7,"div",4),c()()()()),e&2&&(s(4),m(i.pacientes().length?4:-1),s(),m(i.pacienteSeleccionado()&&i.especialistas().length?5:-1),s(),m(i.pacienteSeleccionado()&&i.noHayEspecialistas()?6:-1),s(),m(i.especialistaSeleccionado()?7:-1),s(),m(i.pacienteSeleccionado()&&i.especialidadSeleccionada()?8:-1),s(),m(i.pacienteSeleccionado()&&i.fechaSeleccionada()?9:-1),s(),m(i.pacienteSeleccionado()&&i.horaSelecionada()?10:-1))},dependencies:[z,q],encapsulation:2,data:{animation:[B("especialidadAnimacion",[M(":enter",[N({opacity:0,transform:"scale(0.5)"}),$("400ms cubic-bezier(0.34, 1.56, 0.64, 1)",N({opacity:1,transform:"scale(1)"}))])]),B("listaAnimacion",[M(":enter",[P("@especialidadAnimacion",O(150,U()),{optional:!0})])])]}})};export{K as SolicitarTurnoAdmin};
