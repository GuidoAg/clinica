import{a as F}from"./chunk-RLM7BZDW.js";import{n as Z}from"./chunk-YZVU7P4D.js";import{b as Y}from"./chunk-4DVJJQNQ.js";import"./chunk-BSLYAFLW.js";import"./chunk-X5YLR3NI.js";import"./chunk-SGAKRYQ3.js";import"./chunk-VLNB4REZ.js";import{c as A,g as E,j as V,v as Q,w as I,x as X}from"./chunk-E2BOE3LX.js";import{e as K,f as q,g as k,j as G,k as J,l as S}from"./chunk-MTWZV5NU.js";import{Cb as f,Eb as s,Ma as l,O as $,Ob as j,Pb as L,Ra as v,Sb as c,Ub as d,Wb as C,Xa as h,Xb as y,Yb as T,ab as _,ba as u,bc as W,ca as p,cb as N,cc as w,dc as O,ec as U,f as B,fc as H,ma as b,pb as m,qb as r,rb as o,wb as R,xb as P,yb as x}from"./chunk-EMRS3JRH.js";import{i as z}from"./chunk-ODN5LVDJ.js";function ne(i,t){if(i&1){let e=x();r(0,"button",7),f("click",function(){u(e);let n=s(2);return p(n.mostrarFormularioCancelar=!0)}),c(1," Cancelar turno "),o()}}function le(i,t){if(i&1){let e=x();r(0,"button",8),f("click",function(){u(e);let n=s(2);return p(n.verResenia())}),c(1," Ver rese\xF1a "),o()}}function ce(i,t){if(i&1&&(r(0,"div",4),_(1,ne,2,0,"button",5)(2,le,2,0,"button",6),o()),i&2){let e=s();l(),m("ngIf",e.puedeCancelar),l(),m("ngIf",e.puedeVerResenia)}}function se(i,t){if(i&1){let e=x();r(0,"div",4)(1,"textarea",9),T("ngModelChange",function(n){u(e);let g=s();return y(g.comentarioCancelar,n)||(g.comentarioCancelar=n),p(n)}),o(),r(2,"div",10)(3,"button",11),f("click",function(){u(e);let n=s();return p(n.cancelarAccionCancelar())}),c(4," Cancelar "),o(),r(5,"button",12),f("click",function(){u(e);let n=s();return p(n.confirmarCancelarTurno())}),c(6," Confirmar cancelaci\xF3n "),o()()()}if(i&2){let e=s();l(),C("ngModel",e.comentarioCancelar),l(4),m("disabled",!e.comentarioCancelar.trim()||e.cargando())}}function de(i,t){if(i&1){let e=x();r(0,"div",13)(1,"h3",14),c(2," Rese\xF1a "),o(),r(3,"p",15),c(4),o(),r(5,"button",16),f("click",function(){u(e);let n=s();return p(n.volverDesdeVistaResenia())}),c(6," Volver "),o()()}if(i&2){let e=s();l(4),d(" ",e.cita.resenia||"No se ha dejado una rese\xF1a para este turno."," ")}}var M=class i{constructor(t,e,a){this.turnos=t;this.fb=e;this.snackBar=a}cita;cerrar=new N;accionRealizada=new N;cargando=b(!1);mostrarFormularioCancelar=!1;mostrarFormularioResenia=!1;comentarioCancelar="";get puedeCancelar(){return this.cita.estado!=="completado"&&this.cita.estado!=="cancelado"&&this.cita.estado!=="aceptado"&&this.cita.estado!=="rechazado"&&!this.mostrarFormularioCancelar}get puedeVerResenia(){return!!this.cita.resenia&&this.cita.resenia.trim().length>0}cancelarAccionCancelar(){this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}confirmarCancelarTurno(){this.comentarioCancelar.trim()&&(this.cargando.set(!0),this.turnos.cancelarCitaEspecialista(this.cita,this.comentarioCancelar.trim()).then(t=>{this.cargando.set(!1),t.success?(this.snackBar.open("Turno cancelado exitosamente.","Cerrar",{duration:3e3}),this.accionRealizada.emit("cancelado"),this.cerrar.emit()):this.snackBar.open(t.message??"Ocurri\xF3 un error","Cerrar",{duration:4e3})}).finally(()=>{this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}))}verResenia(){this.mostrarFormularioResenia=!0}volverDesdeVistaResenia(){this.mostrarFormularioResenia=!1}cerrarModal(){this.cerrar.emit()}static \u0275fac=function(e){return new(e||i)(v(F),v(Q),v(Z))};static \u0275cmp=h({type:i,selectors:[["app-acciones-admin"]],inputs:{cita:"cita"},outputs:{cerrar:"cerrar",accionRealizada:"accionRealizada"},decls:5,vars:3,consts:[[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm",3,"click"],[1,"fixed","top-1/2","left-1/2","z-50","w-full","max-w-md","-translate-x-1/2","-translate-y-1/2","transform","items-center","justify-center","rounded-2xl","bg-white","p-11","shadow-lg",3,"click"],["class","flex flex-col gap-3",4,"ngIf"],["class","flex flex-col items-center gap-4 text-center",4,"ngIf"],[1,"flex","flex-col","gap-3"],["class","rounded-lg bg-gray-500 px-4 py-2 font-semibold text-white transition-transform hover:scale-105 hover:bg-gray-800",3,"click",4,"ngIf"],["class","rounded-lg bg-pink-400 px-4 py-2 font-semibold text-white transition-transform hover:scale-105 hover:bg-pink-700",3,"click",4,"ngIf"],[1,"rounded-lg","bg-gray-500","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-gray-800",3,"click"],[1,"rounded-lg","bg-pink-400","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-pink-700",3,"click"],["placeholder","Ingrese el motivo de cancelaci\xF3n","rows","3",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-red-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-3"],["type","button",1,"rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],["type","button",1,"rounded","bg-red-600","px-4","py-2","text-sm","font-semibold","text-white","hover:bg-red-800","disabled:opacity-50",3,"click","disabled"],[1,"flex","flex-col","items-center","gap-4","text-center"],[1,"text-xl","font-bold","text-[color:var(--color-azul-oscuro)]"],[1,"px-2","text-gray-700","italic"],[1,"mt-4","rounded","bg-gray-300","px-4","py-2","text-sm","font-semibold","text-gray-800","hover:bg-gray-400",3,"click"]],template:function(e,a){e&1&&(r(0,"div",0),f("click",function(){return a.cerrarModal()}),o(),r(1,"div",1),f("click",function(g){return g.stopPropagation()}),_(2,ce,3,2,"div",2)(3,se,7,2,"div",2)(4,de,7,1,"div",3),o()),e&2&&(l(2),m("ngIf",!a.mostrarFormularioCancelar&&!a.mostrarFormularioResenia),l(),m("ngIf",a.mostrarFormularioCancelar),l(),m("ngIf",a.mostrarFormularioResenia))},dependencies:[S,k,I,A,E,V,X],encapsulation:2})};var me=(i,t)=>({"cursor-pointer select-none hover:bg-[color:var(--color-azul-oscuro)] hover:text-white":i,"bg-[color:var(--color-azul-oscuro)]/80 text-white":t});function ue(i,t){if(i&1){let e=x();r(0,"app-acciones-admin",13),f("cerrar",function(){u(e);let n=s();return p(n.cerrarPopupAcciones())})("accionRealizada",function(n){u(e);let g=s();return p(g.accionDesdeModal(n))}),o()}if(i&2){let e=s();m("cita",e.citaSeleccionada())}}function pe(i,t){if(i&1){let e=x();r(0,"th",14),f("click",function(){let n=u(e).$implicit,g=s();return p(g.filtroColumna.set(n.key))}),c(1),o()}if(i&2){let e=t.$implicit,a=s();m("ngClass",W(2,me,e.key!=="datosDinamicos"&&e.key!=="acciones",a.filtroColumna()===e.key&&e.key!=="datosDinamicos"&&e.key!=="acciones")),l(),d(" ",e.label," ")}}function ge(i,t){if(i&1&&(r(0,"div")(1,"strong"),c(2),o(),c(3),o()),i&2){let e=t.$implicit;l(2),d("",e.clave,":"),l(),d(" ",e.valor," ")}}function fe(i,t){if(i&1&&(r(0,"tr")(1,"td",24)(2,"div",25),_(3,ge,4,2,"div",15),o()()()),i&2){let e=s().$implicit;l(3),m("ngForOf",e.datosDinamicos)}}function _e(i,t){if(i&1){let e=x();R(0),r(1,"tr",16),f("click",function(){let n=u(e).$implicit,g=s(2);return p(g.toggleFilaExpandida(n.citaId))}),r(2,"td",17),c(3),o(),r(4,"td",17),c(5),w(6,"date"),o(),r(7,"td",18),c(8),w(9,"titlecase"),o(),r(10,"td",17),c(11),o(),r(12,"td",17),c(13),o(),r(14,"td",17),c(15),o(),r(16,"td",17),c(17),o(),r(18,"td",17),c(19),o(),r(20,"td",17),c(21),o(),r(22,"td",17),c(23),o(),r(24,"td",19)(25,"button",20),c(26),o()(),r(27,"td",21)(28,"button",22),f("click",function(){let n=u(e).$implicit,g=s(2);return p(g.abrirPopupAcciones(n))}),c(29," Acciones "),o()()(),_(30,fe,4,1,"tr",23),P()}if(i&2){let e=t.$implicit,a=s(2);l(),L("background-color",a.filaExpandida()===e.citaId?"rgba(46, 64, 45, 0.2)":null),l(2),d(" ",e.citaId," "),l(2),d(" ",U(6,15,e.fechaHora,"short")," "),l(2),m("ngClass",a.estadoClaseMap[e.estado]??"bg-gray-100 text-gray-700"),l(),d(" ",O(9,18,e.estado)," "),l(3),d(" ",e.alturaCm," "),l(2),d(" ",e.pesoKg," "),l(2),d(" ",e.temperaturaC," "),l(2),d(" ",e.presionArterial," "),l(2),d(" ",e.pacienteNombreCompleto," "),l(2),d(" ",e.especialistaNombreCompleto," "),l(2),d(" ",e.especialidadNombre," "),l(3),d(" ",a.filaExpandida()===e.citaId?"Ocultar":"Mostrar"," "),l(4),m("ngIf",a.filaExpandida()===e.citaId)}}function xe(i,t){if(i&1&&(R(0),_(1,_e,31,20,"ng-container",15),P()),i&2){let e=s();l(),m("ngForOf",e.citasFiltradas)}}function be(i,t){i&1&&(r(0,"tr")(1,"td",26),c(2," Cargando datos... "),o()())}var ee=class i{constructor(t,e){this.turnosService=t;this.authSupabase=e;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new B;citas=b([]);filaExpandida=b(null);cargando=b(!0);citaSeleccionada=b(null);mostrarPopupAcciones=!1;estadoClaseMap={solicitado:"bg-yellow-200 text-yellow-800",aceptado:"bg-green-200 text-green-800",rechazado:"bg-red-200 text-red-800",cancelado:"bg-gray-300 text-gray-800",completado:"bg-blue-200 text-blue-800"};columnas=[{key:"citaId",label:"ID"},{key:"fechaHora",label:"Fecha/Hora"},{key:"estado",label:"Estado"},{key:"alturaCm",label:"Altura (cm)"},{key:"pesoKg",label:"Peso (kg)"},{key:"temperaturaC",label:"Temp (\xB0C)"},{key:"presionArterial",label:"Presi\xF3n"},{key:"pacienteNombreCompleto",label:"Paciente"},{key:"especialistaNombreCompleto",label:"Especialista"},{key:"especialidadNombre",label:"Especialidad"}];columnasConDatosDinamicos=[...this.columnas,{key:"datosDinamicos",label:"Datos din\xE1micos"}];filtroColumna=b(null);_filtroValor=b("");get filtroValorModel(){return this._filtroValor()}set filtroValorModel(t){this._filtroValor.set(t)}ngOnInit(){return z(this,null,function*(){this.usuario$.pipe($(this.destroy$)).subscribe(t=>{if(!t){this.usuarioActual=null;return}t.id=typeof t.id=="string"?Number(t.id):t.id,this.usuarioActual=t,this.cargarCitas()})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitas(){return z(this,null,function*(){this.cargando.set(!0);try{if(this.usuarioActual?.id!=null){let t=yield this.turnosService.obtenerCitasConRegistro();this.citas.set(t)}}catch(t){console.error("Error al obtener citas",t)}finally{this.cargando.set(!1)}})}toggleFilaExpandida(t){this.filaExpandida.set(this.filaExpandida()===t?null:t)}activarFiltro(t){this.filtroColumna.set(t),this._filtroValor.set("")}get citasFiltradas(){let t=this.filtroColumna(),e=this._filtroValor().toLowerCase();return!t||e.trim()===""?this.citas():this.citas().filter(a=>{let n=a[t];return n==null?!1:n instanceof Date?n.toLocaleString().toLowerCase().includes(e):n.toString().toLowerCase().includes(e)})}get filtroColumnaLabel(){return this.columnas.find(e=>e.key===this.filtroColumna())?.label??""}limpiarFiltro(){this.filtroColumna.set(""),this._filtroValor.set("")}mostrarAcciones(){this.filtroColumna.set(""),this._filtroValor.set("")}abrirPopupAcciones(t){this.citaSeleccionada.set(t),this.mostrarPopupAcciones=!0}cerrarPopupAcciones(){this.mostrarPopupAcciones=!1,this.citaSeleccionada.set(null)}accionDesdeModal(t){this.cerrarPopupAcciones(),this.cargarCitas()}static \u0275fac=function(e){return new(e||i)(v(F),v(Y))};static \u0275cmp=h({type:i,selectors:[["app-tabla-turnos"]],decls:19,vars:8,consts:[["cargandoTpl",""],[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-[color:var(--color-crema)]","p-6","shadow-inner"],[1,"mb-4","flex","flex-wrap","items-center","gap-3"],["for","filtro",1,"text-sm","font-semibold","text-[color:var(--color-azul-oscuro)]"],["id","filtro","type","text","placeholder","Ingres\xE1 filtro",1,"w-64","rounded","border","border-gray-300","px-3","py-1","text-sm","focus:ring-2","focus:ring-[color:var(--color-azul-oscuro)]","focus:outline-none",3,"ngModelChange","ngModel"],["type","button",1,"rounded","bg-[color:var(--color-azul-oscuro)]","px-3","py-1","text-sm","font-semibold","text-white","shadow","transition-transform","hover:scale-105","hover:bg-[color:var(--color-azul-claro)]",3,"click"],[1,"ml-auto"],[3,"cita","cerrar","accionRealizada",4,"ngIf"],[1,"min-w-full","border-collapse","border","border-gray-300","text-sm"],[1,"bg-[color:var(--color-azul-claro)]","text-[color:var(--color-azul-oscuro)]"],["class","cursor-pointer border border-gray-300 px-3 py-2 transition-colors duration-200 select-none hover:bg-[color:var(--color-azul-oscuro)] hover:text-white",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],[3,"cerrar","accionRealizada","cita"],[1,"cursor-pointer","border","border-gray-300","px-3","py-2","transition-colors","duration-200","select-none","hover:bg-[color:var(--color-azul-oscuro)]","hover:text-white",3,"click","ngClass"],[4,"ngFor","ngForOf"],[1,"cursor-pointer","border","border-gray-300","transition-colors","duration-150","hover:bg-[color:var(--color-verde-claro)]",3,"click"],[1,"border","border-gray-300","px-3","py-1"],[1,"rounded","border","border-gray-300","px-3","py-1","text-center","font-semibold",3,"ngClass"],[1,"border","border-gray-300","px-3","py-1","text-center"],["type","button",1,"text-[color:var(--color-azul-oscuro)]","underline","hover:text-[color:var(--color-azul-claro)]"],[1,"border","border-gray-300","bg-green-200","px-3","py-1","text-center","hover:bg-green-500"],["type","button",1,"font-bold","text-[color:var(--color-azul-oscuro)]","hover:text-[color:var(--color-white)]",3,"click"],[4,"ngIf"],["colspan","11",1,"border","border-gray-300","bg-[color:var(--color-crema)]","px-3","py-2","text-[color:var(--color-azul-oscuro)]"],[1,"grid","grid-cols-2","gap-4"],["colspan","11",1,"border","border-gray-300","px-3","py-6","text-center","font-semibold","text-[color:var(--color-azul-oscuro)]"]],template:function(e,a){if(e&1){let n=x();r(0,"div",1)(1,"div",2)(2,"div",3)(3,"label",4),c(4),w(5,"titlecase"),o(),r(6,"input",5),T("ngModelChange",function(D){return u(n),y(a.filtroValorModel,D)||(a.filtroValorModel=D),p(D)}),o(),r(7,"button",6),f("click",function(){return u(n),p(a.limpiarFiltro())}),c(8," Limpiar "),o(),r(9,"div",7),_(10,ue,1,1,"app-acciones-admin",8),o()(),r(11,"table",9)(12,"thead")(13,"tr",10),_(14,pe,2,5,"th",11),o()(),r(15,"tbody"),_(16,xe,2,1,"ng-container",12)(17,be,3,0,"ng-template",null,0,H),o()()()()}if(e&2){let n=j(18);l(4),d(" Filtrar por ",O(5,6,a.filtroColumnaLabel),": "),l(2),C("ngModel",a.filtroValorModel),l(4),m("ngIf",a.mostrarPopupAcciones&&a.citaSeleccionada()),l(4),m("ngForOf",a.columnasConDatosDinamicos),l(2),m("ngIf",!a.cargando())("ngIfElse",n)}},dependencies:[S,K,q,k,I,A,E,V,M,G,J],encapsulation:2})};export{ee as TablaTurnos};
