import{a as Pe,b as Oe,c as Ne,d as De,e as je,f as ze}from"./chunk-WEKHKOF5.js";import"./chunk-XMEV7A5C.js";import{a as Ve,b as Te,f as ke,i as Me,j as Ae,k as Ie}from"./chunk-PMMIFY6J.js";import{f as Se,g as we,n as Re}from"./chunk-2CRE5YUA.js";import{a as Fe}from"./chunk-YOQAPNJW.js";import{a as j,b as z}from"./chunk-5ZTSR4NX.js";import"./chunk-BI2JOZY7.js";import"./chunk-X5YLR3NI.js";import"./chunk-JNY4XHIA.js";import{b as pe}from"./chunk-RZWFKRPX.js";import{e as ue,f as ge}from"./chunk-MWG2O76V.js";import"./chunk-YCGHKXNR.js";import{c as N,e as g,g as D,h as _e,j as fe,k as he,l as Ce,n as xe,o as ve,v as be,w as Ee,x as ye}from"./chunk-5MFN5EJ7.js";import{e as P,j as O}from"./chunk-YGECKIT7.js";import{Bb as x,Db as u,Ka as ne,La as le,Ma as s,Pb as I,Rb as c,Sb as H,Tb as k,Vb as ce,Wb as de,Xa as A,Xb as me,Y as R,ac as w,ba as f,ca as h,cb as se,da as re,lb as m,mb as p,nb as B,ob as U,pb as L,qb as C,ra as oe,rb as o,sb as r,tb as F,xb as V}from"./chunk-ZQYZ5UVW.js";import{i as S}from"./chunk-ODN5LVDJ.js";var Ge=(i,t)=>({"text-green-600":i,"text-red-600":t});function $e(i,t){i&1&&(o(0,"div",1),re(),o(1,"svg",10),F(2,"circle",11)(3,"path",12),r()())}function We(i,t){if(i&1&&F(0,"img",4),i&2){let e=u();C("src",e.captchaActual.imagenUrl,ne)}}function Ze(i,t){if(i&1&&(o(0,"p",9),c(1),r()),i&2){let e=u();C("ngClass",w(2,Ge,e.captchaValido,!e.captchaValido)),s(),k(" ",e.mensajeVerificacion," ")}}var q=class i{captchaResuelto=new se;auth=R(z);captchas=[];captchaActual;userInput="";captchaValido=!1;mensajeVerificacion="";verificando=!1;cargado=!1;ngOnInit(){return S(this,null,function*(){yield this.cargarCaptchasDesdeSupabase()})}cargarCaptchasDesdeSupabase(){return S(this,null,function*(){try{if(this.captchas=yield this.auth.getCaptchas(),!this.captchas.length){console.error("No se pudieron cargar captchas");return}this.captchaActual=this.obtenerCaptchaAleatorio(),this.cargado=!0}catch(t){console.error("Error al cargar captchas:",t),this.cargado=!1}})}obtenerCaptchaAleatorio(){if(this.captchas.length<2)return this.captchas[0];let t;do{let e=Math.floor(Math.random()*this.captchas.length);t=this.captchas[e]}while(t===this.captchaActual);return t}verificarRespuesta(){return S(this,null,function*(){if(!this.captchaActual)return;this.mensajeVerificacion="",this.verificando=!0,yield new Promise(e=>setTimeout(e,500));let t=yield this.sha256(this.userInput.trim().toLowerCase());this.captchaValido=t===this.captchaActual.answerHash,this.mensajeVerificacion=this.captchaValido?"\u2705 Respuesta correcta":"\u274C Respuesta incorrecta",this.verificando=!1,this.captchaResuelto.emit(this.captchaValido)})}sha256(t){return S(this,null,function*(){let e=new TextEncoder().encode(t),a=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(a)).map(_=>_.toString(16).padStart(2,"0")).join("")})}cambiarCaptcha(){this.captchaActual=this.obtenerCaptchaAleatorio(),this.userInput="",this.mensajeVerificacion=""}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=A({type:i,selectors:[["app-mi-captcha"]],outputs:{captchaResuelto:"captchaResuelto"},decls:12,vars:9,consts:[[1,"relative","w-[300px]","items-center","justify-center","align-middle","text-sm"],[1,"absolute","inset-0","z-10","flex","items-center","justify-center","bg-white/120","backdrop-blur-sm"],[1,"rounded-lg","border","border-gray-300","bg-crema","p-4","shadow-sm"],[1,"flex","flex-col","items-center","gap-2"],["alt","captcha",1,"h-24","w-full","rounded","border","bg-white","object-contain",3,"src"],["placeholder","Escrib\xED lo que ves",1,"w-full","rounded","border","border-gray-300","bg-white","px-3","py-1.5","focus:ring-2","focus:ring-azul-oscuro","focus:outline-none",3,"ngModelChange","ngModel","disabled"],[1,"flex","w-full","justify-between","gap-2"],[1,"flex-1","rounded","bg-verde-claro","px-3","py-1.5","text-lg","text-white","hover:bg-verde-claro/80","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","rounded","bg-azul-claro","px-3","py-1.5","text-lg","text-white","hover:bg-azul-claro/80","disabled:opacity-50",3,"click","disabled"],[1,"mt-1",3,"ngClass"],["viewBox","0 0 24 24","fill","none",1,"h-6","w-6","animate-spin","text-blue-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"]],template:function(e,a){e&1&&(o(0,"div",0),m(1,$e,4,0,"div",1),o(2,"div",2)(3,"div",3),m(4,We,1,1,"img",4),o(5,"input",5),me("ngModelChange",function(d){return de(a.userInput,d)||(a.userInput=d),d}),r(),o(6,"div",6)(7,"button",7),x("click",function(){return a.verificarRespuesta()}),c(8," Verificar "),r(),o(9,"button",8),x("click",function(){return a.cambiarCaptcha()}),c(10," Cambiar "),r()(),m(11,Ze,2,5,"p",9),r()()()),e&2&&(s(),p(a.verificando||!a.cargado?1:-1),s(2),I("opacity-50",a.verificando),s(),p(a.captchaActual?4:-1),s(),ce("ngModel",a.userInput),C("disabled",a.verificando),s(2),C("disabled",a.verificando),s(2),C("disabled",a.verificando),s(2),p(a.mensajeVerificacion?11:-1))},dependencies:[O,P,Ee,N,D,fe],encapsulation:2})};var T=(i,t)=>({"mat-form-field-valid":i,"mat-form-field-invalid":t});function Qe(i,t){if(i&1){let e=V();o(0,"div",2)(1,"p",4),c(2,"\xBFQu\xE9 tipo de usuario sos?"),r(),o(3,"div",5)(4,"div",6),x("click",function(){f(e);let n=u();return h(n.seleccionarTipo("paciente"))})("keyup.enter",function(){f(e);let n=u();return h(n.seleccionarTipo("paciente"))})("keyup.space",function(){f(e);let n=u();return h(n.seleccionarTipo("paciente"))}),o(5,"div",7),F(6,"img",8),o(7,"div",9)(8,"h3",10),c(9,"Paciente"),r()()()(),o(10,"div",11),x("click",function(){f(e);let n=u();return h(n.seleccionarTipo("especialista"))})("keyup.enter",function(){f(e);let n=u();return h(n.seleccionarTipo("especialista"))})("keyup.space",function(){f(e);let n=u();return h(n.seleccionarTipo("especialista"))}),o(11,"div",7),F(12,"img",12),o(13,"div",9)(14,"h3",10),c(15,"Especialista"),r()()()()()()}}function Je(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function Ke(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xEDnimo 2 caracteres"),r())}function Xe(i,t){i&1&&(o(0,"mat-error"),c(1,"Solo letras"),r())}function Ye(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function et(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xEDnimo 2 caracteres"),r())}function tt(i,t){i&1&&(o(0,"mat-error"),c(1,"Solo letras"),r())}function it(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function at(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xEDnimo 18"),r())}function rt(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xE1ximo 99"),r())}function ot(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function nt(i,t){i&1&&(o(0,"mat-error"),c(1,"Debe contener 8 d\xEDgitos"),r())}function lt(i,t){if(i&1&&(o(0,"mat-option",33),c(1),r()),i&2){let e=t.$implicit;C("value",e),s(),H(e)}}function st(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function ct(i,t){if(i&1&&(o(0,"mat-form-field",14)(1,"mat-label"),c(2,"Obra Social"),r(),o(3,"mat-select",32),U(4,lt,2,2,"mat-option",33,B),r(),m(6,st,2,0,"mat-error"),r()),i&2){let e,a,n=u(2);C("ngClass",w(2,T,((e=n.registroForm.get("obraSocial"))==null?null:e.valid)&&(((e=n.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=n.registroForm.get("obraSocial"))==null?null:e.touched)),((e=n.registroForm.get("obraSocial"))==null?null:e.invalid)&&(((e=n.registroForm.get("obraSocial"))==null?null:e.dirty)||((e=n.registroForm.get("obraSocial"))==null?null:e.touched)))),s(4),L(n.obraSocialOptions),s(2),p((a=n.registroForm.get("obraSocial"))!=null&&a.hasError("required")?6:-1)}}function dt(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function mt(i,t){i&1&&(o(0,"mat-error"),c(1,"Email inv\xE1lido"),r())}function pt(i,t){i&1&&(o(0,"mat-error"),c(1,"Campo obligatorio"),r())}function ut(i,t){i&1&&(o(0,"mat-error"),c(1,"M\xEDnimo 7 caracteres"),r())}function gt(i,t){if(i&1){let e=V();o(0,"mat-checkbox",46),x("change",function(){let n=f(e).$implicit,d=u(4);return h(d.toggleEspecialidad(n.id))}),c(1),r()}if(i&2){let e=t.$implicit,a=u(4);C("checked",a.esEspecialidadSeleccionada(e.id)),s(),k(" ",e.nombre," ")}}function _t(i,t){i&1&&(o(0,"div",48),c(1,"M\xEDnimo 2 caracteres"),r())}function ft(i,t){i&1&&(o(0,"div",48),c(1," Solo letras y espacios "),r())}function ht(i,t){if(i&1){let e=V();o(0,"div",45)(1,"input",47),x("click",function(n){return f(e),h(n.stopPropagation())}),r(),m(2,_t,2,0,"div",48),m(3,ft,2,0,"div",48),r()}if(i&2){let e,a,n=u(4);s(2),p((e=n.registroForm.get("nuevaEspecialidad"))!=null&&e.hasError("minlength")?2:-1),s(),p((a=n.registroForm.get("nuevaEspecialidad"))!=null&&a.hasError("pattern")?3:-1)}}function Ct(i,t){if(i&1){let e=V();o(0,"div",39)(1,"div",41),U(2,gt,2,2,"mat-checkbox",42,B),r(),o(4,"div",43)(5,"button",44),x("click",function(n){return f(e),u(3).toggleMostrarNuevaEspecialidad(),h(n.stopPropagation())}),c(6),r(),m(7,ht,4,2,"div",45),r()()}if(i&2){let e=u(3);s(2),L(e.especialidadOptions),s(4),k(" ",e.mostrarCampoOtraEspecialidad?"\u2715 Cancelar":"+ Agregar nueva especialidad"," "),s(),p(e.mostrarCampoOtraEspecialidad?7:-1)}}function xt(i,t){i&1&&(o(0,"div",40),c(1," Deb\xE9s seleccionar al menos una especialidad o agregar una nueva "),r())}function vt(i,t){if(i&1){let e=V();o(0,"div",21)(1,"div",34),c(2," Especialidades (seleccion\xE1 al menos una) "),r(),o(3,"div",35)(4,"div",36),x("click",function(n){f(e);let d=u(2);return h(d.toggleDesplegableEspecialidades(n))})("keyup.enter",function(n){f(e);let d=u(2);return h(d.toggleDesplegableEspecialidades(n))})("keyup.space",function(n){f(e);let d=u(2);return h(d.toggleDesplegableEspecialidades(n))}),o(5,"span",37),c(6),r(),o(7,"mat-icon",38),c(8),r()(),m(9,Ct,8,2,"div",39),r(),m(10,xt,2,0,"div",40),r()}if(i&2){let e,a=u(2);s(4),I("border-azul-oscuro",a.desplegableEspecialidadesAbierto),s(2),k(" ",a.obtenerEspecialidadesSeleccionadasTexto()," "),s(2),H(a.desplegableEspecialidadesAbierto?"expand_less":"expand_more"),s(),p(a.desplegableEspecialidadesAbierto?9:-1),s(),p((e=a.registroForm.get("especialidadesSeleccionadas"))!=null&&e.hasError("alMenosUna")&&((e=a.registroForm.get("especialidadesSeleccionadas"))!=null&&e.touched)?10:-1)}}function bt(i,t){i&1&&(o(0,"mat-error"),c(1," Debe seleccionar una imagen de perfil. "),r())}function Et(i,t){i&1&&(o(0,"mat-error"),c(1," Solo se permiten archivos .jpg o .png "),r())}function yt(i,t){i&1&&(o(0,"mat-error"),c(1," Debe seleccionar una imagen de fondo. "),r())}function Ft(i,t){i&1&&(o(0,"mat-error"),c(1," Solo se permiten archivos .jpg o .png "),r())}function St(i,t){if(i&1){let e=V();o(0,"div",22)(1,"label",49),c(2,"Foto Fondo"),r(),o(3,"input",50),x("change",function(n){f(e);let d=u(2);return h(d.onFileSelected(n,"fondo"))}),r(),m(4,yt,2,0,"mat-error"),m(5,Ft,2,0,"mat-error"),r()}if(i&2){let e,a,n=u(2);s(4),p((e=n.registroForm.get("imagenFondo"))!=null&&e.hasError("required")?4:-1),s(),p((a=n.registroForm.get("imagen"))!=null&&a.hasError("invalidType")?5:-1)}}function wt(i,t){i&1&&(o(0,"div",30),c(1," Debe resolver correctamente el CAPTCHA. "),r())}function Rt(i,t){if(i&1){let e=V();o(0,"div",3)(1,"form",13),x("ngSubmit",function(){f(e);let n=u();return h(n.registrar())}),o(2,"mat-form-field",14)(3,"mat-label"),c(4,"Nombre"),r(),F(5,"input",15),m(6,Je,2,0,"mat-error"),m(7,Ke,2,0,"mat-error"),m(8,Xe,2,0,"mat-error"),r(),o(9,"mat-form-field",14)(10,"mat-label"),c(11,"Apellido"),r(),F(12,"input",16),m(13,Ye,2,0,"mat-error"),m(14,et,2,0,"mat-error"),m(15,tt,2,0,"mat-error"),r(),o(16,"mat-form-field",14)(17,"mat-label"),c(18,"Edad"),r(),F(19,"input",17),m(20,it,2,0,"mat-error"),m(21,at,2,0,"mat-error"),m(22,rt,2,0,"mat-error"),r(),o(23,"mat-form-field",14)(24,"mat-label"),c(25,"DNI"),r(),F(26,"input",18),m(27,ot,2,0,"mat-error"),m(28,nt,2,0,"mat-error"),r(),m(29,ct,7,5,"mat-form-field",14),o(30,"mat-form-field",14)(31,"mat-label"),c(32,"Email"),r(),F(33,"input",19),m(34,dt,2,0,"mat-error"),m(35,mt,2,0,"mat-error"),r(),o(36,"mat-form-field",14)(37,"mat-label"),c(38,"Contrase\xF1a"),r(),F(39,"input",20),m(40,pt,2,0,"mat-error"),m(41,ut,2,0,"mat-error"),r(),m(42,vt,11,6,"div",21),o(43,"div",22)(44,"label",23),c(45,"Foto Perfil"),r(),o(46,"input",24),x("change",function(n){f(e);let d=u();return h(d.onFileSelected(n,"perfil"))}),r(),m(47,bt,2,0,"mat-error"),m(48,Et,2,0,"mat-error"),r(),m(49,St,6,2,"div",22),o(50,"div",25)(51,"button",26)(52,"span"),c(53,"Registrarse"),r()()(),o(54,"div",27)(55,"button",28),x("click",function(){f(e);let n=u();return h(n.tipoUsuario=null)}),c(56," Cambiar tipo de usuario "),r()(),o(57,"div",29),m(58,wt,2,0,"div",30),o(59,"app-mi-captcha",31),x("captchaResuelto",function(n){f(e);let d=u();return h(d.onCaptchaResuelto(n))}),r()()()()}if(i&2){let e,a,n,d,_,M,G,$,v,W,Z,Q,b,J,K,E,X,Y,y,ee,te,ie,ae,l=u();s(),C("formGroup",l.registroForm),s(),C("ngClass",w(29,T,((e=l.registroForm.get("nombre"))==null?null:e.valid)&&(((e=l.registroForm.get("nombre"))==null?null:e.dirty)||((e=l.registroForm.get("nombre"))==null?null:e.touched)),((e=l.registroForm.get("nombre"))==null?null:e.invalid)&&(((e=l.registroForm.get("nombre"))==null?null:e.dirty)||((e=l.registroForm.get("nombre"))==null?null:e.touched)))),s(4),p((a=l.registroForm.get("nombre"))!=null&&a.hasError("required")?6:-1),s(),p((n=l.registroForm.get("nombre"))!=null&&n.hasError("minlength")?7:-1),s(),p((d=l.registroForm.get("nombre"))!=null&&d.hasError("pattern")?8:-1),s(),C("ngClass",w(32,T,((_=l.registroForm.get("apellido"))==null?null:_.valid)&&(((_=l.registroForm.get("apellido"))==null?null:_.dirty)||((_=l.registroForm.get("apellido"))==null?null:_.touched)),((_=l.registroForm.get("apellido"))==null?null:_.invalid)&&(((_=l.registroForm.get("apellido"))==null?null:_.dirty)||((_=l.registroForm.get("apellido"))==null?null:_.touched)))),s(4),p((M=l.registroForm.get("apellido"))!=null&&M.hasError("required")?13:-1),s(),p((G=l.registroForm.get("apellido"))!=null&&G.hasError("minlength")?14:-1),s(),p(($=l.registroForm.get("apellido"))!=null&&$.hasError("pattern")?15:-1),s(),C("ngClass",w(35,T,((v=l.registroForm.get("edad"))==null?null:v.valid)&&(((v=l.registroForm.get("edad"))==null?null:v.dirty)||((v=l.registroForm.get("edad"))==null?null:v.touched)),((v=l.registroForm.get("edad"))==null?null:v.invalid)&&(((v=l.registroForm.get("edad"))==null?null:v.dirty)||((v=l.registroForm.get("edad"))==null?null:v.touched)))),s(4),p((W=l.registroForm.get("edad"))!=null&&W.hasError("required")?20:-1),s(),p((Z=l.registroForm.get("edad"))!=null&&Z.hasError("min")?21:-1),s(),p((Q=l.registroForm.get("edad"))!=null&&Q.hasError("max")?22:-1),s(),C("ngClass",w(38,T,((b=l.registroForm.get("dni"))==null?null:b.valid)&&(((b=l.registroForm.get("dni"))==null?null:b.dirty)||((b=l.registroForm.get("dni"))==null?null:b.touched)),((b=l.registroForm.get("dni"))==null?null:b.invalid)&&(((b=l.registroForm.get("dni"))==null?null:b.dirty)||((b=l.registroForm.get("dni"))==null?null:b.touched)))),s(4),p((J=l.registroForm.get("dni"))!=null&&J.hasError("required")?27:-1),s(),p((K=l.registroForm.get("dni"))!=null&&K.hasError("pattern")?28:-1),s(),p(l.tipoUsuario==="paciente"?29:-1),s(),C("ngClass",w(41,T,((E=l.registroForm.get("mail"))==null?null:E.valid)&&(((E=l.registroForm.get("mail"))==null?null:E.dirty)||((E=l.registroForm.get("mail"))==null?null:E.touched)),((E=l.registroForm.get("mail"))==null?null:E.invalid)&&(((E=l.registroForm.get("mail"))==null?null:E.dirty)||((E=l.registroForm.get("mail"))==null?null:E.touched)))),s(4),p((X=l.registroForm.get("mail"))!=null&&X.hasError("required")?34:-1),s(),p((Y=l.registroForm.get("mail"))!=null&&Y.hasError("email")?35:-1),s(),C("ngClass",w(44,T,((y=l.registroForm.get("password"))==null?null:y.valid)&&(((y=l.registroForm.get("password"))==null?null:y.dirty)||((y=l.registroForm.get("password"))==null?null:y.touched)),((y=l.registroForm.get("password"))==null?null:y.invalid)&&(((y=l.registroForm.get("password"))==null?null:y.dirty)||((y=l.registroForm.get("password"))==null?null:y.touched)))),s(4),p((ee=l.registroForm.get("password"))!=null&&ee.hasError("required")?40:-1),s(),p((te=l.registroForm.get("password"))!=null&&te.hasError("minlength")?41:-1),s(),p(l.tipoUsuario==="especialista"?42:-1),s(5),p((ie=l.registroForm.get("imagenPerfil"))!=null&&ie.hasError("required")?47:-1),s(),p((ae=l.registroForm.get("imagen"))!=null&&ae.hasError("invalidType")?48:-1),s(),p(l.tipoUsuario==="paciente"?49:-1),s(2),C("disabled",l.registroForm.invalid),s(7),p(l.registroForm.errors!=null&&l.registroForm.errors.captchaInvalido&&l.registroForm.touched?58:-1)}}var qe=class i{registroForm;tipoUsuario=null;obraSocialOptions=ze;especialidadOptions=[];especialidadesSeleccionadas=new Set;captchaEsValido=!1;mostrarCampoOtraEspecialidad=!1;desplegableEspecialidadesAbierto=!1;captchaValidoValidator=()=>()=>this.captchaEsValido?null:{captchaInvalido:!0};subEspecialidad;fb=R(be);auth=R(z);snackBar=R(Re);router=R(pe);loading=R(Fe);elementRef=R(oe);ngOnInit(){this.registroForm=this.fb.group({nombre:["",[g.required,g.minLength(2),g.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],apellido:["",[g.required,g.minLength(2),g.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],edad:[null,[g.required,g.min(18),g.max(99)]],dni:["",[g.required,g.pattern(/^\d{8}$/)]],obraSocial:[""],mail:["",[g.required,g.email]],password:["",[g.required,g.minLength(7)]],especialidadesSeleccionadas:[[]],nuevaEspecialidad:["",[g.minLength(2),g.pattern(/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/)]],imagenPerfil:[null,g.required],imagenFondo:[""]},{validators:this.captchaValidoValidator()})}ngOnDestroy(){this.subEspecialidad&&this.subEspecialidad.unsubscribe()}seleccionarTipo(t){return S(this,null,function*(){if(this.tipoUsuario=t,!!this.registroForm){if(t==="especialista")try{this.loading.show(),this.especialidadOptions=yield this.auth.obtenerEspecialidades()}catch(e){console.error("Error al obtener especialidades:",e),this.snackBar.open("Error al cargar especialidades. Intente nuevamente.","Cerrar",{duration:3e3})}finally{this.loading.hide()}t==="paciente"?(this.registroForm.get("obraSocial")?.setValidators([g.required]),this.registroForm.get("imagenFondo")?.setValidators([g.required]),this.registroForm.get("especialidadesSeleccionadas")?.clearValidators(),this.registroForm.get("nuevaEspecialidad")?.clearValidators()):(this.registroForm.get("obraSocial")?.clearValidators(),this.registroForm.get("imagenFondo")?.clearValidators(),this.registroForm.get("especialidadesSeleccionadas")?.setValidators([this.alMenosUnaEspecialidadValidator()])),this.registroForm.get("obraSocial")?.updateValueAndValidity(),this.registroForm.get("imagenFondo")?.updateValueAndValidity(),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity()}})}alMenosUnaEspecialidadValidator(){return t=>{let e=t.value||[],a=this.registroForm?.get("nuevaEspecialidad")?.value;return e.length===0&&!a?{alMenosUna:!0}:null}}toggleEspecialidad(t){this.especialidadesSeleccionadas.has(t)?this.especialidadesSeleccionadas.delete(t):this.especialidadesSeleccionadas.add(t),this.actualizarEspecialidadesEnForm()}toggleMostrarNuevaEspecialidad(){this.mostrarCampoOtraEspecialidad=!this.mostrarCampoOtraEspecialidad,this.mostrarCampoOtraEspecialidad||this.registroForm.get("nuevaEspecialidad")?.setValue("")}toggleDesplegableEspecialidades(t){t&&t.stopPropagation(),this.desplegableEspecialidadesAbierto=!this.desplegableEspecialidadesAbierto}onClickOutside(t){if(!this.desplegableEspecialidadesAbierto)return;let e=t.target;this.elementRef.nativeElement.querySelector(".relative")?.contains(e)||(this.desplegableEspecialidadesAbierto=!1)}obtenerEspecialidadesSeleccionadasTexto(){return this.especialidadesSeleccionadas.size===0?"Ninguna seleccionada":Array.from(this.especialidadesSeleccionadas).map(e=>this.especialidadOptions.find(a=>a.id===e)?.nombre).filter(e=>e).join(", ")}esEspecialidadSeleccionada(t){return this.especialidadesSeleccionadas.has(t)}actualizarEspecialidadesEnForm(){let t=Array.from(this.especialidadesSeleccionadas);this.registroForm.get("especialidadesSeleccionadas")?.setValue(t),this.registroForm.get("especialidadesSeleccionadas")?.updateValueAndValidity()}onFileSelected(t,e){let a=e==="perfil"?"imagenPerfil":"imagenFondo",n=t.target,d=this.registroForm.get(a);if(!n.files?.length){d.setValue(null),d.setErrors({required:!0});return}let _=n.files[0];if(!["image/jpeg","image/png","image/jpg"].includes(_.type)){d.setErrors({invalidType:!0});return}d.setValue(_),d.setErrors(null)}registrar(){return S(this,null,function*(){if(!(this.registroForm.invalid||!this.tipoUsuario)){this.loading.show();try{this.tipoUsuario==="paciente"?yield this.handleRegistroPaciente():yield this.handleRegistroEspecialista()}finally{this.loading.hide()}}})}handleRegistroPaciente(){return S(this,null,function*(){try{let t=this.registroForm.value,e=yield j(t.imagenPerfil),a=yield j(t.imagenFondo),n={nombre:t.nombre,apellido:t.apellido,edad:t.edad,dni:t.dni,obraSocial:t.obraSocial,mail:t.mail,contrasena:t.password,imagenPerfil:e,imagenFondo:a},d=yield this.auth.registerPaciente(n),_=d.errorCode?.toLowerCase();console.log(d.errorCode),_?.includes("error desconocido")?this.mostrarResultado(d.success,d.message):this.mostrarResultado(d.success,d.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar las im\xE1genes.")}})}handleRegistroEspecialista(){return S(this,null,function*(){try{let t=this.registroForm.value,e=yield j(t.imagenPerfil),a=[];t.especialidadesSeleccionadas&&t.especialidadesSeleccionadas.length>0&&a.push(...t.especialidadesSeleccionadas.map(M=>String(M))),t.nuevaEspecialidad&&t.nuevaEspecialidad.trim()&&a.push(t.nuevaEspecialidad.trim());let n={nombre:t.nombre,apellido:t.apellido,edad:t.edad,dni:t.dni,mail:t.mail,contrasena:t.password,especialidades:a,imagenPerfil:e},d=yield this.auth.registerEspecialista(n);d.errorCode?.toLowerCase()?.includes("error desconocido")?this.mostrarResultado(d.success,d.message):this.mostrarResultado(d.success,d.errorCode)}catch{this.mostrarResultado(!1,"Error al procesar la imagen.")}})}mostrarResultado(t,e){if(!t){this.snackBar.open(e||"Ocurri\xF3 un error.","Cerrar",{duration:4e3,panelClass:["bg-red-600","text-white"]});return}this.tipoUsuario=null,this.router.navigate(["/welcome-page/confirmacion"])}onCaptchaResuelto(t){this.captchaEsValido=t,this.registroForm.updateValueAndValidity()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=A({type:i,selectors:[["app-register"]],hostBindings:function(e,a){e&1&&x("click",function(d){return a.onClickOutside(d)},le)},decls:5,vars:2,consts:[[1,"min-h-screen","bg-gray-200","pt-30","pb-60"],[1,"pb-1","text-center","text-4xl","font-bold","text-azul-oscuro"],[1,"pt-16","pb-30","text-center"],[1,"flex","justify-center","py-8"],[1,"mb-6","text-xl","text-gray-700"],[1,"flex","flex-col","items-center","gap-6"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Paciente",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],[1,"rounded-2xl","bg-white","shadow-lg"],["src","assets/imagenes/Registro/pacientes.jpg","alt","Paciente",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"p-4"],[1,"text-xl","font-bold","text-azul-oscuro"],["tabindex","0","role","button","aria-label","Seleccionar tipo de usuario Especialista",1,"w-[380px]","cursor-pointer","p-2","transition-transform","hover:scale-105",3,"click","keyup.enter","keyup.space"],["src","assets/imagenes/Registro/especialistas.jpg","alt","Especialista",1,"h-55","w-full","rounded-t-2xl","object-cover"],[1,"grid","w-full","max-w-2xl","grid-cols-1","gap-4","rounded-xl","bg-crema","p-8","shadow-lg","md:grid-cols-2",3,"ngSubmit","formGroup"],["appearance","fill",1,"col-span-1",3,"ngClass"],["matInput","","formControlName","nombre"],["matInput","","formControlName","apellido"],["matInput","","type","number","formControlName","edad"],["matInput","","formControlName","dni"],["matInput","","type","email","formControlName","mail"],["matInput","","type","password","formControlName","password"],[1,"col-span-2"],[1,"col-span-2","flex","flex-col","gap-2"],["for","fotoPerfil",1,"font-semibold","text-azul-oscuro"],["id","fotoPerfil","type","file","accept","image/*",1,"register-input",3,"change"],[1,"col-span-2","flex","justify-center","pt-4"],["mat-raised-button","","color","primary","type","submit",1,"flex","items-center","justify-center","gap-2","rounded-full","bg-verde-oscuro","px-8","py-2","text-white","shadow-lg",3,"disabled"],[1,"col-span-2","mt-1","flex","justify-center"],["mat-button","","type","button",1,"text-sm","text-gray-600","underline",3,"click"],[1,"col-span-2","mt-1","flex","flex-col","items-center"],[1,"mb-2","text-center","text-sm","text-red-600"],[3,"captchaResuelto"],["formControlName","obraSocial"],[3,"value"],[1,"mb-1","text-sm","font-medium","text-azul-oscuro"],[1,"relative"],["tabindex","0",1,"flex","min-h-[56px]","cursor-pointer","items-center","rounded-md","border","border-gray-300","bg-white","px-4","py-3","transition-colors","hover:border-azul-oscuro",3,"click","keyup.enter","keyup.space"],[1,"flex-1","text-sm","text-gray-700"],[1,"text-gray-500"],[1,"absolute","top-full","right-0","left-0","z-10","mt-1","max-h-60","overflow-y-auto","rounded-lg","border","border-gray-300","bg-white","p-3","shadow-lg"],[1,"mt-1","text-sm","text-red-600"],[1,"space-y-2"],[1,"block","text-sm",3,"checked"],[1,"mt-3","border-t","pt-2"],["type","button","mat-button","",1,"w-full","text-left","text-sm","text-azul-oscuro",3,"click"],[1,"mt-2"],[1,"block","text-sm",3,"change","checked"],["formControlName","nuevaEspecialidad","placeholder","Nombre de la especialidad",1,"w-full","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:border-azul-oscuro","focus:outline-none",3,"click"],[1,"mt-1","text-xs","text-red-600"],["for","fotoFondo",1,"font-semibold","text-azul-oscuro"],["id","fotoFondo","type","file","accept","image/*",1,"register-input",3,"change"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"h2",1),c(2,"Registro"),r(),m(3,Qe,16,0,"div",2),m(4,Rt,60,47,"div",3),r()),e&2&&(s(3),p(!a.tipoUsuario&&a.registroForm?3:-1),s(),p(a.tipoUsuario&&a.registroForm?4:-1))},dependencies:[O,P,ye,he,N,Ce,D,_e,xe,ve,Me,ke,Ve,Te,Ie,Ae,Ne,Oe,Pe,we,Se,ge,ue,je,De,q],styles:[".register-input[_ngcontent-%COMP%]{padding:12px 20px;margin:10px 0;border:2px solid #333;border-radius:6px;background-color:#222;color:#fff;font-size:16px;cursor:pointer;transition:all .3s ease}.register-input[_ngcontent-%COMP%]:hover{border-color:#92cc34;background-color:#2c2c2c}.register-input[_ngcontent-%COMP%]:focus{border-color:#19b44d;background-color:#2c2c2c;outline:none}.register-input[_ngcontent-%COMP%]::-webkit-file-upload-button{background-color:#fff;color:#fff;padding:8px 15px;border-radius:4px;border:none;cursor:pointer;font-size:14px;transition:background-color .3s ease}"]})};export{qe as Register};
