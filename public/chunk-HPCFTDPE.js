import"./chunk-GGQ7LRWG.js";import{a as X}from"./chunk-LMLVVXX5.js";import{a as B}from"./chunk-RLM7BZDW.js";import{c as V,d as P,f as x,g as T}from"./chunk-E6MHVRGS.js";import{b as z}from"./chunk-4DVJJQNQ.js";import"./chunk-BSLYAFLW.js";import"./chunk-X5YLR3NI.js";import{w as H}from"./chunk-E2BOE3LX.js";import{f as U,g as k,k as j,l as M}from"./chunk-MTWZV5NU.js";import{Cb as E,Eb as u,Ka as $,Ma as o,O,Pb as F,Ra as v,Sb as a,Tb as N,Ub as d,Vb as f,Xa as A,ab as m,ba as b,ca as C,cc as I,ec as w,f as D,ma as g,pb as c,qb as r,rb as t,sb as y,yb as S}from"./chunk-EMRS3JRH.js";import{i as h}from"./chunk-ODN5LVDJ.js";function G(i,n){i&1&&(r(0,"div")(1,"p",6),a(2,"Cargando pacientes..."),t()())}function J(i,n){if(i&1&&y(0,"img",18),i&2){let e=u().$implicit;c("src",e.paciente.urlImagenPerfil,$)}}function L(i,n){if(i&1&&(r(0,"li"),a(1),I(2,"date"),t()),i&2){let e=n.$implicit;o(),f(" \u2022 ",w(2,2,e.fechaHora,"short")," \u2013 ",e.especialidadNombre," ")}}function Q(i,n){if(i&1){let e=S();r(0,"div",9),E("click",function(){let p=b(e).$implicit,_=u(2);return C(_.seleccionarPaciente(p))}),m(1,J,1,1,"img",10),r(2,"div",11)(3,"p",12),a(4),t(),r(5,"p",13),a(6),t(),r(7,"p"),a(8),t(),r(9,"p"),a(10),t(),r(11,"p",14),a(12,"\xDAltimos 3 turnos:"),t(),r(13,"ul",15),m(14,L,3,5,"li",16),t(),r(15,"button",17),a(16," Ver historia cl\xEDnica "),t()()()}if(i&2){let e=n.$implicit;o(),c("ngIf",e.paciente.urlImagenPerfil),o(3),f(" ",e.paciente.nombre," ",e.paciente.apellido," "),o(2),N(e.paciente.email),o(2),d("DNI: ",e.paciente.dni),o(2),d("Edad: ",e.paciente.edad),o(4),c("ngForOf",e.citas)}}function W(i,n){if(i&1&&(r(0,"div",7),m(1,Q,17,7,"div",8),t()),i&2){let e=u();o(),c("ngForOf",e.pacientesConCitas)}}function Z(i,n){i&1&&(r(0,"div",6),a(1," No se encontraron pacientes atendidos. "),t())}function ee(i,n){if(i&1&&(r(0,"li"),a(1),t()),i&2){let e=n.$implicit;o(),f(" ",e.clave,": ",e.valor," ")}}function te(i,n){if(i&1&&(r(0,"div")(1,"p")(2,"strong"),a(3,"Fecha:"),t(),a(4),I(5,"date"),t(),r(6,"p")(7,"strong"),a(8,"Especialidad:"),t(),a(9),t(),r(10,"p")(11,"strong"),a(12,"Altura:"),t(),a(13),t(),r(14,"p")(15,"strong"),a(16,"Peso:"),t(),a(17),t(),r(18,"p")(19,"strong"),a(20,"Temperatura:"),t(),a(21),t(),r(22,"p")(23,"strong"),a(24,"Presi\xF3n arterial:"),t(),a(25),t(),r(26,"p")(27,"strong"),a(28,"Datos din\xE1micos:"),t()(),r(29,"ul",22),m(30,ee,2,2,"li",16),t(),y(31,"br"),t()),i&2){let e=n.$implicit;o(4),d(" ",w(5,7,e.fechaHora,"short")),o(5),d(" ",e.especialidadNombre),o(4),d(" ",e.alturaCm," cm"),o(4),d(" ",e.pesoKg," kg"),o(4),d(" ",e.temperaturaC," \xB0C"),o(4),d(" ",e.presionArterial),o(5),c("ngForOf",e.datosDinamicos)}}function ie(i,n){if(i&1){let e=S();r(0,"div",19)(1,"button",20),E("click",function(){b(e);let p=u();return C(p.cerrarHistoriaClinica())}),a(2," \u2190 Volver a pacientes "),t(),r(3,"h2",21),a(4),t(),m(5,te,32,10,"div",16),t()}if(i&2){let e,s,p=u();c("@slideInRight",void 0),o(4),f(" Historia cl\xEDnica de ",(e=p.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.nombre," ",(e=p.pacienteSeleccionado())==null||e.paciente==null?null:e.paciente.apellido," "),o(),c("ngForOf",(s=p.pacienteSeleccionado())==null?null:s.citas)}}var R=class i{constructor(n,e,s){this.turnosService=n;this.authSupabase=e;this.usuariosService=s;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new D;citas=g([]);cargando=g(!0);pacientesConCitas=[];pacienteSeleccionado=g(null);ngOnInit(){this.usuario$.pipe(O(this.destroy$)).subscribe(n=>h(this,null,function*(){if(!n){this.usuarioActual=null;return}n.id=typeof n.id=="string"?Number(n.id):n.id,this.usuarioActual=n,yield this.cargarCitasYPacientes()}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitasYPacientes(){return h(this,null,function*(){this.cargando.set(!0);try{if(this.usuarioActual?.id==null){this.pacientesConCitas=[],this.cargando.set(!1);return}let e=(yield this.turnosService.obtenerCitasEspecialista(this.usuarioActual.id)).filter(l=>l.estado==="completado"),s=new Map;for(let l of e)s.has(l.pacienteId)||s.set(l.pacienteId,[]),s.get(l.pacienteId).push(l);let _=(yield this.usuariosService.obtenerTodosUsuarios()).filter(l=>l.rol==="paciente");this.pacientesConCitas=_.filter(l=>s.has(l.id)).map(l=>{let Y=s.get(l.id).sort((K,q)=>new Date(q.fechaHora).getTime()-new Date(K.fechaHora).getTime()).slice(0,3);return{paciente:l,citas:Y}})}catch(n){console.error("Error cargando citas y pacientes",n),this.pacientesConCitas=[]}finally{this.cargando.set(!1)}})}seleccionarPaciente(n){this.pacienteSeleccionado.set(n)}cerrarHistoriaClinica(){this.pacienteSeleccionado.set(null)}static \u0275fac=function(e){return new(e||i)(v(B),v(z),v(X))};static \u0275cmp=A({type:i,selectors:[["app-pacientes"]],decls:6,vars:6,consts:[[1,"flex","h-full","w-full","gap-4","p-1"],[1,"h-full","min-w-0","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","pb-6","shadow-inner","transition-all","duration-700","ease-in-out"],[4,"ngIf"],["class","flex flex-wrap justify-start gap-6",4,"ngIf"],["class","text-center text-gray-500",4,"ngIf"],["class","w-full translate-x-0 rounded-2xl bg-white p-10 transition-all duration-700 ease-in-out md:w-[35%]",4,"ngIf"],[1,"text-center","text-gray-500"],[1,"flex","flex-wrap","justify-start","gap-6"],["class","h-auto w-[300px] cursor-pointer rounded-lg border border-gray-300 bg-white p-4 shadow-sm transition hover:shadow-md",3,"click",4,"ngFor","ngForOf"],[1,"h-auto","w-[300px]","cursor-pointer","rounded-lg","border","border-gray-300","bg-white","p-4","shadow-sm","transition","hover:shadow-md",3,"click"],["alt","Avatar","class","mb-2 h-14 w-14 rounded-full object-cover","appTrackImage","",3,"src",4,"ngIf"],[1,"text-sm"],[1,"font-semibold","text-azul-oscuro"],[1,"text-gray-600"],[1,"mt-2","font-semibold","text-gray-700"],[1,"list-inside","list-disc","text-sm","text-gray-600"],[4,"ngFor","ngForOf"],["type","button",1,"mt-3","rounded","bg-indigo-600","px-3","py-1","text-sm","font-semibold","text-white","transition","hover:bg-indigo-700"],["alt","Avatar","appTrackImage","",1,"mb-2","h-14","w-14","rounded-full","object-cover",3,"src"],[1,"w-full","translate-x-0","rounded-2xl","bg-white","p-10","transition-all","duration-700","ease-in-out","md:w-[35%]"],[1,"mb-4","self-start","rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","transition","hover:bg-gray-100",3,"click"],[1,"mb-4","text-xl","font-semibold","text-azul-oscuro"],[1,"list-inside","list-disc","text-sm"]],template:function(e,s){e&1&&(r(0,"div",0)(1,"div",1),m(2,G,3,0,"div",2)(3,W,2,1,"div",3)(4,Z,2,0,"div",4),t(),m(5,ie,6,4,"div",5),t()),e&2&&(o(),F("width",s.pacienteSeleccionado()?"65%":"100%"),o(),c("ngIf",s.cargando()),o(),c("ngIf",!s.cargando()&&s.pacientesConCitas.length>0),o(),c("ngIf",!s.cargando()&&s.pacientesConCitas.length===0),o(),c("ngIf",s.pacienteSeleccionado()))},dependencies:[M,U,k,H,j],encapsulation:2,data:{animation:[V("slideInRight",[T(":enter",[x({transform:"translateX(100%)",opacity:0}),P("600ms ease-in-out",x({transform:"translateX(0)",opacity:1}))]),T(":leave",[P("400ms ease-in",x({transform:"translateX(100%)",opacity:0}))])])]}})};export{R as Pacientes};
