import{b as G}from"./chunk-ISZQ6G3H.js";import"./chunk-GGQ7LRWG.js";import{c as k,d as M,f as g,g as b,h as P,i as $,j as O}from"./chunk-P2GLRHRS.js";import{a as X,b as Y}from"./chunk-WKNXHDPQ.js";import{n as q}from"./chunk-M2F6BYP4.js";import{b as W}from"./chunk-VPTHVLTQ.js";import{k as R}from"./chunk-YDT6XDAL.js";import"./chunk-LMZWYZYD.js";import"./chunk-UIGXKFJS.js";import"./chunk-FFHKXHWV.js";import"./chunk-DDKTLT4U.js";import{Ab as E,Eb as w,Gb as c,Ma as A,Oa as o,P as L,Sb as D,Ta as I,Ub as l,Vb as N,Wb as F,Xb as V,Za as z,ca as S,cc as U,da as v,f as j,na as d,nb as u,ob as m,oc as B,qb as C,rb as y,sb as T,tb as h,ub as s,vb as r,wb as f}from"./chunk-PTIYVII4.js";import{j as p}from"./chunk-K4ALXBGI.js";function H(i,t){return p(this,null,function*(){i.set(!0);try{return yield t()}finally{i.set(!1)}})}var ee=()=>[1,2,3,4,5,6,7];function ie(i,t){if(i&1){let e=E();s(0,"button",8),w("click",function(){let n=S(e).$implicit,_=c(3);return v(_.seleccionarEspecialista(n))}),f(1,"img",9),s(2,"span",10),l(3),r()()}if(i&2){let e,a=t.$implicit,n=c(3);D("opacity-50",n.especialistaSeleccionado()&&n.especialistaSeleccionado().id!==a.id),h("@botonBounce",void 0),o(),D("border-blue-600",((e=n.especialistaSeleccionado())==null?null:e.id)===a.id),h("src",a.imagenPerfil||"assets/default-avatar.png",A),o(2),V("",a.nombre," ",a.apellido)}}function te(i,t){if(i&1&&(s(0,"div")(1,"h2",5),l(2," Seleccion\xE1 un profesional "),r(),s(3,"div",6),y(4,ie,4,8,"button",7,C),r()()),i&2){let e=c(2);o(3),h("@listaStagger",void 0),o(),T(e.especialistasValidados())}}function ae(i,t){i&1&&(s(0,"div",3)(1,"p",11),l(2," No se encontraron especialistas con fechas disponibles en los pr\xF3ximos 15 d\xEDas. "),r()())}function ne(i,t){if(i&1){let e=E();s(0,"button",14),w("click",function(){let n=S(e).$implicit,_=c(3);return v(_.seleccionarEspecialidad(n))}),f(1,"img",15),s(2,"span",16),l(3),r()()}if(i&2){let e,a=t.$implicit,n=c(3);D("border-blue-600",((e=n.especialidadSeleccionada())==null?null:e.id)===a.id)("opacity-50",n.especialidadSeleccionada()&&n.especialidadSeleccionada().id!==a.id),h("@especialidadAnimacion",void 0),o(),h("src",a.icono||"assets/default-icon.png",A),o(2),N(a.nombre)}}function oe(i,t){i&1&&(s(0,"p",13),l(1," No hay especialidades disponibles. "),r())}function se(i,t){if(i&1&&(s(0,"div")(1,"h2",5),l(2," ---- Seleccion\xE1 una especialidad ---- "),r(),s(3,"div",6),y(4,ne,4,7,"button",12,C),r(),u(6,oe,2,0,"p",13),r()),i&2){let e=c(2);o(3),h("@listaAnimacion",void 0),o(),T(e.especialidades()),o(2),m(e.noHayEspecialidades()?6:-1)}}function re(i,t){i&1&&f(0,"div",18)}function le(i,t){i&1&&(s(0,"div",17),y(1,re,1,0,"div",18,C),r()),i&2&&(o(),T(U(0,ee)))}function ce(i,t){if(i&1){let e=E();s(0,"button",20),w("click",function(){let n=S(e).$implicit,_=c(4);return v(_.seleccionarFecha(n))}),l(1),r()}if(i&2){let e=t.$implicit,a=c(4);D("bg-blue-600",a.fechaSeleccionada()===e)("text-white",a.fechaSeleccionada()===e),h("@botonBounce",void 0),o(),F(" ",e," ")}}function de(i,t){if(i&1&&(s(0,"div",17),y(1,ce,2,6,"button",19,C),r()),i&2){let e=c(3);h("@listaStagger",void 0),o(),T(e.fechasDisponibles())}}function pe(i,t){i&1&&(s(0,"p",13),l(1,"No hay d\xEDas disponibles."),r())}function ue(i,t){if(i&1&&(s(0,"div")(1,"h2",5),l(2," ---- Seleccion\xE1 un d\xEDa ---- "),r(),u(3,le,3,1,"div",17)(4,de,3,1,"div",17),u(5,pe,2,0,"p",13),r()),i&2){let e=c(2);o(3),m(e.cargandoDiasProgresivo()?3:4),o(2),m(e.noHayFechas()?5:-1)}}function me(i,t){if(i&1){let e=E();s(0,"button",22),w("click",function(){let n=S(e).$implicit,_=c(3);return v(_.seleccionarHorario(n))}),l(1),r()}if(i&2){let e=t.$implicit,a=c(3);D("bg-green-500",a.horaSelecionada()===e)("text-white",a.horaSelecionada()===e),h("@botonBounce",void 0),o(),F(" ",e," ")}}function he(i,t){i&1&&(s(0,"p",13),l(1," No hay turnos disponibles. "),r())}function _e(i,t){if(i&1&&(s(0,"div")(1,"h2",5),l(2," ---- Seleccion\xE1 un horario ---- "),r(),s(3,"div",17),y(4,me,2,6,"button",21,C),r(),u(6,he,2,0,"p",13),r()),i&2){let e=c(2);o(3),h("@listaStagger",void 0),o(),T(e.horariosDisponibles()),o(2),m(e.noHayHorarios()?6:-1)}}function fe(i,t){if(i&1){let e=E();s(0,"div",4)(1,"p",23),l(2," Seleccionaste: "),s(3,"strong"),l(4),r(),f(5,"br"),l(6," Especialidad: "),s(7,"strong"),l(8),r(),f(9,"br"),l(10," D\xEDa: "),s(11,"strong"),l(12),r(),f(13,"br"),l(14," Hora: "),s(15,"strong"),l(16),r()(),s(17,"div",24)(18,"button",25),w("click",function(){S(e);let n=c(2);return v(n.cargarCita())}),l(19," Confirmar "),r()()()}if(i&2){let e,a,n=c(2);o(4),V("",(e=n.especialistaSeleccionado())==null?null:e.nombre," ",(e=n.especialistaSeleccionado())==null?null:e.apellido),o(4),N((a=n.especialidadSeleccionada())==null?null:a.nombre),o(4),N(n.fechaSeleccionada()),o(4),N(n.horaSelecionada())}}function ge(i,t){if(i&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),u(3,te,6,1,"div"),u(4,ae,3,0,"div",3),u(5,se,7,2,"div"),u(6,ue,6,2,"div"),u(7,_e,7,2,"div"),u(8,fe,20,5,"div",4),r()()()),i&2){let e=c();h("@slideInFromRight",e.primeraVezAnimando),o(3),m(e.especialistas().length?3:-1),o(),m(e.noHayEspecialistas()?4:-1),o(),m(e.especialistaSeleccionado()?5:-1),o(),m(e.especialidadSeleccionada()?6:-1),o(),m(e.fechaSeleccionada()?7:-1),o(),m(e.horaSelecionada()?8:-1)}}var J=class i{constructor(t,e,a,n){this.turnosService=t;this.loadin=e;this.authSupabase=a;this.snackBar=n;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new j;especialistas=d([]);especialidades=d([]);fechasDisponibles=d([]);horariosDisponibles=d([]);cargandoDiasProgresivo=d(!1);especialistaSeleccionado=d(null);especialidadSeleccionada=d(null);fechaSeleccionada=d(null);horaSelecionada=d(null);especialidadesBuscadas=d(!1);diasBuscados=d(!1);horasBuscadas=d(!1);especialistasBuscados=d(!1);cargando=d(!1);mostrarContenido=!1;primeraVezAnimando=!0;especialistasValidados=B(()=>this.especialistas().filter(t=>t.validadoAdmin===!0));noHayEspecialistas=B(()=>this.especialistasBuscados()===!0&&this.especialistas().length===0);noHayEspecialidades=B(()=>this.especialistaSeleccionado()!==null&&this.especialidadesBuscadas()===!0&&this.especialidades().length===0);noHayFechas=B(()=>this.especialidadSeleccionada()!==null&&this.diasBuscados()===!0&&this.fechasDisponibles().length===0);noHayHorarios=B(()=>this.fechaSeleccionada()!==null&&this.horasBuscadas()===!0&&this.horariosDisponibles().length===0);ngOnInit(){return p(this,null,function*(){this.usuario$.pipe(L(this.destroy$)).subscribe(a=>{if(!a){this.usuarioActual=null;return}a.id=typeof a.id=="string"?Number(a.id):a.id,this.usuarioActual=a});let e=(yield this.turnosService.obtenerEspecialistas()).filter(a=>a.validadoAdmin===!0&&a.activo===!0);this.loadin.hide(),setTimeout(()=>{this.mostrarContenido=!0,setTimeout(()=>{this.especialistas.set(e),this.especialistasBuscados.set(!0)},200)},100)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}seleccionarEspecialista(t){return p(this,null,function*(){this.primeraVezAnimando=!1,this.especialistaSeleccionado.set(t),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.fechasDisponibles.set([]),this.especialidadesBuscadas.set(!1),this.diasBuscados.set(!1),this.horasBuscadas.set(!1),yield H(this.cargando,()=>p(this,null,function*(){let e=yield this.turnosService.obtenerEspecialidadesDeEspecialista(t.id);this.especialidades.set(e),this.especialidadesBuscadas.set(!0)}))})}seleccionarEspecialidad(t){return p(this,null,function*(){this.especialidadSeleccionada.set(t),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null),this.horariosDisponibles.set([]),this.fechasDisponibles.set([]),this.diasBuscados.set(!1),this.cargandoDiasProgresivo.set(!0);try{let{inicial:e,completar:a}=yield this.turnosService.obtenerFechasConHorariosDisponiblesProgresivo(this.especialistaSeleccionado().id,t.duracion,this.usuarioActual?.id,7,15);this.fechasDisponibles.set(e),this.diasBuscados.set(!0),this.cargandoDiasProgresivo.set(!1),setTimeout(()=>p(this,null,function*(){let n=yield a();this.fechasDisponibles.set(n)}),100)}catch(e){console.error("Error al cargar disponibilidad:",e),this.diasBuscados.set(!0),this.cargandoDiasProgresivo.set(!1)}})}seleccionarFecha(t){return p(this,null,function*(){this.horaSelecionada.set(null),this.fechaSeleccionada.set(t),yield H(this.cargando,()=>p(this,null,function*(){let e=yield this.turnosService.obtenerHorariosDisponibles(t,this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion,this.usuarioActual?.id);this.horariosDisponibles.set(e),this.horasBuscadas.set(!0)}))})}seleccionarHorario(t){this.horaSelecionada.set(t)}cargarCita(){return p(this,null,function*(){let t=this.fechaSeleccionada(),e=this.horaSelecionada(),a=this.especialistaSeleccionado(),n=this.especialidadSeleccionada(),_=this.usuarioActual;if(!t||!e||!a||!n||!_){console.error("Datos incompletos para agendar la cita");return}let K={fechaHora:new Date(`${t}T${e}:00`),duracionMin:n.duracion,pacienteId:_.id,especialistaId:a.id,especialidadId:n.id,estado:"solicitado",comentarioPaciente:" ",comentarioEspecialista:" ",resenia:" "};try{let x=yield this.turnosService.darAltaCita(K);if(x.success)this.snackBar.open("Cita agendada exitosamente","\u2713",{duration:4e3,panelClass:["bg-green-600","text-white"]}),this.especialistaSeleccionado.set(null),this.especialidadSeleccionada.set(null),this.fechaSeleccionada.set(null),this.horaSelecionada.set(null);else{let Q=x.errorCode==="horario_no_disponible"?"El horario seleccionado ya no est\xE1 disponible. Por favor, selecciona otro horario.":x.message||"No se pudo agendar la cita";this.snackBar.open(Q,"\u2715",{duration:6e3,panelClass:["bg-red-600","text-white"]}),x.errorCode==="horario_no_disponible"&&(this.horaSelecionada.set(null),yield H(this.cargando,()=>p(this,null,function*(){let Z=yield this.turnosService.obtenerHorariosDisponibles(this.fechaSeleccionada(),this.especialistaSeleccionado().id,this.especialidadSeleccionada().duracion,this.usuarioActual?.id);this.horariosDisponibles.set(Z)})))}}catch(x){console.error("Error al cargar la cita:",x),this.snackBar.open("Error inesperado al procesar la solicitud","\u2715",{duration:4e3,panelClass:["bg-red-600","text-white"]})}})}static \u0275fac=function(e){return new(e||i)(I(G),I(R),I(W),I(q))};static \u0275cmp=z({type:i,selectors:[["app-solicitar-turno"]],decls:2,vars:1,consts:[[1,"h-full","w-full","overflow-hidden","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-crema","p-6","shadow-inner"],[1,"mx-auto","max-w-4xl","space-y-8","p-4"],[1,"text-center"],[1,"mt-8","text-center"],[1,"mb-4","text-center","text-xl","font-semibold"],[1,"flex","flex-wrap","justify-center","gap-4"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"opacity-50"],[1,"flex","flex-col","items-center","space-y-1","focus:outline-none",3,"click"],["alt","profesional","appTrackImage","",1,"h-20","w-20","rounded-full","border","object-cover","shadow",3,"src"],[1,"text-center","text-sm"],[1,"text-lg","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","hover:bg-blue-50",3,"border-blue-600","opacity-50"],[1,"mt-4","text-center","text-red-500"],[1,"flex","h-21","w-21","flex-col","items-center","justify-center","rounded-lg","border","bg-white","shadow","hover:bg-blue-50",3,"click"],["alt","icono","appTrackImage","",1,"mb-2","h-10","w-10",3,"src"],[1,"text-center","text-xs"],[1,"flex","flex-wrap","justify-center","gap-2"],[1,"h-10","w-24","animate-pulse","rounded","bg-gray-200"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"bg-blue-600","text-white"],[1,"rounded","bg-blue-100","px-4","py-2","text-sm","font-medium","hover:bg-blue-200",3,"click"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"bg-green-500","text-white"],[1,"h-12","w-16","rounded-lg","bg-green-200","text-sm","font-semibold","hover:bg-green-300",3,"click"],[1,"text-sm","text-gray-600"],[1,"pt-4"],[1,"rounded","bg-blue-200","px-4","py-2","text-lg","font-medium","hover:bg-blue-300",3,"click"]],template:function(e,a){e&1&&(s(0,"app-loading-wrapper"),u(1,ge,9,7,"div",0),r()),e&2&&(o(),m(a.mostrarContenido?1:-1))},dependencies:[X,Y],encapsulation:2,data:{animation:[k("slideInFromRight",[b("true => false",[]),b("* => true",[g({transform:"translateX(150%)",opacity:0}),M("600ms cubic-bezier(0.35, 0, 0.25, 1)",g({transform:"translateX(0)",opacity:1}))])]),k("botonBounce",[b(":enter",[g({opacity:0,transform:"scale(0.3) translateY(-20px)"}),M("800ms cubic-bezier(0.68, -0.55, 0.265, 1.55)",g({opacity:1,transform:"scale(1) translateY(0)"}))])]),k("listaStagger",[b(":enter",[$("@botonBounce",O(80,P()),{optional:!0})])]),k("especialidadAnimacion",[b(":enter",[g({opacity:0,transform:"scale(0.5)"}),M("500ms cubic-bezier(0.34, 1.56, 0.64, 1)",g({opacity:1,transform:"scale(1)"}))])]),k("listaAnimacion",[b(":enter",[$("@especialidadAnimacion",O(150,P()),{optional:!0})])])]}})};export{J as SolicitarTurno};
