import{a as le,b as se}from"./chunk-ALGUTR3Y.js";import{a as de}from"./chunk-CZ6G7NRF.js";import{a as H}from"./chunk-XF3OUTFH.js";import{b as G}from"./chunk-LJPIDVEV.js";import{n as j}from"./chunk-PSUGFJZX.js";import{b as oe}from"./chunk-3RRXKLDM.js";import{b as q,c as W,k as ce}from"./chunk-Z4223MVF.js";import"./chunk-LMZWYZYD.js";import"./chunk-FA34LLBW.js";import{b as ee,c as B,g as D,h as te,i as ie,j as R,k as ae,m as ne,n as re,x as z}from"./chunk-AHNE7AS4.js";import"./chunk-3BX3P6FI.js";import{h as X,i as Y,j as I}from"./chunk-PUIB254N.js";import{Ab as g,Eb as p,Gb as s,Oa as l,P as Z,Rb as O,Sb as N,Ta as S,Ub as o,Vb as T,Wb as _,Yb as E,Za as V,Zb as y,_b as w,ca as u,cc as L,da as m,eb as F,f as K,gc as M,hc as J,ic as A,na as b,nb as x,ob as f,qb as k,rb as h,sb as v,tb as C,ub as i,vb as a,wb as Q}from"./chunk-JXJDPNLJ.js";import{j as P}from"./chunk-K4ALXBGI.js";var ge=()=>[1,2,3,4,5],ue=(n,t)=>t.valor;function Ce(n,t){if(n&1){let e=g();i(0,"button",23),p("click",function(c){let d=u(e).$implicit;return s().setCalificacion(d),m(c.stopPropagation())})("mouseenter",function(){let c=u(e).$implicit,d=s();return m(d.setHover(c))})("mouseleave",function(){u(e);let c=s();return m(c.setHover(0))}),o(1," \u2605 "),a()}if(n&2){let e=t.$implicit,r=s();N("text-yellow-400",e<=(r.estrellasHover||r.calificacionEstrellas))("text-gray-300",e>(r.estrellasHover||r.calificacionEstrellas))}}function be(n,t){if(n&1&&(i(0,"span",12),o(1),a()),n&2){let e=s();l(),_(" ",e.calificacionEstrellas," de 5 ")}}function he(n,t){if(n&1){let e=g();i(0,"label",13)(1,"input",24),w("ngModelChange",function(c){u(e);let d=s();return y(d.seleccionRadio,c)||(d.seleccionRadio=c),m(c)}),a(),i(2,"span",25),o(3),a()()}if(n&2){let e=t.$implicit,r=s();l(),E("ngModel",r.seleccionRadio),C("value",e.valor),l(2),T(e.etiqueta)}}function ve(n,t){if(n&1){let e=g();i(0,"label",13)(1,"input",26),w("ngModelChange",function(c){let d=u(e).$implicit;return y(d.seleccionado,c)||(d.seleccionado=c),m(c)}),a(),i(2,"span",25),o(3),a()()}if(n&2){let e=t.$implicit;l(),E("ngModel",e.seleccionado),C("name","checkbox-"+e.valor),l(2),T(e.etiqueta)}}var $=class n{constructor(t){this.snackBar=t}cita;pacienteId;cerrar=new F;encuestaEnviada=new F;cargando=b(!1);experienciaGeneral="";calificacionEstrellas=0;estrellasHover=0;opcionesRadio=[{valor:"excelente",etiqueta:"Excelente"},{valor:"muy-bueno",etiqueta:"Muy bueno"},{valor:"bueno",etiqueta:"Bueno"},{valor:"regular",etiqueta:"Regular"},{valor:"malo",etiqueta:"Malo"}];seleccionRadio="";opcionesCheckbox=[{valor:"puntualidad",etiqueta:"Puntualidad",seleccionado:!1},{valor:"profesionalismo",etiqueta:"Profesionalismo",seleccionado:!1},{valor:"claridad",etiqueta:"Claridad en las explicaciones",seleccionado:!1},{valor:"empatia",etiqueta:"Empat\xEDa",seleccionado:!1},{valor:"instalaciones",etiqueta:"Instalaciones limpias",seleccionado:!1},{valor:"tiempo-espera",etiqueta:"Poco tiempo de espera",seleccionado:!1},{valor:"seguimiento",etiqueta:"Buen seguimiento",seleccionado:!1},{valor:"recomendaria",etiqueta:"Lo recomendar\xEDa",seleccionado:!1}];valorRango=50;setCalificacion(t){this.calificacionEstrellas=t}setHover(t){this.estrellasHover=t}getCheckboxSeleccionados(){return this.opcionesCheckbox.filter(t=>t.seleccionado).map(t=>t.valor).join(",")}validarFormulario(){return this.experienciaGeneral.trim()?this.calificacionEstrellas===0?(this.snackBar.open("Por favor, seleccione una calificaci\xF3n en estrellas.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]}),!1):this.seleccionRadio?this.getCheckboxSeleccionados()?!0:(this.snackBar.open("Por favor, seleccione al menos un aspecto destacado.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]}),!1):(this.snackBar.open("Por favor, seleccione una opci\xF3n de satisfacci\xF3n general.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]}),!1):(this.snackBar.open("Por favor, comparta su experiencia general.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]}),!1)}enviarEncuesta(){return P(this,null,function*(){if(this.validarFormulario()){this.cargando.set(!0);try{let{error:t}=yield q.from(W.ENCUESTAS_PACIENTES).insert([{idPaciente:this.pacienteId,idEspecialista:this.cita.especialistaId,idCita:this.cita.citaId,especialidad:this.cita.especialidadNombre,textBox:this.experienciaGeneral.trim(),estrellas:this.calificacionEstrellas,radioButton:this.seleccionRadio,checkBox:this.getCheckboxSeleccionados(),rango:this.valorRango}]);if(t){console.error("Error al guardar encuesta:",t),this.snackBar.open("Ocurri\xF3 un error al enviar la encuesta.","Cerrar",{duration:4e3,panelClass:["bg-red-600","text-white"]});return}this.snackBar.open("Encuesta enviada exitosamente. \xA1Gracias!","Cerrar",{duration:3e3,panelClass:["bg-green-600","text-white"]}),this.encuestaEnviada.emit(),this.cerrarModal()}catch(t){console.error("Error inesperado:",t),this.snackBar.open("Ocurri\xF3 un error inesperado.","Cerrar",{duration:4e3,panelClass:["bg-red-600","text-white"]})}finally{this.cargando.set(!1)}}})}cerrarModal(){this.cerrar.emit()}static \u0275fac=function(e){return new(e||n)(S(j))};static \u0275cmp=V({type:n,selectors:[["app-encuesta-paciente"]],inputs:{cita:"cita",pacienteId:"pacienteId"},outputs:{cerrar:"cerrar",encuestaEnviada:"encuestaEnviada"},decls:57,vars:8,consts:[[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm"],["appClickFueraPopup","","tabindex","0","role","dialog","aria-modal","true",1,"max-h-[90vh]","w-full","max-w-2xl","overflow-y-auto","rounded-2xl","bg-white","p-8","shadow-lg",3,"clickFuera","click","mousedown","keydown"],[1,"mb-6","text-center","text-2xl","font-bold","text-azul-oscuro"],[1,"mb-6","text-center","text-sm","text-gray-600"],[1,"space-y-6",3,"ngSubmit"],[1,"space-y-2"],["for","experiencia",1,"block","text-sm","font-semibold","text-azul-oscuro"],[1,"text-red-500"],["id","experiencia","name","experiencia","rows","4","placeholder","Contanos sobre tu experiencia durante la consulta...",1,"w-full","resize-none","rounded-lg","border","border-gray-300","px-4","py-3","text-sm","focus:ring-2","focus:ring-azul-oscuro","focus:outline-none",3,"ngModelChange","ngModel"],[1,"block","text-sm","font-semibold","text-azul-oscuro"],[1,"flex","items-center","gap-2"],["type","button",1,"text-4xl","transition-transform","hover:scale-110","focus:outline-none",3,"text-yellow-400","text-gray-300"],[1,"ml-2","text-sm","text-gray-600"],[1,"flex","cursor-pointer","items-center","gap-2","rounded","px-2","py-1","hover:bg-gray-50"],[1,"grid","grid-cols-2","gap-2"],["for","rango",1,"block","text-sm","font-semibold","text-azul-oscuro"],[1,"space-y-3"],["id","rango","type","range","name","rango","min","1","max","100",1,"h-2","w-full","cursor-pointer","appearance-none","rounded-lg","bg-gray-200","accent-azul-oscuro",3,"ngModelChange","ngModel"],[1,"flex","items-center","justify-between","text-xs","text-gray-500"],[1,"text-lg","font-bold","text-azul-oscuro"],[1,"flex","items-center","justify-end","gap-3","border-t","pt-4"],["type","button",1,"rounded-lg","border","border-gray-300","bg-white","px-6","py-2","text-sm","text-gray-700","shadow-sm","hover:bg-gray-100","disabled:opacity-50",3,"click","disabled"],["type","submit",1,"rounded-lg","bg-azul-oscuro","px-6","py-2","text-sm","font-semibold","text-white","shadow","hover:bg-azul-oscuro/90","disabled:opacity-50",3,"disabled"],["type","button",1,"text-4xl","transition-transform","hover:scale-110","focus:outline-none",3,"click","mouseenter","mouseleave"],["type","radio","name","satisfaccion",1,"h-4","w-4","accent-azul-oscuro",3,"ngModelChange","ngModel","value"],[1,"text-sm","text-gray-700"],["type","checkbox",1,"h-4","w-4","accent-azul-oscuro",3,"ngModelChange","ngModel","name"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1),p("clickFuera",function(){return r.cerrarModal()})("click",function(d){return d.stopPropagation()})("mousedown",function(d){return d.stopPropagation()})("keydown",function(d){return d.stopPropagation()}),i(2,"h2",2),o(3," Encuesta de Satisfacci\xF3n "),a(),i(4,"p",3),o(5," Tu opini\xF3n es muy importante para nosotros. Por favor, tom\xE1 un momento para completar esta encuesta sobre tu experiencia. "),a(),i(6,"form",4),p("ngSubmit",function(d){return r.enviarEncuesta(),d.stopPropagation()}),i(7,"div",5)(8,"label",6),o(9," 1. \xBFC\xF3mo fue tu experiencia en la cita? "),i(10,"span",7),o(11,"*"),a()(),i(12,"textarea",8),w("ngModelChange",function(d){return y(r.experienciaGeneral,d)||(r.experienciaGeneral=d),d}),a()(),i(13,"div",5)(14,"div",9),o(15," 2. \xBFQu\xE9 calificaci\xF3n le dar\xEDas a la atenci\xF3n recibida? "),i(16,"span",7),o(17,"*"),a()(),i(18,"div",10),h(19,Ce,2,4,"button",11,k),x(21,be,2,1,"span",12),a()(),i(22,"div",5)(23,"div",9),o(24," 3. \xBFC\xF3mo calificar\xEDas tu satisfacci\xF3n general? "),i(25,"span",7),o(26,"*"),a()(),i(27,"div",5),h(28,he,4,3,"label",13,ue),a()(),i(30,"div",5)(31,"div",9),o(32," 4. \xBFQu\xE9 aspectos destacar\xEDas de la atenci\xF3n? (pod\xE9s seleccionar varios) "),i(33,"span",7),o(34,"*"),a()(),i(35,"div",14),h(36,ve,4,3,"label",13,ue),a()(),i(38,"div",5)(39,"label",15),o(40," 5. \xBFQu\xE9 probabilidad hay de que recomiendes este servicio? (1-100) "),i(41,"span",7),o(42,"*"),a()(),i(43,"div",16)(44,"input",17),w("ngModelChange",function(d){return y(r.valorRango,d)||(r.valorRango=d),d}),a(),i(45,"div",18)(46,"span"),o(47,"Poco probable"),a(),i(48,"span",19),o(49),a(),i(50,"span"),o(51,"Muy probable"),a()()()(),i(52,"div",20)(53,"button",21),p("click",function(d){return r.cerrarModal(),d.stopPropagation()}),o(54," Cancelar "),a(),i(55,"button",22),o(56),a()()()()()),e&2&&(l(12),E("ngModel",r.experienciaGeneral),l(7),v(L(7,ge)),l(2),f(r.calificacionEstrellas>0?21:-1),l(7),v(r.opcionesRadio),l(8),v(r.opcionesCheckbox),l(8),E("ngModel",r.valorRango),l(5),T(r.valorRango),l(4),C("disabled",r.cargando()),l(2),C("disabled",r.cargando()),l(),_(" ",r.cargando()?"Enviando...":"Enviar Encuesta"," "))},dependencies:[I,z,ae,B,re,ee,ne,D,te,R,ie,H],styles:["input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{appearance:none;width:20px;height:20px;border-radius:50%;background:var(--color-azul-oscuro);cursor:pointer;transition:transform .2s}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb:hover{transform:scale(1.2)}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:var(--color-azul-oscuro);cursor:pointer;border:none;transition:transform .2s}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb:hover{transform:scale(1.2)}button[type=button][_ngcontent-%COMP%]{transition:all .2s ease-in-out}"]})};var ye=()=>[1,2,3,4,5];function we(n,t){n&1&&(i(0,"div",6)(1,"div",7),o(2,"Cargando opciones..."),a()())}function Pe(n,t){if(n&1){let e=g();i(0,"button",14),p("click",function(){u(e);let c=s(3);return m(c.mostrarFormularioCancelar=!0)}),o(1," Cancelar turno "),a()}}function Se(n,t){if(n&1){let e=g();i(0,"button",15),p("click",function(){u(e);let c=s(3);return m(c.verResenia())}),o(1," Ver rese\xF1a "),a()}}function ke(n,t){if(n&1){let e=g();i(0,"button",16),p("click",function(){u(e);let c=s(3);return m(c.mostrarFormularioCalificar=!0)}),o(1," Calificar atenci\xF3n "),a()}}function Te(n,t){if(n&1){let e=g();i(0,"button",17),p("click",function(){u(e);let c=s(3);return m(c.verComentarioPaciente())}),o(1," Ver mi comentario "),a()}}function Me(n,t){if(n&1){let e=g();i(0,"button",18),p("click",function(){u(e);let c=s(3);return m(c.abrirEncuesta())}),o(1," Cargar encuesta "),a()}}function Ve(n,t){if(n&1){let e=g();i(0,"button",19),p("click",function(){u(e);let c=s(3);return m(c.verEncuesta())}),o(1," Ver encuesta "),a()}}function Fe(n,t){if(n&1&&(x(0,Pe,2,0,"button",8),x(1,Se,2,0,"button",9),x(2,ke,2,0,"button",10),x(3,Te,2,0,"button",11),x(4,Me,2,0,"button",12),x(5,Ve,2,0,"button",13)),n&2){let e=s(2);f(e.puedeCancelar?0:-1),l(),f(e.puedeVerResenia?1:-1),l(),f(e.puedeCalificar?2:-1),l(),f(e.puedeVerComentarioPaciente?3:-1),l(),f(e.puedeCargarEncuesta?4:-1),l(),f(e.puedeVerEncuesta?5:-1)}}function Ae(n,t){if(n&1&&(i(0,"div",2),x(1,we,3,0,"div",6)(2,Fe,6,6),a()),n&2){let e=s();l(),f(e.verificandoEncuesta()?1:2)}}function Ie(n,t){if(n&1){let e=g();i(0,"div",2)(1,"textarea",20),w("ngModelChange",function(c){u(e);let d=s();return y(d.comentarioCancelar,c)||(d.comentarioCancelar=c),m(c)}),a(),i(2,"div",21)(3,"button",22),p("click",function(){u(e);let c=s();return m(c.cancelarAccionCancelar())}),o(4," Cancelar "),a(),i(5,"button",23),p("click",function(){u(e);let c=s();return m(c.confirmarCancelarTurno())}),o(6," Confirmar cancelaci\xF3n "),a()()()}if(n&2){let e=s();l(),E("ngModel",e.comentarioCancelar),l(4),C("disabled",!e.comentarioCancelar.trim()||e.cargando())}}function Be(n,t){if(n&1){let e=g();i(0,"div",2)(1,"textarea",24),w("ngModelChange",function(c){u(e);let d=s();return y(d.comentarioCalificar,c)||(d.comentarioCalificar=c),m(c)}),a(),i(2,"div",21)(3,"button",22),p("click",function(){u(e);let c=s();return m(c.cancelarAccionCalificar())}),o(4," Cancelar "),a(),i(5,"button",25),p("click",function(){u(e);let c=s();return m(c.confirmarCalificarAtencion())}),o(6," Enviar calificaci\xF3n "),a()()()}if(n&2){let e=s();l(),E("ngModel",e.comentarioCalificar),l(4),C("disabled",!e.comentarioCalificar.trim()||e.cargando())}}function De(n,t){if(n&1){let e=g();i(0,"div",3)(1,"h3",26),o(2," Rese\xF1a "),a(),i(3,"p",27),o(4),a(),i(5,"button",28),p("click",function(){u(e);let c=s();return m(c.volverDesdeVistaResenia())}),o(6," Volver "),a()()}if(n&2){let e=s();l(4),_(" ",e.cita.resenia||"No se ha dejado una rese\xF1a para este turno."," ")}}function Re(n,t){if(n&1){let e=g();i(0,"div",3)(1,"h3",26),o(2," Mi Comentario sobre la Atenci\xF3n "),a(),i(3,"p",27),o(4),a(),i(5,"button",28),p("click",function(){u(e);let c=s();return m(c.volverDesdeVistaComentarioPaciente())}),o(6," Volver "),a()()}if(n&2){let e=s();l(4),T(e.cita.comentarioPaciente)}}function ze(n,t){if(n&1&&(i(0,"span",44),o(1," \u2605 "),a()),n&2){let e=t.$implicit,r=s(2);N("text-yellow-400",e<=(r.encuestaExistente.estrellas||0))("text-gray-300",e>(r.encuestaExistente.estrellas||0))}}function Oe(n,t){if(n&1&&(i(0,"span",39),o(1),a()),n&2){let e=t.$implicit;l(),_(" ",e," ")}}function Ne(n,t){if(n&1){let e=g();i(0,"div",4)(1,"h3",29),o(2," Encuesta de Satisfacci\xF3n "),a(),i(3,"div",30)(4,"div",31)(5,"p",32),o(6," 1. \xBFC\xF3mo fue tu experiencia en la cita? "),a(),i(7,"p",33),o(8),a()(),i(9,"div",31)(10,"p",32),o(11," 2. \xBFQu\xE9 calificaci\xF3n le dar\xEDas a la atenci\xF3n recibida? "),a(),i(12,"div",34),h(13,ze,2,4,"span",35,k),i(15,"span",36),o(16),a()()(),i(17,"div",31)(18,"p",32),o(19," 3. \xBFC\xF3mo calificar\xEDas tu satisfacci\xF3n general? "),a(),i(20,"p",37),o(21),a()(),i(22,"div",31)(23,"p",32),o(24," 4. \xBFQu\xE9 aspectos destacar\xEDas de la atenci\xF3n? "),a(),i(25,"div",38),h(26,Oe,2,1,"span",39,k),a()(),i(28,"div",31)(29,"p",32),o(30," 5. \xBFQu\xE9 probabilidad hay de que recomiendes este servicio? "),a(),i(31,"div",40)(32,"div",41),Q(33,"div",42),a(),i(34,"span",43),o(35),a()()()(),i(36,"button",28),p("click",function(){u(e);let c=s();return m(c.volverDesdeVistaEncuesta())}),o(37," Volver "),a()()}if(n&2){let e=s();l(8),_(" ",e.encuestaExistente.textBox||"Sin respuesta"," "),l(5),v(L(6,ye)),l(3),_(" ",e.encuestaExistente.estrellas," de 5 "),l(5),_(" ",e.obtenerEtiquetaRadio(e.encuestaExistente.radioButton)," "),l(5),v(e.obtenerEtiquetasCheckbox(e.encuestaExistente.checkBox)),l(7),O("width",e.encuestaExistente.rango||0,"%"),l(2),_(" ",e.encuestaExistente.rango,"/100 ")}}function Le(n,t){if(n&1){let e=g();i(0,"app-encuesta-paciente",45),p("cerrar",function(){u(e);let c=s();return m(c.cerrarEncuesta())})("encuestaEnviada",function(){u(e);let c=s();return m(c.onEncuestaEnviada())}),a()}if(n&2){let e=s();C("cita",e.cita)("pacienteId",e.pacienteId)}}var U=class n{constructor(t,e){this.turnos=t;this.snackBar=e}cita;pacienteId;cerrar=new F;accionRealizada=new F;cargando=b(!1);verificandoEncuesta=b(!0);mostrarFormularioCancelar=!1;mostrarFormularioCalificar=!1;mostrarFormularioResenia=!1;mostrarFormularioEncuesta=!1;mostrarVistaEncuesta=!1;mostrarVistaComentarioPaciente=!1;encuestaExistente=null;opcionesRadioMap={excelente:"Excelente","muy-bueno":"Muy bueno",bueno:"Bueno",regular:"Regular",malo:"Malo"};opcionesCheckboxMap={puntualidad:"Puntualidad",profesionalismo:"Profesionalismo",claridad:"Claridad en las explicaciones",empatia:"Empat\xEDa",instalaciones:"Instalaciones limpias","tiempo-espera":"Poco tiempo de espera",seguimiento:"Buen seguimiento",recomendaria:"Lo recomendar\xEDa"};comentarioCancelar="";comentarioCalificar="";ngOnInit(){return P(this,null,function*(){yield this.verificarEncuestaExistente()})}verificarEncuestaExistente(){return P(this,null,function*(){this.verificandoEncuesta.set(!0);try{let{data:t,error:e}=yield q.from(W.ENCUESTAS_PACIENTES).select("*").eq("idCita",this.cita.citaId).single();if(e&&e.code!=="PGRST116"){console.error("Error al verificar encuesta:",e);return}this.encuestaExistente=t}catch(t){console.error("Error inesperado al verificar encuesta:",t)}finally{this.verificandoEncuesta.set(!1)}})}get puedeCancelar(){return this.cita.estado!=="completado"&&this.cita.estado!=="cancelado"&&this.cita.estado!=="rechazado"&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioResenia&&!this.mostrarVistaEncuesta&&!this.mostrarVistaComentarioPaciente}get puedeVerResenia(){return(this.cita.estado==="cancelado"||this.cita.estado==="rechazado"||this.cita.estado==="completado")&&!!this.cita.resenia&&this.cita.resenia.trim().length>0}get puedeCalificar(){let t=this.cita.comentarioPaciente&&this.cita.comentarioPaciente.trim().length>0;return this.cita.estado==="completado"&&!t&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioCancelar}get puedeVerComentarioPaciente(){return(this.cita.estado==="cancelado"||this.cita.estado==="completado")&&!!this.cita.comentarioPaciente&&this.cita.comentarioPaciente.trim().length>0&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioResenia&&!this.mostrarVistaEncuesta}get puedeCargarEncuesta(){return this.cita.estado==="completado"&&!!this.cita.resenia&&this.cita.resenia.trim().length>0&&!this.encuestaExistente&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioResenia}get puedeVerEncuesta(){return this.cita.estado==="completado"&&!!this.encuestaExistente&&!this.mostrarFormularioCalificar&&!this.mostrarFormularioCancelar&&!this.mostrarFormularioResenia}cancelarAccionCancelar(){this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}confirmarCancelarTurno(){this.comentarioCancelar.trim()&&(this.cargando.set(!0),this.turnos.cancelarCitaPaciente(this.cita,this.comentarioCancelar.trim()).then(t=>{this.cargando.set(!1),t.success?(this.snackBar.open("Turno cancelado exitosamente.","Cerrar",{duration:3e3}),this.accionRealizada.emit("cancelado"),this.cerrar.emit()):this.snackBar.open(t.message??"Ocurri\xF3 un error","Cerrar",{duration:4e3})}).finally(()=>{this.mostrarFormularioCancelar=!1,this.comentarioCancelar=""}))}cancelarAccionCalificar(){this.mostrarFormularioCalificar=!1,this.comentarioCalificar=""}confirmarCalificarAtencion(){if(!this.comentarioCalificar.trim()){this.snackBar.open("Por favor, ingres\xE1 un comentario antes de enviar.","Cerrar",{duration:3e3,panelClass:["bg-red-600","text-white"]});return}this.cargando.set(!0),this.turnos.cargarComentarioAtencion(this.cita,this.comentarioCalificar.trim()).then(t=>{this.cargando.set(!1),t.success?(this.snackBar.open("Atenci\xF3n calificada exitosamente.","Cerrar",{duration:3e3}),this.accionRealizada.emit("calificacion"),this.cerrar.emit()):this.snackBar.open(t.message??"Ocurri\xF3 un error","Cerrar",{duration:4e3})}).finally(()=>{this.mostrarFormularioCalificar=!1,this.comentarioCalificar=""})}verResenia(){this.mostrarFormularioResenia=!0}volverDesdeVistaResenia(){this.mostrarFormularioResenia=!1}verComentarioPaciente(){this.mostrarVistaComentarioPaciente=!0}volverDesdeVistaComentarioPaciente(){this.mostrarVistaComentarioPaciente=!1}abrirEncuesta(){this.mostrarFormularioEncuesta=!0}cerrarEncuesta(){this.mostrarFormularioEncuesta=!1}verEncuesta(){this.mostrarVistaEncuesta=!0}volverDesdeVistaEncuesta(){this.mostrarVistaEncuesta=!1}onEncuestaEnviada(){return P(this,null,function*(){this.mostrarFormularioEncuesta=!1,yield this.verificarEncuestaExistente(),this.accionRealizada.emit("encuesta")})}obtenerEtiquetaRadio(t){return t?this.opcionesRadioMap[t]||t:"Sin respuesta"}obtenerEtiquetasCheckbox(t){return t?t.split(",").map(e=>e.trim()).filter(e=>e).map(e=>this.opcionesCheckboxMap[e]||e):[]}cerrarModal(){this.cerrar.emit()}static \u0275fac=function(e){return new(e||n)(S(G),S(j))};static \u0275cmp=V({type:n,selectors:[["app-acciones-paciente"]],inputs:{cita:"cita",pacienteId:"pacienteId"},outputs:{cerrar:"cerrar",accionRealizada:"accionRealizada"},decls:9,vars:7,consts:[["tabindex","0","role","button","aria-label","Cerrar modal",1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm"],["appClickFueraPopup","","tabindex","0","role","dialog","aria-modal","true",1,"fixed","top-1/2","left-1/2","z-50","w-full","max-w-md","-translate-x-1/2","-translate-y-1/2","transform","items-center","justify-center","rounded-2xl","bg-white","p-11","shadow-lg",3,"clickFuera"],[1,"flex","flex-col","gap-3"],[1,"flex","flex-col","items-center","gap-4","text-center"],[1,"flex","max-h-[70vh]","flex-col","gap-4","overflow-y-auto"],[3,"cita","pacienteId"],[1,"flex","items-center","justify-center","py-4"],[1,"text-sm","text-gray-500"],[1,"rounded-lg","bg-red-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-red-700"],[1,"rounded-lg","bg-blue-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-blue-700"],[1,"rounded-lg","bg-purple-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-purple-700"],[1,"rounded-lg","bg-indigo-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-indigo-700"],[1,"rounded-lg","bg-green-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-green-700"],[1,"rounded-lg","bg-teal-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-teal-700"],[1,"rounded-lg","bg-red-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-red-700",3,"click"],[1,"rounded-lg","bg-blue-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-blue-700",3,"click"],[1,"rounded-lg","bg-purple-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-purple-700",3,"click"],[1,"rounded-lg","bg-indigo-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-indigo-700",3,"click"],[1,"rounded-lg","bg-green-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-green-700",3,"click"],[1,"rounded-lg","bg-teal-600","px-4","py-2","font-semibold","text-white","transition-transform","hover:scale-105","hover:bg-teal-700",3,"click"],["placeholder","Ingrese el motivo de cancelaci\xF3n","rows","3",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-red-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-3"],["type","button",1,"rounded","border","border-gray-400","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],["type","button",1,"rounded","bg-red-600","px-4","py-2","text-sm","font-semibold","text-white","hover:bg-red-700","disabled:opacity-50",3,"click","disabled"],["placeholder","Dej\xE1 un comentario sobre la atenci\xF3n recibida","rows","3",1,"w-full","resize-none","rounded","border","border-gray-300","px-3","py-2","text-sm","focus:ring-2","focus:ring-purple-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","button",1,"rounded","bg-purple-600","px-4","py-2","text-sm","font-semibold","text-white","hover:bg-purple-700","disabled:opacity-50",3,"click","disabled"],[1,"text-xl","font-bold","text-[color:var(--color-azul-oscuro)]"],[1,"px-2","text-gray-700","italic"],[1,"mt-4","rounded","bg-gray-300","px-4","py-2","text-sm","font-semibold","text-gray-800","hover:bg-gray-400",3,"click"],[1,"text-center","text-xl","font-bold","text-azul-oscuro"],[1,"space-y-4"],[1,"rounded-lg","bg-gray-50","p-4"],[1,"mb-2","text-sm","font-semibold","text-azul-oscuro"],[1,"text-sm","text-gray-700","italic"],[1,"flex","items-center","gap-1"],[1,"text-2xl",3,"text-yellow-400","text-gray-300"],[1,"ml-2","text-sm","text-gray-600"],[1,"text-sm","text-gray-700"],[1,"flex","flex-wrap","gap-2"],[1,"rounded-full","bg-azul-oscuro","px-3","py-1","text-xs","text-white"],[1,"flex","items-center","gap-3"],[1,"h-2","flex-1","rounded-full","bg-gray-200"],[1,"h-2","rounded-full","bg-azul-oscuro"],[1,"text-lg","font-bold","text-azul-oscuro"],[1,"text-2xl"],[3,"cerrar","encuestaEnviada","cita","pacienteId"]],template:function(e,r){e&1&&(Q(0,"div",0),i(1,"div",1),p("clickFuera",function(){return r.cerrarModal()}),x(2,Ae,3,1,"div",2),x(3,Ie,7,2,"div",2),x(4,Be,7,2,"div",2),x(5,De,7,1,"div",3),x(6,Re,7,1,"div",3),x(7,Ne,38,7,"div",4),a(),x(8,Le,1,2,"app-encuesta-paciente",5)),e&2&&(l(2),f(!r.mostrarFormularioCancelar&&!r.mostrarFormularioCalificar&&!r.mostrarFormularioResenia&&!r.mostrarVistaEncuesta&&!r.mostrarVistaComentarioPaciente?2:-1),l(),f(r.mostrarFormularioCancelar?3:-1),l(),f(r.mostrarFormularioCalificar?4:-1),l(),f(r.mostrarFormularioResenia?5:-1),l(),f(r.mostrarVistaComentarioPaciente?6:-1),l(),f(r.mostrarVistaEncuesta&&r.encuestaExistente?7:-1),l(),f(r.mostrarFormularioEncuesta?8:-1))},dependencies:[I,z,B,D,R,H,$],encapsulation:2})};function qe(n,t){if(n&1){let e=g();i(0,"app-acciones-paciente",11),p("cerrar",function(){u(e);let c=s();return m(c.cerrarPopupAcciones())})("accionRealizada",function(){u(e);let c=s();return m(c.accionDesdeModal())}),a()}if(n&2){let e=s();C("cita",e.citaSeleccionada())("pacienteId",e.usuarioActual.id)}}function We(n,t){if(n&1&&(i(0,"th",10),o(1),a()),n&2){let e=t.$implicit;l(),T(e.label)}}function je(n,t){if(n&1&&(i(0,"div")(1,"strong"),o(2),a(),o(3),a()),n&2){let e=t.$implicit;l(2),_("",e.clave,":"),l(),_(" ",e.valor)}}function He(n,t){if(n&1&&(i(0,"tr")(1,"td",19)(2,"div",20),h(3,je,4,2,"div",null,k),a()()()),n&2){let e=s().$implicit;l(3),v(e.datosDinamicos)}}function Ge(n,t){if(n&1){let e=g();i(0,"tr",12),p("click",function(){let c=u(e).$implicit,d=s(2);return m(d.toggleFilaExpandida(c.citaId))}),i(1,"td",13),o(2),a(),i(3,"td",13),o(4),M(5,"date"),a(),i(6,"td",14),o(7),M(8,"titlecase"),a(),i(9,"td",13),o(10),M(11,"unidadMedida"),a(),i(12,"td",13),o(13),M(14,"unidadMedida"),a(),i(15,"td",13),o(16),M(17,"unidadMedida"),a(),i(18,"td",13),o(19),M(20,"unidadMedida"),a(),i(21,"td",13),o(22),a(),i(23,"td",13),o(24),a(),i(25,"td",13),o(26),a(),i(27,"td",15)(28,"button",16),o(29),a()(),i(30,"td",17)(31,"button",18),p("click",function(){let c=u(e).$implicit,d=s(2);return m(d.abrirPopupAcciones(c))}),o(32," Acciones "),a()()(),x(33,He,5,0,"tr")}if(n&2){let e=t.$implicit,r=s(2);O("background-color",r.filaExpandida()===e.citaId?"rgba(46, 64, 45, 0.2)":null),l(2),T(e.citaId),l(2),_(" ",A(5,15,e.fechaHora,"short")," "),l(2),C("appColorEstado",e.estado),l(),_(" ",J(8,18,e.estado)," "),l(3),_(" ",A(11,20,e.alturaCm,"altura")," "),l(3),_(" ",A(14,23,e.pesoKg,"peso")," "),l(3),_(" ",A(17,26,e.temperaturaC,"temperatura")," "),l(3),_(" ",A(20,29,e.presionArterial,"presion")," "),l(3),_(" ",e.pacienteNombreCompleto," "),l(2),_(" ",e.especialistaNombreCompleto," "),l(2),_(" ",e.especialidadNombre," "),l(3),_(" ",r.filaExpandida()===e.citaId?"Ocultar":"Mostrar"," "),l(4),f(r.filaExpandida()===e.citaId?33:-1)}}function $e(n,t){if(n&1&&h(0,Ge,34,32,null,null,k),n&2){let e=s();v(e.citasFiltradas)}}function Ue(n,t){n&1&&(i(0,"tr")(1,"td",21),o(2," Cargando datos... "),a()())}var xe=class n{constructor(t,e,r){this.turnosService=t;this.authSupabase=e;this.loading=r;this.usuario$=this.authSupabase.user$}usuario$;usuarioActual=null;destroy$=new K;citas=b([]);filaExpandida=b(null);cargando=b(!0);citaSeleccionada=b(null);mostrarPopupAcciones=!1;columnas=[{key:"citaId",label:"ID"},{key:"fechaHora",label:"Fecha/Hora"},{key:"estado",label:"Estado"},{key:"alturaCm",label:"Altura"},{key:"pesoKg",label:"Peso"},{key:"temperaturaC",label:"Temperatura"},{key:"presionArterial",label:"Presi\xF3n arterial"},{key:"pacienteNombreCompleto",label:"Paciente"},{key:"especialistaNombreCompleto",label:"Especialista"},{key:"especialidadNombre",label:"Especialidad"}];columnasConDatosDinamicos=[...this.columnas,{key:"datosDinamicos",label:"Datos din\xE1micos"}];_filtroValor=b("");get filtroValorModel(){return this._filtroValor()}set filtroValorModel(t){this._filtroValor.set(t)}ngOnInit(){return P(this,null,function*(){this.usuario$.pipe(Z(this.destroy$)).subscribe(t=>{if(!t){this.usuarioActual=null;return}t.id=typeof t.id=="string"?Number(t.id):t.id,this.usuarioActual=t,this.cargarCitas()})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarCitas(){return P(this,null,function*(){this.cargando.set(!0);try{if(this.usuarioActual?.id!=null){let t=yield this.turnosService.obtenerCitasPaciente(this.usuarioActual.id);this.citas.set(t)}}catch(t){console.error("Error al obtener citas",t)}finally{this.cargando.set(!1),this.loading.hide()}})}toggleFilaExpandida(t){this.filaExpandida.set(this.filaExpandida()===t?null:t)}get citasFiltradas(){return se(this.citas(),this._filtroValor())}limpiarFiltro(){this._filtroValor.set("")}abrirPopupAcciones(t){this.citaSeleccionada.set(t),this.mostrarPopupAcciones=!0}cerrarPopupAcciones(){this.mostrarPopupAcciones=!1,this.citaSeleccionada.set(null)}accionDesdeModal(){this.cerrarPopupAcciones(),this.cargarCitas()}static \u0275fac=function(e){return new(e||n)(S(G),S(oe),S(ce))};static \u0275cmp=V({type:n,selectors:[["app-mis-turnos-paciente"]],decls:18,vars:3,consts:[[1,"h-full","w-full","p-1"],[1,"h-full","w-full","overflow-auto","rounded-2xl","border","border-white","bg-[color:var(--color-crema)]","p-6","shadow-inner"],[1,"mb-4","flex","flex-wrap","items-center","gap-3"],["for","filtro",1,"text-sm","font-semibold","text-[color:var(--color-azul-oscuro)]"],["id","filtro","type","text","placeholder","Ingres\xE1 filtro",1,"w-64","rounded","border","border-gray-300","px-3","py-1","text-sm","focus:ring-2","focus:ring-[color:var(--color-azul-oscuro)]","focus:outline-none",3,"ngModelChange","ngModel"],["type","button",1,"rounded","bg-[color:var(--color-azul-oscuro)]","px-3","py-1","text-sm","font-semibold","text-white","shadow","transition-transform","hover:scale-105","hover:bg-[color:var(--color-azul-claro)]",3,"click"],[1,"ml-auto"],[3,"cita","pacienteId"],[1,"min-w-full","border-collapse","border","border-gray-300","text-sm"],[1,"bg-[color:var(--color-azul-claro)]","text-[color:var(--color-azul-oscuro)]"],[1,"border","border-gray-300","px-3","py-2"],[3,"cerrar","accionRealizada","cita","pacienteId"],[1,"cursor-pointer","border","border-gray-300","transition-colors","duration-150","hover:bg-[color:var(--color-verde-claro)]",3,"click"],[1,"border","border-gray-300","px-3","py-1"],[1,"rounded","border","border-gray-300","px-3","py-1","text-center","font-semibold",3,"appColorEstado"],[1,"border","border-gray-300","px-3","py-1","text-center"],["type","button",1,"text-[color:var(--color-azul-oscuro)]","underline","hover:text-[color:var(--color-azul-claro)]"],[1,"border","border-gray-300","bg-green-200","px-3","py-1","text-center","hover:bg-green-500"],["type","button",1,"font-bold","text-[color:var(--color-azul-oscuro)]","hover:text-[color:var(--color-white)]",3,"click"],["colspan","11",1,"border","border-gray-300","bg-[color:var(--color-crema)]","px-3","py-2","text-[color:var(--color-azul-oscuro)]"],[1,"grid","grid-cols-2","gap-4"],["colspan","11",1,"border","border-gray-300","px-3","py-6","text-center","font-semibold","text-[color:var(--color-azul-oscuro)]"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),o(4," Filtrar: "),a(),i(5,"input",4),w("ngModelChange",function(d){return y(r.filtroValorModel,d)||(r.filtroValorModel=d),d}),a(),i(6,"button",5),p("click",function(){return r.limpiarFiltro()}),o(7," Limpiar "),a(),i(8,"div",6),x(9,qe,1,2,"app-acciones-paciente",7),a()(),i(10,"table",8)(11,"thead")(12,"tr",9),h(13,We,2,1,"th",10,k),a()(),i(15,"tbody"),x(16,$e,2,0)(17,Ue,3,0,"tr"),a()()()()),e&2&&(l(5),E("ngModel",r.filtroValorModel),l(4),f(r.mostrarPopupAcciones&&r.citaSeleccionada()&&r.usuarioActual?9:-1),l(4),v(r.columnasConDatosDinamicos),l(3),f(r.cargando()?17:16))},dependencies:[I,z,B,D,R,U,le,X,Y,de],encapsulation:2})};export{xe as MisTurnosPaciente};
