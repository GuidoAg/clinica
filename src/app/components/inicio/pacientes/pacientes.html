<div class="flex h-full w-full gap-4 p-1">
  <div
    class="h-full min-w-0 overflow-auto rounded-2xl border border-white bg-crema p-6 pb-6 shadow-inner transition-all duration-700 ease-in-out"
    [style.width]="pacienteSeleccionado() ? '65%' : '100%'"
  >
    @if (cargando()) {
    <div>
      <p class="text-center text-gray-500">Cargando pacientes...</p>
    </div>
    } @if (!cargando() && pacientesConCitas.length > 0) {
    <div
      class="grid gap-6 transition-all duration-700 ease-in-out"
      style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr))"
    >
      @for (item of pacientesConCitas; track item) {
      <div
        @scaleIn
        class="h-auto cursor-pointer rounded-lg border border-gray-300 bg-white p-4 shadow-sm transition-all duration-700 ease-in-out hover:shadow-md"
        [class.pointer-events-none]="panelAnimando()"
        (click)="seleccionarPaciente(item)"
        (keyup.enter)="seleccionarPaciente(item)"
        tabindex="0"
        role="button"
        [attr.aria-label]="'Ver detalles de ' + item.paciente.nombre"
      >
        @if (item.paciente.urlImagenPerfil) {
        <img
          [src]="item.paciente.urlImagenPerfil"
          alt="Avatar"
          class="mb-2 h-14 w-14 rounded-full object-cover"
          appTrackImage
        />
        }
        <div class="text-sm">
          <p class="font-semibold text-azul-oscuro">
            {{ item.paciente.nombre }} {{ item.paciente.apellido }}
          </p>
          <p class="text-gray-600">{{ item.paciente.email }}</p>
          <p>DNI: {{ item.paciente.dni }}</p>
          <p>Edad: {{ item.paciente.edad }}</p>
          <p class="mt-2 font-semibold text-gray-700">Últimos 3 turnos:</p>
          <ul class="list-inside list-disc text-sm text-gray-600">
            @for (cita of item.citas; track cita) {
            <li>
              • {{ cita.fechaHora | date: 'short' }} – {{
              cita.especialidadNombre }}
            </li>
            }
          </ul>
          <button
            type="button"
            class="mt-3 rounded bg-indigo-600 px-3 py-1 text-sm font-semibold text-white transition hover:bg-indigo-700"
          >
            Ver historia clínica
          </button>
        </div>
      </div>
      }
    </div>
    } @if (!cargando() && pacientesConCitas.length === 0) {
    <div class="text-center text-gray-500">
      No se encontraron pacientes atendidos.
    </div>
    }
  </div>

  <!-- Panel lateral siempre presente pero oculto cuando no hay paciente seleccionado -->
  <div
    class="flex h-full flex-col overflow-hidden rounded-2xl bg-white p-6 transition-all duration-700 ease-in-out"
    [style.width]="pacienteSeleccionado() ? '35%' : '0'"
    [style.opacity]="pacienteSeleccionado() ? '1' : '0'"
    [style.padding]="pacienteSeleccionado() ? '1.5rem' : '0'"
    [class.pointer-events-none]="!pacienteSeleccionado()"
  >
    @if (pacienteSeleccionado()) {
    <button
      class="mb-4 self-start rounded border border-gray-400 px-4 py-2 text-sm text-gray-700 transition hover:bg-gray-100"
      (click)="cerrarHistoriaClinica()"
    >
      ← Volver a pacientes
    </button>
    <h2 class="mb-4 text-xl font-semibold text-azul-oscuro">
      Historia clínica de {{ pacienteSeleccionado()?.paciente?.nombre }} {{
      pacienteSeleccionado()?.paciente?.apellido }}
    </h2>
    <div class="overflow-y-auto pr-2">
      @for (cita of pacienteSeleccionado()?.citas; track cita) {
      <div class="mb-4 rounded border border-gray-200 bg-gray-50 p-4">
        <p><strong>Fecha:</strong> {{ cita.fechaHora | date:'short' }}</p>
        <p><strong>Especialidad:</strong> {{ cita.especialidadNombre }}</p>
        <p>
          <strong>Altura:</strong> {{ cita.alturaCm | unidadMedida:'altura' }}
        </p>
        <p><strong>Peso:</strong> {{ cita.pesoKg | unidadMedida:'peso' }}</p>
        <p>
          <strong>Temperatura:</strong> {{ cita.temperaturaC |
          unidadMedida:'temperatura' }}
        </p>
        <p>
          <strong>Presión arterial:</strong> {{ cita.presionArterial |
          unidadMedida:'presion' }}
        </p>
        <p><strong>Datos dinámicos:</strong></p>
        <ul class="list-inside list-disc text-sm">
          @for (d of cita.datosDinamicos; track d) {
          <li>{{ d.clave }}: {{ d.valor }}</li>
          }
        </ul>
      </div>
      }
    </div>
    }
  </div>
</div>
