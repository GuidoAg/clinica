<app-loading-wrapper>
  <div class="h-full w-full p-1">
    <div
      class="h-full w-full overflow-auto rounded-2xl border border-white bg-crema p-6 pb-6 shadow-inner"
    >
      <div class="flex flex-wrap items-center justify-between pb-7">
        <div class="flex flex-wrap gap-2">
          <button
            (click)="solapaActiva = 'pacientes'"
            [class.border-b-2]="solapaActiva === 'pacientes'"
            [class.border-azul-oscuro]="solapaActiva === 'pacientes'"
            [class.text-azul-oscuro]="solapaActiva === 'pacientes'"
            class="px-4 py-2 font-semibold text-gray-600 hover:text-azul-oscuro"
          >
            Pacientes
          </button>

          <button
            (click)="solapaActiva = 'especialistas'"
            [class.border-b-2]="solapaActiva === 'especialistas'"
            [class.border-azul-oscuro]="solapaActiva === 'especialistas'"
            [class.text-azul-oscuro]="solapaActiva === 'especialistas'"
            class="px-4 py-2 font-semibold text-gray-600 hover:text-azul-oscuro"
          >
            Especialistas
          </button>

          <button
            (click)="solapaActiva = 'administradores'"
            [class.border-b-2]="solapaActiva === 'administradores'"
            [class.border-azul-oscuro]="solapaActiva === 'administradores'"
            [class.text-azul-oscuro]="solapaActiva === 'administradores'"
            class="px-4 py-2 font-semibold text-gray-600 hover:text-azul-oscuro"
          >
            Administradores
          </button>
        </div>

        <div class="mr-10 flex gap-3">
          <button
            class="btn h-12 rounded-2xl border-2 border-azul-oscuro bg-white px-6 py-2 text-base text-azul-oscuro transition-all duration-50 hover:bg-azul-oscuro hover:text-white"
            (click)="exportarUsuariosAExcel()"
            title="Exportar usuarios a Excel"
          >
            ðŸ“Š Exportar Excel
          </button>

          <button
            class="btn btn-primary h-12 rounded-2xl bg-azul-oscuro px-6 py-2 text-base text-white transition-all duration-50 hover:bg-azul-claro hover:text-lg"
            (click)="abrirPopupAltas()"
          >
            Dar Alta Usuario
          </button>
        </div>
      </div>

      @if (mostrarPopupAltas) {
      <app-altas-admin
        (cerrar)="cerrarPopupAltas()"
        (altaExitosa)="onAltaExitosa()"
      ></app-altas-admin>
      } @if (solapaActiva === 'pacientes') {
      <div
        class="grid justify-center gap-x-1 gap-y-3"
        style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr))"
      >
        @for (usuario of pacientes; track usuario) {
        <div
          @scaleIn
          class="relative w-full rounded-lg border border-gray-300 bg-white p-4 shadow-sm"
        >
          <button
            (click)="exportarTurnosPaciente(usuario, $event)"
            class="absolute top-2 right-2 flex h-8 w-8 items-center justify-center rounded-full bg-verde-oscuro text-white transition-all hover:scale-110 hover:bg-verde-claro"
            title="Descargar historial de turnos"
          >
            <span class="material-icons text-lg">download</span>
          </button>

          @if (usuario.urlImagenPerfil) {
          <img
            [src]="usuario.urlImagenPerfil"
            alt="Avatar"
            class="mb-2 h-14 w-14 rounded-full object-cover"
            appTrackImage
          />
          }
          <div class="text-sm">
            <p class="font-semibold text-azul-oscuro">
              {{ usuario.nombre }} {{ usuario.apellido }}
            </p>
            <p class="text-gray-600">{{ usuario.email }}</p>
            <p>DNI: {{ usuario.dni }}</p>
            <p>Edad: {{ usuario.edad }}</p>
            <p>
              Email verificado:
              <span
                [ngClass]="usuario.emailVerificado ? 'text-verde-oscuro' : 'text-red-600'"
              >
                {{ usuario.emailVerificado ? 'Verificado' : 'Sin Verificar' }}
              </span>
            </p>
          </div>
        </div>
        }
      </div>
      } @if (solapaActiva === 'especialistas') {
      <div
        class="grid justify-center gap-x-1 gap-y-3"
        style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr))"
      >
        @for (usuario of especialistas; track usuario) {
        <div
          @scaleIn
          class="w-full rounded-lg border border-gray-300 bg-white p-4 shadow-sm"
        >
          @if (usuario.urlImagenPerfil) {
          <img
            [src]="usuario.urlImagenPerfil"
            alt="Avatar"
            class="mb-2 h-14 w-14 rounded-full object-cover"
            appTrackImage
          />
          }
          <div class="text-sm">
            <p class="font-semibold text-azul-oscuro">
              {{ usuario.nombre }} {{ usuario.apellido }}
            </p>
            <p class="text-gray-600">{{ usuario.email }}</p>
            <p>DNI: {{ usuario.dni }}</p>
            <p>Edad: {{ usuario.edad }}</p>
            <p>
              Email verificado:
              <span
                [ngClass]="usuario.emailVerificado ? 'text-verde-oscuro' : 'text-red-600'"
              >
                {{ usuario.emailVerificado ? 'Verificado' : 'Sin Verificar' }}
              </span>
            </p>
            <p>
              Estado:
              <span
                [ngClass]="usuario.validadoAdmin ? 'text-verde-oscuro' : 'text-red-600'"
              >
                {{ usuario.validadoAdmin ? 'Habilitado' : 'Inhabilitado' }}
              </span>
            </p>
          </div>
          <button
            class="mt-2 w-full rounded bg-azul-claro px-3 py-1 text-sm text-white hover:bg-azul-oscuro"
            (click)="toggleValidadoAdmin(usuario)"
          >
            {{ usuario.validadoAdmin ? 'Deshabilitar' : 'Habilitar' }}
          </button>
        </div>
        }
      </div>
      } @if (solapaActiva === 'administradores') {
      <div
        class="grid justify-center gap-x-1 gap-y-3"
        style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr))"
      >
        @for (usuario of administradores; track usuario) {
        <div
          @scaleIn
          class="w-full rounded-lg border border-gray-300 bg-white p-4 shadow-sm"
        >
          @if (usuario.urlImagenPerfil) {
          <img
            [src]="usuario.urlImagenPerfil"
            alt="Avatar"
            class="mb-2 h-14 w-14 rounded-full object-cover"
            appTrackImage
          />
          }
          <div class="text-sm">
            <p class="font-semibold text-azul-oscuro">
              {{ usuario.nombre }} {{ usuario.apellido }}
            </p>
            <p class="text-gray-600">{{ usuario.email }}</p>
            <p>DNI: {{ usuario.dni }}</p>
            <p>Edad: {{ usuario.edad }}</p>
            <p>
              Email verificado:
              <span
                [ngClass]="usuario.emailVerificado ? 'text-verde-oscuro' : 'text-red-600'"
              >
                {{ usuario.emailVerificado ? 'Verificado' : 'Sin Verificar' }}
              </span>
            </p>
          </div>
        </div>
        }
      </div>
      }
    </div>
  </div>
</app-loading-wrapper>
